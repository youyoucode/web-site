!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},SceneManager_1=require("./manager/SceneManager"),MainScene_1=require("./view/mainscene/MainScene"),NetManager_1=require("./model/net/NetManager"),ResizeManager_1=require("./manager/ResizeManager"),LayerManager_1=require("./manager/LayerManager"),PopUpManager_1=require("./base/popup/PopUpManager"),AssetAdapter_1=require("./themes/AssetAdapter"),ThemeAdapter_1=require("./themes/ThemeAdapter"),GameStartLoading_1=require("./view/loading/GameStartLoading"),DataAccessEntry_1=require("./model/DataAccessEntry"),ToolTipManager_1=require("./base/tip/ToolTipManager"),Button=eui.Button,SoundManager_1=require("./manager/SoundManager"),DataAccessManager_1=require("./base/da/DataAccessManager"),TweenLiteDriver_1=require("./base/utils/TweenLiteDriver"),ToastManager_1=require("../src/view/common/ToastManager"),WindowManager_1=require("./base/popup/WindowManager"),Platform_1=require("./platforms/Platform"),IDChooseWindow_1=require("./view/teach/IDChooseWindow"),Main=function(_super){function Main(){_super.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this)}return __extends(Main,_super),Main.prototype.onAddedToStage=function(event){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter_1.AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter_1.ThemeAdapter),ResizeManager_1.default.init(),DataAccessEntry_1.default.init(),LayerManager_1.default.init(this.stage),SceneManager_1.default.getInstance().init(LayerManager_1.default.appLayer),PopUpManager_1.default.init(LayerManager_1.default.popLayer),mouse.enable(this.stage),ToolTipManager_1.default.init(LayerManager_1.default.tipLayer),TweenLiteDriver_1.default.init(),TweenLiteDriver_1.default.setFps(30),ToastManager_1.default.init(LayerManager_1.default.tipLayer),this._loadingView=new GameStartLoading_1.default,LayerManager_1.default.stage.addChild(this._loadingView),this._loadingView.load(),this._loadingView.addEventListener("allLoadComplete",this.initGame,this),this.addButtonSoundEffect()},Main.prototype.onCheckMe=function(result){if(1==result.state){NetManager_1.default.getInstance().userName=Platform_1.default.currentPlatform.openUserId;var maliPlatform_1=Platform_1.default.currentPlatform;maliPlatform_1.getClasses(function(classInfoes){if(classInfoes.length>1)WindowManager_1.default.showWindow(IDChooseWindow_1.default,"IDChooseWindow","",classInfoes);else{if(0==classInfoes.length)return maliPlatform_1.idType="other",maliPlatform_1.userStatusInClass="notInClass",void NetManager_1.default.getInstance().init();var classInfo=classInfoes[0];maliPlatform_1.joinedClass=classInfo.joinedClass,maliPlatform_1.classTeacherId=classInfo.teacherId,maliPlatform_1.classTeacherName=classInfo.teacherName,maliPlatform_1.classId=classInfo.id,maliPlatform_1.className=classInfo.name,maliPlatform_1.inviteCode=classInfo.invitationCode,maliPlatform_1.idType=classInfo.idType,maliPlatform_1.timeSpan=classInfo.timeSpan,maliPlatform_1.sync=classInfo.sync,maliPlatform_1.price=classInfo.price,maliPlatform_1.userStatusInClass=classInfo.userStatusInClass,NetManager_1.default.getInstance().init()}})}else 2==result.state?(console.log("ANONYMOUS!!"),NetManager_1.default.getInstance().userName=Platform_1.default.currentPlatform.openUserId,NetManager_1.default.getInstance().init()):(console.log("OFFLINE,REQUEST ANONYMOUSE ACCOUNT!!"),Platform_1.default.currentPlatform.reload());console.log(Platform_1.default.currentPlatform)},Main.prototype.addButtonSoundEffect=function(){var soundFilters=["btnClose","fightBtn"];this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,function(event){var target=event.target;console.log("[Main.addButtonSoundEffect]",target.name,event.stageX,event.stageY),target instanceof Button&&-1==soundFilters.indexOf(target.name)&&SoundManager_1.default.getInstance().playEffect("u01_button_mp3")},this,!0)},Main.prototype.initGame=function(event){this._loadingView.removeEventListener("allLoadComplete",this.initGame,this),NetManager_1.default.getInstance().addEventListener(NetManager_1.default.SERVERINITIALLED,this.enterGame,this),0==NetManager_1.default.getInstance().userName.length&&(NetManager_1.default.getInstance().userName=egret.localStorage.getItem("login_name")),NetManager_1.default.getInstance().init()},Main.prototype.enterGame=function(event){DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).addSocketPushes(),NetManager_1.default.getInstance().removeEventListener(NetManager_1.default.SERVERINITIALLED,this.enterGame,this),SceneManager_1.default.getInstance().pushScene(new MainScene_1.default,1)},Main.prototype.addChild=function(child){if(child)throw new Error("不能直接添加子对象在本容器内！");return child},Main}(eui.UILayer);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Main},{"../src/view/common/ToastManager":117,"./base/da/DataAccessManager":2,"./base/popup/PopUpManager":9,"./base/popup/WindowManager":13,"./base/tip/ToolTipManager":17,"./base/utils/TweenLiteDriver":23,"./manager/LayerManager":55,"./manager/ResizeManager":56,"./manager/SceneManager":57,"./manager/SoundManager":58,"./model/DataAccessEntry":59,"./model/net/NetManager":68,"./platforms/Platform":81,"./themes/AssetAdapter":83,"./themes/ThemeAdapter":84,"./view/loading/GameStartLoading":137,"./view/mainscene/MainScene":144,"./view/teach/IDChooseWindow":153}],2:[function(require,module,exports){"use strict";var DataAccessManager=function(){function DataAccessManager(){}return DataAccessManager.addAccess=function(da){DataAccessManager._das[da.name]=da},DataAccessManager.getAccess=function(daName){return DataAccessManager._das[daName]},DataAccessManager.removeAccess=function(daName){delete DataAccessManager._das[daName]},DataAccessManager._das={},DataAccessManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DataAccessManager},{}],3:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},EventDispatcher=egret.EventDispatcher,DataAccessProxy=function(_super){function DataAccessProxy(name,data,target){_super.call(this,target),this._name=name,this._data=data}return __extends(DataAccessProxy,_super),Object.defineProperty(DataAccessProxy.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(DataAccessProxy.prototype,"data",{get:function(){return this._data},set:function(dat){this._data=dat},enumerable:!0,configurable:!0}),DataAccessProxy.prototype.dispose=function(){this._data=null},DataAccessProxy}(EventDispatcher);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DataAccessProxy},{}],4:[function(require,module,exports){"use strict";var BaseInfo=function(){function BaseInfo(){}return BaseInfo.prototype.update=function(newProperties){},BaseInfo.prototype.clone=function(){return null},BaseInfo}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BaseInfo},{}],5:[function(require,module,exports){"use strict";var AStar=function(){function AStar(){}return AStar.getInstance=function(){return null==this._instance&&(this._instance=new AStar),this._instance},AStar.prototype.inList=function(list,current){for(var i=0,len=list.length;i<len;i++)if(current.y==list[i].y&&current.x==list[i].x)return!0;return!1},AStar.prototype.getRounds=function(points,current){var rounds=[];return current.y-1>=0&&0==points[current.x][current.y-1]&&rounds.push(new egret.Point(current.x,current.y-1)),current.x-1>=0&&0==points[current.x-1][current.y]&&rounds.push(new egret.Point(current.x-1,current.y)),current.y+1<points[1].length&&0==points[current.x][current.y+1]&&rounds.push(new egret.Point(current.x,current.y+1)),current.x+1<points.length&&0==points[current.x+1][current.y]&&rounds.push(new egret.Point(current.x+1,current.y)),current.y+1<points[1].length&&current.x+1<points.length&&0==points[current.x+1][current.y+1]&&rounds.push(new egret.Point(current.x+1,current.y+1)),current.y-1>=0&&current.x+1<points.length&&0==points[current.x+1][current.y-1]&&rounds.push(new egret.Point(current.x+1,current.y-1)),current.y+1<points[1].length&&current.x-1>=0&&0==points[current.x-1][current.y+1]&&rounds.push(new egret.Point(current.x-1,current.y+1)),current.y-1>=0&&current.x-1>=0&&0==points[current.x-1][current.y-1]&&rounds.push(new egret.Point(current.x-1,current.y-1)),rounds},AStar.prototype.findPath=function(person,start,endPos){var end=endPos;if(null==person.gameWorld)return[];if(0==person.gameWorld.checkTilePassable(person,new egret.Point(endPos.x,endPos.y)))for(var targetPoints=[],i=1;i<30;i++){for(var j=0;j<2*i;j++){var x=endPos.x-i+j,y=endPos.y-i;if(person.gameWorld.checkTilePassable(person,new egret.Point(x,y))){targetPoints.push(new egret.Point(x,y));break}}for(var j=0;j<2*i;j++){var x=endPos.x+i,y=endPos.y-i+j;if(person.gameWorld.checkTilePassable(person,new egret.Point(x,y))){targetPoints.push(new egret.Point(x,y));break}}for(var j=0;j<2*i;j++){var x=endPos.x+i-j,y=endPos.y+i;if(person.gameWorld.checkTilePassable(person,new egret.Point(x,y))){targetPoints.push(new egret.Point(x,y));break}}for(var j=0;j<2*i;j++){var x=endPos.x-i,y=endPos.y+i-j;if(person.gameWorld.checkTilePassable(person,new egret.Point(x,y))){targetPoints.push(new egret.Point(x,y));break}}if(targetPoints.length>0){for(var targetPoint,j=0;j<targetPoints.length;j++)egret.Point.distance(start,targetPoints[j]),targetPoint=targetPoints[j];end=targetPoint;break}}var opens=[],closes=[],cur=null,bFind=!0;for(start.F=0,start.G=0,start.H=0,closes.push(start),cur=start,Math.abs(start.x-end.x)+Math.abs(start.y-end.y)==1&&(end.P=start,closes.push(end),bFind=!1);cur&&bFind;){this.inList(closes,cur)||closes.push(cur);for(var rounds=this.getRounds(person.gameWorld.grids,cur),i=0;i<rounds.length;i++)0==person.gameWorld.checkTilePassable(person,new egret.Point(rounds[i].x,rounds[i].y))||this.inList(closes,rounds[i])||this.inList(opens,rounds[i])||!this.inList(opens,rounds[i])&&person.gameWorld.checkTilePassable(person,new egret.Point(rounds[i].x,rounds[i].y))&&(rounds[i].G=cur.G+Math.sqrt((rounds[i].x-end.x)*(rounds[i].x-end.x)+(rounds[i].y-end.y)*(rounds[i].y-end.y)),rounds[i].H=Math.sqrt((rounds[i].x-end.x)*(rounds[i].x-end.x)+(rounds[i].y-end.y)*(rounds[i].y-end.y)),rounds[i].F=rounds[i].G+rounds[i].H,rounds[i].P=cur,opens.push(rounds[i]));if(!opens.length){cur=null,opens=[];break}opens.sort(function(a,b){return a.F-b.F});for(var oMinF=opens[0],aMinF=[],i=0;i<opens.length;i++)opens[i].F==oMinF.F&&aMinF.push(opens[i]);if(aMinF.length>1){for(var i=0;i<aMinF.length;i++)aMinF[i].D=Math.abs(aMinF[i].x-cur.x)+Math.abs(aMinF[i].y-cur.y);aMinF.sort(function(a,b){return a.D-b.D}),oMinF=aMinF[0]}cur=oMinF,this.inList(closes,cur)||closes.push(cur);for(var i=0;i<opens.length;i++)if(opens[i]==cur){opens.splice(i,1);break}1==cur.H&&(end.P=cur,closes.push(end),cur=null)}if(closes.length){for(var dotCur=closes[closes.length-1],path=[],i=0;dotCur;)path.unshift(new egret.Point(dotCur.x,dotCur.y)),null==(dotCur=dotCur.P)||dotCur.P||(dotCur=null);return opens=null,closes=null,path}return null},AStar}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AStar},{}],6:[function(require,module,exports){"use strict";var Globals_1=require("../../enums/Globals"),PointUtil=function(){function PointUtil(){}return PointUtil.getInstance=function(){return null==this._instance&&(this._instance=new PointUtil),this._instance},PointUtil.prototype.logicToPosition=function(pt){return new egret.Point(pt.x*Globals_1.default.TILE_WIDTH+Globals_1.default.TILE_WIDTH/2,pt.y*Globals_1.default.TILE_HEIGHT+Globals_1.default.TILE_HEIGHT/2)},PointUtil.prototype.positionToLogic=function(pos){return new egret.Point(Math.floor((pos.x-Globals_1.default.TILE_WIDTH/2)/Globals_1.default.TILE_WIDTH),Math.floor((pos.y-Globals_1.default.TILE_HEIGHT/2)/Globals_1.default.TILE_HEIGHT))},PointUtil.prototype.isCollsionWithRect=function(rect1,rect2){return!(rect1.x>rect2.x+rect2.width)&&(!(rect1.x+rect1.width<rect2.x)&&(!(rect1.y>rect2.y+rect2.height)&&!(rect1.y+rect1.height<rect2.y)))},PointUtil.prototype.checkCollision=function(from,to,box){var rect=new egret.Rectangle(Math.min(from.x,to.x),Math.min(from.y,to.y),Math.abs(from.x-to.x),Math.abs(from.y-to.y));if(this.isCollsionWithRect(rect,box)){var dy=Math.floor(box.width*rect.height/rect.width);if(from.x-to.x<0){if(from.y-to.y<0){var collisionY=rect.y+rect.height*(rect.width-box.x+rect.x)/rect.width;return collisionY>=box.y&&collisionY<=box.y+box.height+dy}if(from.y-to.y>0){var collisionY=rect.y+rect.height-rect.height*(box.x-rect.x)/rect.width;return collisionY>=box.y-dy&&collisionY<=box.y+box.height}if(box.x<=rect.x&&box.x+box.width>rect.x)return!0}else if(from.x-to.x>0){if(to.y-from.y<0){var collisionY=rect.y+rect.height-rect.height*(rect.width-box.x+rect.x)/rect.width;return collisionY>=box.y-dy&&collisionY<=box.y+box.height}if(to.y-from.y>0){var collisionY=rect.y+rect.height*(box.x-rect.x)/rect.width;return collisionY>=box.y&&collisionY<=box.y+box.height+dy}if(box.x<=rect.x+rect.width&&box.x>rect.x)return!0}else if(box.x<=rect.x&&box.x+box.width>rect.x&&box.y>=rect.y&&box.y<rect.y+rect.height)return!0}return!1},PointUtil}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PointUtil},{"../../enums/Globals":46}],7:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},WindowManager_1=require("./WindowManager"),SoundManager_1=require("../../manager/SoundManager"),BaseWindow=function(_super){function BaseWindow(name){_super.call(this),this.isComplete=!1,this.isPopUp=!1,this._isCache=!0,this.name=name}return __extends(BaseWindow,_super),Object.defineProperty(BaseWindow.prototype,"data",{get:function(){return this._data},set:function(value){this._data=value,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(BaseWindow.prototype,"isCache",{get:function(){return this._isCache},set:function(value){this._isCache=value},enumerable:!0,configurable:!0}),BaseWindow.prototype.dispose=function(){this.btnClose&&this.btnClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)},BaseWindow.prototype.update=function(){this.isComplete&&this.updateView()},BaseWindow.prototype.updateView=function(){},BaseWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.isComplete=!0,this.btnClose&&(this.btnClose.name="btnClose",this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseClick,this)),this._data&&this.updateView()},BaseWindow.prototype.partAdded=function(partName,instance){_super.prototype.partAdded.call(this,partName,instance)},BaseWindow.prototype.onCloseClick=function(e){SoundManager_1.default.getInstance().playEffect("u02_back_mp3"),WindowManager_1.default.closeWindow(this.name,this.isCache)},BaseWindow}(eui.Panel);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BaseWindow},{"../../manager/SoundManager":58,"./WindowManager":13}],8:[function(require,module,exports){"use strict";var PopUpData=function(){function PopUpData(popUp,modal){this.modal=!1,this.popUp=popUp,this.modal=modal}return PopUpData}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PopUpData},{}],9:[function(require,module,exports){"use strict";var PopUpManagerImpl_1=require("./PopUpManagerImpl"),PopUpManager=function(){function PopUpManager(){}return Object.defineProperty(PopUpManager,"popUpList",{get:function(){return PopUpManager.Impl.popUpList},enumerable:!0,configurable:!0}),Object.defineProperty(PopUpManager,"modalAlpha",{get:function(){return PopUpManager.Impl.modalAlpha},set:function(value){PopUpManager.Impl.modalAlpha=value},enumerable:!0,configurable:!0}),Object.defineProperty(PopUpManager,"modalColor",{get:function(){return PopUpManager.Impl.modalColor},set:function(value){PopUpManager.Impl.modalColor=value},enumerable:!0,configurable:!0}),Object.defineProperty(PopUpManager,"Impl",{get:function(){return PopUpManager._impl||(PopUpManager._impl=new PopUpManagerImpl_1.PopUpManagerImpl),PopUpManager._impl},enumerable:!0,configurable:!0}),PopUpManager.init=function(rootLayer){PopUpManager.Impl.init(rootLayer)},PopUpManager.addPopUp=function(popUp,modal,center){void 0===modal&&(modal=!0),void 0===center&&(center=!0),PopUpManager.Impl.addPopUp(popUp,modal,center)},PopUpManager.bringToFront=function(popUp){PopUpManager.Impl.bringToFront(popUp)},PopUpManager.centerPopUp=function(popUp){PopUpManager.Impl.centerPopUp(popUp)},PopUpManager.removePopUp=function(popUp){PopUpManager.Impl.removePopUp(popUp)},PopUpManager.addEventListener=function(type,listener,thisObject,useCapture,priority){},PopUpManager.removeEventListener=function(popUp){PopUpManager.Impl.removePopUp(popUp)},PopUpManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PopUpManager},{"./PopUpManagerImpl":10}],10:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},PopUpData_1=require("./PopUpData"),PopUpManagerImpl=function(_super){function PopUpManagerImpl(target){_super.call(this,target),this._popUpList=[],this.popUpDataList=[],this._modalColor=0,this._modalAlpha=.8,this.invalidateModalFlag=!1,this.modalMask=null}return __extends(PopUpManagerImpl,_super),Object.defineProperty(PopUpManagerImpl.prototype,"modalAlpha",{get:function(){return this._modalAlpha},set:function(value){this._modalAlpha=value,this.invalidateModal()},enumerable:!0,configurable:!0}),Object.defineProperty(PopUpManagerImpl.prototype,"modalColor",{get:function(){return this._modalColor},set:function(value){this._modalColor=value,this.invalidateModal()},enumerable:!0,configurable:!0}),Object.defineProperty(PopUpManagerImpl.prototype,"popUpList",{get:function(){return this._popUpList},enumerable:!0,configurable:!0}),PopUpManagerImpl.prototype.findPopUpData=function(popUp){for(var list=this.popUpDataList,length=list.length,i=0;i<length;i++){var data=list[i];if(data.popUp==popUp)return data}return null},PopUpManagerImpl.prototype.init=function(root){this.rootLayer=root},PopUpManagerImpl.prototype.addPopUp=function(popUp,modal,center){void 0===modal&&(modal=!1),void 0===center&&(center=!0);var data=this.findPopUpData(popUp);data?(data.modal=modal,popUp.removeEventListener(PopUpManagerImpl.REMOVE_FROM_STAGE,this.onRemoved,this)):(data=new PopUpData_1.default(popUp,modal),this.popUpDataList.push(data),this._popUpList.push(popUp)),this.rootLayer.addChild(popUp),center&&this.centerPopUp(popUp),"isPopUp"in popUp&&(popUp.isPopUp=!0),modal&&this.invalidateModal(),popUp.addEventListener(PopUpManagerImpl.REMOVE_FROM_STAGE,this.onRemoved,this)},PopUpManagerImpl.prototype.onRemoved=function(event){for(var index=0,list=this.popUpDataList,length=list.length,i=0;i<length;i++){var data=list[i];if(data.popUp==event.target){"isPopUp"in data.popUp&&(data.popUp.isPopUp=!1),data.popUp.removeEventListener(PopUpManagerImpl.REMOVE_FROM_STAGE,this.onRemoved,this),this.popUpDataList.splice(index,1),this._popUpList.splice(index,1),this.invalidateModal();break}index++}},PopUpManagerImpl.prototype.invalidateModal=function(){this.invalidateModalFlag||(this.invalidateModalFlag=!0,this.rootLayer.addEventListener(egret.Event.ENTER_FRAME,this.validateModal,this),this.rootLayer.addEventListener(egret.Event.RENDER,this.validateModal,this),this.rootLayer.invalidateSize(),this.rootLayer.invalidateProperties(),this.rootLayer.invalidateDisplayList())},PopUpManagerImpl.prototype.validateModal=function(event){this.invalidateModalFlag=!1,this.rootLayer.removeEventListener(egret.Event.ENTER_FRAME,this.validateModal,this),this.rootLayer.removeEventListener(egret.Event.RENDER,this.validateModal,this),this.updateModal(this.rootLayer)},PopUpManagerImpl.prototype.updateModal=function(uiLayer){for(var found=!1,i=uiLayer.numChildren-1;i>=0;i--){var element=uiLayer.getChildAt(i),data=this.findPopUpData(element);if(data&&data.modal){found=!0;break}}found?(this.modalMask||(this.modalMask=new eui.Rect,this.modalMask.touchEnabled=!0,this.modalMask.top=this.modalMask.left=this.modalMask.right=this.modalMask.bottom=0),this.modalMask.fillColor=this._modalColor,this.modalMask.alpha=this._modalAlpha,this.modalMask.parent==uiLayer?(uiLayer.getChildIndex(this.modalMask)<i&&i--,uiLayer.setChildIndex(this.modalMask,i)):uiLayer.addChildAt(this.modalMask,i)):this.modalMask&&this.modalMask.parent==uiLayer&&uiLayer.removeChild(this.modalMask)},PopUpManagerImpl.prototype.bringToFront=function(popUp){if(this.findPopUpData(popUp)&&popUp.parent){var uiStage=popUp.parent;uiStage.setChildIndex(popUp,uiStage.numChildren-1),this.invalidateModal()}},PopUpManagerImpl.prototype.centerPopUp=function(popUp){popUp.top=popUp.bottom=popUp.left=popUp.right=NaN,popUp.verticalCenter=popUp.horizontalCenter=0;var parent=popUp.parent;if(parent){"validateNow"in popUp&&popUp.validateNow();var popUpBounds=new egret.Rectangle;popUp.getLayoutBounds(popUpBounds),popUp.x=.5*(parent.width-popUpBounds.width),popUp.y=.5*(parent.height-popUpBounds.height)}},PopUpManagerImpl.prototype.removePopUp=function(popUp){popUp&&popUp.parent&&this.findPopUpData(popUp)&&("removeChild"in popUp.parent?popUp.parent.removeChild(popUp):popUp instanceof egret.DisplayObject&&popUp.parent.removeChild(popUp))},PopUpManagerImpl.REMOVE_FROM_STAGE=egret.Event.REMOVED_FROM_STAGE,PopUpManagerImpl}(egret.EventDispatcher);exports.PopUpManagerImpl=PopUpManagerImpl},{"./PopUpData":8}],11:[function(require,module,exports){"use strict";var PopUpPosition=function(){function PopUpPosition(){}return PopUpPosition.ABOVE="above",PopUpPosition.BELOW="below",PopUpPosition.CENTER="center",PopUpPosition.TOP_LEFT="topLeft",PopUpPosition.BOTTOM_RIGHT="bottomRight",PopUpPosition.LEFT="left",PopUpPosition.RIGHT="right",PopUpPosition.SCREEN_CENTER="screenCenter",PopUpPosition}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PopUpPosition},{}],12:[function(require,module,exports){"use strict";var WindowDesc=function(){function WindowDesc(){}return WindowDesc}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=WindowDesc},{}],13:[function(require,module,exports){"use strict";var WindowDesc_1=require("./WindowDesc"),PopUpManager_1=require("./PopUpManager"),SceneManager_1=require("../../manager/SceneManager"),MainScene_1=require("../../view/mainscene/MainScene"),WindowManager=function(){function WindowManager(){throw new Error("current class can not be constructed!")}return WindowManager.createWindow=function(WinClass,winName,desc,winData){var win=WindowManager.getWindowByName(winName);if(null==win){win=new WinClass,win.name=winName,winData&&(win.data=winData);var winDesc=new WindowDesc_1.default;winDesc.winName=winName,winDesc.window=win,winDesc.desc=desc,WindowManager.windows.push(winDesc)}else winData&&(win.data=winData);return win},WindowManager.showWindow=function(WinClass,winName,desc,winData){var win=WindowManager.createWindow(WinClass,winName,desc,winData);return PopUpManager_1.default.addPopUp(win),win},WindowManager.getWindowByName=function(winName){for(var i=WindowManager.windows.length-1;i>=0;i--){var win=WindowManager.windows[i];if(win.winName==winName)return win.window}return null},WindowManager.exist=function(window){for(var i=WindowManager.windows.length-1;i>=0;i--){if(WindowManager.windows[i].window==window)return!0}return!1},WindowManager.closeWindow=function(winName,dispose){void 0===dispose&&(dispose=!1),null==SceneManager_1.default.getInstance().getRunningScene()&&SceneManager_1.default.getInstance().pushScene(new MainScene_1.default,1);for(var i=WindowManager.windows.length-1;i>=0;i--){var winDesc=WindowManager.windows[i];if(winDesc.winName==winName)return PopUpManager_1.default.removePopUp(winDesc.window),dispose&&(winDesc.window.dispose(),WindowManager.windows.splice(i,1)),!0}return!1},WindowManager.closeAllWindow=function(dispose){void 0===dispose&&(dispose=!1);for(var i=WindowManager.windows.length-1;i>=0;i--){var winDesc=WindowManager.windows[i];PopUpManager_1.default.removePopUp(winDesc.window),dispose&&(winDesc.window.dispose(),WindowManager.windows.splice(i,1))}},WindowManager.windows=[],WindowManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=WindowManager},{"../../manager/SceneManager":57,"../../view/mainscene/MainScene":144,"./PopUpManager":9,"./WindowDesc":12}],14:[function(require,module,exports){"use strict";var PopUpPosition_1=require("../popup/PopUpPosition"),TextToolTip_1=require("./TextToolTip"),TargetInfo=function(){function TargetInfo(){this.toolTipCls=TextToolTip_1.default,this.showPos=PopUpPosition_1.default.CENTER,this.showDuration=0,this.timeToShow=0}return TargetInfo}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=TargetInfo},{"../popup/PopUpPosition":11,"./TextToolTip":15}],15:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ToolTip_1=require("./ToolTip"),TextToolTip=function(_super){function TextToolTip(){_super.call(this),this._bg=new egret.Sprite,this.addChild(this._bg),this._textField=new egret.TextField,this._textField.textAlign=egret.HorizontalAlign.LEFT,this._textField.verticalAlign=egret.VerticalAlign.MIDDLE,this._textField.multiline=!0,this._textField.touchEnabled=!1,this._textField.wordWrap=!0,this._textField.width=200,this._textField.height=22,this._textField.size=20,this._textField.fontFamily="Microsoft Yahei",this._textField.textColor=16777215,this._textField.lineSpacing=5,this.addChild(this._textField)}return __extends(TextToolTip,_super),TextToolTip.prototype.commitProperties=function(){_super.prototype.commitProperties.call(this),this.dataChanged&&(this._textField.text=this.toolTipData,this.dataChanged=!1)},TextToolTip.prototype.measure=function(){_super.prototype.measure.call(this);this._textField.wordWrap=!1,this._textField.textWidth+10>TextToolTip.MAX_WIDTH&&(this._textField.width=TextToolTip.MAX_WIDTH-10,this._textField.wordWrap=!0),this.updateBackground()},TextToolTip.prototype.updateDisplayList=function(unscaledWidth,unscaledHeight){_super.prototype.updateDisplayList.call(this,unscaledWidth,unscaledHeight);this._textField.x=5,this._textField.y=5,this._textField.width=this._textField.textWidth+5,this._textField.height=this._textField.textHeight+5,this.updateBackground()},TextToolTip.prototype.updateBackground=function(){this._bg.graphics.clear(),this._bg.graphics.beginFill(0,.7),this._bg.graphics.drawRoundRect(0,0,this._textField.width+10,this._textField.height+10,10,10),this._bg.graphics.endFill()},TextToolTip.MAX_WIDTH=300,TextToolTip}(ToolTip_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=TextToolTip},{"./ToolTip":16}],16:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ToolTip=function(_super){function ToolTip(){_super.call(this),this.dataChanged=!1,this.touchChildren=!1,this.touchEnabled=!1}return __extends(ToolTip,_super),Object.defineProperty(ToolTip.prototype,"toolTipData",{get:function(){return this._toolTipData},set:function(value){this._toolTipData=value,this.dataChanged=!0,this.invalidateProperties(),this.invalidateSize(),this.invalidateDisplayList()},enumerable:!0,configurable:!0}),ToolTip}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ToolTip},{}],17:[function(require,module,exports){"use strict";var PopUpPosition_1=require("../popup/PopUpPosition"),TextToolTip_1=require("./TextToolTip"),TargetInfo_1=require("./TargetInfo"),ToolTipManager=function(){function ToolTipManager(){}return ToolTipManager.init=function(tipLayer){this._tipLayer=tipLayer,tipLayer.touchChildren=!1,tipLayer.touchEnabled=!1},ToolTipManager.register=function(target,toolTipData,ToolTipCls,showPos){void 0===ToolTipCls&&(ToolTipCls=TextToolTip_1.default),void 0===showPos&&(showPos=PopUpPosition_1.default.CENTER);var targetInfo=ToolTipManager.getTargetInfo(target);targetInfo?(targetInfo.toolTipData=toolTipData,targetInfo.toolTipCls=ToolTipCls,targetInfo.showPos=showPos):(targetInfo=new TargetInfo_1.default,targetInfo.target=target,targetInfo.toolTipData=toolTipData,targetInfo.toolTipCls=ToolTipCls,targetInfo.showPos=showPos,targetInfo.showDuration=0,targetInfo.timeToShow=0,ToolTipManager._targetInfoList.push(targetInfo)),target.addEventListener(mouse.MouseEvent.MOUSE_OVER,ToolTipManager.toolTipMouseOverHandler,ToolTipManager),target.addEventListener(mouse.MouseEvent.MOUSE_OUT,ToolTipManager.toolTipMouseOutHandler,ToolTipManager)},ToolTipManager.unRegister=function(target){var targetInfo=ToolTipManager.getTargetInfo(ToolTipManager._currentTarget);if(targetInfo){var tipClass=targetInfo.toolTipCls,key=egret.getQualifiedClassName(tipClass);targetInfo.toolTipCls=null,targetInfo.toolTipData=null,delete ToolTipManager._toolTipCacheMap[key];var targetIndex=ToolTipManager._targetInfoList.indexOf(targetInfo);-1!=targetIndex&&ToolTipManager._targetInfoList.splice(targetIndex,1)}target.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.toolTipMouseOverHandler,this),target.removeEventListener(mouse.MouseEvent.MOUSE_OUT,this.toolTipMouseOutHandler,this)},ToolTipManager.getTargetInfo=function(target){for(var _i=0,_a=ToolTipManager._targetInfoList;_i<_a.length;_i++){var targetInfo=_a[_i];if(targetInfo.target==target)return targetInfo}return null},ToolTipManager.toolTipMouseOverHandler=function(event){ToolTipManager._currentTarget&&ToolTipManager.hide(),ToolTipManager._currentTarget=event.currentTarget;var targetInfo=ToolTipManager.getTargetInfo(ToolTipManager._currentTarget);targetInfo&&ToolTipManager.createTip(targetInfo)},ToolTipManager.createTip=function(targetInfo){var tipClass=targetInfo.toolTipCls,key=egret.getQualifiedClassName(tipClass);ToolTipManager._currentToolTip=ToolTipManager._toolTipCacheMap[key],ToolTipManager._currentToolTip||(ToolTipManager._currentToolTip=new tipClass,ToolTipManager._toolTipCacheMap[key]=ToolTipManager._currentToolTip),ToolTipManager._currentToolTip.toolTipData=targetInfo.toolTipData,ToolTipManager._currentToolTip.validateNow(),ToolTipManager._tipLayer.addChild(ToolTipManager._currentToolTip),ToolTipManager.layoutTip(targetInfo.showPos)},ToolTipManager.toolTipMouseOutHandler=function(event){ToolTipManager.hide()},ToolTipManager.hide=function(){ToolTipManager._currentToolTip&&ToolTipManager._currentToolTip.parent&&ToolTipManager._currentToolTip.parent.removeChild(ToolTipManager._currentToolTip),ToolTipManager._currentToolTip=null},
ToolTipManager.layoutTip=function(pos){var x,y,tipLayer=ToolTipManager._tipLayer,toolTipWidth=ToolTipManager._currentToolTip.width,toolTipHeight=ToolTipManager._currentToolTip.height,rect=ToolTipManager._currentTarget.getTransformedBounds(tipLayer),centerX=rect.left+.5*(rect.width-toolTipWidth),centetY=rect.top+.5*(rect.height-toolTipHeight);switch(pos){case PopUpPosition_1.default.BELOW:x=centerX,y=rect.bottom;break;case PopUpPosition_1.default.ABOVE:x=centerX,y=rect.top-toolTipHeight;break;case PopUpPosition_1.default.LEFT:x=rect.left-toolTipWidth,y=centetY;break;case PopUpPosition_1.default.RIGHT:x=rect.right,y=centetY;break;case PopUpPosition_1.default.CENTER:x=centerX,y=centetY;break;case PopUpPosition_1.default.TOP_LEFT:x=rect.left,y=rect.top;break;case PopUpPosition_1.default.BOTTOM_RIGHT:x=rect.right,y=rect.bottom;break;default:x=centerX,y=centetY}var screenWidth=tipLayer.width,screenHeight=tipLayer.height;x+toolTipWidth>screenWidth&&(x=screenWidth-toolTipWidth),y+toolTipHeight>screenHeight&&(y=screenHeight-toolTipHeight),x<0&&(x=0),y<0&&(y=0),ToolTipManager._currentToolTip.x=x,ToolTipManager._currentToolTip.y=y},ToolTipManager._targetInfoList=[],ToolTipManager._toolTipCacheMap={},ToolTipManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ToolTipManager},{"../popup/PopUpPosition":11,"./TargetInfo":14,"./TextToolTip":15}],18:[function(require,module,exports){"use strict";var TweenLiteDriver_1=require("./TweenLiteDriver"),FrameTweenLite=function(){function FrameTweenLite(){}return FrameTweenLite.delayedCall=function(delay,callback,params,scope){var tween=TweenLite.delayedCall(delay*TweenLiteDriver_1.default.NORMAL_FPS,callback,params,scope,!0);return this.tweenSet.push(tween),tween},FrameTweenLite.from=function(target,duration,vars){vars.useFrames=!0;var tween=TweenLite.from(target,duration*TweenLiteDriver_1.default.NORMAL_FPS,vars);return this.tweenSet.push(tween),tween},FrameTweenLite.fromTo=function(target,duration,fromVars,toVars){fromVars.useFrames=!0,toVars.useFrames=!0;var tween=TweenLite.fromTo(target,duration*TweenLiteDriver_1.default.NORMAL_FPS,fromVars,toVars);return this.tweenSet.push(tween),tween},FrameTweenLite.getTweensOf=function(target){return TweenLite.getTweensOf(target)},FrameTweenLite.killDelayedCallsTo=function(func){TweenLite.killDelayedCallsTo(func)},FrameTweenLite.killTweensOf=function(target,vars){for(var tweens=this.getTweensOf(target),_i=0,tweens_1=tweens;_i<tweens_1.length;_i++){var tween=tweens_1[_i],pos=this.tweenSet.indexOf(tween);-1!=pos&&this.tweenSet.splice(pos,1)}TweenLite.killTweensOf(target,vars)},FrameTweenLite.killTween=function(tweenLite){var pos=this.tweenSet.indexOf(tweenLite);-1!=pos&&(this.tweenSet[pos].kill(),this.tweenSet.splice(pos,1))},FrameTweenLite.set=function(target,vars){var tween=TweenLite.set(target,vars);return this.tweenSet.push(tween),tween},FrameTweenLite.to=function(target,duration,vars){vars.useFrames=!0;var tween=TweenLite.to(target,duration*TweenLiteDriver_1.default.NORMAL_FPS,vars);return this.tweenSet.push(tween),tween},FrameTweenLite.killAll=function(){for(var i in this.tweenSet)this.tweenSet[i].kill();this.tweenSet.length=0},FrameTweenLite.tweenSet=[],FrameTweenLite}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=FrameTweenLite},{"./TweenLiteDriver":23}],19:[function(require,module,exports){"use strict";var TweenLiteDriver_1=require("./TweenLiteDriver"),Interval=function(){function Interval(){}return Interval.setInterval=function(listener,thisObject,delay){for(var args=[],_i=3;_i<arguments.length;_i++)args[_i-3]=arguments[_i];var delayFrames=.001*delay*TweenLiteDriver_1.default.NORMAL_FPS,data={listener:listener,thisObject:thisObject,delay:delayFrames,originDelay:delayFrames,params:args};return this.setIntervalCount++,1==this.setIntervalCount&&(this.lastFrame=TweenLite.ticker.frame,TweenLiteDriver_1.default.startTick(this.intervalUpdate,this)),this.setIntervalIndex++,this.setIntervalCache[this.setIntervalIndex]=data,this.setIntervalIndex},Interval.clearInterval=function(key){this.setIntervalCache[key]&&(this.setIntervalCount--,delete this.setIntervalCache[key],0==this.setIntervalCount&&TweenLiteDriver_1.default.stopTick(this.intervalUpdate,this))},Interval.intervalUpdate=function(timeStamp){var deltaFrames=timeStamp.frame-this.lastFrame;this.lastFrame=timeStamp.frame;for(var key in this.setIntervalCache){var data=this.setIntervalCache[key];data.delay-=deltaFrames,data.delay<=0&&(data.delay=data.originDelay,data.listener.apply(data.thisObject,data.params))}return!1},Interval.setIntervalCache={},Interval.setIntervalIndex=0,Interval.setIntervalCount=0,Interval.lastFrame=0,Interval}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Interval},{"./TweenLiteDriver":23}],20:[function(require,module,exports){"use strict";var TweenLiteDriver_1=require("./TweenLiteDriver"),Timeout=function(){function Timeout(){}return Timeout.setTimeout=function(listener,thisObject,delay){for(var args=[],_i=3;_i<arguments.length;_i++)args[_i-3]=arguments[_i];var delayFrames=.001*delay*TweenLiteDriver_1.default.NORMAL_FPS,data={listener:listener,thisObject:thisObject,delay:delayFrames,params:args};return this.setTimeoutCount++,1==this.setTimeoutCount&&TweenLite.ticker&&(this.lastFrame=TweenLite.ticker.frame,TweenLiteDriver_1.default.startTick(this.timeoutUpdate,this)),this.setTimeoutIndex++,this.setTimeoutCache[this.setTimeoutIndex]=data,this.setTimeoutIndex},Timeout.clearTimeout=function(key){this.setTimeoutCache[key]&&(this.setTimeoutCount--,delete this.setTimeoutCache[key],0==this.setTimeoutCount&&TweenLite.ticker&&TweenLiteDriver_1.default.stopTick(this.timeoutUpdate,this))},Timeout.timeoutUpdate=function(timeStamp){var deltaFrames=timeStamp.frame-this.lastFrame;this.lastFrame=timeStamp.frame;for(var key in this.setTimeoutCache){var key2=key,data=this.setTimeoutCache[key2];data.delay-=deltaFrames,data.delay<=0&&(data.listener.apply(data.thisObject,data.params),this.clearTimeout(key2))}return!1},Timeout.setTimeoutCache={},Timeout.setTimeoutIndex=0,Timeout.setTimeoutCount=0,Timeout.lastFrame=0,Timeout}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Timeout},{"./TweenLiteDriver":23}],21:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},TweenLiteDriver_1=require("./TweenLiteDriver"),TimerEvent_1=require("./TimerEvent"),Timer=function(_super){function Timer(duration,repeatCount){void 0===repeatCount&&(repeatCount=0),_super.call(this),this._repeatCount=0,this._durationFrames=0,this.lastTick=0,this.currentRepeat=0,this._repeatCount=repeatCount,this._durationFrames=.001*duration*TweenLiteDriver_1.default.NORMAL_FPS}return __extends(Timer,_super),Timer.prototype.update=function(frameObject){if(this._durationFrames<=1)this.run();else{var currentTick=TweenLite.ticker.frame;currentTick-this.lastTick>=this._durationFrames&&(this.run(),this.lastTick=currentTick)}},Timer.prototype.run=function(){this.currentRepeat++,0==this.repeatCount?this.dispatchEvent(new TimerEvent_1.default(TimerEvent_1.default.TIMER,this.currentRepeat)):this.currentRepeat<this.repeatCount?this.dispatchEvent(new TimerEvent_1.default(TimerEvent_1.default.TIMER,this.currentRepeat)):(this.dispatchEvent(new TimerEvent_1.default(TimerEvent_1.default.TIMER,this.currentRepeat)),this.dispatchEvent(new TimerEvent_1.default(TimerEvent_1.default.TIMER_COMPLETE,this.currentRepeat)),this.stop())},Timer.prototype.reset=function(){this.currentRepeat=0},Timer.prototype.start=function(){TweenLiteDriver_1.default.startTick(this.update,this)},Timer.prototype.stop=function(){TweenLiteDriver_1.default.stopTick(this.update,this)},Object.defineProperty(Timer.prototype,"durationFrames",{get:function(){return this._durationFrames},set:function(value){this._durationFrames=value},enumerable:!0,configurable:!0}),Object.defineProperty(Timer.prototype,"repeatCount",{get:function(){return this._repeatCount},set:function(value){this._repeatCount=value},enumerable:!0,configurable:!0}),Timer}(egret.EventDispatcher);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Timer},{"./TimerEvent":22,"./TweenLiteDriver":23}],22:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},TimerEvent=function(_super){function TimerEvent(type,currentCount,bubbles,cancelable){void 0===bubbles&&(bubbles=!1),void 0===cancelable&&(cancelable=!1),_super.call(this,type,bubbles,cancelable),this.currentCount=0,this.currentCount=currentCount}return __extends(TimerEvent,_super),TimerEvent.TIMER="timerEvent",TimerEvent.TIMER_COMPLETE="timerComplete",TimerEvent}(egret.Event);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=TimerEvent},{}],23:[function(require,module,exports){"use strict";var TweenLiteDriver=function(){function TweenLiteDriver(){}return TweenLiteDriver.getFps=function(){return this._fps},TweenLiteDriver.init=function(){var _this=this;TweenLite.ticker.useRAF(!1),TweenLite.ticker.addEventListener("tick",function(event){_this.update()},TweenLiteDriver),this._time=0},TweenLiteDriver.update=function(){var timeTick=egret.getTimer();for(var i in this.ticks){var tick=this.ticks[i];if(tick){var tickParam={frame:TweenLite.ticker.frame,time:timeTick};tick.callback.apply(tick.context,[tickParam])}}},TweenLiteDriver.getCurrentTick=function(){return TweenLite.ticker.frame},TweenLiteDriver.setFps=function(frameRate){TweenLite.ticker.fps(frameRate),this._fps=frameRate},TweenLiteDriver.startTick=function(tick,context){for(var key in this.ticks)if(this.ticks[key].callback===tick&&this.ticks[key].context===context)return;var tickObj={callback:tick,context:context};this.ticks.push(tickObj)},TweenLiteDriver.stopTick=function(callback,context){for(var i=this.ticks.length-1;i>=0;i--){var tick=this.ticks[i];if(tick.callback===callback&&tick.context===context){var deleteObj=this.ticks.splice(i,1)[0];deleteObj.callback=null,deleteObj.context=null;break}}},TweenLiteDriver.frame2time=function(numFrame){return 1e3/this._fps*numFrame},TweenLiteDriver.time2frame=function(timeDuration){return Math.floor(timeDuration*this.NORMAL_FPS/1e3)},TweenLiteDriver.NORMAL_FPS=30,TweenLiteDriver.ticks=[],TweenLiteDriver._fps=30,TweenLiteDriver._time=0,TweenLiteDriver}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=TweenLiteDriver},{}],24:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Scene=function(_super){function Scene(){_super.call(this)}return __extends(Scene,_super),Scene.prototype.getData=function(){return this._data},Scene.prototype.setData=function(data){this._data=data},Scene.prototype.onEnter=function(){},Scene.prototype.dispose=function(){},Scene.prototype.callback=function(route,response){},Scene}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Scene},{}],25:[function(require,module,exports){"use strict";var ProblemAlertView_1=require("../editor/ProblemAlertView"),CodeEngine=function(){function CodeEngine(language){this._code="",this._interval=0;var aetherOptions={executionLimit:1e4,problems:{jshint_W040:{level:"ignore"}},language:language,includeFlow:!0,includeMetrics:!0,protectBuiltins:!0,protectAPI:!1,languageVersion:"es6"};this._aether=new Aether(aetherOptions),this._aether.setLanguage(language),this._language=language}return Object.defineProperty(CodeEngine.prototype,"lastAST",{get:function(){return this._lastAST},enumerable:!0,configurable:!0}),Object.defineProperty(CodeEngine.prototype,"language",{get:function(){return this._language},enumerable:!0,configurable:!0}),CodeEngine.prototype.getCode=function(){return this._code},CodeEngine.prototype.setCode=function(code){this._code=code},CodeEngine.prototype.getAether=function(){return this._aether},CodeEngine.prototype.getCompileInfo=function(){if(this._aether)return{problems:this._aether.problems,flow:this._aether.flow,metrics:this._aether.metrics}},CodeEngine.prototype.setStepExecutor=function(executor,context){for(var param=[],_i=2;_i<arguments.length;_i++)param[_i-2]=arguments[_i];this._executorObj={exec:executor,thisObj:context,param:param}},CodeEngine.prototype.compile=function(){this._aether.transpile(this._code),console.log("%cINFORMATION ABOUT AETHER:","background: #fff000; color: #000000"),console.log(this._aether.problems),console.log(this._aether.flow),console.log(this._aether.metrics),console.log("%cAETHER INFORMATION COMPLETE!","background: #fff000; color: #000000"),this._aether.createFunction(),this._aether.esperEngine.loadAST(this._aether.ast)},CodeEngine.prototype.addObject=function(name,object){this._aether.esperEngine.addGlobalBridge(name,object)},CodeEngine.prototype.addFunction=function(name,func){this._aether.esperEngine.addGlobalFx(name,func)},CodeEngine.prototype.start=function(){clearInterval(this._interval),this._interval=setInterval(this.update,0,this)},CodeEngine.prototype.stop=function(){clearInterval(this._interval)},CodeEngine.prototype.update=function(context){if(context._executorObj){var exec=context._executorObj.exec,thisObj=context._executorObj.thisObj,param=context._executorObj.param;param?exec.apply(thisObj,param):exec.apply(thisObj)}},CodeEngine.prototype.reset=function(){this._aether.reset(),this._aether.esperEngine=null,this._lastAST=null},CodeEngine.prototype.stepOne=function(){var result,engine=this._aether.esperEngine;try{result=engine.step()}catch(e){console.log(e);var errors=[{type:"error",text:e}];ProblemAlertView_1.default.getInstance().setProblems(errors),result=e}return this.collectStepAST(engine),!!result},CodeEngine.prototype.collectStepAST=function(engine){for(var ast,frames=engine.evaluator.frames,i=0;i<frames.length;i++)if(frames[i].ast){ast=frames[i].ast;break}ast&&(this._lastAST=ast)},CodeEngine.prototype.dispose=function(){this.reset(),this._executorObj=null},CodeEngine}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CodeEngine},{"../editor/ProblemAlertView":43}],26:[function(require,module,exports){"use strict";var InjectCodeWorker_1=require("./InjectCodeWorker"),UserCodeWorker_1=require("./UserCodeWorker"),ComponentCreator_1=require("../control/component/ComponentCreator"),CodeWorkerManager=function(){function CodeWorkerManager(){}return CodeWorkerManager.init=function(actor){this._componentCreator=new ComponentCreator_1.default,this._componentCreator.attach(actor),this._injectThread=new InjectCodeWorker_1.default(actor),this._userThread=new UserCodeWorker_1.default(actor)},CodeWorkerManager.getInjectTread=function(){return this._injectThread},CodeWorkerManager.getUserThread=function(){return this._userThread},CodeWorkerManager.getComponentCreator=function(){return this._componentCreator},CodeWorkerManager.setUserCompleteCallback=function(cb,context){this._userCodeComplete=cb,this._userCodeCbContext=context,this._userThread.addEventListener("codeRunComplete",cb,context)},CodeWorkerManager.release=function(){this._componentCreator.dispose(),this._injectThread.dispose(),this._userThread.dispose(),this._injectThread=null,this._userThread=null,this._componentCreator=null,this._userCodeCbContext=null,this._userCodeComplete=null},CodeWorkerManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CodeWorkerManager},{"../control/component/ComponentCreator":35,"./InjectCodeWorker":27,"./UserCodeWorker":28}],27:[function(require,module,exports){"use strict";var CodeEngine_1=require("./CodeEngine"),InjectCodeWorker=function(){function InjectCodeWorker(actor){this._counter=0;this._codeEngine=new CodeEngine_1.default("javascript"),this._codeEngine.setStepExecutor(this.tick,this),this._actor=actor}return InjectCodeWorker.prototype.setCode=function(code){this._code=code},InjectCodeWorker.prototype.runCode=function(){this._codeEngine.reset(),this._codeEngine.setCode(this._code+"\nvar script = new Script(); \nwhile(true){ \n   script.chooseAction(); \n   script.checkVictory(); \n}\n"),this._codeEngine.compile(),this._codeEngine.addObject("hero",this._actor.sceneObject),this._codeEngine.addObject("actor",this._actor),this._codeEngine.start()},InjectCodeWorker.prototype.tick=function(){if(this._codeEngine.stepOne())return void this.stop();++this._counter>=4800&&(this.stop(),this._counter=0)},InjectCodeWorker.prototype.stop=function(){this._codeEngine.stop()},InjectCodeWorker.prototype.onSetupLevel=function(){this.runCodeFragment("\nvar script = new Script(); \nscript.setupLevel(); \n")},InjectCodeWorker.prototype.onFirstFrame=function(){this.runCodeFragment("\nvar script = new Script(); \nscript.onFirstFrame(); \n")},InjectCodeWorker.prototype.dispose=function(){this.stop(),this._codeEngine.dispose()},InjectCodeWorker.prototype.runCodeFragment=function(codeFragment){this._codeEngine.reset(),this._codeEngine.setCode(this._code+codeFragment),this._codeEngine.compile(),this._codeEngine.addObject("hero",this._actor.sceneObject),this._codeEngine.addObject("actor",this._actor);for(var result=this._codeEngine.stepOne();!result;)result=this._codeEngine.stepOne()},InjectCodeWorker}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=InjectCodeWorker},{"./CodeEngine":25}],28:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},CodeEngine_1=require("./CodeEngine"),Interval_1=require("../base/utils/Interval"),EditorAdapter_1=require("../editor/EditorAdapter"),DataAccessManager_1=require("../base/da/DataAccessManager"),DataAccessEntry_1=require("../model/DataAccessEntry"),UserCodeWorker=function(_super){function UserCodeWorker(actor,target){_super.call(this,target),this._isComplete=!1,this._markers=[],this._actor=actor}return __extends(UserCodeWorker,_super),Object.defineProperty(UserCodeWorker.prototype,"actor",{get:function(){return this._actor},enumerable:!0,configurable:!0}),Object.defineProperty(UserCodeWorker.prototype,"isComplete",{get:function(){return this._isComplete},enumerable:!0,configurable:!0}),UserCodeWorker.prototype.init=function(){var userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data;this._editorAdapter=new EditorAdapter_1.default,this._editorAdapter.init(userInfo.language),this._editorAdapter.show(),this._codeEngine=new CodeEngine_1.default(this._editorAdapter.language),this._codeEngine.setStepExecutor(this.tick,this),this._language=this._editorAdapter.language,this._editorAdapter.addEventListener("EditEvent",this.onEditEvent,this)},UserCodeWorker.prototype.runCode=function(){this.reset(),this._codeEngine.setCode(this._editorAdapter.editor.getValue()),this._codeEngine.compile(),this._codeEngine.addObject("hero",this._actor),this._codeEngine.start();var compileInfo=this._codeEngine.getCompileInfo(),errors=[];compileInfo&&(errors=compileInfo.problems.errors,errors.forEach(function(error){error.type="error",error.row=error.range&&error.range[0]&&error.range[0].row,error.text=error.message})),this._editorAdapter.editor.renderer.setAnnotations(errors),this._editorAdapter.problemShow.setProblems(errors),this.actor.startTick=egret.getTimer()},UserCodeWorker.prototype.tick=function(){var _this=this;if(this.clearMarkers(),!this._actor.isLock){this._codeEngine.lastAST&&this.setAstCodeHighLight(this._codeEngine.lastAST);this._codeEngine.stepOne()&&(this.stop(),Interval_1.default.clearInterval(this._lastActionInterval),this._lastActionInterval=Interval_1.default.setInterval(function(){_this._actor.isLock||(Interval_1.default.clearInterval(_this._lastActionInterval),_this._isComplete=!0,_this._editorAdapter.editor.getSession().selection.clearSelection(),_this.dispatchEvent(new egret.Event("codeRunComplete")))},this,200))}},UserCodeWorker.prototype.onEditEvent=function(event){this.dispatchEvent(event)},UserCodeWorker.prototype.reset=function(){Interval_1.default.clearInterval(this._lastActionInterval),this._isComplete=!1,this._codeEngine.reset()},UserCodeWorker.prototype.clearMarkers=function(){this._markers=[]},UserCodeWorker.prototype.setEditorText=function(text){this._editorAdapter.editor.setValue(text,1)},UserCodeWorker.prototype.getEditorText=function(){return this._editorAdapter.editor.getSession().getValue()},UserCodeWorker.prototype.insertEditorText=function(text){this._editorAdapter.editor.insert(text)},UserCodeWorker.prototype.insertSnippet=function(snippet){this._editorAdapter.editor.completer&&this._editorAdapter.editor.completer.insertMatch(snippet,this._editorAdapter.editor)},UserCodeWorker.prototype.getEffectiveCodeLine=function(){return this._editorAdapter.getValidCodeLines()},UserCodeWorker.prototype.stop=function(){this._codeEngine.stop(),this.reset()},UserCodeWorker.prototype.dispose=function(){Interval_1.default.clearInterval(this._lastActionInterval),this._editorAdapter.removeEventListener("EditEvent",this.onEditEvent,this),this._codeEngine.stop(),this._codeEngine.dispose(),this._actor.dispose(),this.clearMarkers(),this._markers=null,this._editorAdapter.dispose(),this._editorAdapter=null,this._actor=null},UserCodeWorker.prototype.setAstCodeHighLight=function(ast){switch(this._language){case"javascript":this.setJSAstCodeHighLight(ast);break;case"python":this.setPythonAstCodeHighLight(ast)}},UserCodeWorker.prototype.setJSAstCodeHighLight=function(ast){var range=ast.loc,Range=ace.require("./range").Range,rr=new Range(range.start.line-1,range.start.column,range.end.line-1,range.end.column);this._markers.push(this._editorAdapter.editor.getSession().addMarker(rr,"executing","text",!0)),this.highlightCurrGutterLine(range.start.row),console.log(range.start.line-1,range.start.column,range.end.line-1,range.end.column)},UserCodeWorker.prototype.setPythonAstCodeHighLight=function(ast){var range=ast.originalRange;if(range){var startLine=range.start.row,startColumn=range.start.col,endLine=range.end.row,endColumn=range.end.col,initStartLine=startLine,initEndColumn=endColumn;if(ast.srcName&&"CallExpression"===ast.type){for(var lineNum=this._editorAdapter.editor.getSession().getLength(),srcPart=ast.srcName.split("(")[0],line=this._editorAdapter.editor.getSession().getLine(initStartLine);-1===line.indexOf(srcPart);)if(line=this._editorAdapter.editor.getSession().getLine(++initStartLine),-1!=line.indexOf(srcPart)&&(initEndColumn=srcPart.length),initStartLine>=lineNum){initStartLine=startLine,initEndColumn=endColumn;break}startLine=endLine=initStartLine,endColumn=initEndColumn}var Range=ace.require("./range").Range,rr=new Range(startLine,startColumn,endLine,endColumn);this._markers.push(this._editorAdapter.editor.getSession().addMarker(rr,"executing","text",!0)),this.highlightCurrGutterLine(startLine),ast.srcName&&ast.srcName.indexOf(".")}},UserCodeWorker.prototype.highlightCurrGutterLine=function(row){for(var docLength=this._editorAdapter.editor.getSession().getLength(),i=0;i<docLength;++i)this._editorAdapter.editor.renderer.removeGutterDecoration(i,"executing");this._editorAdapter.editor.renderer.addGutterDecoration(row,"executing"),this._editorAdapter.editor.moveCursorTo(row),this._editorAdapter.editor.renderer.scrollToRow(row)},UserCodeWorker}(egret.EventDispatcher);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UserCodeWorker},{"../base/da/DataAccessManager":2,"../base/utils/Interval":19,"../editor/EditorAdapter":42,"../model/DataAccessEntry":59,"./CodeEngine":25}],29:[function(require,module,exports){"use strict";var Person_1=require("../../view/battlescene/scene/Person"),SceneItem_1=require("../../view/battlescene/scene/SceneItem"),FrameTweenLite_1=require("../../base/utils/FrameTweenLite"),SceneObjectActor=function(){function SceneObjectActor(sceneObject){this._block=!1,this._sceneObject=sceneObject,this._methods={}}return Object.defineProperty(SceneObjectActor.prototype,"sceneObject",{get:function(){return this._sceneObject},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObjectActor.prototype,"isLock",{get:function(){return this._block},enumerable:!0,configurable:!0}),SceneObjectActor.prototype.lock=function(){this._block=!0},SceneObjectActor.prototype.unlock=function(){this._block=!1},SceneObjectActor.prototype.attach=function(sceneObject){this._sceneObject=sceneObject},SceneObjectActor.prototype.bindComponents=function(creator){creator.attach(this)},SceneObjectActor.prototype.addAction=function(name,context){this[name]=_.partial(this.callMethod,name,context||this)},SceneObjectActor.prototype.getAction=function(name){return this[name]},SceneObjectActor.prototype.addMethod=function(name,method){this._methods[name]=method},SceneObjectActor.prototype.callMethod=function(methodName,context){for(var args=[],i=2;i<arguments.length;i++)args.push(arguments[i]);return this._methods[methodName].apply(context,args)},SceneObjectActor.prototype.dispose=function(){for(var key in this._methods)delete this._methods[key];this._methods=null,this._sceneObject=null},SceneObjectActor.prototype.bin=function(param){var candidate,bytes=new egret.ByteArray,result="0b";if(_.isString(param)?(bytes.writeUTFBytes(param),bytes.position=0):_.isObject(param)?(candidate=param.toString(),bytes.writeUTFBytes(candidate),bytes.position=0):_.isNumber(param)&&(result+=param.toString(2)),bytes.bytesAvailable>0)for(;bytes.bytesAvailable>0;){var byteNumber=bytes.readByte();result+=byteNumber.toString(2)}return result},Object.defineProperty(SceneObjectActor.prototype,"pos",{get:function(){return this._sceneObject.logicPosition},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObjectActor.prototype,"hp",{get:function(){return this._sceneObject instanceof Person_1.default?this._sceneObject.batterData.hp:0},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObjectActor.prototype,"MP",{get:function(){return this._sceneObject instanceof Person_1.default?this._sceneObject.batterData.mp:0},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObjectActor.prototype,"dropMP",{get:function(){if(this._sceneObject instanceof SceneItem_1.default){return 40002!=parseInt(this._sceneObject.getData().drop_type)?0:parseInt(this._sceneObject.getData().drop_number)}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObjectActor.prototype,"type",{get:function(){return this._sceneObject.type},enumerable:!0,configurable:!0}),SceneObjectActor.prototype.say=function(word){var _this=this;this._sceneObject.say(word),this.lock();var lite=FrameTweenLite_1.default.delayedCall(1,function(){_this.unlock(),FrameTweenLite_1.default.killTween(lite)})},SceneObjectActor}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SceneObjectActor},{"../../base/utils/FrameTweenLite":18,"../../view/battlescene/scene/Person":91,"../../view/battlescene/scene/SceneItem":92}],30:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseComponent_1=require("./BaseComponent"),SceneObjectActor_1=require("../actions/SceneObjectActor"),ConfigManager_1=require("../../manager/ConfigManager"),SceneMoveObject_1=require("../../view/battlescene/scene/SceneMoveObject"),Globals_1=require("../../enums/Globals"),Attack=function(_super){function Attack(){_super.apply(this,arguments)}return __extends(Attack,_super),Attack.prototype.attach=function(actor){_super.prototype.attach.call(this,actor),actor.addMethod("attack",this.attack),actor.addMethod("cleave",this.cleave),actor.addMethod("powerUp",this.powerUp),actor.addMethod("scattershot",this.scattershot),actor.addMethod("shield",this.shield),actor.addMethod("bash",this.bash),actor.addMethod("attackRange",this.attackRange)},Attack.prototype.cleave=function(){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,skillId=ConfigManager_1.default.getInstance().getSkillIdByType("cleave");skillId<=0||(sceneObjectActor.lock(),sceneObject.playSkill(skillId,sceneObject.logicPosition),sceneObject.once(SceneMoveObject_1.default.HERO_ANIMATION_FINISH,function(){sceneObjectActor.unlock()},this))},Attack.prototype.powerUp=function(){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,skillId=ConfigManager_1.default.getInstance().getSkillIdByType("powerUp");skillId<=0||(sceneObjectActor.lock(),sceneObject.playSkill(skillId,sceneObject.logicPosition),sceneObject.once(SceneMoveObject_1.default.HERO_ANIMATION_FINISH,function(){sceneObjectActor.unlock()},this))},Attack.prototype.scattershot=function(){},Attack.prototype.shield=function(time){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,skillId=ConfigManager_1.default.getInstance().getSkillIdByType("shield");skillId<=0||(sceneObjectActor.lock(),sceneObject.shieldAction(time,skillId),sceneObject.once(SceneMoveObject_1.default.HERO_ANIMATION_FINISH,function(){sceneObjectActor.unlock()},this))},Attack.prototype.bash=function(target){},Attack.prototype.attack=function(targetName){var _this=this,sceneObjectActor=this,self=sceneObjectActor.sceneObject;self.onControl=!0;var world=self.gameWorld,target=null;if("string"==typeof targetName?target=world.getSceneObjectByName(targetName):"object"==typeof targetName&&targetName instanceof SceneObjectActor_1.default&&(target=targetName.sceneObject),target&&!(target.batterData.hp<=0)){var deltaX=target.x-self.x,deltaY=target.y-self.y;Math.sqrt(deltaX*deltaX+deltaY*deltaY)/Globals_1.default.TILE_WIDTH<=self.batterData.viewrange&&(self.collideWith(target)?(sceneObjectActor.lock(),self.playAttack(target.logicPosition)):(sceneObjectActor.lock(),self.setTarget(target),self.onControl=!1),self.once(SceneMoveObject_1.default.HERO_ATTACK_FINISH,function(){self.onControl=!0,self.setTarget(null);var nearestPoint=self.getNearestPoint();return nearestPoint?nearestPoint.equals(self.logicPosition)?void sceneObjectActor.unlock():self.batterData.hp<=0?void sceneObjectActor.unlock():egret.Point.distance(self.logicPosition,nearestPoint)>15?void sceneObjectActor.unlock():(self.moveTo(nearestPoint),console.log("moveTo:",nearestPoint),self.once(SceneMoveObject_1.default.MOVE_FINISHED,function(event){console.log("moveFinished!"),sceneObjectActor.unlock()},_this),void(self.moveToNearestKeyPoint()?self.once(SceneMoveObject_1.default.MOVE_FINISHED,function(event){console.log("moveFinished!"),sceneObjectActor.unlock()},_this):sceneObjectActor.unlock())):void sceneObjectActor.unlock()},self))}},Attack.prototype.attackRange=function(){return this.sceneObject.attackRange},Attack}(BaseComponent_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Attack},{"../../enums/Globals":46,"../../manager/ConfigManager":54,"../../view/battlescene/scene/SceneMoveObject":93,"../actions/SceneObjectActor":29,"./BaseComponent":31}],31:[function(require,module,exports){"use strict";var BaseComponent=function(){function BaseComponent(name){this._name=name}return Object.defineProperty(BaseComponent.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),BaseComponent.prototype.attach=function(actor){this.actor=actor},BaseComponent.prototype.dispose=function(){},BaseComponent}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BaseComponent},{}],32:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}
for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseComponent_1=require("./BaseComponent"),ConfigManager_1=require("../../manager/ConfigManager"),SceneMoveObject_1=require("../../view/battlescene/scene/SceneMoveObject"),Builder=function(_super){function Builder(){_super.apply(this,arguments)}return __extends(Builder,_super),Builder.prototype.attach=function(actor){_super.prototype.attach.call(this,actor),actor.addMethod("buildXY",this.buildXY)},Builder.prototype.buildXY=function(type,x,y,isSummon){var _this=this,sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,filters=["ravidelfin","iceelfin","shadowelfin"];switch(type){case"bomb":case"block":case"ravidelfin":case"iceelfin":case"shadowelfin":if(isSummon&&-1==filters.indexOf(type))break;if(!isSummon&&-1!=filters.indexOf(type))break;var skillId_1=ConfigManager_1.default.getInstance().getSkillIdByType(type);if(skillId_1<=0)return;sceneObjectActor.lock();var targetPoint_1=new egret.Point(x,y);if(!targetPoint_1.equals(sceneObject.logicPosition)){sceneObject.moveCloseTo(targetPoint_1,6),sceneObject.once(SceneMoveObject_1.default.MOVE_FINISHED,function(){sceneObjectActor.lock(),sceneObject.playSkill(skillId_1,targetPoint_1),sceneObject.once(SceneMoveObject_1.default.HERO_ANIMATION_FINISH,function(){sceneObjectActor.unlock()},_this)},this);break}sceneObject.playSkill(skillId_1,targetPoint_1),sceneObject.once(SceneMoveObject_1.default.HERO_ANIMATION_FINISH,function(){3===sceneObject.turn?sceneObject.moveBy(-4,0):4===sceneObject.turn?sceneObject.moveBy(4,0):1===sceneObject.turn?sceneObject.moveBy(0,-4):2===sceneObject.turn?sceneObject.moveBy(0,4):sceneObject.moveBy(4,0),sceneObject.once(SceneMoveObject_1.default.MOVE_FINISHED,function(){sceneObjectActor.unlock()},_this)},this)}},Builder}(BaseComponent_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Builder},{"../../manager/ConfigManager":54,"../../view/battlescene/scene/SceneMoveObject":93,"./BaseComponent":31}],33:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseComponent_1=require("./BaseComponent"),SceneObjectActor_1=require("../actions/SceneObjectActor"),CodeWorkerManager_1=require("../../compile/CodeWorkerManager"),ConfigManager_1=require("../../manager/ConfigManager"),SceneMoveObject_1=require("../../view/battlescene/scene/SceneMoveObject"),Cast=function(_super){function Cast(){_super.apply(this,arguments)}return __extends(Cast,_super),Cast.prototype.attach=function(actor){_super.prototype.attach.call(this,actor),actor.addMethod("cast",this.cast),actor.addMethod("isReady",this.isReady)},Cast.prototype.cast=function(type,target){switch(type){case"magic-missile":case"fireball":case"lightning-bolt":case"root":case"confuse":case"chaotic-energy":case"drain-life":case"fear":case"haste":CodeWorkerManager_1.default.getComponentCreator().getComponent("Cast").playCastSkill(type,target)}},Cast.prototype.isReady=function(skillType){return this.sceneObject.checkSkillReady(skillType)},Cast.prototype.playCastSkill=function(type,target){var _this=this,skillId=ConfigManager_1.default.getInstance().getSkillIdByType(type);if(!(skillId<=0)){var sceneObject=this.actor.sceneObject;if(target instanceof SceneObjectActor_1.default){this.actor.lock();var targetPerson=target.sceneObject;sceneObject.playSkill(skillId,targetPerson.logicPosition)}else if(_.isString(target)){this.actor.lock();var world=sceneObject.gameWorld,tar=world.getSceneObjectByName(target);if(!tar)return void this.actor.unlock();sceneObject.playSkill(skillId,tar.logicPosition)}else _.isObject(target)&&target.hasOwnProperty("x")&&target.hasOwnProperty("y")&&(this.actor.lock(),sceneObject.playSkill(skillId,new egret.Point(target.x,target.y)));sceneObject.once(SceneMoveObject_1.default.HERO_ANIMATION_FINISH,function(){_this.actor.unlock()},this)}},Cast}(BaseComponent_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Cast},{"../../compile/CodeWorkerManager":26,"../../manager/ConfigManager":54,"../../view/battlescene/scene/SceneMoveObject":93,"../actions/SceneObjectActor":29,"./BaseComponent":31}],34:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseComponent_1=require("./BaseComponent"),SceneObjectActor_1=require("../actions/SceneObjectActor"),ComponentCreator_1=require("./ComponentCreator"),ConfigManager_1=require("../../manager/ConfigManager"),PersonTeams_1=require("../../enums/PersonTeams"),Command=function(_super){function Command(){_super.apply(this,arguments)}return __extends(Command,_super),Command.prototype.attach=function(actor){_super.prototype.attach.call(this,actor),actor.addMethod("command",this.command),actor.addMethod("summon",this.summon)},Command.prototype.command=function(friend,action){for(var target=[],_i=2;_i<arguments.length;_i++)target[_i-2]=arguments[_i];if(_.isString(friend)){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld,person=world.getSceneObjectByName(friend);if(person.batterData.team!=PersonTeams_1.default.FRIEND)return;if(1!=parseInt(person.getData().commandable))return;var actor=new SceneObjectActor_1.default(person);actor.bindComponents(new ComponentCreator_1.default);var ids=person.getData().commandable_skill.split("|");if(ids.length<=0)return;for(var filters=[],_a=0,ids_1=ids;_a<ids_1.length;_a++){var id=ids_1[_a],actionData=ConfigManager_1.default.getInstance().getConfig("action",parseInt(id));actionData&&filters.push(actionData.name)}if(-1==filters.indexOf(action))return;for(var _b=0,filters_1=filters;_b<filters_1.length;_b++){var act=filters_1[_b];actor.addAction(act)}0==target.length?actor[action]():1==target.length?actor[action](target[0]):2==target.length&&actor[action](target[0],target[1])}else if(friend instanceof SceneObjectActor_1.default){var actor=friend;actor.getAction(action)()}},Command.prototype.summon=function(type){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,skillId=ConfigManager_1.default.getInstance().getSkillIdByType(type);if(!(skillId<=0)){var skillData=ConfigManager_1.default.getInstance().getConfig("skill",skillId),dmgrang=parseInt(skillData.dmgrange),x=Math.floor(Math.random()*dmgrang),y=Math.floor(Math.random()*dmgrang);sceneObjectActor.buildXY(type,sceneObject.logicPosition.x+x,sceneObject.logicPosition.y+y,!0)}},Command}(BaseComponent_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Command},{"../../enums/PersonTeams":49,"../../manager/ConfigManager":54,"../actions/SceneObjectActor":29,"./BaseComponent":31,"./ComponentCreator":35}],35:[function(require,module,exports){"use strict";var Move_1=require("./Move"),Attack_1=require("./Attack"),Builder_1=require("./Builder"),Cast_1=require("./Cast"),Command_1=require("./Command"),Foundation_1=require("./Foundation"),Find_1=require("./Find"),ComponentCreator=function(){function ComponentCreator(){this._components={}}return ComponentCreator.prototype.attach=function(actor){this._actor=actor,this.createComponent(Move_1.default,"Move"),this.createComponent(Attack_1.default,"Attack"),this.createComponent(Builder_1.default,"Builder"),this.createComponent(Cast_1.default,"Cast"),this.createComponent(Command_1.default,"Command"),this.createComponent(Foundation_1.default,"Foundation"),this.createComponent(Find_1.default,"Find")},ComponentCreator.prototype.createComponent=function(componentDef,name){this._components[name]=new componentDef(name),this._components[name].attach(this._actor)},ComponentCreator.prototype.getComponent=function(name){return this._components[name]},ComponentCreator.prototype.dispose=function(){for(var key in this._components){this._components[key].dispose()}this._components={},this._actor.dispose()},ComponentCreator}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ComponentCreator},{"./Attack":30,"./Builder":32,"./Cast":33,"./Command":34,"./Find":36,"./Foundation":37,"./Move":38}],36:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseComponent_1=require("./BaseComponent"),SceneObjectActor_1=require("../actions/SceneObjectActor"),PersonTeams_1=require("../../enums/PersonTeams"),SceneItem_1=require("../../view/battlescene/scene/SceneItem"),Find=function(_super){function Find(){_super.apply(this,arguments)}return __extends(Find,_super),Find.prototype.attach=function(actor){_super.prototype.attach.call(this,actor),actor.addMethod("findNearestEnemy",this.findNearestEnemy),actor.addMethod("findNearestFriend",this.findNearestFriend),actor.addMethod("findNearest",this.findNearest),actor.addMethod("findByType",this.findByType),actor.addMethod("findEnemies",this.findEnemies),actor.addMethod("findFriendlyMissiles",this.findFriendlyMissiles),actor.addMethod("findFriends",this.findFriends),actor.addMethod("findHazards",this.findHazards),actor.addMethod("findItems",this.findItems),actor.addMethod("findNearestItem",this.findNearestItem)},Find.prototype.findNearestEnemy=function(){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld,result=world.findPersonsByViewRange(sceneObject,sceneObject.batterData.viewrange),hostiles=_.filter(result,function(person){if(person.batterData.team===PersonTeams_1.default.HOSTILE)return!0});if(hostiles.length<1)return null;for(var distance=1/0,findResult=hostiles[0],i=0;i<hostiles.length;i++){var tempDistance=egret.Point.distance(hostiles[i].logicPosition,sceneObject.logicPosition);tempDistance<distance&&(distance=tempDistance,findResult=hostiles[i])}return new SceneObjectActor_1.default(findResult)},Find.prototype.findNearest=function(candidates){var result,sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,dis=Number.MAX_VALUE;for(var i in candidates){var candidate=candidates[i],deltaX=candidate.sceneObject.x-sceneObject.x,deltaY=candidate.sceneObject.y-sceneObject.y,distance=deltaX*deltaX+deltaY*deltaY;distance<dis&&(dis=distance,result=candidate)}return result},Find.prototype.findNearestItem=function(){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld,result=world.findAllByViewRange(sceneObject,sceneObject.batterData.viewrange),candidates=[];for(var i in result)if(result[i]instanceof SceneItem_1.default){var item=result[i];0==item.picked&&candidates.push(new SceneObjectActor_1.default(item))}return this._methods.findNearest.call(this,candidates)},Find.prototype.findNearestFriend=function(){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld,result=world.findPersonsByRange(sceneObject.logicPosition,sceneObject.batterData.viewrange),pos=result.indexOf(sceneObject);-1!=pos&&result.splice(pos,1);var hostiles=_.filter(result,function(person){if(person.batterData.team===PersonTeams_1.default.FRIEND)return!0});if(hostiles.length<1)return null;for(var distance=1/0,findResult=hostiles[0],i=0;i<hostiles.length;i++){var tempDistance=egret.Point.distance(hostiles[i].logicPosition,sceneObject.logicPosition);tempDistance<distance&&(distance=tempDistance,findResult=hostiles[i])}return new SceneObjectActor_1.default(findResult)},Find.prototype.findByType=function(type){var result=[],sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld,candidates=world.findAllByViewRange(sceneObject,sceneObject.batterData.viewrange);for(var i in candidates){var obj=candidates[i];obj.getData().findtype===type&&result.push(new SceneObjectActor_1.default(obj))}return result},Find.prototype.findEnemies=function(){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld,objs=world.findPersonsByRange(sceneObject.logicPosition,sceneObject.batterData.viewrange),result=[];for(var i in objs){var person=objs[i];person.batterData.team===PersonTeams_1.default.HOSTILE&&result.push(new SceneObjectActor_1.default(person))}return result},Find.prototype.findFriendlyMissiles=function(){return[]},Find.prototype.findFriends=function(){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld,objs=world.findPersonsByViewRange(sceneObject,sceneObject.batterData.viewrange),result=[];for(var i in objs){var person=objs[i];person.batterData.team===PersonTeams_1.default.FRIEND&&result.push(new SceneObjectActor_1.default(person))}return result},Find.prototype.findHazards=function(){},Find.prototype.findItems=function(){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld,result=world.findAllByViewRange(sceneObject,sceneObject.batterData.viewrange),candidates=[];for(var i in result)if(result[i]instanceof SceneItem_1.default){var item=result[i];0==item.picked&&candidates.push(new SceneObjectActor_1.default(item))}return candidates},Find}(BaseComponent_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Find},{"../../enums/PersonTeams":49,"../../view/battlescene/scene/SceneItem":92,"../actions/SceneObjectActor":29,"./BaseComponent":31}],37:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseComponent_1=require("./BaseComponent"),SceneObjectActor_1=require("../actions/SceneObjectActor"),Globals_1=require("../../enums/Globals"),SceneItem_1=require("../../view/battlescene/scene/SceneItem"),SceneMoveObject_1=require("../../view/battlescene/scene/SceneMoveObject"),SceneItemTypes_1=require("../../enums/SceneItemTypes"),SceneManager_1=require("../../manager/SceneManager"),FrameTweenLite_1=require("../../base/utils/FrameTweenLite"),Foundation=function(_super){function Foundation(){_super.apply(this,arguments)}return __extends(Foundation,_super),Foundation.prototype.attach=function(actor){_super.prototype.attach.call(this,actor),actor.addMethod("distanceTo",this.distanceTo),actor.addMethod("wait",this.wait),actor.addMethod("now",this.now),actor.addMethod("open",this.open),actor.addMethod("check",this.check),actor.addMethod("costOf",this.costOf),actor.addMethod("setLightColor",this.setLightColor),actor.addMethod("toggleLight",this.toggleLight)},Foundation.prototype.distanceTo=function(obj){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,deltaX=obj.sceneObject.x-sceneObject.x,deltaY=obj.sceneObject.y-sceneObject.y;return Math.sqrt(deltaX*deltaX+deltaY*deltaY)/Globals_1.default.TILE_WIDTH},Foundation.prototype.open=function(target){var targetObj,targetPos,_this=this,sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld;_.isString(target)?targetObj=world.getSceneObjectByName(target):target instanceof SceneObjectActor_1.default&&(targetObj=target.sceneObject),targetObj&&(targetPos=targetObj.logicPosition),targetPos&&(targetPos.equals(sceneObject.logicPosition)?sceneObject.openSceneItem(targetObj):(sceneObjectActor.lock(),sceneObject.moveCloseTo(targetPos,2),sceneObject.once(SceneMoveObject_1.default.MOVE_FINISHED,function(){var hero=sceneObject;hero.openSceneItem(targetObj),hero.moveToNearestKeyPoint()?hero.once(SceneMoveObject_1.default.MOVE_FINISHED,function(event){sceneObjectActor.unlock()},_this):sceneObjectActor.unlock()},this)))},Foundation.prototype.check=function(target,time){var targetObj,sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject,world=sceneObject.gameWorld;if(_.isString(target))targetObj=world.getSceneObjectByName(target);else if(target instanceof SceneObjectActor_1.default&&(targetObj=target.sceneObject)instanceof SceneItem_1.default){var sceneItem=targetObj;if(parseInt(sceneItem.getData().type)!=SceneItemTypes_1.default.CHECKABLE_ITEM)return}if(targetObj){var battleScene_1=SceneManager_1.default.getInstance().getRunningScene();sceneObjectActor.lock(),battleScene_1.battleUI.showCheckTip(targetObj),FrameTweenLite_1.default.delayedCall(time||3,function(){sceneObjectActor.unlock(),battleScene_1.battleUI.hideCheckTip()})}},Foundation.prototype.wait=function(time){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject;sceneObjectActor.lock(),sceneObject.idle(),FrameTweenLite_1.default.delayedCall(time||3,function(){sceneObjectActor.unlock()})},Foundation.prototype.now=function(){var sceneObjectActor=this;return Math.floor(.001*(egret.getTimer()-sceneObjectActor.startTick))},Foundation.prototype.costOf=function(target){},Foundation.prototype.setLightColor=function(color){var colorTexture;switch(color){case"pink":colorTexture="Streamer_1";break;case"white":colorTexture="Streamer_2";break;case"green":colorTexture="Streamer_3";break;case"yellow":colorTexture="Streamer_4";break;case"red":colorTexture="Streamer_5"}if(colorTexture){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject;!sceneObject.drawContent||sceneObject.drawContent.length<1||(sceneObject.drawContent=colorTexture)}},Foundation.prototype.toggleLight=function(toggle){this.sceneObject.drawContent=toggle?"Streamer_1":""},Foundation}(BaseComponent_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Foundation},{"../../base/utils/FrameTweenLite":18,"../../enums/Globals":46,"../../enums/SceneItemTypes":52,"../../manager/SceneManager":57,"../../view/battlescene/scene/SceneItem":92,"../../view/battlescene/scene/SceneMoveObject":93,"../actions/SceneObjectActor":29,"./BaseComponent":31}],38:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseComponent_1=require("./BaseComponent"),SceneObjectActor_1=require("../actions/SceneObjectActor"),SceneMoveObject_1=require("../../view/battlescene/scene/SceneMoveObject"),Move=function(_super){function Move(){_super.apply(this,arguments)}return __extends(Move,_super),Move.prototype.attach=function(actor){_super.prototype.attach.call(this,actor),actor.addMethod("moveSimply",this.moveSimply),actor.addMethod("moveLeft",this.moveLeft),actor.addMethod("moveRight",this.moveRight),actor.addMethod("moveUp",this.moveUp),actor.addMethod("moveDown",this.moveDown),actor.addMethod("moveXY",this.moveXY),actor.addMethod("dash",this.dash),actor.addMethod("move",this.move),actor.addMethod("jumpTo",this.jumpTo)},Move.prototype.moveSimply=function(mx,my,times){var sceneObjectActor=this;sceneObjectActor.lock(),times=times||1;var sceneObject=sceneObjectActor.sceneObject;sceneObject.moveBy(mx*times,my*times),sceneObject.once(SceneMoveObject_1.default.MOVE_FINISHED,function(){sceneObjectActor.unlock()},this)},Move.prototype.moveLeft=function(times){this._methods.moveSimply.apply(this,[-10,0,times])},Move.prototype.moveRight=function(times){this._methods.moveSimply.apply(this,[10,0,times])},Move.prototype.moveUp=function(times){this._methods.moveSimply.apply(this,[0,-10,times])},Move.prototype.moveDown=function(times){this._methods.moveSimply.apply(this,[0,10,times])},Move.prototype.moveXY=function(x,y){var sceneObjectActor=this,sceneObject=sceneObjectActor.sceneObject;sceneObjectActor.lock();var targetPos=new egret.Point(x,y);if(sceneObject.logicPosition.equals(targetPos))return void sceneObjectActor.unlock();sceneObject.moveTo(targetPos),sceneObject.once(SceneMoveObject_1.default.MOVE_FINISHED,function(){sceneObjectActor.unlock()},this)},Move.prototype.dash=function(x,y){var actor=this;actor.lock(),actor.sceneObject.dashAction(new egret.Point(x,y)),actor.sceneObject.once(SceneMoveObject_1.default.MOVE_FINISHED,function(){actor.unlock()},this)},Move.prototype.move=function(target){var targetPos,actor=this;if(_.isString(target)){targetPos=actor.sceneObject.gameWorld.getSceneObjectByName(target).logicPosition}else target instanceof SceneObjectActor_1.default?targetPos=target.sceneObject.logicPosition:_.isObject(target)&&target.hasOwnProperty("x")&&target.hasOwnProperty("y")&&(targetPos=new egret.Point(target.x,target.y));this.moveXY(targetPos.x,targetPos.y)},Move.prototype.jumpTo=function(x,y){},Move}(BaseComponent_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Move},{"../../view/battlescene/scene/SceneMoveObject":93,"../actions/SceneObjectActor":29,"./BaseComponent":31}],39:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseInfo_1=require("../../base/info/BaseInfo"),GoalState_1=require("./GoalState"),GoalInfo=function(_super){function GoalInfo(){_super.call(this),this.state=GoalState_1.default.FAILED,this.whoMarkers={},this.targetMarkers={}}return __extends(GoalInfo,_super),Object.defineProperty(GoalInfo.prototype,"whos",{get:function(){if(!this.data.who)return null;if(!this._whos){this._whos=this.data.who.split("|");for(var i=this._whos.length-1;i>=0;i--){var who=this._whos[i];who.length<=1?this._whos.splice(i,1):this.whoMarkers[who]=!1}}return this._whos},enumerable:!0,configurable:!0}),Object.defineProperty(GoalInfo.prototype,"targets",{get:function(){if(!this.data.target)return null;if(!this._targets){this._targets=this.data.target.split("|");for(var i=this._targets.length-1;i>=0;i--){var target=this._targets[i];target.length<=1?this._targets.splice(i,1):this.targetMarkers[target]=!1}}return this._targets},enumerable:!0,configurable:!0}),Object.defineProperty(GoalInfo.prototype,"targetAllHit",{get:function(){for(var key in this.targetMarkers)if(!this.targetMarkers[key])return!1;return!0},set:function(value){for(var key in this.targetMarkers)this.targetMarkers[key]=value},enumerable:!0,configurable:!0}),Object.defineProperty(GoalInfo.prototype,"whoAllHit",{get:function(){for(var key in this.whoMarkers)if(!this.whoMarkers[key])return!1;return!0},set:function(value){for(var key in this.whoMarkers)this.whoMarkers[key]=value},enumerable:!0,configurable:!0}),GoalInfo}(BaseInfo_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GoalInfo},{"../../base/info/BaseInfo":4,"./GoalState":41}],40:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GoalInfo_1=require("./GoalInfo"),ConfigManager_1=require("../../manager/ConfigManager"),GoalState_1=require("./GoalState"),Interval_1=require("../../base/utils/Interval"),CodeWorkerManager_1=require("../../compile/CodeWorkerManager"),GoalManager=function(_super){function GoalManager(){_super.apply(this,arguments),this._interval=0}return __extends(GoalManager,_super),Object.defineProperty(GoalManager.prototype,"win",{get:function(){for(var i in this._keyGoals)if(this._keyGoals[i].state!=GoalState_1.default.SUCCESS)return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(GoalManager.prototype,"star",{get:function(){var result=0;if(!this.win)return result;this.win&&(result=1);var cs=this._positiveGoals.concat(this._negativeGoals),finishedCount=0;for(var i in cs)cs[i].state===GoalState_1.default.SUCCESS&&finishedCount++;return finishedCount/cs.length>=2/3&&result++,finishedCount/cs.length==1&&result++,result},enumerable:!0,configurable:!0}),Object.defineProperty(GoalManager.prototype,"currentGoals",{get:function(){return this._positiveGoals.concat(this._negativeGoals)},enumerable:!0,configurable:!0}),GoalManager.getInstance=function(){return GoalManager._instance||(GoalManager._instance=new GoalManager),GoalManager._instance},GoalManager.prototype.setSceneObject=function(sceneObject){this._sceneObject=sceneObject},GoalManager.prototype.dispose=function(){this._keyGoals=null,this._positiveGoals=null,this._negativeGoals=null,this._sceneObject=null,Interval_1.default.clearInterval(this._interval)},GoalManager.prototype.reset=function(){var cs=this._positiveGoals.concat(this._negativeGoals);for(var i in cs)this.setGoalInitState(cs[i]);this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,cs))},GoalManager.prototype.init=function(currentLevel){this._positiveGoals=[],this._negativeGoals=[],this._keyGoals=[];for(var levelData=ConfigManager_1.default.getInstance().getConfig("pve_story_level",currentLevel),goals=levelData.goal1.split("|"),i=0;i<goals.length;i++){var goalId=parseInt(goals[i]),goalInfo=new GoalInfo_1.default,goalData=ConfigManager_1.default.getInstance().getConfig("pve_story_level_goal",goalId);goalInfo.data=goalData,goalInfo.whos,goalInfo.targets,this.setGoalInitState(goalInfo),goalInfo.targetAllHit&&goalInfo.whoAllHit?this._positiveGoals.push(goalInfo):this._negativeGoals.push(goalInfo),0===parseInt(goalData.optional)&&this._keyGoals.push(goalInfo)}console.assert(this._keyGoals.length>0,"关键目标不能没有！！！"),this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_INITIALIZED,!1,!1,this._positiveGoals.concat(this._negativeGoals)))},GoalManager.prototype.check=function(){for(var i in this._positiveGoals)this.checkType(this._positiveGoals[i]);for(var i in this._negativeGoals)this.checkType(this._negativeGoals[i])},GoalManager.prototype.setGoalInitState=function(goalInfo){switch(parseInt(goalInfo.data.type)){case GoalManager.REACH_POINT:case GoalManager.DESTROY_PERSON:case GoalManager.PICK_UP_ITEM:case GoalManager.CODE_LINE_LIMIT:case GoalManager.CODE_CONTENT:case GoalManager.CALL_GROUP_TO_POINT:case GoalManager.MP_LIMIT:goalInfo.whoAllHit=!1,goalInfo.targetAllHit=!1;break;case GoalManager.NOT_REACH_POINT:case GoalManager.GROUP_ALIVE:case GoalManager.NOT_PICK_UP_ITEM:goalInfo.whoAllHit=!0,goalInfo.targetAllHit=!0}goalInfo.state=GoalState_1.default.FAILED},GoalManager.prototype.checkType=function(goalInfo){switch(parseInt(goalInfo.data.type)){case GoalManager.REACH_POINT:this.checkReachPoint(goalInfo);break;case GoalManager.NOT_REACH_POINT:this.checkNotReachPoint(goalInfo);break;case GoalManager.GROUP_ALIVE:this.checkGroupAlive(goalInfo);break;case GoalManager.DESTROY_PERSON:this.checkPersonDestroyed(goalInfo);break;case GoalManager.PICK_UP_ITEM:this.checkPickedItem(goalInfo);break;case GoalManager.NOT_PICK_UP_ITEM:this.checkPreventPickedItem(goalInfo);break;case GoalManager.CODE_LINE_LIMIT:this.checkCodeLine(goalInfo);break;case GoalManager.CODE_CONTENT:this.checkCodeContent(goalInfo);break;case GoalManager.CALL_GROUP_TO_POINT:this.checkGroupToPoint(goalInfo);break;case GoalManager.MP_LIMIT:this.checkMpLimit(goalInfo)}},GoalManager.prototype.start=function(){var _this=this;this._interval&&Interval_1.default.clearInterval(this._interval),this._interval=Interval_1.default.setInterval(function(){_this.check()},this,100)},GoalManager.prototype.stop=function(){Interval_1.default.clearInterval(this._interval)},GoalManager.prototype.checkPositives=function(){for(var i in this._positiveGoals)this._positiveGoals[i].whos.length>0&&this._positiveGoals[i].whoAllHit&&(this._positiveGoals[i].state=GoalState_1.default.SUCCESS,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,this._positiveGoals[i]))),this._positiveGoals[i].targets.length>0&&this._positiveGoals[i].targetAllHit&&(this._positiveGoals[i].state=GoalState_1.default.SUCCESS,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,this._positiveGoals[i])))},GoalManager.prototype.checkReachTarget=function(who,target,world){var reach=!1;return"exit"===target?reach=world.exitArea.contains(who.logicPosition.x,who.logicPosition.y):world.getAreaByID(target)&&(reach=world.getAreaByID(target).contains(who.x,who.y)),reach},GoalManager.prototype.checkReachPoint=function(goalInfo){if(!goalInfo.targetAllHit){var world=this._sceneObject.gameWorld,whoName=goalInfo.whos[0],who=world.getSceneObjectByName(whoName);console.assert(null!=who&&void 0!=who,"目标对象不能为空！");for(var _i=0,_a=goalInfo.targets;_i<_a.length;_i++){var target=_a[_i];this.checkReachTarget(who,target,world)&&(goalInfo.targetMarkers[target]=!0)}goalInfo.targetAllHit&&(goalInfo.state=GoalState_1.default.SUCCESS,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}},GoalManager.prototype.checkPersonDestroyed=function(goalInfo){if(!goalInfo.whoAllHit){for(var world=this._sceneObject.gameWorld,_i=0,_a=goalInfo.whos;_i<_a.length;_i++){var whoName=_a[_i],who=world.getSceneObjectByName(whoName);who&&(who.batterData.hp<=0&&(goalInfo.whoMarkers[whoName]=!0))}goalInfo.whoAllHit&&(goalInfo.state=GoalState_1.default.SUCCESS,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}},GoalManager.prototype.checkPickedItem=function(goalInfo){if(!goalInfo.targetAllHit){for(var hero=this._sceneObject,_i=0,_a=goalInfo.targets;_i<_a.length;_i++){var target=_a[_i];-1!=hero.getPickedItems().indexOf(target)&&(goalInfo.targetMarkers[target]=!0)}goalInfo.targetAllHit&&(goalInfo.state=GoalState_1.default.SUCCESS,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}},GoalManager.prototype.checkGroupToPoint=function(goalInfo){if(!goalInfo.whoAllHit){for(var world=this._sceneObject.gameWorld,targetName=goalInfo.targets[0],_i=0,_a=goalInfo.whos;_i<_a.length;_i++){var whoName=_a[_i],who=world.getSceneObjectByName(whoName);who&&(this.checkReachTarget(who,targetName,world)&&(goalInfo.whoMarkers[whoName]=!0))}goalInfo.whoAllHit&&(goalInfo.state=GoalState_1.default.SUCCESS,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}},GoalManager.prototype.checkMpLimit=function(goalInfo){if(!goalInfo.targetAllHit){for(var world=this._sceneObject.gameWorld,i=0;i<goalInfo.whos.length-1;i++){var whoName=goalInfo.whos[i];world.getSceneObjectByName(whoName).batterData.mp>=parseInt(goalInfo.targets[i])&&(goalInfo.targetMarkers[whoName]=!0)}goalInfo.targetAllHit&&(goalInfo.state=GoalState_1.default.SUCCESS,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}},GoalManager.prototype.checkNotReachPoint=function(goalInfo){if(goalInfo.targetAllHit){var world=this._sceneObject.gameWorld,whoName=goalInfo.whos[0],who=world.getSceneObjectByName(whoName);console.assert(null!=who&&void 0!=who,"目标对象不能为空！");for(var _i=0,_a=goalInfo.targets;_i<_a.length;_i++){var target=_a[_i];this.checkReachTarget(who,target,world)&&(goalInfo.targetMarkers[target]=!1)}goalInfo.targetAllHit||(goalInfo.state=GoalState_1.default.FAILED,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}},GoalManager.prototype.checkGroupAlive=function(goalInfo){if(goalInfo.whoAllHit){var world=this._sceneObject.gameWorld;if(world){for(var _i=0,_a=goalInfo.whos;_i<_a.length;_i++){var whoName=_a[_i],who=world.getSceneObjectByName(whoName);who&&(who.batterData.hp<=0&&(goalInfo.whoMarkers[whoName]=!1))}goalInfo.whoAllHit||(goalInfo.state=GoalState_1.default.FAILED,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}}},GoalManager.prototype.checkPreventPickedItem=function(goalInfo){if(goalInfo.targetAllHit){for(var hero=this._sceneObject,_i=0,_a=goalInfo.targets;_i<_a.length;_i++){var target=_a[_i];-1!=hero.getPickedItems().indexOf(target)&&(goalInfo.targetMarkers[target]=!1)}goalInfo.targetAllHit||(goalInfo.state=GoalState_1.default.FAILED,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}},
GoalManager.prototype.checkCodeLine=function(goalInfo){if(goalInfo.state!=GoalState_1.default.SUCCESS){var effectiveLine=CodeWorkerManager_1.default.getUserThread().getEffectiveCodeLine(),codeLineLimit=parseInt(goalInfo.data.codeline);codeLineLimit>0&&(effectiveLine<=codeLineLimit&&(goalInfo.state=GoalState_1.default.SUCCESS),this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}},GoalManager.prototype.checkCodeContent=function(goalInfo){if(goalInfo.state!=GoalState_1.default.SUCCESS){var userCode=CodeWorkerManager_1.default.getUserThread().getEditorText();if(!(userCode.length<=1)){for(var result=!0,_i=0,_a=goalInfo.targets;_i<_a.length;_i++){var target=_a[_i];-1==userCode.indexOf(target)&&(result=!1)}result&&(goalInfo.state=GoalState_1.default.SUCCESS,this.dispatchEvent(new egret.Event(GoalManager.GOAL_STATE_CHANGED,!1,!1,goalInfo)))}}},GoalManager.REACH_POINT=1,GoalManager.NOT_REACH_POINT=2,GoalManager.GROUP_ALIVE=3,GoalManager.DESTROY_PERSON=4,GoalManager.PICK_UP_ITEM=5,GoalManager.NOT_PICK_UP_ITEM=6,GoalManager.CODE_LINE_LIMIT=7,GoalManager.CODE_CONTENT=8,GoalManager.CALL_GROUP_TO_POINT=9,GoalManager.MP_LIMIT=10,GoalManager.GOAL_STATE_CHANGED="goal_state_changed",GoalManager.GOAL_STATE_INITIALIZED="goal_state_initialized",GoalManager.GOAL_WORLD_END="goal_world_end",GoalManager}(egret.EventDispatcher);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GoalManager},{"../../base/utils/Interval":19,"../../compile/CodeWorkerManager":26,"../../manager/ConfigManager":54,"./GoalInfo":39,"./GoalState":41}],41:[function(require,module,exports){"use strict";var GoalState=function(){function GoalState(){}return GoalState.SUCCESS=2,GoalState.FAILED=3,GoalState}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GoalState},{}],42:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},SyntaxCheckLoop_1=require("./SyntaxCheckLoop"),ProblemAlertView_1=require("./ProblemAlertView"),ConfigManager_1=require("../manager/ConfigManager"),DataAccessEntry_1=require("../model/DataAccessEntry"),DataAccessManager_1=require("../base/da/DataAccessManager"),World_1=require("../../src/view/battlescene/world/World"),editModes={javascript:"ace/mode/javascript",coffeescript:"ace/mode/coffee",python:"ace/mode/python",clojure:"ace/mode/clojure",lua:"ace/mode/lua",io:"ace/mode/text"},EditorAdapter=function(_super){function EditorAdapter(){_super.apply(this,arguments)}return __extends(EditorAdapter,_super),EditorAdapter.prototype.init=function(language){var _this=this;void 0===language&&(language="python"),this.language=language,this.editor=ace.edit("code-area"),this.editor.on("focus",function(){_this.dispatchEvent(new egret.Event("EditEvent",!1,!1,{type:"focus",data:!0}))}),this.editor.getSession().setTabSize(4),this.editor.setFontSize("14px"),this.editor.getSession().setUseSoftTabs(!0),this.editor.getSession().setMode("ace/mode/"+language),this.editor.setTheme("ace/theme/monokai"),this.editor.renderer.adjustWrapLimit(),this.editor.setAutoScrollEditorIntoView(!0),this.editor.renderer.setAnimatedScroll(!0),this.editor.setOption("highlightGutterLine",!0);var aceSession=this.editor.getSession();this.aceDoc=aceSession.getDocument(),aceSession.setUseWorker(!1),aceSession.setMode(editModes[language]),aceSession.setWrapLimitRange(null,null),aceSession.setUseWrapMode(!0),aceSession.setNewLineMode("windows"),aceSession.setUseSoftTabs(!0),this.editor.setShowPrintMargin(!1),this.editor.setShowInvisibles(!1),this.editor.setBehavioursEnabled(!0),this.editor.setShowFoldWidgets(!1),this.editor.setKeyboardHandler(null),this.editor.setHighlightActiveLine(!0),this.editor.$blockScrolling=1/0,this.createShortcuts(),this.initAutoComplete(!0,this.language),this.syntaxLoop=new SyntaxCheckLoop_1.default(this,this.language),this.problemShow=new ProblemAlertView_1.default;var self=this;this.editor.commands.on("exec",function(e){if(e.stopPropagation(),e.preventDefault(),-1!=["Enter","Return"].indexOf(e.command.name))return _this.zatanna&&_this.zatanna.on&&_this.zatanna.on(),e.editor.execCommand("optimizeInsertMatch");if(e.command&&_this.editor&&"updateTokensOnEnter"==e.command.name){_this.editor.getCursorPosition().row>=_this.editor.getSession().getLength()-2&&e.editor.renderer.scrollToRow(e.editor.renderer.getLastVisibleRow())}_this.zatanna&&_this.zatanna.on&&_this.zatanna.on(),e.command.exec(e.editor,e.args||{})}),this.oldValue="",this.newValue=this.editor.getValue();var self=this;this.editor.renderer.on("afterRender",function(){self.oldValue=self.newValue,self.editor?self.newValue=self.editor.getValue():self.newValue||(self.newValue=""),self.oldValue!=self.newValue&&self.syntaxLoop.transpile(self.editor.getValue())}),this.addEventListener(World_1.default.HERO_CLICKED,function(e){console.log(e.data)},this)},EditorAdapter.prototype.initAutoComplete=function(autocomplete,language){void 0===autocomplete&&(autocomplete=!0),this.autocomplete=autocomplete,this.zatanna=new Zatanna(this.editor,{basic:!0,liveCompletion:!0,snippetsLangDefaults:!1,completers:{keywords:!1,snippets:autocomplete,text:autocomplete},autoLineEndings:{javascript:";"},popupFontSizePx:16,popupWidthPx:380}),this.addMaliSnippets(language)},EditorAdapter.prototype.updateAutocomplete=function(autocomplete){this.autocomplete=autocomplete,this.zatanna&&this.zatanna.set("snippets",autocomplete)},EditorAdapter.prototype.getValidCodeLines=function(){for(var docLines=this.editor.session.doc.getAllLines(),docLength=this.editor.session.doc.getLength(),commentReg=/^\s*(#|\/\/)/,multiLineStartReg=/^\s*(\/\*)/,multiLineEndReg=/.*(\*\/)/,isInMultiComment=!1,notValidLineNum=0,i=0;i<docLength;++i){var docLine=docLines[i];multiLineStartReg.test(docLine)?isInMultiComment=!0:multiLineEndReg.test(docLine)&&(isInMultiComment=!1,++notValidLineNum),1==isInMultiComment?++notValidLineNum:(commentReg.test(docLine)||/^$/.test(docLine))&&++notValidLineNum}return docLength-notValidLineNum},EditorAdapter.prototype.createShortcuts=function(){var _this=this,addCommand=function(command){_this.editor.commands.addCommand(command)};addCommand({name:"test",bindKey:"F7",exec:function(){console.log("F7 pressed"),_this.syntaxLoop.transpile()}}),addCommand({name:"optimizeInsertMatch",bindKey:"Enter|Return",exec:function(){if(_this.editor.getSession().selection.isEmpty()){var cursor=_this.editor.getCursorPosition(),line=_this.aceDoc.getLine(cursor.row),popup=_this.editor.completer.popup,lineSlice=line.slice(0,cursor.column),lineData=lineSlice.split(/[^,]?\s*;\s*|[^,]?\s+/);if(!popup.getData(popup.getRow()).snippet||lineData.length<1)_this.editor.completer.insertMatch();else if(_this.editor.completer.popup.isOpen){var snippetCode=popup.getData(popup.getRow()).snippet,bracketRight=lineSlice.lastIndexOf(")"),heroRight=lineSlice.lastIndexOf("hero");if(-1!=bracketRight&&-1!=heroRight&&bracketRight<heroRight||-1==bracketRight&&-1!=heroRight){var startColum=Math.max(cursor.column-lineData.slice(-1)[0].length,bracketRight),Range_1=ace.require("./range").Range,range=new Range_1(cursor.row,startColum,cursor.row,cursor.column);_this.editor.getSession().remove(range)}_this.editor.completer.insertMatch();var skillConfig=ConfigManager_1.default.getInstance().getConfigs("skill"),needLineWrap=[];for(var skillId in skillConfig)"1"==skillConfig[skillId].islinebreak&&needLineWrap.push(skillConfig[skillId]["snippet_"+_this.language]);-1!=needLineWrap.indexOf(snippetCode)&&(!0,_this.editor.insert("\n"))}else _this.editor.execCommand("insertstring","\n"),_this.editor.renderer.scrollCursorIntoView(),_this.editor.renderer.animateScrolling(_this.editor.renderer.scrollTop)}}})},EditorAdapter.prototype.addMaliSnippets=function(language){for(var userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data,ownEquipIds=userInfo.ownedHero.items,snippets=[],_i=0,ownEquipIds_1=ownEquipIds;_i<ownEquipIds_1.length;_i++){var itemId=ownEquipIds_1[_i],equip=userInfo.getEquipById(itemId);if(equip&&equip.data.skill&&!(equip.data.skill.length<5))for(var skillIds=equip.data.skill.split("|"),_a=0,skillIds_1=skillIds;_a<skillIds_1.length;_a++){var skillId=skillIds_1[_a],skillData=ConfigManager_1.default.getInstance().getConfig("skill",parseInt(skillId));skillData&&snippets.push({content:skillData["snippet_"+language],meta:"press enter",name:skillData.type,tabTrigger:skillData.tabtrigger})}}snippets.push({content:"hero.say(${1:})",meta:"press enter",name:"say",tabTrigger:"say"}),this.zatanna.addSnippets(snippets,language)},EditorAdapter.prototype.show=function(){document.getElementById("code-area").style.display="block"},EditorAdapter.prototype.hide=function(){document.getElementById("code-area").style.display="none"},EditorAdapter.prototype.dispose=function(){this.hide(),this.syntaxLoop.terminate(),ProblemAlertView_1.default.getInstance().hideProblems(),this.editor.setValue(""),this.editor=null},EditorAdapter}(egret.EventDispatcher);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EditorAdapter},{"../../src/view/battlescene/world/World":103,"../base/da/DataAccessManager":2,"../manager/ConfigManager":54,"../model/DataAccessEntry":59,"./ProblemAlertView":43,"./SyntaxCheckLoop":44}],43:[function(require,module,exports){"use strict";var ProblemAlertView=function(){function ProblemAlertView(){this.template=_.template("<p><div style='position:absolute; left:3px; width:248px; height:30px;border-bottom:1px solid white;'><span style='position:relative; left:7px; top: 10px;font-size:14px; color: #ffffff;'>修正你的代码</span><span style='position:absolute; top:3px; width: 31px; height: 31px; right:-3px;'><span id='problem-alert-close-btn'onmouseover='this.style.backgroundPosition=\"left -27px\"'onmouseout='this.style.backgroundPosition=\"left top\"'style='position:absolute; width:27px; height:27px; background:url(\"resource/battle/ace/error_btn.png\")'></span></span></div></p><span  style='position:relative; left:7px; top: 34px; font: monaco bold 13px; text-align:left; color:#ffffff;'>可能的错误:</span><% for(var i=0; i<problems.length; ++ i) {%><div style='left:7px; color: #ffffff; display:block; top: <%= 7 * i + 37 %>px; position:relative;line-height:120%'><%= problems[i]['text'] %></div> <% } %></div>");var problems=[{text:"Unmerged error",raw:"Merged Warning"}];this.el=document.getElementById("problem-alert-view"),this.el.innerHTML=this.template({problems:problems});var self=this;document.getElementById("problem-alert-close-btn").onclick=function(e){self.hideProblems()}}return ProblemAlertView.getInstance=function(){return this.pInstance||(this.pInstance=new ProblemAlertView)},ProblemAlertView.prototype.destroy=function(){},ProblemAlertView.prototype.onCloseBtnClick=function(e){this.hideProblems()},ProblemAlertView.prototype.setProblems=function(problems){!problems||problems.length<=0?this.hideProblems():this.showProblems(problems)},ProblemAlertView.prototype.showProblems=function(problems){if(problems&&problems.length&&(this.problems=problems),this.problems&&this.problems.length&&(this.el.innerHTML=this.template({problems:this.problems}),this.el.visible=!0,this.el.style.display="block"),null==document.getElementById("problem-alert-close-btn").onclick){var self=this;document.getElementById("problem-alert-close-btn").onclick=function(e){self.hideProblems()}}},ProblemAlertView.prototype.hideProblems=function(){this.el.visible=!1,this.el.style.display="none"},ProblemAlertView}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ProblemAlertView},{}],44:[function(require,module,exports){"use strict";var SyntaxCheckLoop=function(){function SyntaxCheckLoop(editorAdapter,language){this.editor=editorAdapter.editor,this.worker=new Worker("js/worker.js");var userCode=this.editor.getValue();this.worker.postMessage({type:"transpile",rawCode:userCode});var notifyErrors=function(e){var data=e.data;if("compile_info"==data.type){var problems=data.problems,errors=problems.errors;errors.forEach(function(error){error.type="error",error.row=error.range&&error.range[0]&&error.range[0].row,error.text=error.message}),this.editor.renderer.setAnnotations(errors),editorAdapter.problemShow.setProblems(errors)}}.bind(this);this.worker.onmessage=notifyErrors}return SyntaxCheckLoop.prototype.transpile=function(userCode){userCode||(userCode=this.editor.getValue()),this.worker.postMessage({type:"transpile",rawCode:userCode})},SyntaxCheckLoop.prototype.changeLanguage=function(language){this.worker.postMessage({type:"change_language",language:language})},SyntaxCheckLoop.prototype.terminate=function(){this.worker&&this.worker.terminate()},SyntaxCheckLoop}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SyntaxCheckLoop},{}],45:[function(require,module,exports){"use strict";var CommonConfig=function(){function CommonConfig(){}return CommonConfig.EQUIP_ALL=0,CommonConfig.EQUIP_PRIMARY_ATTACK=1,CommonConfig.EQUIP_ASSISTANT_ATTACK=2,CommonConfig.EQUIP_ARMOR=3,CommonConfig.EQUIP_MICROCHIP=4,CommonConfig.EQUIP_COMPASS=5,CommonConfig.EQUIP_BARITE_TYPE1=6,CommonConfig.EQUIP_BARITE_TYPE2=7,CommonConfig.EQUIP_BARITE_TYPE3=8,CommonConfig.EQUIP_TYPES=["EQUIP_PRIMARY_ATTACK","EQUIP_ASSISTANT_ATTACK","EQUIP_ARMOR","EQUIP_MICROCHIP","EQUIP_COMPASS","EQUIP_BARITE_TYPE1","EQUIP_BARITE_TYPE2","EQUIP_BARITE_TYPE3"],CommonConfig.EQUIP_TYPES_CN=["主手","副手","护甲","芯片","罗盘","晶石次元","晶石预言","晶石塑能"],CommonConfig.CAREER_WARRIOR=1,CommonConfig.CAREER_MAGICIAN=2,CommonConfig.CAREER_SHOOTER=3,CommonConfig.CAREER_ASSASSIN=4,CommonConfig}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CommonConfig},{}],46:[function(require,module,exports){"use strict";var Globals=function(){function Globals(){}return Globals.GAME_WIDTH=1920,Globals.GAME_HEIGHT=1080,Globals.BATTLE_AREA_WIDTH_RATIO=.55,Globals.CODE_AREA_HEIGHT_RATIO=.62,Globals.MAX_INIT_VIGOR=150,Globals.TILE_WIDTH=16,Globals.TILE_HEIGHT=16,Globals.PALETTE_WIDTH=(1-Globals.BATTLE_AREA_WIDTH_RATIO)*Globals.GAME_WIDTH-5,Globals.PALETTE_HEIGHT=(1-Globals.CODE_AREA_HEIGHT_RATIO)*Globals.GAME_HEIGHT-60,Globals.STATUS_CODE_SUCCESS=200,Globals.HERO_CAREER={1:"warrior",2:"mage",3:"gunman",4:"assassin"},Globals.BADGE_TYPE_PYTHON=10,Globals.BADGE_TYPE_JAVASCRIPT=11,Globals.domGameWidth=0,Globals.domGameHeight=0,Globals.scaleRatio=0,Globals.guide=!0,Globals}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Globals},{}],47:[function(require,module,exports){"use strict";var HostConfig=function(){function HostConfig(){}return HostConfig.SESTEM_PLAYER=0,HostConfig.SESTEM_SETTING=1,HostConfig.SESTEM_ADD_CLASS=2,HostConfig.EQUIP_TYPES=["SESTEM_SETTING","SESTEM_ADD_CLASS"],HostConfig}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HostConfig},{}],48:[function(require,module,exports){"use strict";var Language=function(){function Language(){}return Language.JAVASCRIPT="javascript",Language.PYTHON="python",Language.LUA="lua",Language.COFFEESCRIPT="coffeescript",Language}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Language},{}],49:[function(require,module,exports){"use strict";var PersonTeams=function(){function PersonTeams(){}return PersonTeams.FRIEND=1,PersonTeams.HOSTILE=2,PersonTeams.NEUTRAL=3,PersonTeams.CHAOS=4,PersonTeams.GOODMAN=5,PersonTeams}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PersonTeams},{}],50:[function(require,module,exports){"use strict";var PersonTypes=function(){function PersonTypes(){}return PersonTypes.NPC=1,PersonTypes.MONSTER=2,PersonTypes.CREATURE=3,PersonTypes.HERO=4,PersonTypes.BOMB=5,PersonTypes}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PersonTypes},{}],51:[function(require,module,exports){"use strict";var Protocols=function(){function Protocols(){}return Protocols.QUERY_ENTRY="gate.gateHandler.queryEntry",Protocols.ROUTE_LOGIN="connector.entryHandler.enter",Protocols.ROUTE_PLAYSTORY="game.gameHandler.playStory",Protocols.ROUTE_GETSTORYINFO="game.gameHandler.getStoryInfo",Protocols.ROUTE_USEITEM="game.gameHandler.useItem",Protocols.ROUTE_SELECT_HERO="game.gameHandler.selectHero",Protocols.ROUTE_CHANGE_NAME="game.gameHandler.changeName",Protocols.ROUTE_BUY_HERO="game.gameHandler.buyHero",Protocols.ROUTE_SAVE_STORY_CODE="game.gameHandler.saveStoryCode",Protocols.ROUTE_GET_STORY_CODE="game.gameHandler.getStoryCode",Protocols.ROUTE_ASKQUESTION="game.gameHandler.askQuestion",Protocols.ROUTE_GETQUESTIONS="game.gameHandler.getQuestions",Protocols.ROUTE_GETREPLYS="game.gameHandler.getReplys",Protocols.ROUTE_REPLYQUESTION="game.gameHandler.replyQuestion",Protocols.ROUTE_PUSHQUESTION="game.gameHandler.pushQuestion",Protocols.ROUTE_PUSHREPLY="game.gameHandler.pushReply",Protocols.ROUTE_GETUSERINFO="game.gameHandler.getUserInfo",Protocols.ROUTE_READREPLY="game.gameHandler.readReply",Protocols.ROUTE_GETUSERID="game.gameHandler.getUserId",Protocols.ROUTE_PUSH_CLASSLOCK="game.gameHandler.classLock",Protocols.ROUTE_LOCK_CLASS="game.gameHandler.lockClass",Protocols.ROUTE_REMOVE_QUESTION="game.gameHandler.removeQuestion",Protocols.ROUTE_REMOVE_REPLY="game.gameHandler.removeReply",Protocols}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Protocols},{}],52:[function(require,module,exports){"use strict";var SceneItemTypes=function(){function SceneItemTypes(){}return SceneItemTypes.STATIC_MATERIAL=1,SceneItemTypes.GUIDE=2,SceneItemTypes.PICKABLE_ITEM=3,SceneItemTypes.ALTERNATIVE_ITEM=4,SceneItemTypes.TRANSFER_POINT=5,SceneItemTypes.STUFF=6,SceneItemTypes.CHECKABLE_ITEM=7,SceneItemTypes}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SceneItemTypes},{}],53:[function(require,module,exports){Main=require("./Main").default,egret.runEgret({renderMode:"webgl",audioType:0})},{"./Main":1}],54:[function(require,module,exports){"use strict";var ConfigManager=function(){function ConfigManager(){this.maps={},this._dictionary=new Object}return ConfigManager.getInstance=function(){return this._instance||(this._instance=new ConfigManager)},ConfigManager.prototype.parseConfig=function(fileName){var fileData=RES.getRes(fileName);console.assert(void 0!=fileData,"[ConfigManager.parseConfig] file "+fileName+"找不到！！！");var keys,lines=fileData.split("\n");this._dictionary[fileName]=new Object,"skill"==fileName&&(this._dictionary[fileName+"name"]=new Object);for(var i=0;i<lines.length-1;i++)if(0==i)keys=lines[i].split("^");else if(lines[i].length>0){for(var values=lines[i].split("^"),dat=new Object,n=1;n<keys.length-1;n++)dat[keys[n]]=values[n];dat[keys[1]]&&dat&&(this._dictionary[fileName][Number(dat[keys[1]])]=dat),"skill"==fileName&&dat&&dat.type&&dat.type.length>1&&(this._dictionary[fileName+"name"][dat.type]=Number(dat.id))}},ConfigManager.prototype.init=function(){this.parseConfig("buff"),this.parseConfig("hero"),this.parseConfig("item"),this.parseConfig("npc_enemy"),this.parseConfig("pve_story_group"),this.parseConfig("pve_story_level"),this.parseConfig("pve_story_level_goal"),this.parseConfig("pve_story_map"),this.parseConfig("skill"),this.parseConfig("action"),this.parseConfig("equip"),this.parseConfig("ai"),this.parseConfig("story"),this.parseConfig("event"),this.parseConfig("guide"),RES.destroyRes("config")},ConfigManager.prototype.loadConfig=function(fileName){var url="resource/config/"+fileName+".csv",cfgLoader=new egret.URLLoader;cfgLoader.dataFormat=egret.URLLoaderDataFormat.TEXT,cfgLoader.addEventListener(egret.Event.COMPLETE,function(event){ConfigManager.getInstance().parseConfig(fileName),event.target.dispatchEvent(new egret.Event(ConfigManager.CONFIGLOADED,!1,!1,fileName))},url),cfgLoader.load(new egret.URLRequest(url))},ConfigManager.prototype.getConfigs=function(fileName){return this._dictionary[fileName]},ConfigManager.prototype.getConfig=function(fileName,id){return this._dictionary[fileName][id]},ConfigManager.prototype.getValue=function(fileName,id,key){return this._dictionary[fileName][id][key]},ConfigManager.prototype.getIDByName=function(fileName,name){return this._dictionary[fileName+"name"][name]},ConfigManager.prototype.getSkillIdByType=function(type){var tables=ConfigManager.getInstance().getConfigs("skill");for(var key in tables){var t=tables[key];if(t.type===type)return parseInt(t.id)}return 0},ConfigManager.CONFIGLOADED="config_loaded",ConfigManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ConfigManager},{}],55:[function(require,module,exports){"use strict";var LayerManager=function(){function LayerManager(){throw new Error("Current class could  not be instantiated!")}return LayerManager.init=function(stage){LayerManager._stage=stage,LayerManager.create()},LayerManager.create=function(){LayerManager._appLayer=new eui.UILayer,LayerManager._popLayer=new eui.UILayer,LayerManager._tipLayer=new eui.UILayer,LayerManager._stage.addChild(LayerManager._appLayer),LayerManager._stage.addChild(LayerManager._popLayer),LayerManager._stage.addChild(LayerManager._tipLayer),LayerManager.enableInteractive(LayerManager._appLayer),LayerManager.enableInteractive(LayerManager._popLayer),LayerManager.enableInteractive(LayerManager._tipLayer)},LayerManager.enableInteractive=function(layer){layer.touchEnabled=!0,layer.touchChildren=!0,layer.touchThrough=!0},Object.defineProperty(LayerManager,"appLayer",{get:function(){return LayerManager._appLayer},enumerable:!0,configurable:!0}),Object.defineProperty(LayerManager,"popLayer",{get:function(){return LayerManager._popLayer},enumerable:!0,configurable:!0}),Object.defineProperty(LayerManager,"tipLayer",{get:function(){return LayerManager._tipLayer},enumerable:!0,configurable:!0}),Object.defineProperty(LayerManager,"stage",{get:function(){return LayerManager._stage},enumerable:!0,configurable:!0}),LayerManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=LayerManager},{}],56:[function(require,module,exports){"use strict";var Globals_1=require("../enums/Globals"),ResizeManager=function(){function ResizeManager(){}return ResizeManager.init=function(){ResizeManager.resizeView(),window.addEventListener("resize",function(event){ResizeManager.resizeView()},!1)},ResizeManager.resizeView=function(){var realWidth=0,realHeight=0,left=0,top=0;window.innerWidth/window.innerHeight>=Globals_1.default.GAME_WIDTH/Globals_1.default.GAME_HEIGHT?(realHeight=window.innerHeight,realWidth=realHeight*Globals_1.default.GAME_WIDTH/Globals_1.default.GAME_HEIGHT,left=.5*(window.innerWidth-realWidth)):(realWidth=window.innerWidth,realHeight=realWidth*Globals_1.default.GAME_HEIGHT/Globals_1.default.GAME_WIDTH,top=.5*(window.innerHeight-realHeight)),Globals_1.default.domGameWidth=realWidth,Globals_1.default.domGameHeight=realHeight,Globals_1.default.scaleRatio=realWidth/Globals_1.default.GAME_WIDTH,document.getElementById("code-area").style.left=realWidth*Globals_1.default.BATTLE_AREA_WIDTH_RATIO+left+10+"px",document.getElementById("code-area").style.top=top+20+"px",document.getElementById("code-area").style.width=realWidth*(1-Globals_1.default.BATTLE_AREA_WIDTH_RATIO)-20+"px",document.getElementById("code-area").style.height=realHeight*Globals_1.default.CODE_AREA_HEIGHT_RATIO-70+"px";Globals_1.default.BATTLE_AREA_WIDTH_RATIO,Globals_1.default.CODE_AREA_HEIGHT_RATIO;document.getElementById("problem-alert-view").style.top=110+top+"px",document.getElementById("problem-alert-view").style.left=realWidth*Globals_1.default.BATTLE_AREA_WIDTH_RATIO-255+left+"px"},ResizeManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ResizeManager},{"../enums/Globals":46}],57:[function(require,module,exports){"use strict";var MainScene_1=require("../view/mainscene/MainScene"),SceneManager=function(){function SceneManager(){this._scenes=[],this._popups=[]}return SceneManager.getInstance=function(){return null==this._instance&&(this._instance=new SceneManager),this._instance},SceneManager.prototype.init=function(stage){this._stage=stage},SceneManager.prototype.getStage=function(){return this._stage},SceneManager.prototype.serverBack=function(route,data){this._scenes[this._scenes.length-1].callback(route,data);for(var i=0;i<this._popups.length;i++)this._popups[i].callback(route,data)},SceneManager.prototype.getRunningScene=function(){return this._scenes[this._scenes.length-1]},SceneManager.prototype.popScene=function(ck){void 0===ck&&(ck=!0),this._scenes.length>0?(this._stage.removeChild(this._scenes[this._scenes.length-1]),this._scenes.pop().dispose(),this._scenes.length>0&&this._scenes[this._scenes.length-1].onEnter()):ck&&this.pushScene(new MainScene_1.default,1)},SceneManager.prototype.pushScene=function(scene,data){this._scenes.push(scene),this._stage.addChild(this._scenes[this._scenes.length-1]),this._scenes[this._scenes.length-1].onEnter(),data&&this._scenes[this._scenes.length-1].setData(data)},SceneManager.prototype.replaceScene=function(scene,data){this.popScene(!1),this._scenes.push(scene),this._stage.addChild(this._scenes[this._scenes.length-1]),this._scenes[this._scenes.length-1].onEnter(),data&&this._scenes[this._scenes.length-1].setData(data)},Object.defineProperty(SceneManager.prototype,"numScenes",{get:function(){return this._scenes.length},enumerable:!0,configurable:!0}),SceneManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SceneManager},{"../view/mainscene/MainScene":144}],58:[function(require,module,exports){"use strict";var SoundManager=function(){function SoundManager(){this.sounds={},this.soundChannels={},this.volume=1,this.musicVolume=1,this.effectVolume=1}return SoundManager.prototype.setVolume=function(volume){for(var soundId in this.soundChannels){var channel=this.soundChannels[soundId];0!=channel.position&&(channel.volume=volume)}this.volume=volume},SoundManager.prototype.playMusic=function(soundId,startTime,loops){void 0===startTime&&(startTime=0),void 0===loops&&(loops=1),this.play(soundId,startTime,loops,egret.Sound.MUSIC)},SoundManager.prototype.playEffect=function(soundId,startTime,loops){void 0===startTime&&(startTime=0),void 0===loops&&(loops=1),this.play(soundId,startTime,loops,egret.Sound.EFFECT)},SoundManager.prototype.playAsyncEffect=function(url,startTime,loops){if(void 0===startTime&&(startTime=0),void 0===loops&&(loops=1),this.soundChannels[url]&&this.sounds[url]){this.soundChannels[url].stop();var chanel=this.sounds[url].play(startTime,loops);return chanel.volume=this.effectVolume,void(this.soundChannels[url]=chanel)}RES.getResByUrl("resource/sounds/"+url+".mp3",function(data,url){if(data){this.sounds[url]=data,this.sounds[url].type=egret.Sound.EFFECT;var chanel=this.sounds[url].play(startTime,loops);chanel.volume=this.effectVolume,this.soundChannels[url]=chanel,console.log("loaded sound:"+url)}},this)},SoundManager.prototype.play=function(soundId,startTime,loops,type){if(void 0===startTime&&(startTime=0),void 0===loops&&(loops=1),void 0===type&&(type=egret.Sound.EFFECT),this.soundChannels[soundId]&&this.sounds[soundId]){this.soundChannels[soundId].stop();var chanel=this.sounds[soundId].play(startTime,loops);return chanel.volume=type==egret.Sound.EFFECT?this.effectVolume:this.musicVolume,void(this.soundChannels[soundId]=chanel)}RES.getResAsync(soundId,function(data,url){if(data){this.sounds[soundId]=data,this.sounds[soundId].type=type;var chanel=this.sounds[soundId].play(startTime,loops);chanel.volume=type==egret.Sound.EFFECT?this.effectVolume:this.musicVolume,this.soundChannels[soundId]=chanel,console.log("loaded sound:"+url)}},this)},SoundManager.prototype.stop=function(soundId){this.sounds.hasOwnProperty(soundId)&&(this.soundChannels[soundId].stop(),delete this.soundChannels[soundId],delete this.sounds[soundId])},SoundManager.prototype.stopMusic=function(){for(var soundId in this.soundChannels)this.sounds[soundId].type===egret.Sound.MUSIC&&this.soundChannels[soundId].stop()},SoundManager.prototype.stopEffect=function(){for(var soundId in this.soundChannels)this.sounds[soundId].type===egret.Sound.EFFECT&&this.soundChannels[soundId].stop()},SoundManager.prototype.setMusicVolume=function(vol){for(var soundId in this.soundChannels)if(this.sounds[soundId].type===egret.Sound.MUSIC){var channel=this.soundChannels[soundId];0!=channel.position&&(channel.volume=vol)}this.musicVolume=vol},SoundManager.prototype.setEffectVolume=function(vol){for(var soundId in this.soundChannels)if(this.sounds[soundId].type===egret.Sound.EFFECT){var channel=this.soundChannels[soundId];0!=channel.position&&(channel.volume=vol)}this.effectVolume=vol},SoundManager.prototype.dispose=function(){for(var soundId in this.soundChannels)this.soundChannels[soundId].stop(),this.sounds[soundId].close();this.soundChannels={},this.sounds={}},SoundManager.prototype.restoreSoundSetting=function(){var musicState=egret.localStorage.getItem("musicSwitch");"on"!=musicState&&musicState?SoundManager.getInstance().setMusicVolume(0):SoundManager.getInstance().setMusicVolume(1);var effectState=egret.localStorage.getItem("effectSwitch");"on"!=effectState&&effectState?SoundManager.getInstance().setEffectVolume(0):SoundManager.getInstance().setEffectVolume(1)},SoundManager.getInstance=function(){return null==SoundManager._instance&&(SoundManager._instance=new SoundManager),SoundManager._instance},SoundManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SoundManager},{}],59:[function(require,module,exports){"use strict";var DataAccessManager_1=require("../base/da/DataAccessManager"),LoginProxy_1=require("./da/LoginProxy"),UserInfoProxy_1=require("./da/UserInfoProxy"),UserInfo_1=require("./vo/UserInfo"),BattleInfoProxy_1=require("./da/BattleInfoProxy"),BattleInfo_1=require("./vo/BattleInfo"),TeachSystemProxy_1=require("./da/TeachSystemProxy"),TeachSystemInfo_1=require("./vo/teach/TeachSystemInfo"),DataAccessEntry=function(){function DataAccessEntry(){}return DataAccessEntry.init=function(){DataAccessManager_1.default.addAccess(new LoginProxy_1.default(DataAccessEntry.LOGIN_PROXY)),DataAccessManager_1.default.addAccess(new UserInfoProxy_1.default(DataAccessEntry.USERINFO_PROXY,new UserInfo_1.default)),DataAccessManager_1.default.addAccess(new BattleInfoProxy_1.default(DataAccessEntry.BATTLE_INFO_PROXY,new BattleInfo_1.default)),DataAccessManager_1.default.addAccess(new TeachSystemProxy_1.default(DataAccessEntry.TEACH_SYSTEM_PROXY,new TeachSystemInfo_1.default))},DataAccessEntry.LOGIN_PROXY="connector",DataAccessEntry.USERINFO_PROXY="userinfo",DataAccessEntry.BATTLE_INFO_PROXY="battleInfoProxy",DataAccessEntry.TEACH_SYSTEM_PROXY="teachSytemProxy",DataAccessEntry}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DataAccessEntry},{"../base/da/DataAccessManager":2,"./da/BattleInfoProxy":63,"./da/LoginProxy":64,"./da/TeachSystemProxy":66,"./da/UserInfoProxy":67,"./vo/BattleInfo":70,"./vo/UserInfo":73,"./vo/teach/TeachSystemInfo":76}],60:[function(require,module,exports){"use strict";var AIInfo=function(){function AIInfo(timer,cfg){if(this.endPoint=new egret.Point(0,0),this.type=0,this.event="",this.next=[],this.overTime=0,this.skill=0,this.focusName="",this.gNPC="",this.gHP=0,cfg.gNPC.length>1&&(this.gNPC=cfg.gNPC),Number(cfg.gHP)>0&&(this.gHP=Number(cfg.gHP)),cfg.focusName.length>1&&(this.focusName=cfg.focusName),Number(cfg.endX)>0&&(this.endPoint=new egret.Point(Math.floor(Number(cfg.endX)+Math.random()*Number(cfg.endRange)),Math.floor(Number(cfg.endY)+Math.random()*Number(cfg.endRange)))),this.type=Number(cfg.type),cfg.next.length>0)for(var ids=cfg.next.split("|"),i=0;i<ids.length;i++)Number(ids[i])>0&&this.next.push(Number(ids[i]));this.overTime=Math.floor(timer)+Number(cfg.delayTime),this.skill=Number(cfg.skill),this.event=cfg.event}return AIInfo}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=AIInfo},{}],61:[function(require,module,exports){"use strict"
;var BuffInfo=function(){function BuffInfo(cfg){this.delayTime=0,this.hp=0,this.speed=1,this.attack_add=1,this.safe_range=1,this.hurt_cut=0,this.isOver=!1,this.confuse=0,this.delayTime=Number(cfg.delay_time),this.hp=Number(cfg.hp_add),this.speed=Number(cfg.speed),this.attack_add=Number(cfg.attack_add),this.safe_range=Number(cfg.safe_range),this.hurt_cut=Number(cfg.hurt_cut),this.confuse=Number(cfg.confuse)}return BuffInfo}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BuffInfo},{}],62:[function(require,module,exports){"use strict";var PersonInfo=function(){function PersonInfo(cfg){this._hp=0,this._mp=0,this.maxhp=0,this.team=0,this.viewrange=0,this.attackID=0,this.skillID=0,this.attack_add=0,this.attack_base=0,this.hurt_cut=0,this.sayhi=0,this.safeRange=0,this._hp=Number(cfg.hp),this.maxhp=this._hp,this.team=Number(cfg.team),this.viewrange=Number(cfg.viewrange),this.attackID=Number(cfg.attack),this.skillID=Number(cfg.skill),this.attack_base=Number(cfg.atkdamage),this.sayhi=Number(cfg.sayhi)}return Object.defineProperty(PersonInfo.prototype,"hp",{get:function(){return this._hp},set:function(v){this._hp=v},enumerable:!0,configurable:!0}),Object.defineProperty(PersonInfo.prototype,"mp",{get:function(){return this._mp},set:function(v){this._mp=v},enumerable:!0,configurable:!0}),PersonInfo}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PersonInfo},{}],63:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ServerAccessProxy_1=require("./ServerAccessProxy"),NetManager_1=require("../net/NetManager"),Protocols_1=require("../../enums/Protocols"),BattleInfoProxy=function(_super){function BattleInfoProxy(){_super.apply(this,arguments)}return __extends(BattleInfoProxy,_super),BattleInfoProxy.prototype.parseReceivedData=function(rawData){if(_super.prototype.parseReceivedData.call(this,rawData),Protocols_1.default.ROUTE_GET_STORY_CODE==rawData.route){var info=this.data,codeInfo=rawData.data.storycode;info.codeId=codeInfo.id;var codeResult=codeInfo.code;codeResult.length>0&&(info.userCode=codeResult,NetManager_1.default.getInstance().dispatchEvent(new egret.Event(BattleInfoProxy.USER_CODE_CHANGED,!1,!1,info)))}Protocols_1.default.ROUTE_SAVE_STORY_CODE==rawData.route&&console.log("save user code complete.")},BattleInfoProxy.USER_CODE_CHANGED="userCodeChanged",BattleInfoProxy}(ServerAccessProxy_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BattleInfoProxy},{"../../enums/Protocols":51,"../net/NetManager":68,"./ServerAccessProxy":65}],64:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ServerAccessProxy_1=require("./ServerAccessProxy"),NetManager_1=require("../net/NetManager"),DataAccessEntry_1=require("../DataAccessEntry"),DataAccessManager_1=require("../../base/da/DataAccessManager"),HeroInfo_1=require("../vo/HeroInfo"),EquipInfo_1=require("../vo/EquipInfo"),Platform_1=require("../../platforms/Platform"),MaliPlatform_1=require("../../platforms/MaliPlatform"),Protocols_1=require("../../enums/Protocols"),LoginProxy=function(_super){function LoginProxy(){_super.apply(this,arguments)}return __extends(LoginProxy,_super),LoginProxy.prototype.parseReceivedData=function(rawData){if(_super.prototype.parseReceivedData.call(this,rawData),rawData.route==Protocols_1.default.ROUTE_LOGIN){var resInfo=rawData.data.user,userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data;userInfo.uuid=parseInt(resInfo.id),userInfo.exp=parseInt(resInfo.exp),userInfo.diamond=parseInt(resInfo.diamond),userInfo.level=parseInt(resInfo.level),userInfo.nickName=resInfo.name,userInfo.vigor=parseInt(resInfo.physical),userInfo.serverTime=parseFloat(resInfo.createTime),userInfo.coin=parseInt(resInfo.coin),userInfo.storyID=parseInt(resInfo.storyID),userInfo.modelID=parseInt(resInfo.mid),userInfo.heroId=parseInt(resInfo.hid);var equips=rawData.data.equips,heros=rawData.data.heros;userInfo.equips=[];for(var _i=0,equips_1=equips;_i<equips_1.length;_i++){var equip=equips_1[_i],equipInfo=new EquipInfo_1.default;equipInfo.uuid=parseFloat(equip.id),equipInfo.modelID=parseInt(equip.mid),equipInfo.userId=parseFloat(equip.uid),equipInfo.updateTime=parseFloat(equip.createTime||0),userInfo.equips.push(equipInfo)}userInfo.heros=[];for(var _a=0,heros_1=heros;_a<heros_1.length;_a++){var hero=heros_1[_a],heroInfo=new HeroInfo_1.default;heroInfo.exp=parseFloat(hero.exp),heroInfo.uuid=parseFloat(hero.id),heroInfo.item1=parseInt(hero.item1),heroInfo.item2=parseInt(hero.item2),heroInfo.item3=parseInt(hero.item3),heroInfo.item4=parseInt(hero.item4),heroInfo.item5=parseInt(hero.item5),heroInfo.item6=parseInt(hero.item6),heroInfo.item7=parseInt(hero.item7),heroInfo.item8=parseInt(hero.item8),heroInfo.mid=parseInt(hero.mid),heroInfo.userId=parseFloat(hero.uid),userInfo.heros.push(heroInfo)}if(Platform_1.default.currentPlatform instanceof MaliPlatform_1.default){var platform=Platform_1.default.currentPlatform;userInfo.isAnonymous=platform.isAnonymous,userInfo.idType=platform.idType,userInfo.nickName=Platform_1.default.currentPlatform.platformName||userInfo.nickName,userInfo.className=platform.className,platform.classTeacherId&&NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_GETUSERID,{pid:platform.classTeacherId});var lockState=rawData.data.lockState;platform.classLockInfo.classId=lockState.class_id,platform.classLockInfo.lockLvl=parseInt(lockState.lock_level),platform.classLockInfo.lockOperator=lockState.teacher_id,platform.classLockInfo.state=lockState.state}NetManager_1.default.getInstance().dispatchEvent(new egret.Event(LoginProxy.LOGIN_DATA,!1,!1,userInfo));var accountInfo={accountId:userInfo.uuid,level:userInfo.level||1,gameServer:"mali",accountType:userInfo.isAnonymous?0:1,age:0,gender:1};TDGA.Account(accountInfo)}else if(rawData.route==Protocols_1.default.ROUTE_GETUSERID){var resInfo_1=rawData.data;console.log(resInfo_1);var userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data;userInfo.teacherId=resInfo_1.userId}},LoginProxy.LOGIN_DATA="login_data",LoginProxy}(ServerAccessProxy_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=LoginProxy},{"../../base/da/DataAccessManager":2,"../../enums/Protocols":51,"../../platforms/MaliPlatform":80,"../../platforms/Platform":81,"../DataAccessEntry":59,"../net/NetManager":68,"../vo/EquipInfo":71,"../vo/HeroInfo":72,"./ServerAccessProxy":65}],65:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},DataAccessProxy_1=require("../../base/da/DataAccessProxy"),NetManager_1=require("../net/NetManager"),Globals_1=require("../../enums/Globals"),ServerAccessProxy=function(_super){function ServerAccessProxy(name,data,target){_super.call(this,name,data,target),NetManager_1.default.getInstance().addEventListener(NetManager_1.default.SERVERCALLBACK,this.onServerDataReceived,this)}return __extends(ServerAccessProxy,_super),ServerAccessProxy.prototype.onServerDataReceived=function(event){var rawData=event.data,result=(rawData.route,rawData.data),code=result.code;code!=Globals_1.default.STATUS_CODE_SUCCESS?console.log("[ServerAccessProxy.onServerDataReceived] result code :",code):this.parseReceivedData(rawData)},ServerAccessProxy.prototype.parseReceivedData=function(rawData){},ServerAccessProxy}(DataAccessProxy_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ServerAccessProxy},{"../../base/da/DataAccessProxy":3,"../../enums/Globals":46,"../net/NetManager":68}],66:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ServerAccessProxy_1=require("./ServerAccessProxy"),NetManager_1=require("../net/NetManager"),QuestionMessage_1=require("../vo/teach/QuestionMessage"),Alert_1=require("../../view/common/Alert"),SceneManager_1=require("../../manager/SceneManager"),WindowManager_1=require("../../base/popup/WindowManager"),ClassHelpWindow_1=require("../../view/teach/ClassHelpWindow"),ReplyMessage_1=require("../vo/teach/ReplyMessage"),UserInfo_1=require("../vo/UserInfo"),EquipInfo_1=require("../vo/EquipInfo"),HeroInfo_1=require("../vo/HeroInfo"),Protocols_1=require("../../enums/Protocols"),Platform_1=require("../../platforms/Platform"),TeachSystemProxy=function(_super){function TeachSystemProxy(){_super.apply(this,arguments),this.currentHelpId=0}return __extends(TeachSystemProxy,_super),TeachSystemProxy.prototype.addSocketPushes=function(){var _this=this;NetManager_1.default.getInstance().onServerCall(Protocols_1.default.ROUTE_PUSHQUESTION,function(rawData){console.log("received question:",rawData);var systemInfo=_this.data,req=new QuestionMessage_1.default;req.uuid=parseInt(rawData.id),req.teacherId=parseInt(rawData.uid),req.from=parseInt(rawData.studentid),req.storyId=parseInt(rawData.storyid),req.code=rawData.code,req.hadRead=1==parseInt(rawData.readed),req.requestTime=parseInt(rawData.createTime),req.studentEmail=rawData.student_mail,systemInfo.addQuestion(req.uuid,req),_this.dispatchEvent(new egret.Event(TeachSystemProxy.QUESTIONS_COMPLETE,!1,!1,systemInfo.getQuestions()))}),NetManager_1.default.getInstance().onServerCall(Protocols_1.default.ROUTE_PUSHREPLY,function(rawData){console.log("received reply:",rawData);var reply=new ReplyMessage_1.default;reply.uuid=parseInt(rawData.id.insertid),reply.storyId=parseInt(rawData.storyid),reply.code=rawData.code,reply.hadRead=1==parseInt(rawData.readed),reply.createTime=parseInt(rawData.createTime);var systemInfo=_this.data;systemInfo.addReply(reply.uuid,reply),_this.dispatchEvent(new egret.Event(TeachSystemProxy.REPLYS_COMPLETE,!1,!1,systemInfo.getReplys()))}),NetManager_1.default.getInstance().onServerCall(Protocols_1.default.ROUTE_PUSH_CLASSLOCK,function(rawData){console.log(rawData);var maliPlatform=Platform_1.default.currentPlatform;maliPlatform.classLockInfo.classId=rawData.classId,maliPlatform.classLockInfo.lockLvl=parseInt(rawData.levelId),maliPlatform.classLockInfo.lockOperator=rawData.teacherId,maliPlatform.classLockInfo.state=rawData.state,_this.dispatchEvent(new egret.Event("classLockStateChanged",!1,!1,maliPlatform.classLockInfo))})},TeachSystemProxy.prototype.parseReceivedData=function(rawData){switch(_super.prototype.parseReceivedData.call(this,rawData),rawData.route){case Protocols_1.default.ROUTE_ASKQUESTION:this.handleAskComplete(rawData);break;case Protocols_1.default.ROUTE_GETQUESTIONS:this.handleGetQuestions(rawData);break;case Protocols_1.default.ROUTE_GETREPLYS:this.handleGetReplys(rawData);break;case Protocols_1.default.ROUTE_REPLYQUESTION:this.handleReplyComplete(rawData);break;case Protocols_1.default.ROUTE_GETUSERINFO:this.handlePlayerInfo(rawData);break;case Protocols_1.default.ROUTE_READREPLY:this.handleMarkRead(rawData);break;case Protocols_1.default.ROUTE_REMOVE_QUESTION:this.handleRemoveQuestion(rawData);break;case Protocols_1.default.ROUTE_REMOVE_REPLY:this.handleRemoveReply(rawData)}},TeachSystemProxy.prototype.handleAskComplete=function(rawData){rawData.data.insertid>0?Alert_1.default.show("提示","求助发送成功",2):Alert_1.default.show("提示","求助发送失败",2)},TeachSystemProxy.prototype.handleGetQuestions=function(rawData){var systemInfo=this.data,questionObjs=rawData.data.questions;console.log(questionObjs);for(var key in questionObjs){var questionObj=questionObjs[key],req=new QuestionMessage_1.default;req.uuid=parseInt(questionObj.id),req.teacherId=parseInt(questionObj.uid),req.from=parseInt(questionObj.studentid),req.storyId=parseInt(questionObj.storyid),req.code=questionObj.code,req.hadRead=1==parseInt(questionObj.readed),req.requestTime=parseInt(questionObj.createTime),req.fromName=questionObj.studentname,req.studentEmail=questionObj.stu_mail,systemInfo.addQuestion(req.uuid,req)}this.dispatchEvent(new egret.Event(TeachSystemProxy.QUESTIONS_COMPLETE,!1,!1,systemInfo.getQuestions()))},TeachSystemProxy.prototype.handleGetReplys=function(rawData){var systemInfo=this.data,responseObjs=rawData.data.replys;console.log(responseObjs);for(var key in responseObjs){var questionObj=responseObjs[key],reply=new ReplyMessage_1.default;reply.uuid=parseInt(questionObj.id),reply.storyId=parseInt(questionObj.storyid),reply.code=questionObj.code,reply.hadRead=1==parseInt(questionObj.readed),reply.createTime=parseInt(questionObj.createTime),systemInfo.addReply(reply.uuid,reply)}this.dispatchEvent(new egret.Event(TeachSystemProxy.REPLYS_COMPLETE,!1,!1,systemInfo.getReplys()))},TeachSystemProxy.prototype.handleReplyComplete=function(rawData){var insertId=rawData.data.result.insertid,questionId=rawData.data.result.qid;if(insertId>1){this.data.removeQuestion(questionId);Alert_1.default.show("提示","答案已发送",2).once("confirm",function(){WindowManager_1.default.closeAllWindow(),SceneManager_1.default.getInstance().popScene(),WindowManager_1.default.showWindow(ClassHelpWindow_1.default,"ClassHelpWindow")},this)}},TeachSystemProxy.prototype.handlePlayerInfo=function(rawData){var systemInfo=this.data,userInfo=systemInfo.getQuestion(this.currentHelpId).userInfo;userInfo||(userInfo=new UserInfo_1.default,userInfo.idType=UserInfo_1.default.ID_STUDENT);var resInfo=rawData.data.user;userInfo.uuid=parseInt(resInfo.id),userInfo.exp=parseInt(resInfo.exp),userInfo.diamond=parseInt(resInfo.diamond),userInfo.level=parseInt(resInfo.level),userInfo.nickName=resInfo.name,userInfo.vigor=parseInt(resInfo.physical),userInfo.serverTime=parseFloat(resInfo.updateTime),userInfo.coin=parseInt(resInfo.coin),userInfo.storyID=parseInt(resInfo.storyID),userInfo.modelID=parseInt(resInfo.mid),userInfo.heroId=parseInt(resInfo.hid);var equips=rawData.data.equips,heros=rawData.data.heros;userInfo.equips=[];for(var _i=0,equips_1=equips;_i<equips_1.length;_i++){var equip=equips_1[_i],equipInfo=new EquipInfo_1.default;equipInfo.uuid=parseFloat(equip.id),equipInfo.modelID=parseInt(equip.mid),equipInfo.userId=parseFloat(equip.uid),equipInfo.updateTime=parseFloat(equip.updateTime||0),userInfo.equips.push(equipInfo)}userInfo.heros=[];for(var _a=0,heros_1=heros;_a<heros_1.length;_a++){var hero=heros_1[_a],heroInfo=new HeroInfo_1.default;heroInfo.exp=parseFloat(hero.exp),heroInfo.uuid=parseFloat(hero.id),heroInfo.item1=parseInt(hero.item1),heroInfo.item2=parseInt(hero.item2),heroInfo.item3=parseInt(hero.item3),heroInfo.item4=parseInt(hero.item4),heroInfo.item5=parseInt(hero.item5),heroInfo.item6=parseInt(hero.item6),heroInfo.item7=parseInt(hero.item7),heroInfo.item8=parseInt(hero.item8),heroInfo.mid=parseInt(hero.mid),heroInfo.userId=parseFloat(hero.uid),userInfo.heros.push(heroInfo)}this.dispatchEvent(new egret.Event(TeachSystemProxy.USER_INFO_COMPLETE,!1,!1,userInfo))},TeachSystemProxy.prototype.handleMarkRead=function(rawData){var systemInfo=this.data;if(rawData.data.readed>0){var reply=systemInfo.getReply(parseInt(rawData.data.id));reply&&(reply.hadRead=!0)}},TeachSystemProxy.prototype.handleRemoveQuestion=function(rawData){var systemInfo=this.data,qid=parseInt(rawData.data.questionId);systemInfo.removeQuestion(qid),this.dispatchEvent(new egret.Event(TeachSystemProxy.QUESTION_REMOVED,!1,!1,systemInfo.getQuestions()))},TeachSystemProxy.prototype.handleRemoveReply=function(rawData){var systemInfo=this.data,rid=parseInt(rawData.data.replyId);systemInfo.removeReply(rid),this.dispatchEvent(new egret.Event(TeachSystemProxy.REPLY_REMOVED,!1,!1,systemInfo.getReplys()))},TeachSystemProxy.QUESTIONS_COMPLETE="questionsComplete",TeachSystemProxy.REPLYS_COMPLETE="replysComplete",TeachSystemProxy.USER_INFO_COMPLETE="getUserInfoComplete",TeachSystemProxy.QUESTION_REMOVED="questionRemoved",TeachSystemProxy.REPLY_REMOVED="replyRemoved",TeachSystemProxy}(ServerAccessProxy_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=TeachSystemProxy},{"../../base/popup/WindowManager":13,"../../enums/Protocols":51,"../../manager/SceneManager":57,"../../platforms/Platform":81,"../../view/common/Alert":115,"../../view/teach/ClassHelpWindow":152,"../net/NetManager":68,"../vo/EquipInfo":71,"../vo/HeroInfo":72,"../vo/UserInfo":73,"../vo/teach/QuestionMessage":74,"../vo/teach/ReplyMessage":75,"./ServerAccessProxy":65}],67:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ServerAccessProxy_1=require("./ServerAccessProxy"),NetManager_1=require("../net/NetManager"),UserInfo_1=require("../vo/UserInfo"),EquipInfo_1=require("../vo/EquipInfo"),HeroInfo_1=require("../vo/HeroInfo"),Protocols_1=require("../../enums/Protocols"),UserInfoProxy=function(_super){function UserInfoProxy(){_super.apply(this,arguments)}return __extends(UserInfoProxy,_super),UserInfoProxy.prototype.parseReceivedData=function(rawData){if(_super.prototype.parseReceivedData.call(this,rawData),Protocols_1.default.ROUTE_GETSTORYINFO==rawData.route?NetManager_1.default.getInstance().dispatchEvent(new egret.Event(UserInfoProxy.STORY_UPDATE_STAR,!1,!1,rawData.data.story)):Protocols_1.default.ROUTE_CHANGE_NAME==rawData.route&&NetManager_1.default.getInstance().dispatchEvent(new egret.Event(UserInfoProxy.USER_UPDATE_DATA,!1,!1,rawData.data.nickName.name)),rawData.route==Protocols_1.default.ROUTE_PLAYSTORY){console.log(rawData);var result=rawData.data,userInfo=(result.code,this.data),updateInfo=result.updateInfo;if(!updateInfo)return;userInfo.storyID=updateInfo.storyID||userInfo.storyID;var deltaDiamond=updateInfo.adddiamond||0,deltaExp=updateInfo.addexp||0,deltaVigor=updateInfo.addphysical||0;userInfo.diamond+=deltaDiamond,userInfo.exp+=deltaExp,userInfo.vigor+=deltaVigor,userInfo.level=UserInfo_1.default.levelFromExp(userInfo.exp),TDGA.Account.setLevel(userInfo.level);var equips=updateInfo.items,deltaEquips=[],deltaHeros=[];for(var i in equips){var item=equips[i],mid=parseInt(item.mid);if(mid>=1e4&&mid<2e4){var equipInfo=new EquipInfo_1.default;equipInfo.uuid=parseFloat(item.id),equipInfo.modelID=mid,equipInfo.userId=parseFloat(item.uid),equipInfo.updateTime=parseFloat(item.createTime||0),userInfo.equips.push(equipInfo),deltaEquips.push(equipInfo)}else if(mid>=3e4&&mid<4e4){var heroInfo=new HeroInfo_1.default,obj=rawData.data;heroInfo.uuid=parseInt(item.id),heroInfo.mid=mid,userInfo.heros.push(heroInfo),deltaHeros.push(heroInfo)}}NetManager_1.default.getInstance().dispatchEvent(new egret.Event(UserInfoProxy.STORY_UPDATE_DATA,!1,!1,{userInfo:userInfo,deltaExp:deltaExp,deltaEquips:deltaEquips,deltaVigor:deltaVigor,deltaDiamond:deltaDiamond,deltaHeros:deltaHeros}))}else if(Protocols_1.default.ROUTE_USEITEM==rawData.route){var obj=rawData.data,userInfo=this.data;obj.ret?userInfo.ownedHero["item"+obj.seat]=obj.id:userInfo.ownedHero["item"+obj.seat]=0,NetManager_1.default.getInstance().dispatchEvent(new egret.Event(UserInfoProxy.EQUIP_UPDATE_STATE,!1,!1,rawData))}else if(Protocols_1.default.ROUTE_SELECT_HERO==rawData.route){console.log(rawData);var userInfo=this.data;userInfo.heroId=rawData.data.hid,NetManager_1.default.getInstance().dispatchEvent(new egret.Event(UserInfoProxy.HERO_CHANGED,!1,!1,userInfo.ownedHero))}else if(Protocols_1.default.ROUTE_BUY_HERO==rawData.route){var userInfo=this.data,heroInfo=new HeroInfo_1.default,obj=rawData.data;heroInfo.uuid=parseInt(obj.id),heroInfo.mid=parseInt(obj.mid)||heroInfo.mid,userInfo.heros.push(heroInfo),userInfo.diamond-=parseInt(obj.diamond),NetManager_1.default.getInstance().dispatchEvent(new egret.Event(UserInfoProxy.HERO_BOUGHT,!1,!1,heroInfo))}},UserInfoProxy.STORY_UPDATE_DATA="story_update_data",UserInfoProxy.USER_UPDATE_DATA="user_update_data",UserInfoProxy.STORY_UPDATE_STAR="story_update_star",UserInfoProxy.EQUIP_UPDATE_STATE="equip_update_state",UserInfoProxy.HERO_BOUGHT="heroBought",UserInfoProxy.HERO_CHANGED="heroChanged",UserInfoProxy}(ServerAccessProxy_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UserInfoProxy},{"../../enums/Protocols":51,"../net/NetManager":68,"../vo/EquipInfo":71,"../vo/HeroInfo":72,"../vo/UserInfo":73,"./ServerAccessProxy":65}],68:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},PomeloConnector_1=require("./PomeloConnector"),NetManager=function(_super){function NetManager(){_super.apply(this,arguments),this._userName=""}return __extends(NetManager,_super),NetManager.getInstance=function(){return null==this._instance&&(this._instance=new NetManager),this._instance},Object.defineProperty(NetManager.prototype,"userName",{get:function(){return this._userName},set:function(value){this._userName=value},enumerable:!0,configurable:!0}),NetManager.prototype.init=function(){var sysConfig=RES.getRes("sys_json");this._connector=new PomeloConnector_1.default(this),this._connector.init(sysConfig.websocket.host,sysConfig.websocket.port)},NetManager.prototype.callServerSocket=function(route,value){this._connector.callSocket(route,value)},NetManager.prototype.onServerCall=function(route,cb){this._connector.socketPush(route,cb)},NetManager.SERVERINITIALLED="server_initialled",NetManager.SERVERCALLBACK="server_data_callback",NetManager}(egret.EventDispatcher);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=NetManager},{"./PomeloConnector":69}],69:[function(require,module,exports){"use strict";var Protocols_1=require("../../enums/Protocols"),NetManager_1=require("./NetManager"),Alert_1=require("../../view/common/Alert"),Platform_1=require("../../platforms/Platform"),PomeloConnector=function(){function PomeloConnector(boss){this._isInitialled=!1,this._userName=boss.userName,this._boss=boss}return PomeloConnector.prototype.init=function(host,port){function initCallback(){_this.gate.request(Protocols_1.default.QUERY_ENTRY,{name:_this._userName,pid:Platform_1.default.currentPlatform.platformAccount||""},function(initResult){if(_this.gate.disconnect(),500===initResult.code)return void console.error("Has error with GATE connection");_this._uid=initResult.uid,_this.initSocketServer(initResult,_this)})}var _this=this;this.gate=new Pomelo,this.gate.on("io-error",function(e){console.log("socket has error:",e)}),this.gate.init({host:host,port:port},initCallback)},PomeloConnector.prototype.initSocketServer=function(gateServerResult,_this){_this.socket=new Pomelo,_this.socket.on("io-error",function(e){console.log("socket has error:")}),_this.socket.on("close",function(e){console.log("socket is closed!"),Alert_1.default.show("错误","断开与服务器的连接",2).once("confirm",function(){window.location.reload()},this)}),_this.socket.on("onResponse",function(e){console.log("onResponse")}),_this.socket.init({host:gateServerResult.host,port:gateServerResult.port},function(){_this._isInitialled=!0,_this._boss.dispatchEvent(new egret.Event(NetManager_1.default.SERVERINITIALLED))})},PomeloConnector.prototype.callSocket=function(route,value){var _this=this;this._isInitialled?(value?value.uid=this._uid:value={uid:this._uid},console.log("[NetManager.callServerSocket] sent data:",route,value),this.socket.request(route,value,function(data){_this._boss.dispatchEvent(new egret.Event(NetManager_1.default.SERVERCALLBACK,!1,!1,{route:route,data:data}))})):console.log("服务器连接还没有初始化完成")},PomeloConnector.prototype.socketPush=function(route,callback){this._isInitialled&&this.socket.on(route,callback)},PomeloConnector}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PomeloConnector},{"../../enums/Protocols":51,"../../platforms/Platform":81,"../../view/common/Alert":115,"./NetManager":68}],70:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseInfo_1=require("../../base/info/BaseInfo"),BattleInfo=function(_super){function BattleInfo(){_super.apply(this,arguments),this.codeId=0}return __extends(BattleInfo,_super),BattleInfo}(BaseInfo_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BattleInfo},{"../../base/info/BaseInfo":4}],71:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseInfo_1=require("../../base/info/BaseInfo"),ConfigManager_1=require("../../manager/ConfigManager"),EquipInfo=function(_super){function EquipInfo(){_super.apply(this,arguments)}return __extends(EquipInfo,_super),Object.defineProperty(EquipInfo.prototype,"data",{get:function(){return ConfigManager_1.default.getInstance().getConfig("equip",this.modelID)},enumerable:!0,configurable:!0}),EquipInfo}(BaseInfo_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EquipInfo},{"../../base/info/BaseInfo":4,"../../manager/ConfigManager":54}],72:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseInfo_1=require("../../base/info/BaseInfo"),ConfigManager_1=require("../../manager/ConfigManager"),HeroInfo=function(_super){function HeroInfo(){_super.call(this),this.hp=1,this.icon="",this.exp=0,this.item1=0,this.item2=0,this.item3=0,this.item4=0,this.item5=0,this.item6=0,this.item7=0,this.item8=0,this._mid=0}return __extends(HeroInfo,_super),Object.defineProperty(HeroInfo.prototype,"mid",{get:function(){return this._mid},set:function(val){this._mid=val,this.icon=this.data.icon},enumerable:!0,configurable:!0}),Object.defineProperty(HeroInfo.prototype,"data",{get:function(){return ConfigManager_1.default.getInstance().getConfig("hero",this._mid)},enumerable:!0,configurable:!0}),Object.defineProperty(HeroInfo.prototype,"items",{get:function(){for(var result=[],i=1;i<=8;i++)0!=this["item"+i]&&void 0!=this["item"+i]&&result.push(this["item"+i]);return result},enumerable:!0,configurable:!0}),HeroInfo}(BaseInfo_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HeroInfo},{"../../base/info/BaseInfo":4,"../../manager/ConfigManager":54}],73:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseInfo_1=require("../../base/info/BaseInfo"),Globals_1=require("../../enums/Globals"),Language_1=require("../../enums/Language"),ConfigManager_1=require("../../manager/ConfigManager"),UserInfo=function(_super){function UserInfo(){_super.apply(this,arguments),this.modelID=0,this.exp=0,this.diamond=0,this.headIcon="career_head_30000_c",this.vigor=Globals_1.default.MAX_INIT_VIGOR,this.coin=0,this.level=1,this.serverTime=0,this.storyID=0,this.heroId=0,this.heros=[],this.equips=[],this.language=Language_1.default.PYTHON,this.vipLevel=0,this.idType=UserInfo.ID_OTHER,this.teacherId=0,this.className="js-class-mid"}return __extends(UserInfo,_super),Object.defineProperty(UserInfo.prototype,"isTeacher",{get:function(){return this.idType==UserInfo.ID_TEACHER},enumerable:!0,configurable:!0}),Object.defineProperty(UserInfo.prototype,"isStudent",{get:function(){return this.idType==UserInfo.ID_STUDENT},enumerable:!0,configurable:!0}),Object.defineProperty(UserInfo.prototype,"ownedHero",{get:function(){if(!this._currentHero||this.heroId!=this._currentHero.uuid)for(var i in this.heros)this.heros[i].uuid===this.heroId&&(this._currentHero=this.heros[i]);return this._currentHero},enumerable:!0,configurable:!0}),UserInfo.prototype.getEquipById=function(id){for(var i in this.equips)if(this.equips[i].uuid===id)return this.equips[i];return null},UserInfo.prototype.getHeroSlotEquip=function(slot){if(slot<1||slot>8)return null;var ownedHero=this.ownedHero,item=ownedHero["item"+slot];return 0===item||void 0===item?null:this.getEquipById(item)},UserInfo.prototype.getHeroActionNames=function(){for(var effectiveEquipIds=this.ownedHero.items,actions=[],_i=0,effectiveEquipIds_1=effectiveEquipIds;_i<effectiveEquipIds_1.length;_i++){var id=effectiveEquipIds_1[_i],equip=this.getEquipById(id);if(equip&&!(equip.data.skill.length<4))for(var skillIds=equip.data.skill.split("|"),_a=0,skillIds_1=skillIds;_a<skillIds_1.length;_a++){var skillId=skillIds_1[_a],skillData=ConfigManager_1.default.getInstance().getConfig("skill",parseInt(skillId));if(skillData){var action=ConfigManager_1.default.getInstance().getConfig("action",skillData.action);action&&actions.push(action.name)}}}return actions},UserInfo.levelFromExp=function(exp){return exp>0?Math.floor(UserInfo.a*Math.log(1/UserInfo.b*(exp+UserInfo.c)))+1:1},UserInfo.expForLevel=function(level){return level>1?Math.ceil(Math.exp((level-1)/UserInfo.a)*UserInfo.b-UserInfo.c):0},UserInfo.ID_TEACHER="teacher",UserInfo.ID_STUDENT="student",UserInfo.ID_OTHER="other",UserInfo.a=6,UserInfo.b=100,UserInfo.c=UserInfo.b,UserInfo}(BaseInfo_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UserInfo},{"../../base/info/BaseInfo":4,"../../enums/Globals":46,"../../enums/Language":48,"../../manager/ConfigManager":54}],74:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseInfo_1=require("../../../base/info/BaseInfo"),QuestionMessage=function(_super){function QuestionMessage(){_super.apply(this,arguments),this.fromName="学生",this.hadRead=!1}return __extends(QuestionMessage,_super),Object.defineProperty(QuestionMessage.prototype,"formatRequestTime",{get:function(){var date=new Date(1e3*this.requestTime);return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+"    "+this.format60(date.getHours())+":"+this.format60(date.getMinutes())+":"+this.format60(date.getSeconds())},enumerable:!0,configurable:!0}),QuestionMessage.prototype.format60=function(t){return t<10?"0"+t:t.toString()},QuestionMessage}(BaseInfo_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=QuestionMessage},{"../../../base/info/BaseInfo":4}],75:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseInfo_1=require("../../../base/info/BaseInfo"),ReplyMessage=function(_super){function ReplyMessage(){_super.apply(this,arguments)}return __extends(ReplyMessage,_super),Object.defineProperty(ReplyMessage.prototype,"formatCreateTime",{get:function(){var date=new Date(1e3*this.createTime);return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+"    "+this.format60(date.getHours())+":"+this.format60(date.getMinutes())+":"+this.format60(date.getSeconds())},enumerable:!0,configurable:!0}),ReplyMessage.prototype.format60=function(t){
return t<10?"0"+t:t.toString()},ReplyMessage}(BaseInfo_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ReplyMessage},{"../../../base/info/BaseInfo":4}],76:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseInfo_1=require("../../../base/info/BaseInfo"),TeachSystemInfo=function(_super){function TeachSystemInfo(){_super.call(this),this._questionMsgMap={},this._replyMsgMap={}}return __extends(TeachSystemInfo,_super),TeachSystemInfo.prototype.addQuestion=function(questionId,question){this._questionMsgMap[questionId]=question},TeachSystemInfo.prototype.getQuestion=function(questionId){return this._questionMsgMap[questionId]},TeachSystemInfo.prototype.removeQuestion=function(questionId){var ques=this._questionMsgMap[questionId];return ques&&delete this._questionMsgMap[questionId],ques},TeachSystemInfo.prototype.getQuestions=function(){return _.values(this._questionMsgMap)},TeachSystemInfo.prototype.addReply=function(replyId,reply){this._replyMsgMap[replyId]=reply},TeachSystemInfo.prototype.getReply=function(replyId){return this._replyMsgMap[replyId]},TeachSystemInfo.prototype.removeReply=function(replyId){var reply=this._replyMsgMap[replyId];return reply&&delete this._replyMsgMap[replyId],reply},TeachSystemInfo.prototype.getReplys=function(){return _.values(this._replyMsgMap)},TeachSystemInfo}(BaseInfo_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=TeachSystemInfo},{"../../../base/info/BaseInfo":4}],77:[function(require,module,exports){"use strict";var BasePlatform=function(){function BasePlatform(){this.appID="101371743",this.redirectURI="http://code.youyoucode.cn",this.platformUserId=null,this.platformUserAccount=null,this.platformUserName=null,this._anonymous=!1,this._isLogin=!1}return Object.defineProperty(BasePlatform.prototype,"isAnonymous",{get:function(){return this._anonymous},set:function(v){this._anonymous=v},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlatform.prototype,"isLogin",{get:function(){return this._isLogin},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlatform.prototype,"platformName",{get:function(){return this.platformUserName},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlatform.prototype,"platformAccount",{get:function(){return this.platformUserAccount},enumerable:!0,configurable:!0}),BasePlatform.prototype.anonymous=function(callback){},BasePlatform.prototype.checkMe=function(callback){},Object.defineProperty(BasePlatform.prototype,"openUserId",{get:function(){return this.platformUserId},set:function(v){this.platformUserId=v},enumerable:!0,configurable:!0}),BasePlatform.prototype.register=function(data,onComplete){},BasePlatform.prototype.login=function(data,onComplete){},BasePlatform.prototype.logout=function(){},BasePlatform}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BasePlatform},{}],78:[function(require,module,exports){"use strict";var ClassLockInfo=function(){function ClassLockInfo(){this.classId="",this.state=0,this.lockLvl=0}return ClassLockInfo}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ClassLockInfo},{}],79:[function(require,module,exports){"use strict";var HttpMethod=egret.HttpMethod,HttpUtil=function(){function HttpUtil(){}return HttpUtil.useGet=function(route,sendData,onComplete,onError){$.ajax(route,{type:HttpMethod.GET,data:JSON.stringify(sendData),dataType:"json",contentType:"application/json;charset=utf-8",xhrFields:{withCredentials:!0},success:onComplete,error:onError})},HttpUtil.usePost=function(route,sendData,onComplete,onError){var setting={type:egret.HttpMethod.POST,contentType:"application/json;charset=utf-8",data:JSON.stringify(sendData),dataType:"json",success:onComplete,xhrFields:{withCredentials:!0},error:onError};$.ajax(route,setting)},HttpUtil.usePut=function(route,sendData,onComplete,onError){var setting={type:"put",contentType:"application/json;charset=utf-8",data:JSON.stringify(sendData),dataType:"json",success:onComplete,xhrFields:{withCredentials:!0},error:onError};$.ajax(route,setting)},HttpUtil.jsonpGet=function(route,onComplete,onError){$.ajax({type:"get",async:!1,url:route+"?_format=application/javascript",dataType:"jsonp",jsonp:"callback",xhrFields:{withCredentials:!0},success:function(json){onComplete(json)},error:function(result){onError&&onError(result)}})},HttpUtil}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HttpUtil},{}],80:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BasePlatform_1=require("./BasePlatform"),HttpUtil_1=require("./HttpUtil"),Alert_1=require("../view/common/Alert"),ClassLockInfo_1=require("./ClassLockInfo"),MaliPlatform=function(_super){function MaliPlatform(){_super.call(this),this.idType="other",this.joinedClass=!1,this.userStatusInClass="notInClass",this.price=0,this.sync=!1,this.timeSpan=0,this.courseUrl="http://course.youyoucode.cn/api/",this.root="http://sso.malichina.com/api/",this.classLockInfo=new ClassLockInfo_1.default}return __extends(MaliPlatform,_super),MaliPlatform.prototype.anonymous=function(callback){var _this=this;HttpUtil_1.default.usePost(this.root+"users/weak",null,function(result){console.log(result),_this.platformUserId=result.userId,_this.accessToken=result.id,_this._isLogin=!0,_this._anonymous=!0,callback(result)},function(error,textStatus,errorThrown){Alert_1.default.show("提示","登录失败，请重新输入",2)})},MaliPlatform.prototype.checkMe=function(callback){var _this=this,result={state:0};HttpUtil_1.default.jsonpGet(this.root+"users/me",function(data){console.log(data),data.id&&data.username?(_this._isLogin=!0,_this._anonymous=!1,_this.platformUserId=data.id,_this.platformUserAccount=data.email,_this.platformUserName=data.username,result.state=1,callback(result)):data.id&&!data.username&&(_this._isLogin=!0,_this._anonymous=!0,_this.platformUserId=data.id,result.state=2,callback(result))},function(error,textStatus,errorThrown){console.log(error.responseJSON),_this._anonymous=!1,_this._isLogin=!1,result.state=3,callback(result)})},MaliPlatform.prototype.register=function(data,onComplete){var _this=this;HttpUtil_1.default.usePost(this.root+"users",data,function(result){_this.platformUserId=result.id,onComplete(result)},function(error,textStatus,errorThrown){var err=error.responseJSON.error,tip="";422==err.statusCode&&(tip="这个名字已经有人用了哦！换个更帅气的名字吧"),Alert_1.default.show(err.name,err.statusCode+" "+tip,2)})},MaliPlatform.prototype.bindAnonymous=function(data,onComplete){var _this=this;HttpUtil_1.default.usePut(this.root+"users/"+data.id,data,function(result){_this.platformUserId=result.id,onComplete(result)},function(error,textStatus,errorThrown){var err=error.responseJSON.error;Alert_1.default.show(err.name,err.statusCode+err.message,2)})},MaliPlatform.prototype.login=function(data,onComplete){var _this=this;HttpUtil_1.default.usePost(this.root+"users/login",data,function(result){_this._isLogin=!0,_this.platformUserId=result.userId,_this.accessToken=result.id,console.log("[MaliPlatform.login],login success:",result),_this.getClasses(function(classInfoes){onComplete(result)})},function(error,textStatus,errorThrown){var err=error.responseJSON.error,tip="";401==err.statusCode&&(tip="用户名或密码不正确"),Alert_1.default.show(err.name,err.statusCode+" "+tip,2)})},MaliPlatform.prototype.getClasses=function(callback){var _this=this;HttpUtil_1.default.useGet(this.courseUrl+"Classes?filter=%7B%22where%22%20%3A%7B%20%22_participants.id%22%20%3A%20%22"+this.platformUserId+"%22%20%7D%7D",null,function(classes){console.log(classes);for(var resolvedClasses=[],i=0;i<classes.length;i++){var classInfo={},classObj=classes[i];if("published"==classObj.status){var invitationCode=(classObj.beginTime,classObj.code),classId=(classObj.endTime,classObj.id),className=classObj.name,classPrice=classObj.price,sync=classObj.sync,timeSpan=classObj.timeSpan,joinedClass=!1,userStatusInClass=void 0,myIdType="other",teachers=[],users=classObj._participants;for(var i_1 in users){var user=users[i_1];user.id==_this.platformUserId&&(myIdType="learn"==user.category?"student":"teacher",joinedClass="approved"==user.status,userStatusInClass=user.status),"teach"==user.category&&teachers.push({id:user.id,creatorName:user.creatorName})}if(classInfo.sync=sync,classInfo.timeSpan=timeSpan,classInfo.id=classId,classInfo.name=className,classInfo.price=classPrice,classInfo.invitationCode=invitationCode,classInfo.joinedClass=joinedClass,classInfo.userStatusInClass=userStatusInClass,teachers.length>0){var aTeacher=teachers[Math.floor(Math.random()*teachers.length)];classInfo.teacherId=aTeacher.id,classInfo.teacherName=aTeacher.creatorName}classInfo.idType=myIdType,resolvedClasses.push(classInfo)}}callback(resolvedClasses)})},MaliPlatform.prototype.logout=function(){var _this=this;HttpUtil_1.default.usePost(this.root+"users/logout",null,function(result){_this.reload()},function(error,textStatus,errorThrown){var err=error.responseJSON.error;if(401==err.statusCode)return void _this.reload();Alert_1.default.show(err.name,err.statusCode+err.message,2)})},MaliPlatform.prototype.changePassword=function(psd,newPsd){var param={password:psd,newPassword:newPsd};HttpUtil_1.default.usePost(this.root+"users/"+this.platformUserId+"/passwordChange",param,function(result){Alert_1.default.show("","密码修改成功",2)},function(error,textStatus,errorThrown){var err=error.responseJSON.error;Alert_1.default.show(err.name,err.statusCode+err.message,2)})},MaliPlatform.prototype.joinClass=function(inviteCode,platformUserId,onComplete){var _this=this;console.log(inviteCode,platformUserId),HttpUtil_1.default.usePost(this.courseUrl+"Classes/join/"+platformUserId+"/"+inviteCode,{},function(result){if(!result.id)return void Alert_1.default.show("错误","加入班级失败",2);_this.classId=result.id,_this.className=result.name,_this.inviteCode=result.code,_this.schedules=result.schedules,console.log("[MaliPlatform.joinClass],join success:",result),_this.getClasses(function(typeResult){var classInfoes=typeResult;for(var key in classInfoes){var classInfo=classInfoes[key];if(inviteCode===classInfo.invitationCode){_this.joinedClass=classInfo.joinedClass,_this.classTeacherId=classInfo.teacherId,_this.classTeacherName=classInfo.teacherName,_this.classId=classInfo.id,_this.className=classInfo.name,_this.inviteCode=inviteCode,_this.idType=classInfo.idType,result.idType=_this.idType;break}}onComplete(result)})},function(error,textStatus,errorThrown){var err=error.responseJSON.error;Alert_1.default.show(err.name,err.statusCode+err.message,2)})},MaliPlatform.prototype.reload=function(){var sysConfig=RES.getRes("sys_json");"zc"==sysConfig.embedTo?window.location.assign(sysConfig.embedLink+"login.html"):"ml"==sysConfig.embedTo?window.location.assign(sysConfig.embedLink):window.location.reload()},MaliPlatform}(BasePlatform_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MaliPlatform},{"../view/common/Alert":115,"./BasePlatform":77,"./ClassLockInfo":78,"./HttpUtil":79}],81:[function(require,module,exports){"use strict";var QQPlatform_1=require("./QQPlatform"),MaliPlatform_1=require("./MaliPlatform"),Platform=function(){function Platform(){}return Platform.createPlatform=function(platformName){var platform;return platform="qq"==platformName?new QQPlatform_1.default:new MaliPlatform_1.default,this.currentPlatform=platform,platform},Platform}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Platform},{"./MaliPlatform":80,"./QQPlatform":82}],82:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BasePlatform_1=require("./BasePlatform"),QQPlatform=function(_super){function QQPlatform(){_super.call(this),this.appID="101371743",this.redirectURI="http://code.youyoucode.cn",this.root="https://graph.qq.com/"}return __extends(QQPlatform,_super),QQPlatform.prototype.openLogin=function(){var queryParams=["client_id="+this.appID,"redirect_uri="+this.redirectURI,"scope=get_user_info,list_album,upload_pic,add_feeds,do_like","response_type=token"],query=queryParams.join("&"),url="https://graph.qq.com/oauth2.0/authorize?"+query;window.open(url,"_self")},QQPlatform.prototype.checkRedirectUrl=function(callback){if(void 0===callback&&(callback=null),window.location.hash.length>0){var accessToken=window.location.hash.substring(1);this.accessToken=accessToken;var queryParams=[accessToken,"callback=userCallback"],query=queryParams.join("&"),url="https://graph.qq.com/oauth2.0/me?"+query,script=document.createElement("script");script.src=url,document.body.appendChild(script)}},QQPlatform}(BasePlatform_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=QQPlatform},{"./BasePlatform":77}],83:[function(require,module,exports){"use strict";var AssetAdapter=function(){function AssetAdapter(){}return AssetAdapter.prototype.getAsset=function(source,compFunc,thisObject){function onGetRes(data){compFunc.call(thisObject,data,source)}if(RES.hasRes(source)){var data=RES.getRes(source);data?onGetRes(data):RES.getResAsync(source,onGetRes,this)}else RES.getResByUrl(source,onGetRes,this,RES.ResourceItem.TYPE_IMAGE)},AssetAdapter}();exports.AssetAdapter=AssetAdapter},{}],84:[function(require,module,exports){"use strict";var ThemeAdapter=function(){function ThemeAdapter(){}return ThemeAdapter.prototype.getTheme=function(url,compFunc,errorFunc,thisObject){function onGetRes(e){compFunc.call(thisObject,e)}function onError(e){e.resItem.url==url&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,onError,null),errorFunc.call(thisObject))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,onError,null),RES.getResByUrl(url,onGetRes,this,RES.ResourceItem.TYPE_TEXT)},ThemeAdapter}();exports.ThemeAdapter=ThemeAdapter},{}],85:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},EquipInfo_1=require("../../model/vo/EquipInfo"),BadgeListItemRenderer=function(_super){function BadgeListItemRenderer(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="BadgeListItemRenderSkin" width="230" height="180" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image id="imgContent" width="156" height="128" x="38"/><e:Image width="146" height="62" x="43" y="118" source="badge_json.badge_time_frame_png"/><e:Label id="labTime" text="标签" x="63" y="134" size="20" stroke="3" strokeColor="0x003479" width="108" height="28" textAlign="center" verticalAlign="middle"/></e:Skin>'}return __extends(BadgeListItemRenderer,_super),BadgeListItemRenderer.prototype.dataChanged=function(){if(_super.prototype.dataChanged.call(this),this.data instanceof EquipInfo_1.default){var equipInfo=this.data;this.labTime.text=this.formatCreateTime(equipInfo.updateTime),this.imgContent.source="resource/icon/badge/"+equipInfo.data.icon+".png"}else this.labTime.text="未获得",this.imgContent.source="resource/icon/badge/dis/"+this.data.icon+".png"},BadgeListItemRenderer.prototype.formatCreateTime=function(time){var date=new Date(1e3*time);return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+"    "+this.format60(date.getHours())+":"+this.format60(date.getMinutes())+":"+this.format60(date.getSeconds())},BadgeListItemRenderer.prototype.format60=function(t){return t<10?"0"+t:t.toString()},BadgeListItemRenderer}(eui.ItemRenderer);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BadgeListItemRenderer},{"../../model/vo/EquipInfo":71}],86:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),Globals_1=require("../../enums/Globals"),WindowManager_1=require("../../base/popup/WindowManager"),BadgeTipWindow=function(_super){function BadgeTipWindow(){_super.call(this),this.width=Globals_1.default.GAME_WIDTH,this.height=Globals_1.default.GAME_HEIGHT,this.touchEnabled=!0,this.touchChildren=!0,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="BadgeTipWindowSkin" width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="badge_get_title_png" x="740" y="164"/><e:Image source="badge_get_light_png" x="772" y="247"/><e:Image id="imgBadgeIcon" width="240" height="190" x="842" y="345"/></e:Skin>',this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)}return __extends(BadgeTipWindow,_super),BadgeTipWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.imgBadgeIcon.source="resource/icon/badge/"+Globals_1.default.badgeAwardInfo.data.icon+".png"},BadgeTipWindow.prototype.onTouch=function(event){WindowManager_1.default.closeWindow(this.name)},BadgeTipWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},BadgeTipWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BadgeTipWindow},{"../../base/popup/BaseWindow":7,"../../base/popup/WindowManager":13,"../../enums/Globals":46}],87:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),ConfigManager_1=require("../../manager/ConfigManager"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),Language_1=require("../../enums/Language"),BadgeListItemRenderer_1=require("./BadgeListItemRenderer"),MouseScroller_1=require("../common/MouseScroller"),BadgeWindow=function(_super){function BadgeWindow(){_super.call(this),this.PYTHON_TYPE=10,this.JAVASCRIPT_TYPE=11,this.preSelectedIndex=0,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="BadgeWindowSkin" width="1076" height="804" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image width="1076" height="804" x="0" y="0" source="badge_json.badge_frame_png"/><e:Button id="btnClose" label="按钮" x="1002" y="66" skinName="WindowCloseBtnSkin"/><e:TabBar id="tabBar" width="408" height="60" x="70" y="104" itemRendererSkinName="BadgeTabBarSkin"/><e:Scroller id="scrollerBadge"  x="46" y="176" width="1000" height="592" scrollPolicyV="auto"  skinName="skins.ScrollerSkin"><e:Group  width="990" height="592"><e:List id="list" width="990" itemRendererSkinName="BadgeListItemRenderSkin"><e:layout><e:TileLayout horizontalGap="15" columnWidth="230" rowHeight="190" horizontalAlign="left" verticalAlign="top" orientation="rows"/></e:layout></e:List></e:Group></e:Scroller></e:Skin>',this.userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data}return __extends(BadgeWindow,_super),BadgeWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),MouseScroller_1.default.enableMouseScroller(this.scrollerBadge),this.tabBar.dataProvider=new eui.ArrayCollection([{label:"Python"}]),this.list.itemRenderer=BadgeListItemRenderer_1.default,this.list.dataProvider=new eui.ArrayCollection(this.parseCurrentKnowledges(Language_1.default.PYTHON)),this.tabBar.addEventListener(egret.Event.CHANGE,this.onTabClick,this),this.preSelectedIndex=this.tabBar.selectedIndex},BadgeWindow.prototype.parseCurrentKnowledges=function(language){var equipInfos=this.userInfo.equips,checkType=language==Language_1.default.PYTHON?this.PYTHON_TYPE:this.JAVASCRIPT_TYPE,equips=ConfigManager_1.default.getInstance().getConfigs("equip"),result=[];for(var key in equips){var config=equips[key];if(parseInt(config.type)===checkType){var tag=!1;for(var i in equipInfos)if(equipInfos[i].data==config){result.push(equipInfos[i]),tag=!0;break}tag||result.push(config)}}return result},BadgeWindow.prototype.onTabClick=function(event){if(this.tabBar.selectedIndex!=this.preSelectedIndex){var language=this.tabBar.selectedItem.label.toLowerCase();this.list.dataProvider=new eui.ArrayCollection(this.parseCurrentKnowledges(language))}this.preSelectedIndex=this.tabBar.selectedIndex},BadgeWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.tabBar.removeEventListener(egret.Event.CHANGE,this.onTabClick,this)},BadgeWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BadgeWindow},{"../../base/da/DataAccessManager":2,"../../base/popup/BaseWindow":7,"../../enums/Language":48,"../../manager/ConfigManager":54,"../../model/DataAccessEntry":59,"../common/MouseScroller":116,"./BadgeListItemRenderer":85}],88:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Scene_1=require("../../base/view/Scene"),World_1=require("./world/World"),Globals_1=require("../../enums/Globals"),BattleSceneUI_1=require("../battleui/BattleSceneUI"),PopUpManager_1=require("../../base/popup/PopUpManager"),ConfigManager_1=require("../../manager/ConfigManager"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),SceneMoveObject_1=require("./scene/SceneMoveObject"),GoalManager_1=require("../../control/goal/GoalManager"),SoundManager_1=require("../../manager/SoundManager"),NetManager_1=require("../../model/net/NetManager"),Timeout_1=require("../../base/utils/Timeout"),BattleInfoProxy_1=require("../../model/da/BattleInfoProxy"),CodeWorkerManager_1=require("../../compile/CodeWorkerManager"),SceneObjectActor_1=require("../../control/actions/SceneObjectActor"),FrameTweenLite_1=require("../../base/utils/FrameTweenLite"),GoalState_1=require("../../control/goal/GoalState"),Protocols_1=require("../../enums/Protocols"),BattleScene=function(_super){function BattleScene(){_super.call(this),this._uiLock=!1}return __extends(BattleScene,_super),Object.defineProperty(BattleScene.prototype,"battleUI",{get:function(){return this._battleUI},enumerable:!0,configurable:!0}),BattleScene.prototype.onEnter=function(){_super.prototype.onEnter.call(this)},BattleScene.prototype.setData=function(data){_super.prototype.setData.call(this,data),this._userInfo=data.player_info,this._levelID=parseInt(data.levelID),this._codeLifeSpan=parseInt(ConfigManager_1.default.getInstance().getValue("pve_story_level",this._levelID,"lifespan")),this._battleInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.BATTLE_INFO_PROXY).data,this._worldContainer=new egret.Sprite,this._worldContainer.graphics.clear(),this._worldContainer.graphics.beginFill(0,.2),this._worldContainer.graphics.drawRect(0,0,Globals_1.default.GAME_WIDTH*Globals_1.default.BATTLE_AREA_WIDTH_RATIO,Globals_1.default.GAME_HEIGHT),this._worldContainer.graphics.endFill(),this.addChild(this._worldContainer);var world=new World_1.default;world.setData(data),this._worldContainer.addChild(world),this._world=world,this._battleUI=new BattleSceneUI_1.default(data),PopUpManager_1.default.addPopUp(this._battleUI,!1),this._battleUI.addEventListener(BattleSceneUI_1.default.RUN_TOUCH_TAP,this.onRunBtnTouch,this),this._battleUI.addEventListener(BattleSceneUI_1.default.BTN_ZOOM_IN,this.onZoominTouch,this),this._battleUI.addEventListener(BattleSceneUI_1.default.BTN_ZOOM_OUT,this.onZoomoutTouch,this),this._battleUI.miniScale=Math.max(Globals_1.default.GAME_WIDTH*Globals_1.default.BATTLE_AREA_WIDTH_RATIO/this._world.getWidth(),Globals_1.default.GAME_HEIGHT/this._world.getHeight()),NetManager_1.default.getInstance().addEventListener(BattleInfoProxy_1.default.USER_CODE_CHANGED,this.onGetUserCode,this),this.onWorldComplete()},BattleScene.prototype.onZoominTouch=function(event){this._world.camera.zoom(event.data)},BattleScene.prototype.onZoomoutTouch=function(event){this._world.camera.zoom(event.data)},BattleScene.prototype.onRunBtnTouch=function(event){this._battleUI.codeFreeze?this.fightPause():this.fightStart()},BattleScene.prototype.onWorldComplete=function(){if(this.createCodeRuntime(),this._world.addEventListener(SceneMoveObject_1.default.HERO_HP,this.onHeroHpChanged,this),this._world.addEventListener(World_1.default.HERO_CLICKED,this.insertSpecificName,this),GoalManager_1.default.getInstance().addEventListener(GoalManager_1.default.GOAL_WORLD_END,this.stopFightGracefully,this),this.getData().teach_info){var requestMsg=this.getData().teach_info;CodeWorkerManager_1.default.getUserThread().setEditorText(requestMsg.code)}else this.getData().level_code?CodeWorkerManager_1.default.getUserThread().setEditorText(this.getData().level_code):NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_GET_STORY_CODE,{storyid:this._levelID});this.battleUI.showGoalPatrol()},BattleScene.prototype.insertSpecificName=function(e){console.log(e.data)},BattleScene.prototype.onGetUserCode=function(event){CodeWorkerManager_1.default.getUserThread().setEditorText(this._battleInfo.userCode)},BattleScene.prototype.createCodeRuntime=function(){var _this=this;this._heroActor=new SceneObjectActor_1.default(this._world.hero),CodeWorkerManager_1.default.init(this._heroActor),CodeWorkerManager_1.default.getUserThread().init(),CodeWorkerManager_1.default.getUserThread().setEditorText(RES.getRes(this._levelID+"_code_txt")),CodeWorkerManager_1.default.getInjectTread().setCode(RES.getRes(this._levelID+"_script_js")),CodeWorkerManager_1.default.getInjectTread().onSetupLevel(),this.configActions(),CodeWorkerManager_1.default.setUserCompleteCallback(function(){_this._battleUI.codeDone()},this)},BattleScene.prototype.configActions=function(){var actions=this._userInfo.getHeroActionNames(),filterMethods=["hp","pos","type","MP","say","dropMP"];for(var index in actions){var action=actions[index];action&&(-1==filterMethods.indexOf(action)&&CodeWorkerManager_1.default.getUserThread().actor.addAction(action))}},BattleScene.prototype.testConfigActions=function(){var actions=ConfigManager_1.default.getInstance().getConfigs("action"),filterMethods=["hp","pos","type","MP","say","dropMP"];for(var index in actions){var action=actions[index];action&&(-1==filterMethods.indexOf(action.name)&&CodeWorkerManager_1.default.getUserThread().actor.addAction(action.name))}},BattleScene.prototype.onHeroHpChanged=function(event){var data=event.data;this._battleUI.updateHeroHp(100*data.hp/data.maxhp,100),data.hp<=0&&this.stopFightGracefully(4)},BattleScene.prototype.stopFightGracefully=function(param){var _this=this,duration=_.isNumber(param)?param:param.data;CodeWorkerManager_1.default.getUserThread().stop(),CodeWorkerManager_1.default.getInjectTread().stop(),this._uiLock=!0,FrameTweenLite_1.default.delayedCall(duration,function(){_this._uiLock=!1,_this._world.stopPlay(),GoalManager_1.default.getInstance().stop(),GoalManager_1.default.getInstance().checkPositives(),_this._battleUI.codeDone();for(var goals=GoalManager_1.default.getInstance().currentGoals,_i=0,goals_1=goals;_i<goals_1.length;_i++){var goal=goals_1[_i];goal.state==GoalState_1.default.SUCCESS?TDGA.onMissionCompleted(goal.data.name):TDGA.onMissionFailed(goal.data.name,"failed")}})},BattleScene.prototype.fightReload=function(){CodeWorkerManager_1.default.getUserThread().stop(),CodeWorkerManager_1.default.getUserThread().setEditorText(RES.getRes(this._levelID+"_code_txt")),CodeWorkerManager_1.default.getInjectTread().stop(),CodeWorkerManager_1.default.getInjectTread().onSetupLevel()},BattleScene.prototype.fightPause=function(){this._uiLock||(this._world.hero.batterData.hp>0&&this._world.hero.idle(),this._heroActor.lock(),CodeWorkerManager_1.default.getUserThread().stop(),CodeWorkerManager_1.default.getInjectTread().stop(),GoalManager_1.default.getInstance().stop(),this._world.stopPlay(),Timeout_1.default.clearTimeout(this._codeLifeTime))},BattleScene.prototype.fightStart=function(){var _this=this;this._uiLock||(FrameTweenLite_1.default.killAll(),this._heroActor.unlock(),this._world.startPlay(),CodeWorkerManager_1.default.getUserThread().runCode(),CodeWorkerManager_1.default.getInjectTread().onFirstFrame(),CodeWorkerManager_1.default.getInjectTread().runCode(),this._battleUI.updateHeroHp(100,100),GoalManager_1.default.getInstance().reset(),GoalManager_1.default.getInstance().setSceneObject(this._world.hero),GoalManager_1.default.getInstance().start(),Timeout_1.default.clearTimeout(this._codeLifeTime),this._codeLifeTime=Timeout_1.default.setTimeout(function(){_this.stopFightGracefully(2)},this,1e3*this._codeLifeSpan),NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_SAVE_STORY_CODE,{id:this._battleInfo.codeId,code:CodeWorkerManager_1.default.getUserThread().getEditorText()}))},BattleScene.prototype.dispose=function(){FrameTweenLite_1.default.killAll(),NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_SAVE_STORY_CODE,{id:this._battleInfo.codeId,code:CodeWorkerManager_1.default.getUserThread().getEditorText()});var levelBgm=this.getData().level_bgm;levelBgm&&levelBgm.length>0&&SoundManager_1.default.getInstance().stop(levelBgm+"_mp3"),SoundManager_1.default.getInstance().playMusic("ui_mp3",0,0),Timeout_1.default.clearTimeout(this._codeLifeTime),RES.destroyRes("battle"),RES.destroyRes("battlescene"),RES.destroyRes("battleContent"),PopUpManager_1.default.removePopUp(this._battleUI),this._battleUI.removeEventListener(BattleSceneUI_1.default.RUN_TOUCH_TAP,this.onRunBtnTouch,this),this._battleUI.removeEventListener(BattleSceneUI_1.default.BTN_ZOOM_IN,this.onZoominTouch,this),this._battleUI.removeEventListener(BattleSceneUI_1.default.BTN_ZOOM_OUT,this.onZoomoutTouch,this),this._battleUI.dispose(),CodeWorkerManager_1.default.release(),this._world.removeEventListener(SceneMoveObject_1.default.HERO_HP,this.onHeroHpChanged,this),this._world.dispose(),this._worldContainer.removeChild(this._world),this._world=null,this._worldContainer.graphics.clear(),this.removeChild(this._worldContainer),this._worldContainer=null,GoalManager_1.default.getInstance().stop(),GoalManager_1.default.getInstance().removeEventListener(GoalManager_1.default.GOAL_WORLD_END,this.stopFightGracefully,this),NetManager_1.default.getInstance().removeEventListener(BattleInfoProxy_1.default.USER_CODE_CHANGED,this.onGetUserCode,this)},BattleScene.BATTLELOADED="battle_loaded",BattleScene}(Scene_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BattleScene},{"../../base/da/DataAccessManager":2,"../../base/popup/PopUpManager":9,"../../base/utils/FrameTweenLite":18,"../../base/utils/Timeout":20,"../../base/view/Scene":24,"../../compile/CodeWorkerManager":26,"../../control/actions/SceneObjectActor":29,"../../control/goal/GoalManager":40,"../../control/goal/GoalState":41,"../../enums/Globals":46,"../../enums/Protocols":51,"../../manager/ConfigManager":54,"../../manager/SoundManager":58,"../../model/DataAccessEntry":59,"../../model/da/BattleInfoProxy":63,"../../model/net/NetManager":68,"../battleui/BattleSceneUI":104,"./scene/SceneMoveObject":93,"./world/World":103}],89:[function(require,module,exports){"use strict"
;var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},SceneObject_1=require("./SceneObject"),BitmapObject=function(_super){function BitmapObject(textrue){_super.call(this),this.image=new egret.Bitmap,this.image.texture=textrue,this.image.y=-textrue.textureHeight,this.addChild(this.image)}return __extends(BitmapObject,_super),BitmapObject.prototype.dispose=function(){_super.prototype.dispose.call(this),this.removeChild(this.image),this.image.texture.dispose(),this.image=null},BitmapObject}(SceneObject_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BitmapObject},{"./SceneObject":94}],90:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Person_1=require("./Person"),ConfigManager_1=require("../../../manager/ConfigManager"),SceneMoveObject_1=require("./SceneMoveObject"),SceneItem_1=require("./SceneItem"),CommonConfig_1=require("../../../enums/CommonConfig"),Hero=function(_super){function Hero(){_super.call(this)}return __extends(Hero,_super),Hero.prototype.isEquipedByPlayer=function(equipUniqueId,currHeroInfo){if(0==equipUniqueId)return!1;for(var itemLen=CommonConfig_1.default.EQUIP_TYPES.length,i=0;i<itemLen;++i){var key="item"+(i+1),heroEquipId=currHeroInfo[key];if(heroEquipId&&equipUniqueId==heroEquipId)return!0}return!1},Hero.prototype.setData=function(data){this._picks=[],this._stories=[],this._drawable="",this._oldPosisition=new egret.Point(0,0);var cfg=ConfigManager_1.default.getInstance().getConfig("hero",data.ownedHero.mid);_super.prototype.setData.call(this,cfg),this.name="hero",this.onControl=!0;for(var userInfo=data,userEquipInfo=userInfo.equips,i=0;i<userEquipInfo.length;++i)if(Number(userEquipInfo[i].userId)-userInfo.ownedHero.userId==0&&this.isEquipedByPlayer(Number(userEquipInfo[i].uuid),userInfo.ownedHero)){var itemCFG=ConfigManager_1.default.getInstance().getConfig("equip",userEquipInfo[i].modelID);if(Number(itemCFG.hp)>0&&(this.batterData.hp=this.batterData.hp+Number(itemCFG.hp)),Number(itemCFG.speed)>0&&(this.speed=this.speed+Number(itemCFG.speed)),Number(itemCFG.atkdamage)>0&&(this.batterData.attack_base=this.batterData.attack_base+Number(itemCFG.atkdamage)),Number(itemCFG.viewrange)>0&&(this.batterData.viewrange=this.batterData.viewrange+Number(itemCFG.viewrange)),Number(itemCFG.skill)>0){var skillCFG_1=ConfigManager_1.default.getInstance().getConfig("skill",Number(itemCFG.skill));1==Number(skillCFG_1.isattack)&&(this.batterData.attackID=Number(itemCFG.skill))}}if(this.batterData.attackID>0){var skillCFG=ConfigManager_1.default.getInstance().getConfig("skill",this.batterData.attackID);this._attackRange=Math.max(1,Number(skillCFG.atkrange))}this.batterData.maxhp=this.batterData.hp,this._hptext.text=this.batterData.hp+"/"+this.batterData.maxhp},Hero.prototype.restart=function(){_super.prototype.restart.call(this),this._picks=[],this._stories=[],this.onControl=!0},Hero.prototype.update=function(timeObject){_super.prototype.update.call(this,timeObject),Math.floor(this._timer)-this._floorTimer>0&&this._drawable.length>0&&this._oldPosisition!=this.position&&(this.gameWorld.showFlower(this._drawable,this.position),this._oldPosisition=this.position)},Object.defineProperty(Hero.prototype,"drawContent",{get:function(){return this._drawable},set:function(val){null==RES.getRes(val)&&this.say("找不到这个颜色"),this._drawable=val},enumerable:!0,configurable:!0}),Hero.prototype.transfer=function(pt){for(var items=this.gameWorld.findAllByRange(this.logicPosition,0),i=0;i<items.length;i++)if(items[i]instanceof SceneItem_1.default){var item=items[i];if(5==item.getData().type&&item.getData().teleport_target.length>0)for(var targets=item.getData().teleport_target.split("|"),j=0;j<targets.length;j++){var point=this.gameWorld.getSceneObjectByName(targets[j]);point.x==pt.x&&point.y==pt.y&&(this.logicPosition=pt)}}},Hero.prototype.openSceneItem=function(item){4==item.getData().type&&item.pickedByPerson(this)},Hero.prototype.answered=function(id){this._stories.push(id)},Hero.prototype.pick=function(nam){this._picks.push(nam)},Hero.prototype.getStoriesAnswered=function(){return this._stories},Hero.prototype.getPickedItems=function(){return this._picks},Hero.prototype.hurt=function(value){_super.prototype.hurt.call(this,value),this.dispatchEvent(new egret.Event(SceneMoveObject_1.default.HERO_HP,!0,!1,this.batterData))},Hero}(Person_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Hero},{"../../../enums/CommonConfig":45,"../../../manager/ConfigManager":54,"./Person":91,"./SceneItem":92,"./SceneMoveObject":93}],91:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ConfigManager_1=require("../../../manager/ConfigManager"),PersonInfo_1=require("../../../model/battle/PersonInfo"),PersonTeams_1=require("../../../enums/PersonTeams"),SceneMoveObject_1=require("./SceneMoveObject"),AIInfo_1=require("../../../model/battle/AIInfo"),PointUtil_1=require("../../../base/math/PointUtil"),BuffInfo_1=require("../../../model/battle/BuffInfo"),Hero_1=require("./Hero"),PersonTypes_1=require("../../../enums/PersonTypes"),SoundManager_1=require("../../../manager/SoundManager"),FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),Timeout_1=require("../../../base/utils/Timeout"),World_1=require("../world/World"),Person=function(_super){function Person(){_super.call(this),this._floorTimer=0,this._attackRange=1,this._birthPoint=new egret.Point(0,0),this._onControl=!1,this._buildIndex=0,this._storyID=0,this._isRotating=0,this._birthTimer=-1}return __extends(Person,_super),Object.defineProperty(Person.prototype,"birthPoint",{get:function(){return this._birthPoint},set:function(pt){this._birthPoint=pt},enumerable:!0,configurable:!0}),Object.defineProperty(Person.prototype,"onControl",{get:function(){return this._onControl},set:function(ct){this._onControl=ct},enumerable:!0,configurable:!0}),Object.defineProperty(Person.prototype,"batterData",{get:function(){return this._batterData},set:function(dat){this._batterData=dat},enumerable:!0,configurable:!0}),Person.prototype.birth=function(){this.batterData.hp=0;var that=this,state=this._animation.gotoAndPlay("born",0,-1,1);Timeout_1.default.setTimeout(function(){that.batterData&&(that.batterData.hp=that.batterData.maxhp)},this,1e3*state.clip.duration)},Person.prototype.setData=function(dat){if(this.batterData=new PersonInfo_1.default(dat),this._baseAttackRange=Math.max(1,this.batterData.viewrange-1),this.batterData.attackID>0){var skillCFG=ConfigManager_1.default.getInstance().getConfig("skill",this.batterData.attackID);this._attackRange=Math.max(1,Number(skillCFG.atkrange))}this._skillCD={},_super.prototype.setData.call(this,dat),this._BuffList=[],this._AIList=[],this._isRotating=Number(dat.isrotating),this._hpbg=new egret.Bitmap,this._hpbar=new egret.Bitmap,this.batterData.team==PersonTeams_1.default.FRIEND?(this._hpbg.texture=RES.getRes("hp_blue_bg_png"),this._hpbar.texture=RES.getRes("hp_blue_png")):this.batterData.team==PersonTeams_1.default.NEUTRAL||this.batterData.team==PersonTeams_1.default.GOODMAN?(this._hpbg.texture=RES.getRes("hp_green_bg_png"),this._hpbar.texture=RES.getRes("hp_green_png")):(this._hpbg.texture=RES.getRes("hp_red_bg_png"),this._hpbar.texture=RES.getRes("hp_red_png")),this._hpbg.x=-36,this._hpbg.y=-135,this.addChild(this._hpbg),this._hpbar.x=-24,this._hpbar.y=-125,this.addChild(this._hpbar),this._hptext=new egret.TextField,this._hptext.textColor=16777215,this._hptext.width=120,this._hptext.textAlign="center",this._hptext.text=name,this._hptext.size=17,this._hptext.x=-57,this._hptext.y=-142,this.addChild(this._hptext),this._hptext.text=this.batterData.hp+"/"+this.batterData.maxhp,this._hpbg.visible=!1,this._hpbar.visible=!1,this._hptext.visible=!1,3==Number(dat.hero_rotation)?this._display.scaleX=1:this._display.scaleX=-1},Person.prototype.dispose=function(){_super.prototype.dispose.call(this),this.removeChild(this._hpbg),this._hpbg.texture.dispose(),this._hpbg=null,this.removeChild(this._hpbar),this._hpbar.texture.dispose(),this._hpbar=null,this.removeChild(this._hptext),this._hptext=null,this._focusTarget=null,this._AIList=null,this._BuffList=null,this._batterData=null,this._skillCD=null},Object.defineProperty(Person.prototype,"attackRange",{get:function(){return this._attackRange},enumerable:!0,configurable:!0}),Person.prototype.initAI=function(){if(this._AIList=[],this._data.ai&&this._data.ai.length>0)for(var ids=this._data.ai.split("|"),i=0;i<ids.length;i++)if(Number(ids[i])>0){var ai=new AIInfo_1.default(0,ConfigManager_1.default.getInstance().getConfig("ai",Number(ids[i])));this._AIList.push(ai)}},Person.prototype.restart=function(){_super.prototype.restart.call(this),this._focusTarget=null,this._floorTimer=0,this.batterData.hp=this.batterData.maxhp,this.batterData.mp=0,this.batterData.sayhi=Number(this._data.sayhi),this.position=this.birthPoint,this.speed=this.baseSpeed,this.initAI(),this._BuffList=[],this._skillCD={},this._storyID=0,this._buildIndex=0,this._hpbar.scaleX=1,this._hptext.text=this.batterData.hp+"/"+this.batterData.maxhp,this._hpbg.visible=!1,this._hpbar.visible=!1,this._hptext.visible=!1},Person.prototype.turnUp=function(){1!=this._turn&&(_super.prototype.turnUp.call(this),this._animation.gotoAndPlay("move_fore",0,0,0))},Person.prototype.turnDown=function(){2!=this._turn&&(_super.prototype.turnDown.call(this),this._animation.gotoAndPlay("move_back",0,0,0))},Person.prototype.turnLeft=function(){3!=this._turn&&(_super.prototype.turnLeft.call(this),this._isRotating>0&&(this._display.scaleX=1),this._animation.gotoAndPlay("move_side",0,0,0))},Person.prototype.turnRight=function(){4!=this._turn&&(_super.prototype.turnRight.call(this),this._isRotating>0&&(this._display.scaleX=-1),this._animation.gotoAndPlay("move_side",0,0,0))},Person.prototype.turnLeftUp=function(){5!=this._turn&&(_super.prototype.turnUp.call(this),this._isRotating>0&&(this._display.scaleX=1),this._animation.gotoAndPlay("move_sideb",0,0,0))},Person.prototype.turnRightUp=function(){8!=this._turn&&(_super.prototype.turnUp.call(this),this._isRotating>0&&(this._display.scaleX=-1),this._animation.gotoAndPlay("move_sideb",0,0,0))},Person.prototype.turnLeftDown=function(){7!=this._turn&&(_super.prototype.turnDown.call(this),this._isRotating>0&&(this._display.scaleX=1),this._animation.gotoAndPlay("move_right",0,0,0))},Person.prototype.turnRightDown=function(){6!=this._turn&&(_super.prototype.turnDown.call(this),this._isRotating>0&&(this._display.scaleX=-1),this._animation.gotoAndPlay("move_right",0,0,0))},Person.prototype.addBuffCFG=function(buff){buff.delayTime>0?(buff.overTime=Math.floor(this._timer)+buff.delayTime,this._BuffList.push(buff),buff.speed>0&&(this.speed=this.speed+this.baseSpeed*(buff.speed-1)),buff.attack_add>0&&(this.batterData.attack_add=this.batterData.attack_add+buff.attack_add),buff.safe_range>0&&(this.batterData.safeRange=this.batterData.safeRange+buff.safe_range),buff.hurt_cut>0&&(this.batterData.hurt_cut=this.batterData.hurt_cut+buff.hurt_cut)):0==buff.delayTime?buff.hp>0&&this.hurt(-buff.hp):(this._BuffList.push(buff),buff.speed>0&&(this.speed=this.speed+this.baseSpeed*(buff.speed-1)),buff.attack_add>0&&(this.batterData.attack_add=this.batterData.attack_add+buff.attack_add)),this._hpbar.scaleX=Math.min(1,this.batterData.hp/this.batterData.maxhp),this._hptext.text=this.batterData.hp+"/"+this.batterData.maxhp},Person.prototype.addBuff=function(buffID){this.addBuffCFG(new BuffInfo_1.default(ConfigManager_1.default.getInstance().getConfig("buff",buffID)))},Person.prototype.updateBuff=function(){for(var i=0;i<this._BuffList.length;i++)0==this._BuffList[i].isOver&&this._BuffList[i].overTime-Math.floor(this._timer)>=0&&(this._BuffList[i].isOver=!0,this._BuffList[i].speed>0&&(this.speed=this.speed/this._BuffList[i].speed),this._BuffList[i].attack_add>0&&(this.speed=this.batterData.attack_add-this._BuffList[i].attack_add),this._BuffList[i].safe_range>0&&(this.batterData.safeRange=this.batterData.safeRange-this._BuffList[i].safe_range),this._BuffList[i].hurt_cut>0&&(this.batterData.hurt_cut=this.batterData.hurt_cut-this._BuffList[i].hurt_cut));this._hpbar.scaleX=Math.min(1,this.batterData.hp/this.batterData.maxhp),this._hptext.text=this.batterData.hp+"/"+this.batterData.maxhp},Person.prototype.playSkillByName=function(name,pt){this.playSkill(ConfigManager_1.default.getInstance().getIDByName("skill",name),pt)},Person.prototype.shieldAction=function(time,skillID){if(this.batterData.hp<1&&skillID>0&&this._skillCD[skillID]&&this._skillCD[skillID]>this._timer)return void this.dispatchEvent(new egret.Event(SceneMoveObject_1.default.HERO_ANIMATION_FINISH));var skillCFG=ConfigManager_1.default.getInstance().getConfig("skill",skillID),oldState=this.onControl;if(this.onControl=!0,this._animation.gotoAndPlay(skillCFG.skill_action,0,0,-1),Number(skillCFG.buff)>0){var buff=new BuffInfo_1.default(ConfigManager_1.default.getInstance().getConfig("buff",Number(skillCFG.buff)));buff.delayTime=time,this.addBuffCFG(buff)}FrameTweenLite_1.default.delayedCall(time,function(){this.dispatchEvent(new egret.Event(SceneMoveObject_1.default.HERO_ANIMATION_FINISH)),this.onControl=oldState,this.idle()})},Person.prototype.dashAction=function(logicPos){this._dashed=!0,this.speed=2*this.speed,this.moveTo(logicPos)},Person.prototype.playSkill=function(skillID,pt){if(skillID<1||this.batterData.hp<1||skillID>0&&this._skillCD[skillID]&&this._skillCD[skillID]>this._timer)return this instanceof Hero_1.default&&this.say("技能还不能施放"),void this.dispatchEvent(new egret.Event(SceneMoveObject_1.default.HERO_ANIMATION_FINISH));pt.x>this.logicPosition.x?this._display.scaleX=-1:this._display.scaleX=1;var skillCFG=ConfigManager_1.default.getInstance().getConfig("skill",skillID);this.sceneType==PersonTypes_1.default.BOMB&&(pt=this.logicPosition),skillCFG.s_sound.length>1&&SoundManager_1.default.getInstance().playAsyncEffect(skillCFG.s_sound),"build"==skillCFG.skill_type?this.playBuildSkill(pt,skillCFG):this.playCommonSkill(pt,skillCFG,skillID)},Person.prototype.playBuildSkill=function(pt,skillCFG){var _this=this,state=this._animation.gotoAndPlay(skillCFG.skill_action,0,0,-1);Timeout_1.default.setTimeout(function(){_this.dispatchEvent(new egret.Event(SceneMoveObject_1.default.HERO_ANIMATION_FINISH))},this,1e3*state.clip.duration);var builds=skillCFG.build_id.split("|"),buildIDs=builds[0];builds.length>1&&(buildIDs=builds[Math.floor(Math.random()*builds.length)]),builds=buildIDs.split(",");for(var i=0;i<builds.length;i++){var buildID=Number(builds[i]);Number(skillCFG.dmgrange)>0&&(pt.x=pt.x+Math.floor(Math.random()*Number(skillCFG.dmgrange)),pt.y=pt.y+Math.floor(Math.random()*Number(skillCFG.dmgrange))),this._buildIndex=this._buildIndex+1;var showName=skillCFG.build_name+"_"+this._buildIndex,trueName=showName;if(skillCFG.build_name.length<=1&&(showName="",trueName=this.name+"_"+this._buildIndex),buildID>=5e4){var person=this.gameWorld.addPerson(buildID,trueName,showName,PointUtil_1.default.getInstance().logicToPosition(pt).x,PointUtil_1.default.getInstance().logicToPosition(pt).y);5e4==buildID&&person.birth(),person.initAI(),this.gameWorld.buildObjects.push(person)}else buildID>=4e4&&this.gameWorld.buildObjects.push(this.gameWorld.addItem(buildID,trueName,showName,PointUtil_1.default.getInstance().logicToPosition(pt).x,PointUtil_1.default.getInstance().logicToPosition(pt).y))}this.gameWorld.updateDepth()},Person.prototype.playCommonSkill=function(pt,skillCFG,skillID){var state,_this=this;state=this instanceof Hero_1.default&&this.batterData.attackID==skillID&&Math.random()>.5?this.logicPosition.y<pt.y?this._animation.gotoAndPlay(skillCFG.skill_action+"2",0,0,-1):this._animation.gotoAndPlay(skillCFG.skill_action+"2_b",0,0,-1):this.logicPosition.y<pt.y?this._animation.gotoAndPlay(skillCFG.skill_action,0,0,-1):this._animation.gotoAndPlay(skillCFG.skill_action+"_b",0,0,-1),Timeout_1.default.setTimeout(function(){_this.dispatchEvent(new egret.Event(SceneMoveObject_1.default.HERO_ANIMATION_FINISH))},this,1e3*state.clip.duration);var targets=[];this._skillCD[skillID]=this._timer+Number(skillCFG.cd)/1e3;for(var alltargets=this.gameWorld.findPersonsByRange(pt,skillCFG.dmgrange),dmftype=Number(skillCFG.dmgtype),i=0;i<alltargets.length;i++)alltargets[i].batterData.hp>0&&(alltargets[i]==this&&this.sceneType!=PersonTypes_1.default.BOMB||3!=dmftype&&alltargets[i].batterData.team!=dmftype||targets.push(alltargets[i]));skillCFG.s_effect.length>1&&this.gameWorld.createEffect(.3,skillCFG.s_effect,this.position);var needTime=0;skillCFG.m_effect.length>1&&(needTime=this.gameWorld.createParticleEffect(skillCFG.m_effect,this.position,PointUtil_1.default.getInstance().logicToPosition(pt))),needTime+=Number(skillCFG.e_holdtime);var _that=this;FrameTweenLite_1.default.delayedCall(needTime,function(){for(var i=0;i<targets.length;i++)skillCFG.e_effect.length>1&&_that.gameWorld.createEffect(needTime,skillCFG.e_effect,_that.gameWorld.getSceneObjectByName(targets[i].name).position)});var hurtNumber=this.batterData.attack_base+this.batterData.attack_add+Number(skillCFG.atkdamage);0!=hurtNumber&&FrameTweenLite_1.default.delayedCall(needTime,function(){for(var i=0;i<targets.length;i++)if(targets[i].batterData.hp>0&&targets[i].sceneType==PersonTypes_1.default.BOMB&&targets[i].playAttack(targets[i].logicPosition),targets[i].hurt(hurtNumber),skillCFG.buff.length>0)for(var buffs=skillCFG.buff.split("|"),j=0;j<buffs.length;j++)Number(buffs[j])>0&&targets[i].addBuff(Number(buffs[j]))})},Person.prototype.getStoryID=function(){return this._storyID},Person.prototype.playStory=function(id){if(this._storyID=id,id<=0)return void(-1==id&&(this.batterData.hp=0,this.die()));var storyCFG=ConfigManager_1.default.getInstance().getConfig("story",id),that=this;Number(storyCFG.delay_time)>0&&FrameTweenLite_1.default.delayedCall(Number(storyCFG.delay_time),function(){for(var keys=storyCFG.next.split("|"),i=0;i<keys.length;i++)Number(keys[i])>0&&that.playStory(Number(keys[i]))}),this.playEvent(storyCFG.event),this.say(storyCFG.content)},Person.prototype.playEvent=function(val){for(var that=this,events=val.split("|"),i=0;i<events.length;i++)if(Number(events[i])>0){var eventCFG=ConfigManager_1.default.getInstance().getConfig("event",Number(events[i]));if(Number(eventCFG.ai)>0)if(Number(eventCFG.delay_time)>0)FrameTweenLite_1.default.delayedCall(Number(eventCFG.delay_time),function(){var ai=new AIInfo_1.default(that._timer,ConfigManager_1.default.getInstance().getConfig("ai",Number(eventCFG.ai)));1==ai.type&&ai.focusName.length>1&&(ai.endPoint=that.gameWorld.getSceneObjectByName(ai.focusName).logicPosition),that._AIList.push(ai)});else{var ai=new AIInfo_1.default(that._timer,ConfigManager_1.default.getInstance().getConfig("ai",Number(eventCFG.ai)));1==ai.type&&ai.focusName.length>1&&(ai.endPoint=that.gameWorld.getSceneObjectByName(ai.focusName).logicPosition),that._AIList.push(ai)}else if(Number(eventCFG.skill)>0)Number(eventCFG.delay_time)>0?FrameTweenLite_1.default.delayedCall(Number(eventCFG.delay_time),function(){eventCFG.npc.length>1?that.playSkill(Number(eventCFG.skill),that.gameWorld.getSceneObjectByName(eventCFG.npc).logicPosition):that.playSkill(Number(eventCFG.skill),that.logicPosition)}):eventCFG.npc.length>1?that.playSkill(Number(eventCFG.skill),that.gameWorld.getSceneObjectByName(eventCFG.npc).logicPosition):that.playSkill(Number(eventCFG.skill),that.logicPosition);else if(eventCFG.action.length>1){var ps=that.gameWorld.getSceneObjectByName(eventCFG.npc);ps.animation.gotoAndPlay(eventCFG.action,0,0,-1)}if(eventCFG.kill.length>1)if(Number(eventCFG.delay_time)>0)FrameTweenLite_1.default.delayedCall(Number(eventCFG.delay_time),function(){if("self"==eventCFG.kill)that.batterData.hp=0,that.die();else{var ps=that.gameWorld.getSceneObjectByName(eventCFG.kill);ps.batterData.hp=0,ps.die()}});else if("self"==eventCFG.kill)that.batterData.hp=0,that.die();else{var ps=that.gameWorld.getSceneObjectByName(eventCFG.kill);ps.batterData.hp=0,ps.die()}}},Person.prototype.checkStory=function(words){var storyCFG=ConfigManager_1.default.getInstance().getConfig("story",this._storyID);if(storyCFG.answer.length>1)for(var answers=storyCFG.answer.split("|"),nexts=storyCFG.next.split("|"),i=0;i<answers.length;i++)if("qitade"==answers[i])this.playStory(Number(nexts[i]));else if(answers[i].length>0)for(var keys=answers[i].split(","),j=0;j<keys.length;j++)if(keys[j].length>0){if(words.indexOf(keys[j])>=0)return this.playStory(Number(nexts[i])),!0;if("NUM"==keys[j]){var n=parseInt(words);if(!isNaN(n))return this.playStory(Number(storyCFG.next)),!0}}return!1},Person.prototype.checkSkillReady=function(skillType){var skillId=ConfigManager_1.default.getInstance().getSkillIdByType(skillType);return void 0===this._skillCD[skillId]||null==this._skillCD[skillId]||this._skillCD[skillId]-this._timer<=0},Person.prototype.playAttack=function(pt){this.playSkill(this.batterData.attackID,pt)},Person.prototype.hurt=function(value){if(this.batterData.hurt_cut>0&&(value=Math.max(1,value-this.batterData.hurt_cut)),this.batterData.hp=Math.min(this.batterData.maxhp,Math.max(0,this.batterData.hp-value)),this._hpbar.scaleX=Math.min(1,this.batterData.hp/this.batterData.maxhp),this._hptext.text=this.batterData.hp+"/"+this.batterData.maxhp,this.batterData.hp<=0?(this._hpbg.visible=!1,this._hpbar.visible=!1,this._hptext.visible=!1):0==this._hpbg.visible&&(this._hpbg.visible=!0,this._hpbar.visible=!0,this._hptext.visible=!0),value>0){var colorMatrix=[1,0,0,0,100,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._armature.display.filters=[new egret.ColorMatrixFilter(colorMatrix)];var _that=this;FrameTweenLite_1.default.delayedCall(.4,function(){_that._armature.display.filters=[],_that.batterData.hp<=0&&_that.die()})}},Person.prototype.findTarget=function(range){for(var tempTarget,targets=this.gameWorld.findPersonsByViewRange(this,range),dis=1e3,i=0;i<targets.length;i++)targets[i]!=this&&(this.batterData.team==PersonTeams_1.default.CHAOS||this.batterData.team==PersonTeams_1.default.HOSTILE&&targets[i].batterData.team==PersonTeams_1.default.GOODMAN||this.batterData.team!=targets[i].batterData.team&&targets[i].batterData.team<PersonTeams_1.default.NEUTRAL&&this.batterData.team<PersonTeams_1.default.NEUTRAL)&&egret.Point.distance(targets[i].logicPosition,this.logicPosition)<dis&&(tempTarget=targets[i],dis=egret.Point.distance(targets[i].logicPosition,this.logicPosition));return tempTarget},Person.prototype.autoFight=function(){if(this._focusTarget){if(this._focusTarget.batterData.hp<1)return void this.lostTarget();egret.Point.distance(this._focusTarget.logicPosition,this.logicPosition)<=this._attackRange&&this.gameWorld.checkPersonsInViewRange(this,this._focusTarget,this._attackRange)?(this.idle(),this.playSkill(this.batterData.attackID,this._focusTarget.logicPosition),this.batterData.skillID>0&&!(this instanceof Hero_1.default)&&this.playSkill(this.batterData.skillID,this._focusTarget.logicPosition)):this.moveTo(this._focusTarget.logicPosition)}},Person.prototype.lostTarget=function(){if(this._focusTarget=null,this instanceof Hero_1.default){var self=this;FrameTweenLite_1.default.delayedCall(1.5,function(){self.idle(),FrameTweenLite_1.default.killTweensOf(self),self.dispatchEvent(new egret.Event(SceneMoveObject_1.default.HERO_ATTACK_FINISH))})}else this.idle(),FrameTweenLite_1.default.killTweensOf(this)},Person.prototype.finishAI=function(ai){for(var i=0;i<this._AIList.length;i++)if(this._AIList[i]==ai){this._AIList.splice(i,1);break}if(ai.next.length>0)for(var i=0;i<ai.next.length;i++){var aiNext=new AIInfo_1.default(this._timer,ConfigManager_1.default.getInstance().getConfig("ai",ai.next[i]));1==aiNext.type&&aiNext.focusName.length>1&&(aiNext.endPoint=this.gameWorld.getSceneObjectByName(ai.focusName).logicPosition),this._AIList.push(aiNext)}ai.event.length>0&&this.playEvent(ai.event)},Person.prototype.checkAI=function(ai){if(0==ai.type)this.finishAI(ai);else if(1==ai.type){if(ai.focusName.length>1&&(ai.endPoint=this.gameWorld.getSceneObjectByName(ai.focusName).logicPosition),egret.Point.distance(ai.endPoint,this.logicPosition)<1)return this.finishAI(ai),!0;if(ai.gNPC.length>1){if(egret.Point.distance(this.gameWorld.getSceneObjectByName(ai.gNPC).logicPosition,this.logicPosition)>this.batterData.viewrange)return!0}else if(ai.gHP>0&&100*this.batterData.hp/this.batterData.maxhp-ai.gHP<=0)return!0}else if(2==ai.type){if(Math.floor(this._timer)>=ai.overTime)return this.finishAI(ai),!0}else if(3==ai.type)this.batterData.hp<=ai.gHP&&this.finishAI(ai);else if(4==ai.type)for(var answers=ai.focusName.split("|"),i=0;i<answers.length;i++)if(this.gameWorld.getDeadNames().indexOf(answers[i])>=0){this.finishAI(ai);break}return!1},Person.prototype.runAI=function(ai){if(0==this.checkAI(ai))1==ai.type&&(ai.focusName.length>1&&(ai.endPoint=this.gameWorld.getSceneObjectByName(ai.focusName).logicPosition),this.moveTo(ai.endPoint));else if(2==ai.type)ai.skill>0&&this.playSkill(ai.skill,this.logicPosition);else if(5==ai.type){var rotatePoint=PointUtil_1.default.getInstance().logicToPosition(ai.endPoint),newX=rotatePoint.x+(this.position.x-rotatePoint.x)*Math.cos(90)-(this.position.y-rotatePoint.y)*Math.sin(90),newY=rotatePoint.y+(this.position.x-rotatePoint.x)*Math.sin(90)+(this.position.y-rotatePoint.y)*Math.cos(90);this.position=new egret.Point(newX,newY);var skillCFG=ConfigManager_1.default.getInstance().getConfig("skill",ai.skill),that_1=this;if("build"==skillCFG.skill_type){var state=this._animation.gotoAndPlay(skillCFG.skill_action,0,0,-1);Timeout_1.default.setTimeout(function(){that_1.dispatchEvent(new egret.Event(SceneMoveObject_1.default.HERO_ANIMATION_FINISH))},this,1e3*state.clip.duration);var builds=skillCFG.build_id.split("|"),buildID=Number(builds[0]);if(builds.length>1&&(buildID=Number(builds[Math.floor(Math.random()*builds.length)])),buildID>=5e4){var showName=skillCFG.build_name+"_"+this._buildIndex,trueName=showName;skillCFG.build_name.length<=1&&(showName="",trueName=this.name+"_"+this._buildIndex);var person=this.gameWorld.addPerson(buildID,trueName,showName,this.position.x,this.position.y);5e4==buildID&&person.birth(),this.gameWorld.buildObjects.push(person),person.moveTo(new egret.Point(this.logicPosition.x+10*(this.logicPosition.x-ai.endPoint.x),this.logicPosition.y+10*(this.logicPosition.y-ai.endPoint.y)))}}}},Person.prototype.setTarget=function(_target){this._focusTarget=_target},Person.prototype.getTarget=function(){return this._focusTarget},Person.prototype.update=function(timeObject){if(_super.prototype.update.call(this,timeObject),!(this.batterData.hp<=0||this.onControl||0==World_1.default.ISPLAYING)&&(this._focusTarget&&(egret.Point.distance(this._focusTarget.logicPosition,this.logicPosition)<=this._attackRange&&0!=this._status&&this.gameWorld.checkPersonsInViewRange(this,this._focusTarget,this._attackRange)&&this.idle(),this instanceof Hero_1.default&&0==this.gameWorld.checkPersonsInViewRange(this,this._focusTarget,this._attackRange)&&this.lostTarget()),Math.floor(this._timer)-this._floorTimer>0)){if(this.batterData.sayhi>0)for(var targets=this.gameWorld.findPersonsByViewRange(this,this.batterData.viewrange),i=0;i<targets.length;i++)if(targets[i]instanceof Hero_1.default){this.playStory(this.batterData.sayhi),this.batterData.sayhi=0;break}if(this.updateBuff(),this.batterData.team!=PersonTeams_1.default.NEUTRAL&&null==this._focusTarget&&(this._focusTarget=this.findTarget(this.batterData.viewrange)),null!=this._focusTarget)this.autoFight();else for(var i=0;i<this._AIList.length;i++)this.runAI(this._AIList[i]);if(this._floorTimer=Math.floor(this._timer),this.batterData.safeRange>0)for(var targets=this.gameWorld.findPersonsByRange(this.logicPosition,this.batterData.safeRange),i=0;i<targets.length;i++)targets[i]!=this&&(this.batterData.team==PersonTeams_1.default.CHAOS||this.batterData.team!=targets[i].batterData.team&&targets[i].batterData.team<PersonTeams_1.default.NEUTRAL&&this.batterData.team<PersonTeams_1.default.NEUTRAL)&&targets[i].pushedByPerson(this,this.batterData.safeRange)}},Person.prototype.pushedByPerson=function(ps,range){var dist=egret.Point.distance(ps.position,this.position),endPos=new egret.Point(ps.position.x+range*(this.position.x-ps.position.x)/dist,ps.position.y+range*(this.position.y-ps.position.y)/dist),end=PointUtil_1.default.getInstance().positionToLogic(endPos);if(this.gameWorld.checkTilePassable(this,end))for(var targetPoints=[],i=1;i<30;i++){for(var j=0;j<2*i;j++){var x=end.x-i+j,y=end.y-i;if(this.gameWorld.checkTilePassable(this,new egret.Point(x,y))){targetPoints.push(new egret.Point(x,y));break}}for(var j=0;j<2*i;j++){var x=end.x+i,y=end.y-i+j;if(this.gameWorld.checkTilePassable(this,new egret.Point(x,y))){targetPoints.push(new egret.Point(x,y));break}}for(var j=0;j<2*i;j++){var x=end.x+i-j,y=end.y+i;if(this.gameWorld.checkTilePassable(this,new egret.Point(x,y))){targetPoints.push(new egret.Point(x,y));break}}for(var j=0;j<2*i;j++){var x=end.x-i,y=end.y+i-j;if(this.gameWorld.checkTilePassable(this,new egret.Point(x,y))){targetPoints.push(new egret.Point(x,y));break}}if(targetPoints.length>0){for(var targetPoint,j=0;j<targetPoints.length;j++)egret.Point.distance(ps.logicPosition,targetPoints[j]),targetPoint=targetPoints[j];end=targetPoint;break}}this.logicPosition=end},Person.prototype.die=function(){this.gameWorld.addDeadNames(this.name),FrameTweenLite_1.default.killTweensOf(this),this._status=4,this._animation.gotoAndPlay("die",0,0,-1),this._focusTarget=null,FrameTweenLite_1.default.to(this._display,1,{alpha:0,delay:3}),this._nameLabel&&FrameTweenLite_1.default.to(this._nameLabel,1,{alpha:0})},Object.defineProperty(Person.prototype,"hp",{get:function(){return this.batterData.hp},enumerable:!0,configurable:!0}),Object.defineProperty(Person.prototype,"maxHp",{get:function(){return this.batterData.maxhp},enumerable:!0,configurable:!0}),Person.prototype.moveToNearestKeyPoint=function(){var nearestPoint=this.getNearestPoint();return!!nearestPoint&&(!nearestPoint.equals(this.logicPosition)&&(!(this.batterData.hp<=0)&&(!(egret.Point.distance(this.logicPosition,nearestPoint)>15)&&(this.moveTo(nearestPoint),!0))))},Person}(SceneMoveObject_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Person},{"../../../base/math/PointUtil":6,"../../../base/utils/FrameTweenLite":18,"../../../base/utils/Timeout":20,"../../../enums/PersonTeams":49,"../../../enums/PersonTypes":50,"../../../manager/ConfigManager":54,"../../../manager/SoundManager":58,"../../../model/battle/AIInfo":60,"../../../model/battle/BuffInfo":61,"../../../model/battle/PersonInfo":62,"../world/World":103,"./Hero":90,"./SceneMoveObject":93}],92:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},SceneMoveObject_1=require("./SceneMoveObject"),Hero_1=require("./Hero"),LoadBitmap_1=require("../sprite/LoadBitmap"),FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),SceneItem=function(_super){function SceneItem(){_super.call(this),this._pickabled=!0,this._picked=!1,this._openabled=!0}return __extends(SceneItem,_super),Object.defineProperty(SceneItem.prototype,"pickabled",{get:function(){return this._pickabled},set:function(pa){this._pickabled=pa},enumerable:!0,configurable:!0}),Object.defineProperty(SceneItem.prototype,"picked",{get:function(){return this._picked},enumerable:!0,configurable:!0}),
Object.defineProperty(SceneItem.prototype,"openabled",{get:function(){return this._openabled},set:function(oa){this._openabled=oa},enumerable:!0,configurable:!0}),SceneItem.prototype.setData=function(dat){_super.prototype.setData.call(this,dat)},SceneItem.prototype.restart=function(){_super.prototype.restart.call(this),this._picked=!1,Number(this._data.whocollect)>0?this._pickabled=!0:this._pickabled=!1,Number(this._data.openable)>0?this._openabled=!0:this._openabled=!1},SceneItem.prototype.idle=function(){_super.prototype.idle.call(this),this.alpha=1,this.scaleX=1,this.scaleY=1},SceneItem.prototype.pickedByPerson=function(person){if(this.pickabled||this.openabled){if(this._picked=!0,this.gameWorld&&this.gameWorld.addDeadNames(this.name),this.getData().buff.length>0)for(var buffs=this.getData().buff.split("|"),i=0;i<buffs.length;i++)Number(buffs[i])>0&&person.addBuff(Number(buffs[i]));if(this.getData().drop_type.length>1)for(var drops=this.getData().drop_type.split("|"),i=0;i<drops.length;i++)if(Number(drops[i])>7e5)person.playEvent(drops[i]);else{var bit=new LoadBitmap_1.default("resource/battle/drop/"+drops[i]+".png");bit.x=this.x,bit.y=this.y,this.gameWorld.addEffect(bit),FrameTweenLite_1.default.to(bit,.6,{delay:.1*i,x:bit.x+10-20*Math.random(),y:bit.y-20*Math.random()}),FrameTweenLite_1.default.to(bit,.2,{delay:.1*i+.6,scale:0,x:person.x,y:person.y,onComplete:function(){bit.parent&&bit.parent.removeChild(bit)}})}this.disappear(),this.pickabled=!1,this.openabled=!1,person instanceof Hero_1.default&&person.pick(this.name)}},SceneItem.prototype.disappear=function(){FrameTweenLite_1.default.to(this,.5,{delay:.3,alpha:0,scale:0})},SceneItem}(SceneMoveObject_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SceneItem},{"../../../base/utils/FrameTweenLite":18,"../sprite/LoadBitmap":99,"./Hero":90,"./SceneMoveObject":93}],93:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},SceneObject_1=require("./SceneObject"),AStar_1=require("../../../base/math/AStar"),Hero_1=require("./Hero"),PointUtil_1=require("../../../base/math/PointUtil"),FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),SceneMoveObject=function(_super){function SceneMoveObject(){_super.call(this),this._nameHeight=0,this._baseAttackRange=1,this._status=0,this._baseSpeed=1,this._speed=1,this._sceneType=1,this._8face=!1,this._dashed=!1,this._oldTarget=new egret.Point(-1,0)}return __extends(SceneMoveObject,_super),SceneMoveObject.prototype.getDisplay=function(){return this._display},Object.defineProperty(SceneMoveObject.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(SceneMoveObject.prototype,"speed",{get:function(){return this._speed},set:function(value){this._speed=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneMoveObject.prototype,"sceneType",{get:function(){return this._sceneType},set:function(value){this._sceneType=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneMoveObject.prototype,"baseSpeed",{get:function(){return this._baseSpeed},set:function(value){this._baseSpeed=value},enumerable:!0,configurable:!0}),SceneMoveObject.prototype.setData=function(dat){this._data=dat,this.physicalWidth=Number(dat.physicalw),this.physicalHeight=Number(dat.physicalh),this.sightBlock=Number(dat.isvisionblock),this.moveBlock=Number(dat.ismoveblock),this.physicalBlock=Number(dat.isphysicalblock),this.speed=Number(dat.speed),this.baseSpeed=this.speed,this.sceneType=Number(dat.type),this._nameHeight=Number(dat.nameh),Number(dat.isfullangle)>0&&(this._8face=!0);var dragonBoneData=RES.getRes(dat.icon+"_skeleton_json"),textureData=RES.getRes(dat.icon+"_texture_json"),texture=RES.getRes(dat.icon+"_texture_png");dragonBoneData||console.error("[SceneMoveObject.setData] animation res error:",dat.icon+" not found"),this._dragonbonesFactory=new dragonBones.EgretFactory,this._dragonbonesFactory.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(dragonBoneData)),this._dragonbonesFactory.addTextureAtlas(new dragonBones.EgretTextureAtlas(texture,textureData)),this._armature=this._dragonbonesFactory.buildArmature(dat.icon),this._animation=this._armature.animation,this._armature.display.x=0,this._armature.display.y=0,dragonBones.WorldClock.clock.add(this._armature),this._animation.gotoAndPlay("idle",0,0,0),this._turn=0,this.addChild(this._armature.display),this._display=this._armature.display},SceneMoveObject.prototype.showName=function(name){this._nameLabel=new egret.TextField,this._nameLabel.textColor=16777215,this._nameLabel.width=200,this._nameLabel.textAlign="center",this._nameLabel.text=name,this._nameLabel.size=22,this._nameLabel.x=-102,this._nameLabel.y=-this._nameHeight,this._nameLabel.filters=[new egret.GlowFilter(16646001,.5,3,3)],this.addChild(this._nameLabel)},SceneMoveObject.prototype.setPath=function(path){this._path=path,FrameTweenLite_1.default.killTweensOf(this),this._status=1,this.runPath()},SceneMoveObject.prototype.runPath=function(){if(this._path&&this._path.length>0&&0!=this._status){var targetTile=this._path.shift();this.changeFace(PointUtil_1.default.getInstance().logicToPosition(targetTile)),this.moveFirstStep(targetTile)}},SceneMoveObject.prototype.moveBy=function(logicX,logicY){if(this._speed>0){for(var path=[],i=0;i<Math.abs(logicX);i++)path.push(new egret.Point(this.logicPosition.x+(i+1)*logicX/Math.abs(logicX),this.logicPosition.y));for(var i=0;i<Math.abs(logicY);i++)path.push(new egret.Point(this.logicPosition.x,this.logicPosition.y+(i+1)*logicY/Math.abs(logicY)));this.setPath(path)}},SceneMoveObject.prototype.moveTo=function(logicPos){this._speed>0&&this.logicPosition!=logicPos&&(this.gameWorld.usePath?(this.setPath(AStar_1.default.getInstance().findPath(this,this.logicPosition,logicPos)),this._oldTarget=logicPos):(FrameTweenLite_1.default.killTweensOf(this),this._status=1,this.changeFace(PointUtil_1.default.getInstance().logicToPosition(logicPos)),this.moveStraightStep(PointUtil_1.default.getInstance().logicToPosition(logicPos)),this._oldTarget=logicPos))},SceneMoveObject.prototype.changeFace=function(faceTarget){if(this._8face){var angle=Math.atan((faceTarget.y-this.position.y)/(faceTarget.x-this.position.x));faceTarget.x>this.position.x?angle>3*Math.PI/8?this.turnUp():angle>Math.PI/8?this.turnLeft():angle>-Math.PI/8?this.turnLeftDown():angle>3*-Math.PI/8?this.turnLeftUp():this.turnDown():angle>3*Math.PI/8?this.turnUp():angle>Math.PI/8?this.turnRightUp():angle>-Math.PI/8?this.turnRightDown():angle>3*-Math.PI/8?this.turnRight():this.turnUp()}else Math.abs(this.position.x-faceTarget.x)>Math.abs(this.position.y-faceTarget.y)?this.position.x-faceTarget.x>0?this.turnLeft():this.turnRight():this.position.y-faceTarget.y>0?this.turnDown():this.turnUp()},SceneMoveObject.prototype.moveStraightStep=function(pos){var targetPos,distance=egret.Point.distance(pos,this.position);targetPos=distance<=5?pos:new egret.Point(this.position.x+5*(pos.x-this.position.x)/distance,this.position.y+5*(pos.y-this.position.y)/distance);var newLogicPoint=PointUtil_1.default.getInstance().positionToLogic(targetPos);if(newLogicPoint!=this.logicPosition&&this instanceof Hero_1.default&&this.gameWorld.dispatchEvent(new egret.Event(SceneMoveObject.HERO_PASSBY,!1,!1,this)),0==this.gameWorld.checkTilePassable(this,newLogicPoint))this instanceof Hero_1.default&&(this.dispatchEvent(new egret.Event(SceneMoveObject.MOVE_FINISHED,!1,!1,{type:"abnormal",pos:this.logicPosition})),this.say("被阻挡了")),this.idle();else{var needTime=.0175*egret.Point.distance(this.position,targetPos)/this.speed,_this=this;if(0==needTime)return;FrameTweenLite_1.default.to(this,needTime,{x:targetPos.x,y:targetPos.y,onComplete:function(){_this.gameWorld&&(_this.gameWorld.updateDepth(),egret.Point.distance(_this.logicPosition,_this._oldTarget)>=1?_this.moveStraightStep(PointUtil_1.default.getInstance().logicToPosition(_this._oldTarget)):(_this instanceof Hero_1.default&&_this.dispatchEvent(new egret.Event(SceneMoveObject.MOVE_FINISHED,!1,!1,{type:"normal",pos:_this.logicPosition})),_this.idle()))},ease:Linear.easeNone})}},SceneMoveObject.prototype.moveCloseTo=function(logicPos,range){for(var targetPoints=[],i=range;i>0;i--){for(var j=0;j<2*i;j++){var dPoint=new egret.Point(logicPos.x-i+j,logicPos.y-i);egret.Point.distance(logicPos,dPoint)<=range&&1==this.gameWorld.checkTilePassable(this,dPoint)&&targetPoints.push(dPoint)}for(var j=0;j<2*i;j++){var dPoint=new egret.Point(logicPos.x+i,logicPos.y-i+j);egret.Point.distance(logicPos,dPoint)<=range&&1==this.gameWorld.checkTilePassable(this,dPoint)&&targetPoints.push(dPoint)}for(var j=0;j<2*i;j++){var dPoint=new egret.Point(logicPos.x+i-j,logicPos.y+i);egret.Point.distance(logicPos,dPoint)<=range&&1==this.gameWorld.checkTilePassable(this,dPoint)&&targetPoints.push(dPoint)}for(var j=0;j<2*i;j++){var dPoint=new egret.Point(logicPos.x-i,logicPos.y+i-j);egret.Point.distance(logicPos,dPoint)<=range&&1==this.gameWorld.checkTilePassable(this,dPoint)&&targetPoints.push(dPoint)}if(targetPoints.length>0){for(var targetPoint,_distance=-1,j=0;j<targetPoints.length;j++)(egret.Point.distance(this.logicPosition,targetPoints[j])<_distance||-1==_distance)&&(targetPoint=targetPoints[j],_distance=egret.Point.distance(this.logicPosition,targetPoints[j]));this.setPath(AStar_1.default.getInstance().findPath(this,this.logicPosition,targetPoint)),this._oldTarget=targetPoint;break}}},SceneMoveObject.prototype.moveFirstStep=function(targetTile){var _this=this,targetPos=PointUtil_1.default.getInstance().logicToPosition(targetTile),oldLogicPoint=this.logicPosition,needTime=.00875*egret.Point.distance(this.position,targetPos)/this.speed;0!=needTime&&FrameTweenLite_1.default.to(this,needTime,{x:(targetPos.x+this.position.x)/2,y:(targetPos.y+this.position.y)/2,onComplete:function(){_this.gameWorld&&(0==_this.gameWorld.checkTilePassable(_this,targetTile)?(_this._oldTarget=new egret.Point(-1,0),_this.idle(),_this.logicPosition=oldLogicPoint,_this instanceof Hero_1.default&&(_this.dispatchEvent(new egret.Event(SceneMoveObject.MOVE_FINISHED,!1,!1,{type:"abnormal",pos:this.logicPosition})),_this.say("被阻挡了"))):(_this.gameWorld&&_this.gameWorld.updateDepth(),_this.moveSecondStep(needTime,targetPos)))},ease:Linear.easeNone})},SceneMoveObject.prototype.moveSecondStep=function(needTime,targetPos){var _this=this;FrameTweenLite_1.default.to(this,needTime,{x:targetPos.x,y:targetPos.y,onComplete:function(){_this.gameWorld&&(_this.gameWorld.dispatchEvent(new egret.Event(SceneMoveObject.HERO_PASSBY,!1,!1,_this)),_this._path.length>0?_this.runPath():(_this._dashed&&(_this._dashed=!1,_this.speed=_this.speed/2),_this.idle(),_this instanceof Hero_1.default&&_this.dispatchEvent(new egret.Event(SceneMoveObject.MOVE_FINISHED,!1,!1,{type:"normal",pos:_this.logicPosition}))))},ease:Linear.easeNone})},SceneMoveObject.prototype.restart=function(){_super.prototype.restart.call(this),this._display.alpha=1,FrameTweenLite_1.default.killTweensOf(this._display),this._nameLabel&&(FrameTweenLite_1.default.killTweensOf(this._nameLabel),this._nameLabel.alpha=1),this._oldTarget=new egret.Point(-1,0)},SceneMoveObject.prototype.idle=function(){_super.prototype.idle.call(this),0!=this._status&&(FrameTweenLite_1.default.killTweensOf(this),this._status=0,this._turn=0,this._animation.gotoAndPlay("idle",0,0,0))},SceneMoveObject.prototype.dispose=function(){_super.prototype.dispose.call(this),dragonBones.WorldClock.clock.remove(this._armature),this._dragonbonesFactory.dispose(!0),this._armature.dispose(),this._animation.stop()},SceneMoveObject.HERO_STOPPED="hero_stopped",SceneMoveObject.MOVE_FINISHED="hero_move_finished",SceneMoveObject.HERO_PASSBY="hero_passby",SceneMoveObject.HERO_HP="hero_hp",SceneMoveObject.HERO_ANIMATION_FINISH="hero_animation_over",SceneMoveObject.HERO_ATTACK_FINISH="hero_attack_over",SceneMoveObject}(SceneObject_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SceneMoveObject},{"../../../base/math/AStar":5,"../../../base/math/PointUtil":6,"../../../base/utils/FrameTweenLite":18,"./Hero":90,"./SceneObject":94}],94:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},World_1=require("../world/World"),PointUtil_1=require("../../../base/math/PointUtil"),FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),SceneObject=function(_super){function SceneObject(){_super.call(this),this._turn=0,this._timer=0,this._sightBlock=0,this._moveBlock=0,this._physicalBlock=0,this._physicalWidth=0,this._physicalHeight=0,this._position=new egret.Point(0,0)}return __extends(SceneObject,_super),SceneObject.prototype.getData=function(){return this._data},Object.defineProperty(SceneObject.prototype,"type",{get:function(){return this._data.findtype},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObject.prototype,"sightBlock",{get:function(){return this._sightBlock},set:function(value){this._sightBlock=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObject.prototype,"moveBlock",{get:function(){return this._moveBlock},set:function(value){this._moveBlock=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObject.prototype,"physicalBlock",{get:function(){return this._physicalBlock},set:function(value){this._physicalBlock=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObject.prototype,"physicalWidth",{get:function(){return this._physicalWidth},set:function(value){this._physicalWidth=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObject.prototype,"physicalHeight",{get:function(){return this._physicalHeight},set:function(value){this._physicalHeight=value},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObject.prototype,"position",{get:function(){return new egret.Point(this.x,this.y)},set:function(pos){this.x=pos.x,this.y=pos.y,this._position=pos},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObject.prototype,"logicPosition",{get:function(){return this._logicPosition=PointUtil_1.default.getInstance().positionToLogic(this.position),this._logicPosition},set:function(pt){this.position=PointUtil_1.default.getInstance().logicToPosition(pt),this._logicPosition=pt},enumerable:!0,configurable:!0}),SceneObject.prototype.checkPointIn=function(pt){if(pt){var tmpPoint=pt.subtract(this.logicPosition);if(tmpPoint.x<=Math.floor(this.physicalWidth/2)&&tmpPoint.x>=-Math.floor(this.physicalWidth/2)&&tmpPoint.y<=Math.floor(this.physicalHeight/2)&&tmpPoint.y>=-Math.floor(this.physicalHeight/2))return!0}return!1},Object.defineProperty(SceneObject.prototype,"turn",{get:function(){return this._turn},enumerable:!0,configurable:!0}),SceneObject.prototype.turnUp=function(){this._turn=1},SceneObject.prototype.turnDown=function(){this._turn=2},SceneObject.prototype.turnLeft=function(){this._turn=3},SceneObject.prototype.turnRight=function(){this._turn=4},SceneObject.prototype.turnLeftUp=function(){this._turn=5},SceneObject.prototype.turnRightUp=function(){this._turn=8},SceneObject.prototype.turnLeftDown=function(){this._turn=7},SceneObject.prototype.turnRightDown=function(){this._turn=6},SceneObject.prototype.getSize=function(){return new egret.Rectangle(this.logicPosition.x-Math.floor(this.physicalWidth/2),this.logicPosition.y-Math.floor(this.physicalHeight/2),this.physicalWidth,this.physicalHeight)},SceneObject.prototype.update=function(timeObject){this._timer=timeObject.frame/30},SceneObject.prototype.say=function(word){"biexianshi"!=word.toString()&&this.gameWorld.addChatBubble(this,word.toString())},SceneObject.prototype.dispose=function(){FrameTweenLite_1.default.killTweensOf(this),this._data=null},SceneObject.prototype.restart=function(){FrameTweenLite_1.default.killTweensOf(this),this.idle()},SceneObject.prototype.idle=function(){},Object.defineProperty(SceneObject.prototype,"pos",{get:function(){return this.logicPosition},enumerable:!0,configurable:!0}),Object.defineProperty(SceneObject.prototype,"gameWorld",{get:function(){return this.parent&&this.parent.parent&&this.parent.parent instanceof World_1.default?this.parent.parent:null},enumerable:!0,configurable:!0}),SceneObject.prototype.collideWith=function(collider){return 0==egret.Point.distance(this.logicPosition,collider.logicPosition)},SceneObject.prototype.getNearestPoint=function(){for(var points=this.gameWorld.points,distance=1/0,nearestPoint=points[0],i=0;i<points.length;i++)if(points[i]){var tempDistance=egret.Point.distance(points[i],this.logicPosition);tempDistance<distance&&(distance=tempDistance,nearestPoint=points[i])}return nearestPoint},SceneObject}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SceneObject},{"../../../base/math/PointUtil":6,"../../../base/utils/FrameTweenLite":18,"../world/World":103}],95:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),ChatBubble=function(_super){function ChatBubble(fromLeft,pos,content){_super.call(this),this._label=new egret.TextField,this._label.textColor=16777215,this._label.width=260,this._label.textAlign="left",this._label.text=content,this._label.size=22,this._label.x=32,this._label.y=15,this._bg=new egret.Bitmap,this._bg.texture=RES.getRes("bubble_png"),this._bg.scale9Grid=new egret.Rectangle(30,20,10,10),this._bg.width=300,this._bg.height=22*this._label.numLines+40,this.addChild(this._bg),this.addChild(this._label),fromLeft?(this._bg.scaleX=-1,this._label.x=-277,this.x=pos.x-25):this.x=pos.x+40,this.y=pos.y;var _this=this;FrameTweenLite_1.default.to(this,2,{delay:3*content.length+3,alpha:0,onComplete:function(){_this.removeChild(_this._bg),_this._bg=null,_this.removeChild(_this._label),_this._label=null,_this.parent&&_this.parent.removeChild(_this)},ease:Linear.easeInOut})}return __extends(ChatBubble,_super),ChatBubble}(egret.DisplayObjectContainer);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ChatBubble},{"../../../base/utils/FrameTweenLite":18}],96:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Flower=function(_super){function Flower(textrueName,position){_super.call(this),this.texture=RES.getRes(textrueName),this.anchorOffsetX=8,this.anchorOffsetY=8,this.x=position.x,this.y=position.y}return __extends(Flower,_super),Flower}(egret.Bitmap);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Flower},{}],97:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),FootPrint=function(_super){function FootPrint(position,turn){_super.call(this),this.texture=RES.getRes("foot_png"),this.anchorOffsetX=8,this.anchorOffsetY=8,1==turn?this.rotation=180:3==turn?this.rotation=-90:4==turn&&(this.rotation=90),this.x=position.x,this.y=position.y;var _this=this;FrameTweenLite_1.default.to(this,20,{alpha:0,onComplete:function(){_this.parent&&_this.parent.removeChild(_this)},ease:Linear.easeInOut})}return __extends(FootPrint,_super),FootPrint}(egret.Bitmap);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=FootPrint},{"../../../base/utils/FrameTweenLite":18}],98:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Timer_1=require("../../../base/utils/Timer"),TimerEvent_1=require("../../../base/utils/TimerEvent"),FrameEffect=function(_super){function FrameEffect(plistName){_super.call(this),this._animationIndex=1,this._speed=1,this.isLoop=!1,this._name=plistName,this._allTexture=new Object;var plist=RES.getRes(plistName+"_plist"),test=new egret.Bitmap;test.texture=RES.getRes(plistName+"_png");var dict=plist.children[0],data=dict.children[1];this._length=Math.floor(data.children.length/2);for(var i=0;i<this._length;i++){var key=data.children[2*i],obj=key.children[0],fName=obj.text,drawTexture=new egret.RenderTexture,allT=data.children[2*i+1];key=allT.children[1],obj=key.children[0];var sArr=obj.text.split(",");sArr[0]=sArr[0].slice(1);var offX=Number(sArr[0].slice(1)),offY=Number(sArr[1].slice(0,-1)),width=Number(sArr[2].slice(1));sArr[3]=sArr[3].slice(0,-1);var height=Number(sArr[3].slice(0,-1));key=allT.children[7],obj=key.children[0],sArr=obj.text.split(","),sArr[0]=sArr[0].slice(1);var fromX=Number(sArr[0].slice(1)),fromY=Number(sArr[1].slice(0,-1));key=allT.children[9],obj=key.children[0],drawTexture.drawToTexture(test,new egret.Rectangle(offX,offY,width,height),1),drawTexture.$initData(0,0,width,height,fromX,fromY,width,height,width,height),0==i&&(this.texture=drawTexture,key=allT.children[9],obj=key.children[0],sArr=obj.text.split(","),sArr[0]=sArr[0].slice(1),sArr[1]=sArr[1].slice(0,-1),this.anchorOffsetX=Number(sArr[0])/2,this.anchorOffsetY=Number(sArr[1])/2),this._allTexture[fName]=drawTexture}this.texture=this._allTexture[this._name+" (1).png"],test=null;var timer=new Timer_1.default(40/this._speed,this._length);timer.addEventListener(TimerEvent_1.default.TIMER,this.onTimer,this),timer.addEventListener(TimerEvent_1.default.TIMER_COMPLETE,this.onTimerComplete,this),timer.start()}return __extends(FrameEffect,_super),FrameEffect.prototype.onTimer=function(event){this._animationIndex++,this._animationIndex>this._length&&(this._animationIndex=1),this.texture=this._allTexture[this._name+" ("+this._animationIndex+").png"]},FrameEffect.prototype.onTimerComplete=function(event){var timer=event.currentTarget;if(this.isLoop)timer.reset(),timer.start();else{timer.removeEventListener(TimerEvent_1.default.TIMER,this.onTimer,this),timer.removeEventListener(TimerEvent_1.default.TIMER_COMPLETE,this.onTimerComplete,this),this.parent&&this.parent.removeChild(this);for(var texKey in this._allTexture)this._allTexture[texKey].dispose(),this._allTexture[texKey]=null;this._allTexture=null}},FrameEffect}(egret.Bitmap);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=FrameEffect},{"../../../base/utils/Timer":21,"../../../base/utils/TimerEvent":22}],99:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},LoadBitmap=function(_super){function LoadBitmap(address){_super.call(this),RES.getResByUrl(address,this.onComplete,this,RES.ResourceItem.TYPE_IMAGE)}return __extends(LoadBitmap,_super),LoadBitmap.prototype.onComplete=function(event){this.texture=event},LoadBitmap}(egret.Bitmap);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=LoadBitmap},{}],100:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Globals_1=require("../../../enums/Globals"),MapTips=function(_super){function MapTips(pt){_super.call(this),this.x=pt.x*Globals_1.default.TILE_WIDTH+20,this.y=pt.y*Globals_1.default.TILE_HEIGHT-15,this._bg=new egret.Shape,this._bg.graphics.beginFill(0,.5),this._bg.graphics.drawRect(0,0,90,30),this._bg.graphics.endFill(),this.addChild(this._bg),this._label=new egret.TextField,this._label.textColor=16777215,this._label.width=90,this._label.textAlign="center",this._label.text="x:"+pt.x+",y:"+pt.y,this._label.size=18,this._label.x=2,this._label.y=4,this.addChild(this._label)}return __extends(MapTips,_super),MapTips.prototype.dispose=function(){this._bg.graphics.clear(),this._bg=null,this._label=null},MapTips}(egret.DisplayObjectContainer);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MapTips},{"../../../enums/Globals":46}],101:[function(require,module,exports){"use strict";var Globals_1=require("../../../enums/Globals"),TweenLiteDriver_1=require("../../../base/utils/TweenLiteDriver"),Camera=function(){function Camera(){this._lock=!1,this._scale=1,this._velocity=0,this._centerPoint=new egret.Point(Globals_1.default.GAME_WIDTH*Globals_1.default.BATTLE_AREA_WIDTH_RATIO/2,Globals_1.default.GAME_HEIGHT/2)}return Object.defineProperty(Camera.prototype,"lock",{get:function(){return this._lock},set:function(value){this._lock=value},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"focusPoint",{get:function(){return this._oldPosition},enumerable:!0,configurable:!0}),Camera.prototype.bind=function(world){this._world=world,this._oldPosition=new egret.Point(this._world.hero.x,this._world.hero.y),this.updatePosition()},Camera.prototype.update=function(time){this._oldPosition.x==this._hero.x&&this._oldPosition.y==this._hero.y||this.updatePosition()},Camera.prototype.lockAt=function(hero){this._hero=hero,this._oldPosition=new egret.Point(this._hero.x,this._hero.y),TweenLiteDriver_1.default.startTick(this.update,this),this.updatePosition(),this._lock=!0},Camera.prototype.unLock=function(){this._lock&&(TweenLiteDriver_1.default.stopTick(this.update,this),this._lock=!1)},Camera.prototype.updatePosition=function(){this.lock&&(egret.Point.distance(this._oldPosition,this._hero.position)<1||egret.Point.distance(this._oldPosition,this._hero.position)>5?(this._oldPosition.x=this._hero.x,this._oldPosition.y=this._hero.y):(Math.abs(this._hero.x-this._oldPosition.x)>0&&(this._velocity=Math.min(Math.abs(this._hero.x-this._oldPosition.x),4),this._oldPosition.x=this._oldPosition.x+this._velocity*(this._hero.x-this._oldPosition.x)/Math.abs(this._hero.x-this._oldPosition.x)),Math.abs(this._hero.y-this._oldPosition.y)>0&&(this._velocity=Math.min(Math.abs(this._hero.y-this._oldPosition.y),4),this._oldPosition.y=this._oldPosition.y+this._velocity*(this._hero.y-this._oldPosition.y)/Math.abs(this._hero.y-this._oldPosition.y)))),this.focusAt(this._oldPosition.x,this._oldPosition.y)},Camera.prototype.focusAt=function(x,y){this._world.x=Math.max(Math.min(0,Globals_1.default.GAME_WIDTH*Globals_1.default.BATTLE_AREA_WIDTH_RATIO-this._world.getWidth()*this._scale),Math.min(0,this._centerPoint.x-x*this._scale)),this._world.y=Math.max(Math.min(0,Globals_1.default.GAME_HEIGHT-this._world.getHeight()*this._scale),Math.min(0,this._centerPoint.y-y*this._scale)),this._oldPosition=new egret.Point((this._centerPoint.x-this._world.x)/this._scale,(this._centerPoint.y-this._world.y)/this._scale),this._x=x,this._y=y},Camera.prototype.getScale=function(){return this._scale},Camera.prototype.zoom=function(scale){return this._scale=scale,this._world.scaleX=this._scale,this._world.scaleY=this._scale,this.focusAt(this._x,this._y),this._scale},Camera}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Camera},{"../../../base/utils/TweenLiteDriver":23,"../../../enums/Globals":46}],102:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Person_1=require("../scene/Person"),Globals_1=require("../../../enums/Globals"),BitmapObject_1=require("../scene/BitmapObject"),ConfigManager_1=require("../../../manager/ConfigManager"),SceneItem_1=require("../scene/SceneItem"),TileMap=function(_super){function TileMap(){_super.apply(this,arguments),this._points=[]}return __extends(TileMap,_super),TileMap.prototype.getWidth=function(){return this._width},TileMap.prototype.getHeight=function(){return this._height},TileMap.prototype.updateDepth=function(){this.sceneObjects.sort(function(a,b){return a.y-b.y});for(var i=0;i<this.sceneObjects.length;i++)this._mainLayer.setChildIndex(this.sceneObjects[i],i)},TileMap.prototype.setData=function(mapKey){var data=egret.XML.parse(RES.getRes(mapKey));this.sceneObjects=[],this.grids=new Array,this._birthPoint=new egret.Point(0,0);var texture=RES.getRes(mapKey+"battleMap_png");this._width=Globals_1.default.TILE_WIDTH*data.attributes.width,this._height=Globals_1.default.TILE_HEIGHT*data.attributes.height,this._bgEffectLayer=new egret.Sprite,this.addChild(this._bgEffectLayer);for(var i=0;i<Math.ceil(this._width/texture.textureWidth);i++)for(var j=0;j<Math.ceil(this._height/texture.textureHeight);j++){var bitmap=new egret.Bitmap;bitmap.texture=texture,bitmap.x=texture.textureWidth*i,bitmap.y=texture.textureHeight*j,this._bgEffectLayer.addChild(bitmap)}texture=null,this._mainLayer=new egret.Sprite,this.addChild(this._mainLayer),this._effectLayer=new egret.Sprite,this.addChild(this._effectLayer);for(var i=0;i<data.attributes.width;i++){this.grids[i]=new Array;for(var j=0;j<data.attributes.height;j++)this.grids[i][j]=0}for(var tilesets=[],i=0;i<data.children.length;i++){var layer=data.children[i];if("tileset"==layer.name)for(var j=0;j<layer.children.length;j++){var tileset=layer.children[j];tileset.children.length>0&&(tilesets[tileset.attributes.id]=tileset.children[0].attributes.source)}}for(var i=0;i<data.children.length;i++){var layer=data.children[i];if("obstacles"==layer.attributes.name){var gridWidth=Number(layer.attributes.width);if(layer.children.length>0&&layer.children[0].children.length>0)for(var values=layer.children[0].children[0].text.split(","),j=0;j<values.length;j++)Number(values[j])>0&&(this.grids[j%gridWidth][Math.floor(j/gridWidth)]=1)}else if("object"==layer.attributes.name)for(var j=0;j<layer.children.length;j++){var point=layer.children[j],imageOBJ=new BitmapObject_1.default(RES.getRes(tilesets[point.attributes.gid-1]));imageOBJ.x=Math.floor(point.attributes.x),imageOBJ.y=Math.floor(point.attributes.y),imageOBJ.name=point.attributes.name,this._bgEffectLayer.addChild(imageOBJ),"entry"==point.attributes.name?this._birthPoint=this.createWorldLogicPoint(point.attributes):"exit"==point.attributes.name?this._exitPoint=this.createWorldLogicPoint(point.attributes):-1!=point.attributes.name.indexOf("point")&&this._points.push(this.createWorldLogicPoint(point.attributes))}else if("npc"==layer.attributes.name)for(var j=0;j<layer.children.length;j++){var npc=layer.children[j];if(npc.attributes.name.indexOf("npc")>=0){var names=npc.attributes.name.split("|");this.addPerson(Number(names[2]),names[1],names[3],npc.attributes.x,npc.attributes.y)}else if(npc.attributes.name.indexOf("item")>=0){var names=npc.attributes.name.split("|");this.addItem(Number(names[2]),names[1],names[3],npc.attributes.x,npc.attributes.y)}else{var imageOBJ=new BitmapObject_1.default(RES.getRes(tilesets[npc.attributes.gid-1]));imageOBJ.x=Math.floor(npc.attributes.x),imageOBJ.y=Math.floor(npc.attributes.y),imageOBJ.name=npc.attributes.name,this._mainLayer.addChild(imageOBJ),this.sceneObjects.push(imageOBJ)}}else if("ground"==layer.attributes.name)for(var j=0;j<layer.children.length;j++){var npc=layer.children[j],imageOBJ=new BitmapObject_1.default(RES.getRes(tilesets[npc.attributes.gid-1]));imageOBJ.x=Math.floor(npc.attributes.x),imageOBJ.y=Math.floor(npc.attributes.y),this._bgEffectLayer.addChild(imageOBJ)}}this._bgEffectLayer.touchEnabled=!1,
this._bgEffectLayer.touchChildren=!1,this._bgEffectLayer.cacheAsBitmap=!0},TileMap.prototype.addPerson=function(id,name,showName,x,y){var cfg=ConfigManager_1.default.getInstance().getConfig("npc_enemy",id),person=new Person_1.default;return this._mainLayer.addChild(person),person.setData(cfg),person.name=name,showName&&showName.length>0&&person.showName(showName),person.x=Math.floor(x),person.y=Math.floor(y),person.birthPoint=person.position,this.sceneObjects.push(person),person},TileMap.prototype.addItem=function(id,name,showName,x,y){var cfg=ConfigManager_1.default.getInstance().getConfig("item",id),item=new SceneItem_1.default;return this._mainLayer.addChild(item),item.setData(cfg),item.name=name,showName&&showName.length>0&&item.showName(showName),item.x=Math.floor(x),item.y=Math.floor(y),this.sceneObjects.push(item),item},TileMap.prototype.dispose=function(){this._bgEffectLayer.removeChildren(),this._mainLayer.removeChildren(),this._effectLayer.removeChildren();for(var i=0;i<this.sceneObjects.length;i++)this.sceneObjects[i]&&(this.sceneObjects[i].dispose(),this.sceneObjects[i]=null);this.sceneObjects=null},TileMap.prototype.addEffect=function(sp){this._effectLayer.addChild(sp)},TileMap.prototype.createWorldLogicPoint=function(pointAttribute){var x=Math.floor((Math.floor(pointAttribute.x)+Math.floor(pointAttribute.width)/2)/Globals_1.default.TILE_WIDTH),y=Math.floor((Math.floor(pointAttribute.y)-Math.floor(pointAttribute.height)/2)/Globals_1.default.TILE_HEIGHT);return new egret.Point(x,y)},TileMap.prototype.checkTilePassable=function(obj,pt){if(obj&&0==obj.moveBlock)return!0;for(var i=0;i<this.sceneObjects.length;i++)if(this.sceneObjects[i].physicalBlock>0&&obj!=this.sceneObjects[i]){if(this.sceneObjects[i]instanceof Person_1.default){var person=this.sceneObjects[i];if(person.batterData.hp<1)continue}var fromX=this.sceneObjects[i].logicPosition.x-Math.floor(this.sceneObjects[i].physicalWidth/2),fromY=this.sceneObjects[i].logicPosition.y-Math.floor(this.sceneObjects[i].physicalHeight/2);if(pt.x>=fromX&&pt.x<=fromX+this.sceneObjects[i].physicalWidth&&pt.y>=fromY&&pt.y<=fromY+this.sceneObjects[i].physicalHeight)return!1}return null!=this.grids[pt.x]&&null!=this.grids[pt.x][pt.y]&&!(this.grids[pt.x][pt.y]>0)},TileMap}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=TileMap},{"../../../enums/Globals":46,"../../../manager/ConfigManager":54,"../scene/BitmapObject":89,"../scene/Person":91,"../scene/SceneItem":92}],103:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Hero_1=require("../scene/Hero"),Camera_1=require("./Camera"),MapTips_1=require("../sprite/MapTips"),FootPrint_1=require("../sprite/FootPrint"),SceneObject_1=require("../scene/SceneObject"),Person_1=require("../scene/Person"),FrameEffect_1=require("../sprite/FrameEffect"),Globals_1=require("../../../enums/Globals"),SceneItem_1=require("../scene/SceneItem"),SceneMoveObject_1=require("../scene/SceneMoveObject"),ChatBubble_1=require("../sprite/ChatBubble"),PointUtil_1=require("../../../base/math/PointUtil"),TileMap_1=require("./TileMap"),Flower_1=require("../sprite/Flower"),TweenLiteDriver_1=require("../../../base/utils/TweenLiteDriver"),FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),World=function(_super){function World(){_super.apply(this,arguments),this._isTimeDelayed=!1,this._startTime=0,this.usePath=!1}return __extends(World,_super),World.prototype.showMapTips=function(world){world._mapTips&&(world._effectLayer.removeChild(world._mapTips),world._mapTips.dispose(),world._mapTips=null),world._mapTips=new MapTips_1.default(world._mousePoint),world._effectLayer.addChild(world._mapTips)},World.prototype.hideMapTips=function(){this._mapTips&&(this._mapTips.parent&&this._effectLayer.removeChild(this._mapTips),this._mapTips.dispose(),this._mapTips=null)},World.prototype.showFootPrint=function(position,turn){this._bgEffectLayer.addChild(new FootPrint_1.default(position,turn))},World.prototype.showFlower=function(textrueName,position){this._bgEffectLayer.addChild(new Flower_1.default(textrueName,position))},World.prototype.getDeadNames=function(){return this._deadNames},World.prototype.addDeadNames=function(n){this._deadNames.push(n)},World.prototype.setData=function(data){_super.prototype.setData.call(this,data.tiledmap),parseInt(data.find_path)>0&&(this.usePath=!0),this.buildObjects=[],this._deadNames=[],this.hero=new Hero_1.default;var userInfo=data.player_info;this.hero.setData(userInfo),this._mainLayer.addChild(this.hero),this.sceneObjects.push(this.hero),this.hero.logicPosition=new egret.Point(this._birthPoint.x,this._birthPoint.y),this.hero.birthPoint=PointUtil_1.default.getInstance().logicToPosition(this.hero.logicPosition),3==Number(data.hero_rotation)?this.hero.getDisplay().scaleX=1:this.hero.getDisplay().scaleX=-1,this.camera=new Camera_1.default,this.camera.bind(this);var _this=this,onDrag=!1,startPos=new egret.Point(0,0),oldCamera=new egret.Point(0,0),canvas=document.getElementsByTagName("CANVAS")[0];canvas&&(canvas.onmousedown=function(evt){if(evt.x<Globals_1.default.GAME_WIDTH*Globals_1.default.BATTLE_AREA_WIDTH_RATIO*Globals_1.default.scaleRatio){_this.camera.unLock(),onDrag=!0,startPos=new egret.Point(evt.x,evt.y),oldCamera=_this.camera.focusPoint;for(var i=0;i<_this.sceneObjects.length;i++)_this.sceneObjects[i]instanceof Person_1.default&&_this.sceneObjects[i].checkPointIn(_this._mousePoint)&&(_this.dispatchEvent(new egret.Event(World.HERO_CLICKED,!1,!1,_this.sceneObjects[i].name)),console.log("hero clicked - push msg"))}},canvas.onmouseup=function(){onDrag=!1},canvas.onmousemove=function(evt){if(onDrag)_this.camera.focusAt(oldCamera.x-evt.x+startPos.x,oldCamera.y-evt.y+startPos.y);else{var nowPoint=new egret.Point(Math.floor(((evt.x-canvas.offsetLeft)*Globals_1.default.GAME_WIDTH/canvas.clientWidth-_this.x-Globals_1.default.TILE_WIDTH/2)/_this.camera.getScale()/Globals_1.default.TILE_WIDTH),Math.floor(((evt.y-canvas.offsetTop)*Globals_1.default.GAME_HEIGHT/canvas.clientHeight-_this.y-Globals_1.default.TILE_HEIGHT/2)/_this.camera.getScale()/Globals_1.default.TILE_HEIGHT));_this._mousePoint&&(egret.Point.distance(_this._mousePoint,nowPoint)>0?(_this._isTimeDelayed=!1,TweenLite.killDelayedCallsTo(_this.showMapTips),_this.hideMapTips()):0==_this._isTimeDelayed&&(_this._isTimeDelayed=!0,TweenLite.delayedCall(.5,_this.showMapTips,[_this]))),_this._mousePoint=nowPoint}}),this.updateDepth(),this.addEventListener(SceneMoveObject_1.default.HERO_PASSBY,this.onPersonPick,this),TweenLiteDriver_1.default.startTick(this.updateDragonBones,this)},World.prototype.onPersonPick=function(event){for(var person=event.data,i=0;i<this.sceneObjects.length;i++)if(this.sceneObjects[i]instanceof SceneItem_1.default&&person instanceof Hero_1.default&&this.sceneObjects[i].checkPointIn(person.logicPosition)){var item=this.sceneObjects[i];item.pickabled&&item.pickedByPerson(person)}},World.prototype.play=function(){this._deadNames=[],this._effectLayer.removeChildren();for(var i=0;i<this.buildObjects.length;i++)for(var j=0;j<this.sceneObjects.length;j++)if(this.sceneObjects[j].name==this.buildObjects[i].name){this.sceneObjects[j].parent&&(this.sceneObjects[j].parent.removeChild(this.sceneObjects[j]),this.sceneObjects[j]=null),this.sceneObjects.splice(j,1);break}this.buildObjects=[];for(var i=0;i<this.sceneObjects.length;i++)if(this.sceneObjects[i].restart(),this.sceneObjects[i]instanceof Person_1.default){var person=this.sceneObjects[i];person.batterData.hp=Math.max(1,person.batterData.maxhp)}this._startTime=TweenLiteDriver_1.default.getCurrentTick(),TweenLiteDriver_1.default.startTick(this.update,this)},World.prototype.updateDragonBones=function(){return dragonBones.WorldClock.clock.advanceTime(.034),!1},World.prototype.update=function(timeObj){timeObj.frame=timeObj.frame-this._startTime;for(var i=0;i<this.sceneObjects.length;i++)this.sceneObjects[i].update(timeObj);return!1},World.prototype.dispose=function(){_super.prototype.dispose.call(this);var canvas=document.getElementsByTagName("CANVAS")[0];canvas&&(canvas.onmousedown=null,canvas.onmouseup=null,canvas.onmousemove=null),TweenLiteDriver_1.default.stopTick(this.updateDragonBones,this),TweenLiteDriver_1.default.stopTick(this.update,this),this.hideMapTips()},World.prototype.stopPlay=function(){TweenLiteDriver_1.default.stopTick(this.updateDragonBones,this),TweenLiteDriver_1.default.stopTick(this.update,this),FrameTweenLite_1.default.killAll(),World.ISPLAYING=!1},World.prototype.startPlay=function(){this.play(),TweenLiteDriver_1.default.startTick(this.updateDragonBones,this),this.camera.lockAt(this.hero),World.ISPLAYING=!0},World.prototype.addChatBubble=function(ps,words){var pt=ps.logicPosition.add(new egret.Point(0,-6)),screenPoint=new egret.Point(pt.x*Globals_1.default.TILE_WIDTH,pt.y*Globals_1.default.TILE_HEIGHT).subtract(new egret.Point(this.x,this.y));this._effectLayer.addChild(new ChatBubble_1.default(screenPoint.x>Globals_1.default.GAME_WIDTH*Globals_1.default.BATTLE_AREA_WIDTH_RATIO/2,new egret.Point(pt.x*Globals_1.default.TILE_WIDTH,pt.y*Globals_1.default.TILE_WIDTH),words.toString()));for(var i=0;i<this.sceneObjects.length;i++)if(this.sceneObjects[i]instanceof Person_1.default&&this.sceneObjects[i]!=ps){var person=this.sceneObjects[i],storyID=person.getStoryID();storyID>0&&person.checkStory(words)&&this.hero.answered(storyID)}},World.prototype.getSceneObjectByName=function(name){for(var i=0;i<this.sceneObjects.length;i++)if(this.sceneObjects[i].name==name)return this.sceneObjects[i];return null},World.prototype.findAllByRange=function(pt,range){for(var result=[],i=0;i<this.sceneObjects.length;i++){var npc=this.sceneObjects[i];npc instanceof SceneObject_1.default&&Math.abs(npc.logicPosition.x-pt.x)<=range&&Math.abs(npc.logicPosition.y-pt.y)<=range&&result.push(npc)}return result},World.prototype.findPersonsByRange=function(pt,range){for(var result=[],i=0;i<this.sceneObjects.length;i++){var npc=this.sceneObjects[i];npc instanceof Person_1.default&&egret.Point.distance(npc.logicPosition,pt)<=range&&npc.batterData.hp>0&&result.push(npc)}return result},World.prototype.findAllByViewRange=function(person,range){for(var result=[],i=0;i<this.sceneObjects.length;i++)if(this.sceneObjects[i]!=person&&egret.Point.distance(this.sceneObjects[i].logicPosition,person.logicPosition)<=range){for(var isInSightLine=!0,j=0;j<this.sceneObjects.length;j++)if(this.sceneObjects[j].sightBlock>0&&this.sceneObjects[j]!=person&&i!=j&&PointUtil_1.default.getInstance().checkCollision(person.logicPosition,this.sceneObjects[i].logicPosition,this.sceneObjects[j].getSize())){if(this.sceneObjects[j]instanceof Person_1.default){var p=this.sceneObjects[j];p.batterData.hp>0&&(isInSightLine=!1)}else isInSightLine=!1;break}for(var k=0;k<this.grids.length;k++)for(var j=0;j<this.grids[k].length;j++)if(this.grids[k][j]>0&&PointUtil_1.default.getInstance().checkCollision(person.logicPosition,this.sceneObjects[i].logicPosition,new egret.Rectangle(k,j,1,1))){isInSightLine=!1,PointUtil_1.default.getInstance().checkCollision(person.logicPosition,this.sceneObjects[i].logicPosition,new egret.Rectangle(k,j,1,1));break}isInSightLine&&result.push(this.sceneObjects[i])}return result},World.prototype.findPersonsByViewRange=function(person,range){for(var result=[],i=0;i<this.sceneObjects.length;i++)if(this.sceneObjects[i]instanceof Person_1.default&&this.sceneObjects[i]!=person&&egret.Point.distance(this.sceneObjects[i].logicPosition,person.logicPosition)<=range){var npc=this.sceneObjects[i],isInSightLine=!0;if(npc.batterData.hp<1)isInSightLine=!1;else{for(var j=0;j<this.sceneObjects.length;j++)if(this.sceneObjects[j].sightBlock>0&&this.sceneObjects[j]!=person&&i!=j&&PointUtil_1.default.getInstance().checkCollision(person.logicPosition,npc.logicPosition,this.sceneObjects[j].getSize())){if(this.sceneObjects[j]instanceof Person_1.default){var p=this.sceneObjects[j];p.batterData.hp>0&&(isInSightLine=!1)}else isInSightLine=!1;break}for(var k=0;k<this.grids.length;k++)for(var j=0;j<this.grids[k].length;j++)if(this.grids[k][j]>0&&PointUtil_1.default.getInstance().checkCollision(person.logicPosition,npc.logicPosition,new egret.Rectangle(k,j,1,1))){isInSightLine=!1;break}}isInSightLine&&result.push(npc)}return result},World.prototype.checkPersonsInViewRange=function(person,npc,range){var isInSightLine=!0;if(egret.Point.distance(npc.logicPosition,person.logicPosition)<=range)if(npc.batterData.hp<1)isInSightLine=!1;else{for(var j=0;j<this.sceneObjects.length;j++)if(this.sceneObjects[j].sightBlock>0&&this.sceneObjects[j]!=person&&this.sceneObjects[j]!=npc&&PointUtil_1.default.getInstance().checkCollision(person.logicPosition,npc.logicPosition,this.sceneObjects[j].getSize())){if(this.sceneObjects[j]instanceof Person_1.default){var p=this.sceneObjects[j];p.batterData.hp>0&&(isInSightLine=!1)}else isInSightLine=!1;break}for(var k=0;k<this.grids.length;k++)for(var j=0;j<this.grids[k].length;j++)if(this.grids[k][j]>0&&PointUtil_1.default.getInstance().checkCollision(person.logicPosition,npc.logicPosition,new egret.Rectangle(k,j,1,1))){isInSightLine=!1;break}}return isInSightLine},World.prototype.createEffect=function(delayTime,skillName,pos){var _this=this;FrameTweenLite_1.default.delayedCall(delayTime,function(){var eff=new FrameEffect_1.default(skillName);eff.x=pos.x,eff.y=pos.y,_this._effectLayer.addChild(eff)})},World.prototype.createHurtEffect=function(pos,value){},World.prototype.createParticleEffect=function(skillName,frompos,topos){var sprite=new FrameEffect_1.default(skillName);sprite.isLoop=!0,skillName.indexOf("Add")>-1&&(sprite.blendMode=egret.BlendMode.ADD),sprite.anchorOffsetX=sprite.texture.textureWidth/2,sprite.anchorOffsetY=sprite.texture.textureHeight/2,sprite.x=frompos.x,sprite.y=frompos.y-100,this._effectLayer.addChild(sprite);var angle=180*Math.atan((topos.y-frompos.y)/(topos.x-frompos.x))/Math.PI;topos.x>=frompos.x?(sprite.rotation=angle,topos.y=topos.y-60):sprite.rotation=angle-180;var needTime=.001*egret.Point.distance(frompos,topos);return FrameTweenLite_1.default.to(sprite,needTime,{x:topos.x,y:topos.y,onComplete:function(){sprite.parent&&sprite.parent.removeChild(sprite)}}),needTime},Object.defineProperty(World.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"birthPoint",{get:function(){return this._birthPoint},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"endPoint",{get:function(){return this._exitPoint},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"exitArea",{get:function(){return new egret.Rectangle(this._exitPoint.x-1,this._exitPoint.y-1,3,3)},enumerable:!0,configurable:!0}),World.prototype.getAreaByID=function(name){var obj=this.getSceneObjectByName(name);return obj?new egret.Rectangle(obj.x,obj.y,obj.physicalWidth*Globals_1.default.TILE_WIDTH,obj.physicalHeight*Globals_1.default.TILE_HEIGHT):null},World.HERO_CLICKED="hero_clicked",World.ISPLAYING=!0,World}(TileMap_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=World},{"../../../base/math/PointUtil":6,"../../../base/utils/FrameTweenLite":18,"../../../base/utils/TweenLiteDriver":23,"../../../enums/Globals":46,"../scene/Hero":90,"../scene/Person":91,"../scene/SceneItem":92,"../scene/SceneMoveObject":93,"../scene/SceneObject":94,"../sprite/ChatBubble":95,"../sprite/Flower":96,"../sprite/FootPrint":97,"../sprite/FrameEffect":98,"../sprite/MapTips":100,"./Camera":101,"./TileMap":102}],104:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},WindowManager_1=require("../../base/popup/WindowManager"),BattleSettingWindow_1=require("./battlesetting/BattleSettingWindow"),BattleResultWindow_1=require("./battleresult/BattleResultWindow"),GoalPanel_1=require("./goal/GoalPanel"),GoalManager_1=require("../../control/goal/GoalManager"),ActionBox_1=require("./action/ActionBox"),Globals_1=require("../../enums/Globals"),ConfigManager_1=require("../../manager/ConfigManager"),SoundManager_1=require("../../manager/SoundManager"),ExploreWindow_1=require("../explore/ExploreWindow"),EquipWindow_1=require("../explore/equipment/EquipWindow"),BadgeTipWindow_1=require("../badge/BadgeTipWindow"),BattleTipWindow_1=require("./battletip/BattleTipWindow"),ResourceItem=RES.ResourceItem,TweenLiteDriver_1=require("../../base/utils/TweenLiteDriver"),NetManager_1=require("../../model/net/NetManager"),CodeWorkerManager_1=require("../../compile/CodeWorkerManager"),ReplyListWindow_1=require("../teach/ReplyListWindow"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),ActionItem_1=require("./action/ActionItem"),Alert_1=require("../common/Alert"),TeachSystemProxy_1=require("../../model/da/TeachSystemProxy"),SceneManager_1=require("../../manager/SceneManager"),CreateRoleWindow_1=require("../mainsceneui/CreateRoleWindow"),LayerManager_1=require("../../manager/LayerManager"),UIPopupLoading_1=require("../loading/UIPopupLoading"),Protocols_1=require("../../enums/Protocols"),Platform_1=require("../../platforms/Platform"),BattleSceneUI=function(_super){function BattleSceneUI(data){_super.call(this),this.isPopUp=!1,this._codeFreeze=!0,this.isPaletteIconState=!1,this._zoomValue=1,this._requestTick=-6e4,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="BattleSceneUISkin"  width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><w:Config id="157f6433802"/><e:Image source="battleBg_png_png" x="1056" y="0" height="1080" width="864" scale9Grid="76,81,571,939" locked="true"/><e:TabBar id="tabBar" width="443" height="42" x="580" y="-1"></e:TabBar><e:Image source="battle_scene_json.battle_scene_HP_img_png" scale9Grid="50,18,68,17" width="260"/><e:Image source="battle_scene_json.battle_scene_MP_img_png" x="187" visible="false"/><e:Label id="labelMp" text="500" x="215" y="18" width="84" height="21" size="17" textAlign="center" verticalAlign="middle"  strokeColor="0x001d45" stroke="2" visible="false"/><e:Button id="btnCast" skinName="battleCastBtnSkin" x="1100" y="630"/><e:Button id="btnSubmit" skinName="runButtonSkin" x="1523" y="630" /><e:Button id="btnDone" skinName="finishButtonSkin" x="1523" y="630" /><e:Button id="speedx1Btn" skinName=\'Speedx1ButtonSkin\' x=\'1320\' y=\'630\'/><e:Button id="speedx2Btn" skinName="Speedx2ButtonSkin" x="1320" y="630"/><e:Button id="zoominBtn" skinName="battleZoominButton" x="996" y="1015" width="51" height="52"/><e:Button id="zoomoutBtn" skinName="battleZoomoutButton" x="945" y="1015" width="51" height="52"/><e:Button id="btnLayout" label="按钮" x="1752" y="1045" skinName="LayoutIconButtonSkin"/><e:ProgressBar id="pgbHp" x="55" y="10" width="173" height="34" skinName="thangHealthBarSkin"/><e:Label text="编程语言" x="1746" y="17" width="78" height="15" size="17" textAlign="right" textColor="0x00fcff" strokeColor="0x002251" bold="true"/><e:Label id=\'labelLang\' text="PYTHON" x="1830" y="12" size="17" width="113" textAlign="left" textColor="0xffffff" height="25" strokeColor="0x002251" bold="true" verticalAlign="middle"/><e:Image source="battle_scene_json.rule_png" x="1058" y="692" scaleX="1" scaleY="1"/><e:Image source="battle_scene_json.rule_2_png" x="1061" y="1044" scaleX="1" scaleY="1"/><e:Button id="btnUp" label="按钮" x="1468" y="666" skinName="PageUpButtonSkin" height="38"/><e:Button id="btnDown" label="按钮" x="1468" y="1044" skinName="PageDownButtonSkin" height="38"/><e:Button id="btnSetting" skinName="battleSettingButtonSkin" y="929" width="151" height="151"/><e:Button id="btnStory" skinName="storyButtonSkin" x="151" y="929" width="151" height="151"/><e:Button id="btnRequest" label="求助" x="305" y="929" skinName="RequestHelpButtonSkin" width="151" height="151"/><e:Button id="btnCheckReply" label="查看" x="455" y="929" skinName="ResponseHelpButtonSkin" width="151" height="151"/><e:Button id="btnResponse" label="回复" x="1683" y="624" skinName="ClassTeacherReplyButtonSkin"/><e:Image id="imgReply" source="teaching_reddot_png" x="564" y="959"/><e:Button id="btnLock" label="锁定班级" x="688" y="981" skinName="CommonButtonSkin"/><e:Button id="btnQuickReply" label="Button" x="1807.97" y="623.15" skinName="QuickReplyButtonSkin"/></e:Skin>',this._battleData=data,this._userInfo=data.player_info,this.updateHeroHp(100,100)}return __extends(BattleSceneUI,_super),Object.defineProperty(BattleSceneUI.prototype,"miniScale",{set:function(val){this._miniZoom=val},enumerable:!0,configurable:!0}),Object.defineProperty(BattleSceneUI.prototype,"codeFreeze",{get:function(){return this._codeFreeze},set:function(value){this._codeFreeze=value},enumerable:!0,configurable:!0}),BattleSceneUI.prototype.updateHeroHp=function(cur,max){this.pgbHp.maximum=max,this.pgbHp.value=cur},BattleSceneUI.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this),this.maliPlatform=Platform_1.default.currentPlatform,this.btnLock.visible=this.maliPlatform.classTeacherId==this.maliPlatform.openUserId,this.btnLock.label=1==this.maliPlatform.classLockInfo.state?"解锁班级":"锁定班级",this.speedx1Btn.visible=!0,this.speedx2Btn.visible=!1;var mySelf=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data;this.btnRequest.visible=this.btnCheckReply.visible=mySelf.isStudent,this.btnResponse.visible=mySelf.isTeacher&&this._battleData.teach_info,this.btnQuickReply.visible=mySelf.isTeacher&&this._battleData.teach_info,this.imgReply.visible=!1,this.pgbHp.slideDuration=0,this.pgbHp.maximum=100,this.pgbHp.minimum=0,this.btnCast.skinName="battleCastBtnSkin",this.btnCast.name="btnCast",this.btnSubmit.name="btnSubmit",this.btnDone.name="btnDone",this.btnStory.name="btnStory",this.btnLayout.name="btnLayout",this.btnSetting.name="btnSetting",this.btnUp.name="btnUp",this.btnDown.name="btnDown",this.speedx1Btn.name="speedx1Btn",this.speedx2Btn.name="speedx2Btn",this.zoominBtn.name="zoominBtn",this.zoomoutBtn.name="zoomoutBtn",this.btnRequest.name="btnRequest",this.btnCheckReply.name="btnCheckReply",this.btnResponse.name="btnResponse",this.btnLock.name="btnLock",this.btnQuickReply.name="btnQuickReply",this._actionBox=new ActionBox_1.default,this._actionBox.x=Globals_1.default.GAME_WIDTH*Globals_1.default.BATTLE_AREA_WIDTH_RATIO,this._actionBox.y=Globals_1.default.CODE_AREA_HEIGHT_RATIO*Globals_1.default.GAME_HEIGHT+25,this.addChild(this._actionBox),this._actionBox.updatePalette(this.parseActionGroups(),this._userInfo.language);var layout=egret.localStorage.getItem("spellBoxLayout"),view=egret.localStorage.getItem("spellBoxView");this._actionBox.isCollapse="expand"===view,this.isPaletteIconState="txt"===layout,this.onLayoutChanged(null),this.goalPanel=new GoalPanel_1.default,this.addChild(this.goalPanel),GoalManager_1.default.getInstance().init(parseInt(this._battleData.levelID)),this.btnSubmit.visible=!1,this.btnDone.visible=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onbtnClick,this),this.btnLayout.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLayoutChanged,this),this.createCheckTipBox(),this.addEventListener(ActionItem_1.default.ACTION_ITEM_CLICKED,function(event){var skillConfig=ConfigManager_1.default.getInstance().getConfigs("skill"),needLineWrap=[];for(var skillId in skillConfig)"1"==skillConfig[skillId].islinebreak&&needLineWrap.push(skillConfig[skillId]["snippet_"+_this._userInfo.language]);-1!=needLineWrap.indexOf(event.data)?(!0,/\${/.test(event.data)?CodeWorkerManager_1.default.getUserThread().insertSnippet({snippet:event.data}):CodeWorkerManager_1.default.getUserThread().insertEditorText(event.data+"\n")):/\${/.test(event.data)?CodeWorkerManager_1.default.getUserThread().insertSnippet({snippet:event.data}):CodeWorkerManager_1.default.getUserThread().insertEditorText(event.data)},this,!0),DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).addEventListener(TeachSystemProxy_1.default.REPLYS_COMPLETE,this.onReplys,this),DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).addEventListener("classLockStateChanged",this.onLockStateChanged,this)},BattleSceneUI.prototype.showGoalPatrol=function(){this.goalPanel.patrolPanel()},BattleSceneUI.prototype.parseActionGroups=function(){for(var result={},userInfo=this._userInfo,effectiveEquipIds=userInfo.ownedHero.items,_i=0,effectiveEquipIds_1=effectiveEquipIds;_i<effectiveEquipIds_1.length;_i++){var id=effectiveEquipIds_1[_i],equip=userInfo.getEquipById(id);if(equip&&(equip.data.skill&&!(equip.data.skill.length<5))){var skillIds=equip.data.skill.split("|"),actionBoxObj=result[equip.data.ID]={item:{},props:[],short:""};actionBoxObj.item.name=equip.data.name,actionBoxObj.item.imageURL="resource/icon/equip/"+equip.data.icon+".png";for(var _a=0,skillIds_1=skillIds;_a<skillIds_1.length;_a++){var skillId=skillIds_1[_a],skillData=ConfigManager_1.default.getInstance().getConfig("skill",parseInt(skillId));if(skillData){var prop={shortName:skillData.fullname,short_name:skillData.shortname,name:skillData.type,short_description:skillData.description,short_example:skillData.example,snippets:{},icon:"resource/icon/action/"+skillData.icon+"_normal.png",type:"function",owner:"hero"};actionBoxObj.props.push(prop);var tpl=RES.getRes("SimplePaletteTip_tpl"),initialHTML=_.template(tpl)({doc:prop,marked:marked,docName:"docName",selectedMethod:null,language:"python",writable:!1,argumentExamples:["a","b"]});prop.initialHTML=initialHTML}}}}return result},BattleSceneUI.prototype.onLayoutChanged=function(event){this.isPaletteIconState=!this.isPaletteIconState,this.btnLayout.skinName=this.isPaletteIconState?"LayoutIconButtonSkin":'<?xml version="1.0" encoding="utf-8" ?><e:Skin class="LayoutTxtButtonSkin" states="up,over,down,disabled" minHeight="50" minWidth="100" xmlns:e="http://ns.egret.com/eui" width="140" height="30"><e:Image source="battle_scene_json.code_model_png" includeIn="down" x="0" y="0"/><e:Image source="battle_scene_json.code_model_png" includeIn="over" x="0" y="0"/><e:Image source="battle_scene_json.code_model_png" includeIn="up" x="0" y="0"/></e:Skin>';var numColumn=this._actionBox.isCollapse?2:4;this.isPaletteIconState?this._actionBox.iconLayout(numColumn):this._actionBox.charLayout(numColumn),this._actionBox.setIconState(this.isPaletteIconState?"icon":"txt")},BattleSceneUI.prototype.onEnterCreateRolePopup=function(e){SceneManager_1.default.getInstance().popScene(),LayerManager_1.default.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterCreateRolePopup,this),WindowManager_1.default.showWindow(CreateRoleWindow_1.default,"CreateRoleWindow")},BattleSceneUI.prototype.onbtnClick=function(event){switch(event.target.name){case"btnCast":SoundManager_1.default.getInstance().playEffect("u11_run_mp3");if(CodeWorkerManager_1.default.getUserThread().getEffectiveCodeLine()<1)break;this.btnCast.label=this.codeFreeze?"RUN":"STOP",this.codeFreeze=!this.codeFreeze,this.btnDone.visible=!1,this.btnCast.skinName=this.codeFreeze?"battleCastBtnSkin":'<?xml version="1.0" encoding="utf-8"?><e:Skin class="battlePauseBtnSkin" width="202" height="56" currentState="up" xmlns:e="http://ns.egret.com/eui" states="up,over,down,disabled" ><e:Image source="battle_scene_json.btn_stop_normal_png" includeIn="up"/><e:Image source="battle_scene_json.btn_stop_selected_png" includeIn="over"/><e:Image source="battle_scene_json.btn_stop_selected_png" includeIn="down"/></e:Skin>',this.goalPanel.collapsePanel(),this.dispatchEvent(new egret.Event(BattleSceneUI.RUN_TOUCH_TAP));break;case"btnSetting":WindowManager_1.default.showWindow(BattleSettingWindow_1.default,"BattleSettingWindow","",this._battleData),document.getElementById("code-area").style.display="none";break;case"btnSubmit":break;case"btnDone":if(11e4==parseInt(this._battleData.levelID)){egret.localStorage.setItem("guide_state",NetManager_1.default.getInstance().userName+"|yes"),LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterCreateRolePopup,this),UIPopupLoading_1.default.startPopupLoading(["hero"]);break}WindowManager_1.default.showWindow(BattleResultWindow_1.default,"BattleResultWindow","",this._battleData),document.getElementById("code-area").style.display="none";break;case"btnStory":WindowManager_1.default.showWindow(BattleTipWindow_1.default,"BattleTipWindow"),document.getElementById("code-area").style.display="none";break;case"btnLayout":break;case"btnUp":this._actionBox.updateContentPosition(-100);break;case"btnDown":this._actionBox.updateContentPosition(100);break;case"speedx1Btn":this.speedx1Btn.visible=!1,this.speedx2Btn.visible=!0,TweenLiteDriver_1.default.setFps(60);break;case"speedx2Btn":this.speedx2Btn.visible=!1,this.speedx1Btn.visible=!0,TweenLiteDriver_1.default.setFps(30);break;case"zoominBtn":this._zoomValue=this._zoomValue+.2,this._zoomValue>=3&&(this._zoomValue=3),this.dispatchEvent(new egret.Event(BattleSceneUI.BTN_ZOOM_IN,!1,!1,this._zoomValue));break;case"zoomoutBtn":this._zoomValue=this._zoomValue-.2,this._zoomValue<=this._miniZoom&&(this._zoomValue=this._miniZoom),this.dispatchEvent(new egret.Event(BattleSceneUI.BTN_ZOOM_OUT,!1,!1,this._zoomValue));break;case"btnRequest":this.handleAskHelp();break;case"btnResponse":this.handleReplyQuestion();break;case"btnCheckReply":WindowManager_1.default.showWindow(ReplyListWindow_1.default,"ReplyListWindow","",this._battleData),document.getElementById("code-area").style.display="none",this.imgReply.visible=!1;break;case"btnLock":var maliPlatform=this.maliPlatform;NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_LOCK_CLASS,{classId:maliPlatform.classId,lock:1==maliPlatform.classLockInfo.state?0:1,teacherId:maliPlatform.classTeacherId,levelId:this._battleData.levelID});break;case"btnQuickReply":this.handleQuickReplyQuestion()}},BattleSceneUI.prototype.handleAskHelp=function(){var _this=this,curTick=egret.getTimer();if(curTick-this._requestTick<6e4)return void Alert_1.default.show("提示","一分钟只能请求一次，先耐心研究一下吧，加油！",2);Alert_1.default.show("提示","确认发送请求？").once("confirm",function(){_this._requestTick=curTick;var msg={teacherid:_this._userInfo.teacherId,classname:_this._userInfo.className,storyid:parseInt(_this._battleData.levelID),code:CodeWorkerManager_1.default.getUserThread().getEditorText(),student_mail:Platform_1.default.currentPlatform.platformAccount};NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_ASKQUESTION,msg)},this)},BattleSceneUI.prototype.handleReplyQuestion=function(){var _this=this;Alert_1.default.show("提示","您确认发送当前编辑的答案么？").once("confirm",function(){var requestMsg=_this._battleData.teach_info,message={studentid:requestMsg.from,storyid:parseInt(_this._battleData.levelID),code:CodeWorkerManager_1.default.getUserThread().getEditorText(),id:requestMsg.uuid};NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_REPLYQUESTION,message)},this)},BattleSceneUI.prototype.handleQuickReplyQuestion=function(){var _this=this;Alert_1.default.show("提示","您确认发送标准答案么？").once("confirm",function(){var requestMsg=_this._battleData.teach_info,message={studentid:requestMsg.from,storyid:parseInt(_this._battleData.levelID),code:RES.getRes(_this._battleData.levelID+"_answer_txt"),id:requestMsg.uuid};NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_REPLYQUESTION,message)},this)},BattleSceneUI.prototype.onReplys=function(event){event.data.length>0&&(this.imgReply.visible=!0)},BattleSceneUI.prototype.onLockStateChanged=function(event){var classLockInfo=event.data
;this.btnLock.label=1==classLockInfo.state?"解锁班级":"锁定班级"},BattleSceneUI.prototype.codeDone=function(){this._battleData.teach_info||(this.btnDone.visible=GoalManager_1.default.getInstance().win),this.btnCast.label="RUN",this.btnCast.skinName="battleCastBtnSkin",this.codeFreeze=!0,this.goalPanel.expandPanel()},BattleSceneUI.prototype.dispose=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onbtnClick,this),this.btnLayout.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLayoutChanged,this),GoalManager_1.default.getInstance().dispose(),TweenLiteDriver_1.default.setFps(60),DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).removeEventListener(TeachSystemProxy_1.default.REPLYS_COMPLETE,this.onReplys,this),DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).removeEventListener("classLockStateChanged",this.onLockStateChanged,this)},BattleSceneUI.prototype.createCheckTipBox=function(){this._checkTipBox=new eui.Image,this.addChild(this._checkTipBox),this._checkTipBox.visible=!1},BattleSceneUI.prototype.onEnterPopup=function(e){LayerManager_1.default.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this);var explore_win=WindowManager_1.default.showWindow(ExploreWindow_1.default,"ExploreWindow","地图界面");if(console.log("explore update view"),explore_win.updateView(),explore_win.isLevelInChapter(this._battleData.next_level)){if(this._battleData.next_level){var currLevelId=this._battleData.levelID,nextLevelId=this._battleData.next_level,isInSameGroup=explore_win.isInSameGroup(currLevelId,nextLevelId),groupId=explore_win.findLevelGroupId(nextLevelId);if(isInSameGroup)if(BattleResultWindow_1.default.SKIP_NEXT_LEVEL==this._skipType){var equip_win=WindowManager_1.default.showWindow(EquipWindow_1.default,"EquipWindow","装备界面");equip_win.setData(explore_win.groups_info[groupId].levels[nextLevelId]),equip_win.updateView()}else explore_win.showGroupPanel(groupId);this.showBadgeTipWindow()}}else this._battleData.next_level&&(explore_win.gotoNextChapter(),this.showBadgeTipWindow())},BattleSceneUI.prototype.skip=function(skipType){void 0===skipType&&(skipType=!0),this._skipType=skipType,LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this),UIPopupLoading_1.default.startPopupLoading(["explore","equip"])},BattleSceneUI.prototype.showBadgeTipWindow=function(){Globals_1.default.badgeAwardInfo&&WindowManager_1.default.showWindow(BadgeTipWindow_1.default,"BadgeTipWindow","",Globals_1.default.badgeAwardInfo)},BattleSceneUI.prototype.showCheckTip=function(targetSceneItem){var _this=this;this._checkTipBox.visible=!0;var sceneItemData=targetSceneItem.getData();RES.getResByUrl("resource/icon/checkicon/check_"+sceneItemData.id+".png",function(data,url){_this._checkTipBox.source=data,_this._checkTipBox.x=.5*(Globals_1.default.GAME_WIDTH*Globals_1.default.BATTLE_AREA_WIDTH_RATIO-data.bitmapData.width),_this._checkTipBox.y=.5*(Globals_1.default.GAME_HEIGHT-data.bitmapData.height)},this,ResourceItem.TYPE_IMAGE)},BattleSceneUI.prototype.hideCheckTip=function(){this._checkTipBox.visible=!1},BattleSceneUI.RUN_TOUCH_TAP="runTouchTap",BattleSceneUI.BTN_ZOOM_IN="battleZoomIn",BattleSceneUI.BTN_ZOOM_OUT="battleZoomUut",BattleSceneUI}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BattleSceneUI},{"../../base/da/DataAccessManager":2,"../../base/popup/WindowManager":13,"../../base/utils/TweenLiteDriver":23,"../../compile/CodeWorkerManager":26,"../../control/goal/GoalManager":40,"../../enums/Globals":46,"../../enums/Protocols":51,"../../manager/ConfigManager":54,"../../manager/LayerManager":55,"../../manager/SceneManager":57,"../../manager/SoundManager":58,"../../model/DataAccessEntry":59,"../../model/da/TeachSystemProxy":66,"../../model/net/NetManager":68,"../../platforms/Platform":81,"../badge/BadgeTipWindow":86,"../common/Alert":115,"../explore/ExploreWindow":118,"../explore/equipment/EquipWindow":128,"../loading/UIPopupLoading":139,"../mainsceneui/CreateRoleWindow":146,"../teach/ReplyListWindow":155,"./action/ActionBox":105,"./action/ActionItem":107,"./battleresult/BattleResultWindow":108,"./battlesetting/BattleSettingWindow":111,"./battletip/BattleTipWindow":112,"./goal/GoalPanel":114}],105:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Globals_1=require("../../../enums/Globals"),ActionGroup_1=require("./ActionGroup"),ActionItem_1=require("./ActionItem"),MouseScroller_1=require("../../common/MouseScroller"),ActionBox=function(_super){function ActionBox(){_super.call(this),this.isCollapse=!0,this.HGAP=5,this.VGAP=0,this.paletteGroupList=[],this.realPos=0,this._iconState="txt",this.paletteGroupList=[],this.drawBg(),this.touchEnabled=!0,this.scrollView=new egret.ScrollView,this.scrollView.width=Globals_1.default.PALETTE_WIDTH,this.scrollView.height=Globals_1.default.PALETTE_HEIGHT,this.groupContent=new egret.Sprite,this.scrollView.setContent(this.groupContent),this.addChild(this.scrollView),this.scrollView.verticalScrollPolicy="auto",this.drawScroll(),MouseScroller_1.default.enableMouseScrollView(this.scrollView,2*this.VGAP)}return __extends(ActionBox,_super),ActionBox.prototype.setIconState=function(value){this._iconState=value},ActionBox.prototype.updateContentPosition=function(deltaStep){this.realPos=this.scrollView.scrollTop;var deltaH=this.groupContent.height+2*this.VGAP-this.scrollView.height;deltaH<=0?this.realPos=0:(this.realPos+=deltaStep,this.realPos<0?this.realPos=0:this.realPos>deltaH&&(this.realPos=deltaH)),this.updateScrollPos()},ActionBox.prototype.drawScroll=function(){this.scrollThumb=new egret.Sprite;var g=this.scrollThumb.graphics;g.clear(),g.beginFill(98801,.6),g.drawRect(0,0,5,35),g.endFill(),this.scrollThumb.x=Globals_1.default.PALETTE_WIDTH-5,this.scrollThumb.y=0,this.addChild(this.scrollThumb),this.scrollThumb.visible=!1},ActionBox.prototype.drawBg=function(){this.graphics.clear(),this.graphics.beginFill(64991,0),this.graphics.drawRoundRect(0,0,Globals_1.default.PALETTE_WIDTH,Globals_1.default.PALETTE_HEIGHT,5,5),this.graphics.endFill()},ActionBox.prototype.updateScrollPos=function(){this.scrollView.scrollTop=this.realPos;var deltaH=this.groupContent.height+2*this.VGAP-this.scrollView.height;deltaH<=0?this.scrollThumb.visible=!1:(this.scrollThumb.visible=!1,this.scrollThumb.y=(Globals_1.default.PALETTE_HEIGHT-this.scrollThumb.height)*this.realPos/deltaH)},ActionBox.prototype.updatePalette=function(groups,language){void 0===language&&(language="python"),this.dispose(),this.entryGroups=groups;for(var key in groups){var group=groups[key],item=group.item,props=group.props,short=group.short,actionGroup=new ActionGroup_1.default;for(var index in props){var obj=props[index],paletteItem=new ActionItem_1.default(obj,language);actionGroup.addItem(paletteItem)}actionGroup.setProperty(item,short),actionGroup.layout(),this.groupContent.addChild(actionGroup),this.paletteGroupList.push(actionGroup)}},ActionBox.prototype.charLayout=function(nColumns){void 0===nColumns&&(nColumns=2),this.paletteGroupList.sort(function(a,b){return a.numChildren>b.numChildren?-1:a.numChildren<b.numChildren?1:0});for(var baselines=[0,0],columnCursor=0,i=0;i<this.paletteGroupList.length;i++){var paletteGroup=this.paletteGroupList[i];paletteGroup.changeToTxtState();var min=Math.min(baselines[0],baselines[1]);columnCursor=baselines.indexOf(min),paletteGroup.x=this.HGAP+columnCursor*(paletteGroup.width+this.HGAP),paletteGroup.y=this.VGAP+min,baselines[columnCursor]=paletteGroup.y+paletteGroup.height}this.realPos=0,this.scrollThumb.x=Globals_1.default.PALETTE_WIDTH-5,this.updateScrollPos(),egret.localStorage.setItem("spellBoxLayout","txt")},ActionBox.prototype.iconLayout=function(nColumns){void 0===nColumns&&(nColumns=2),this.paletteGroupList.sort(function(a,b){return a.numChildren>b.numChildren?1:a.numChildren<b.numChildren?-1:0});for(var rowIndex=0,columnBaseLines=[0],baseY=0,i=0;i<this.paletteGroupList.length;i++){var paletteGroup=this.paletteGroupList[i];paletteGroup.changeToIconState(),paletteGroup.width+columnBaseLines[rowIndex]>Globals_1.default.PALETTE_WIDTH?(rowIndex++,paletteGroup.x=this.HGAP,paletteGroup.y=this.VGAP+baseY,columnBaseLines.push(this.HGAP+paletteGroup.width)):(paletteGroup.x=this.HGAP,paletteGroup.y=this.VGAP+baseY,columnBaseLines[rowIndex]=paletteGroup.x+paletteGroup.width),paletteGroup.y+paletteGroup.height>baseY&&(baseY=paletteGroup.y+paletteGroup.height)}this.realPos=0,this.scrollThumb.x=Globals_1.default.PALETTE_WIDTH-5,this.updateScrollPos(),egret.localStorage.setItem("spellBoxLayout","icon")},ActionBox.prototype.dispose=function(){for(var i in this.paletteGroupList){this.paletteGroupList[i].dispose()}this.groupContent.removeChildren(),this.paletteGroupList=[]},ActionBox}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ActionBox},{"../../../enums/Globals":46,"../../common/MouseScroller":116,"./ActionGroup":106,"./ActionItem":107}],106:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Globals_1=require("../../../enums/Globals"),ActionGroup=function(_super){function ActionGroup(){_super.apply(this,arguments),this.entries=[],this.vGap=12,this.hGap=5,this.ICON_STATE_BG_HEIGHT=119,this.PALETTE_WIDTH=Globals_1.default.PALETTE_WIDTH-15,this.currentWidth=this.PALETTE_WIDTH,this.currentHeight=0,this.ICON_BG_WIDTH=108,this.ICON_BG_HEIGHT=101,this.ICON_WIDTH2=80,this.ICON_HEIGHT2=80,this.TXT_NAME_WIDTH=150,this.TXT_NAME_HEIGHT=24,this.FRAME_TOP=15,this.FRAME_LEFT=12}return __extends(ActionGroup,_super),ActionGroup.prototype.addItem=function(actionItem){this.addChild(actionItem),this.entries.push(actionItem)},ActionGroup.prototype.setProperty=function(property,short){var _this=this;this.imgIconBg=new eui.Image,this.imgIconBg.width=this.ICON_BG_WIDTH,this.imgIconBg.height=this.ICON_BG_HEIGHT,RES.getResAsync("palette_icon_bg_png",function(data,key){_this.imgIconBg.source=data},this),this.addChild(this.imgIconBg),this.imgIconBg.x=.5*(this.TXT_NAME_WIDTH-this.ICON_BG_WIDTH)+this.FRAME_LEFT,this.imgIconBg.y=this.FRAME_TOP,this.itemIcon=new eui.Image,this.itemIcon.width=this.ICON_WIDTH2,this.itemIcon.height=this.ICON_HEIGHT2,this.itemIcon.source=property.imageURL,this.short=short,this.addChild(this.itemIcon),this.txtName=new egret.TextField,this.txtName.width=this.TXT_NAME_WIDTH,this.txtName.height=this.TXT_NAME_HEIGHT,this.txtName.size=20,this.txtName.textAlign=egret.HorizontalAlign.CENTER,this.txtName.x=this.FRAME_LEFT,this.txtName.y=this.ICON_STATE_BG_HEIGHT-this.TXT_NAME_HEIGHT,this.addChild(this.txtName),this.txtName.stroke=2,this.txtName.strokeColor=146828,this.txtName.fontFamily="Microsoft Yahei",this.txtName.text=property.name||"装备名称"},ActionGroup.prototype.layout=function(state){var _this=this;void 0===state&&(state="txt"),this.currentHeight=0,this.currentWidth=0;for(var i=0,length=this.entries.length;i<length;i++){var entry=this.entries[i],ny=i>0?this.entries[i-1].height+this.entries[i-1].y:5;if("txt"==state){entry.x=this.ICON_WIDTH2+2*this.FRAME_LEFT+this.hGap,entry.y=ny+this.vGap,this.currentWidth=entry.x+entry.width;var h=entry.y+entry.height;this.currentHeight=h>this.currentHeight?h:this.currentHeight}else{var nx=i>0?this.entries[i-1].width+this.entries[i-1].x:this.TXT_NAME_WIDTH+this.hGap;nx+entry.width+this.hGap>this.PALETTE_WIDTH?(entry.x=this.FRAME_LEFT,entry.y=this.currentHeight+this.vGap):(entry.x=nx+this.hGap,entry.y=0==i?this.vGap+this.currentHeight:this.currentHeight-entry.height),this.currentHeight=entry.y+entry.height,this.currentWidth=this.PALETTE_WIDTH}}"icon"===state?this.iconToBig():this.iconToSmall(),this.imgBg||(this.imgBg=new eui.Image,this.addChildAt(this.imgBg,0),this.imgBg.scale9Grid=new egret.Rectangle(33,33,780,48),RES.getResAsync("palette_group_bg_png",function(data,key){_this.imgBg.source=data},this)),this.currentHeight=this.currentHeight<this.ICON_STATE_BG_HEIGHT?this.ICON_STATE_BG_HEIGHT:this.currentHeight,this.graphics.clear(),this.graphics.lineStyle(0,13226,0),this.graphics.drawRoundRect(0,0,this.currentWidth+this.hGap,this.currentHeight+this.vGap,1,1),this.width=this.currentWidth+this.hGap,this.height=this.currentHeight+this.vGap,this.imgBg.width=this.currentWidth+this.hGap,this.imgBg.height=this.currentHeight+this.vGap,this.imgIconBg.visible="icon"===state,this.txtName.visible="icon"===state},ActionGroup.prototype.iconToSmall=function(){this.itemIcon.width=this.ICON_WIDTH2,this.itemIcon.height=this.ICON_HEIGHT2,this.itemIcon.x=this.FRAME_LEFT,this.itemIcon.y=this.FRAME_TOP},ActionGroup.prototype.iconToBig=function(){this.itemIcon.width=this.ICON_WIDTH2,this.itemIcon.height=this.ICON_HEIGHT2,this.itemIcon.x=.5*(this.TXT_NAME_WIDTH-this.ICON_WIDTH2)+this.FRAME_LEFT,this.itemIcon.y=.5*(this.ICON_STATE_BG_HEIGHT-this.ICON_HEIGHT2)},ActionGroup.prototype.changeToTxtState=function(){this.entries.forEach(function(value,index){value.changeToTxtState()},this),this.layout("txt")},ActionGroup.prototype.changeToIconState=function(){this.entries.forEach(function(value,index){value.changeToIconState()},this),this.layout("icon")},ActionGroup.prototype.dispose=function(){for(var i in this.entries){this.entries[i].dispose()}},ActionGroup}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ActionGroup},{"../../../enums/Globals":46}],107:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Globals_1=require("../../../enums/Globals"),SoundManager_1=require("../../../manager/SoundManager"),ActionItem=function(_super){function ActionItem(doc,language){_super.call(this),this.ITEM_HEIGHT=20,this.ITEM_WIDTH=170,this.FRAME_BORDER=10,this._doc=doc,this._language=language,this._txtMethod=new egret.TextField,this._txtMethod.textColor=51967,this._txtMethod.text=doc.shortName,this._txtMethod.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(this._txtMethod),this.changeToTxtState(),this.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this,!0),this.addEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this,!0),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.name="actionItem"}return __extends(ActionItem,_super),ActionItem.prototype.changeToIconState=function(){var _this=this,nameLength=this._doc.short_name?this._doc.short_name.length:0;this.ITEM_WIDTH=nameLength<=6?115:15*nameLength,this.ITEM_HEIGHT=105,this._txtMethod.width=this.ITEM_WIDTH,this._txtMethod.height=26,this._txtMethod.size=20,this._txtMethod.bold=!1,this._txtMethod.x=0,this._txtMethod.y=80,this._txtMethod.text=this._doc.short_name||"method",this._txtMethod.textAlign=egret.HorizontalAlign.CENTER,this._imgIcon||(this._imgIcon=new eui.Image,this._imgIcon.width=50,this._imgIcon.height=50,this._doc.icon?this._imgIcon.source=this._doc.icon:RES.getResAsync("method_default_png",function(data,url){_this._imgIcon.source=data},this)),this.contains(this._imgIcon)||this.addChild(this._imgIcon),this._imgBg||(this._imgBg=new eui.Image,this._imgBg.width=this.ITEM_WIDTH,this._imgBg.height=this.ITEM_HEIGHT-this._txtMethod.height-10,this._imgBg.y=this.FRAME_BORDER,this._imgBg.fillMode=egret.BitmapFillMode.SCALE,this._imgBg.scale9Grid=new egret.Rectangle(22,22,70,22),RES.getResAsync("palette_item_bg_png",function(data,key){_this._imgBg.source=data},this)),this.contains(this._imgBg)||(this.addChild(this._imgBg),this.swapChildren(this._imgBg,this._imgIcon)),this.drawBg(),this._imgIcon.x=.5*(this.ITEM_WIDTH-this._imgIcon.width),this._imgIcon.y=.5*(this.ITEM_HEIGHT-this._txtMethod.height-this._imgIcon.height)+5},ActionItem.prototype.changeToTxtState=function(){this.ITEM_WIDTH=.5*Globals_1.default.PALETTE_WIDTH-110,this.ITEM_HEIGHT=25,this._txtMethod.width=this.ITEM_WIDTH,this._txtMethod.height=this.ITEM_HEIGHT,this._txtMethod.size=20,this._txtMethod.bold=!1,this._txtMethod.x=0,this._txtMethod.y=0,this._txtMethod.text=this._doc.shortName,this._txtMethod.textAlign=egret.HorizontalAlign.LEFT,this._imgIcon&&this.contains(this._imgIcon)&&this.removeChild(this._imgIcon),this._imgBg&&this.contains(this._imgBg)&&this.removeChild(this._imgBg),this.drawBg()},ActionItem.prototype.drawBg=function(){this.graphics.clear(),this.graphics.beginFill(2366,0),this.graphics.drawRoundRect(0,0,this.ITEM_WIDTH,this.ITEM_HEIGHT,2,2),this.graphics.endFill()},ActionItem.prototype.onTap=function(event){console.log("you clicked method name:",this._doc.shortName),this.dispatchEvent(new egret.Event(ActionItem.ACTION_ITEM_CLICKED,!0,!1,this._doc.shortName))},ActionItem.prototype.onMouseOver=function(event){var actionTip=$("#codeTipData");actionTip.html(this._doc.initialHTML),this._txtMethod.textColor=15990669;var self=this,wstr=actionTip.css("width"),hstr=actionTip.css("height"),tipWidth=parseFloat(wstr.substr(0,wstr.length-2)),tipHeight=parseFloat(hstr.substr(0,hstr.length-2)),globalPos=self.parent.localToGlobal(self.x,self.y),dw=.5*(window.innerWidth-Globals_1.default.domGameWidth),dh=.5*(window.innerHeight-Globals_1.default.domGameHeight),rx=Globals_1.default.scaleRatio*globalPos.x,ry=Globals_1.default.scaleRatio*globalPos.y;actionTip.css("left",dw+rx+self.width*Globals_1.default.scaleRatio*.5-tipWidth-10),actionTip.css("top",dh+ry-tipHeight-25),actionTip.removeClass("hidden"),SoundManager_1.default.getInstance().playEffect("u07_skill_mp3")},ActionItem.prototype.onMouseOut=function(event){$("#codeTipData").addClass("hidden"),this._txtMethod.textColor=51967},ActionItem.prototype.dispose=function(){this._txtMethod.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),this._txtMethod.removeEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},ActionItem.ACTION_ITEM_CLICKED="actionItemClicked",ActionItem}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ActionItem},{"../../../enums/Globals":46,"../../../manager/SoundManager":58}],108:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),WindowManager_1=require("../../../base/popup/WindowManager"),UserInfo_1=require("../../../model/vo/UserInfo"),DataAccessManager_1=require("../../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../../model/DataAccessEntry"),NetManager_1=require("../../../model/net/NetManager"),GoalManager_1=require("../../../control/goal/GoalManager"),UserInfoProxy_1=require("../../../model/da/UserInfoProxy"),RewardSlot_1=require("./RewardSlot"),RewardBar_1=require("./RewardBar"),SceneManager_1=require("../../../manager/SceneManager"),Globals_1=require("../../../enums/Globals"),SoundManager_1=require("../../../manager/SoundManager"),Protocols_1=require("../../../enums/Protocols"),BattleResultWindow=function(_super){function BattleResultWindow(name){_super.call(this,name),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="BattleVictorySkin" width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="battle_victory_window_json.battle_level_pic_png" x="633" y="525"/><e:Label id="labLvl" text="Lv 99" x="634" y="524" width="168" height="40" textAlign="center" verticalAlign="middle" size="28" stroke="3" strokeColor="0x023d8c"/><e:ProgressBar id="pgbExp" y="518" width="475" skinName="BattleResultExpSkin" height="44" horizontalCenter="77.5"/><e:Image id="labAward" source="battle_victory_window_json.pic_reward_get_png" y="685" horizontalCenter="0"/><e:Group id="grpAward" width="727" height="111" y="657" horizontalCenter="0"></e:Group><e:Image source="battle_victory_window_json.battle_rule_png" y="825" scaleX="1" scaleY="1" horizontalCenter="0"/><e:Button id="btnContinue" label="" y="881" skinName="BattleContinueButtonSkin" x="1050"/><e:Button id="btnNext" label="" y="881" skinName="BattleNextpassSkin" x="730"/><e:Image id="imgStarBg" source="battle_victory_window_json.pic_victory_01_png" x="106" horizontalCenter="-3" y="75"/><e:Image id="imgShengli" source="battle_victory_window_json.pic_victory_03_png" y="170" horizontalCenter="6.5"/></e:Skin>',this.userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data,this.createAnimation()}return __extends(BattleResultWindow,_super),BattleResultWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),Globals_1.default.badgeAwardInfo=null,this.addListeners(),this.updateExp(0),this.playAnimation(),this.labAward.visible=this.checkIfGotAward(),SoundManager_1.default.getInstance().playEffect("u06_score_mp3")},BattleResultWindow.prototype.storyDataUpdate=function(event){this.updateExp(event.data.deltaExp),this.updateRewards(event.data)},Object.defineProperty(BattleResultWindow.prototype,"data",{get:function(){return this._data},set:function(value){this._data=value,this.checkIfGotAward()||(NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_PLAYSTORY,{id:parseInt(this.data.levelID),star:GoalManager_1.default.getInstance().star}),NetManager_1.default.getInstance().addEventListener(UserInfoProxy_1.default.STORY_UPDATE_DATA,this.storyDataUpdate,this))},enumerable:!0,configurable:!0}),BattleResultWindow.prototype.checkIfGotAward=function(){TDGA.onMissionCompleted(this.data.levelID);var achievedStar=GoalManager_1.default.getInstance().star;return parseInt(this.data.levelID)<=this.userInfo.storyID&&this.data.star_level>=achievedStar},BattleResultWindow.prototype.updateExp=function(deltaExp){var previousExp=this.userInfo.exp,currentExp=previousExp+deltaExp,currentLevel=UserInfo_1.default.levelFromExp(currentExp),currentLevelExp=UserInfo_1.default.expForLevel(currentLevel),nextLevel=currentLevel+1,nextLevelXP=UserInfo_1.default.expForLevel(nextLevel),totalXPNeeded=nextLevelXP-currentLevelExp;this.pgbExp.value=currentExp-currentLevelExp,this.pgbExp.maximum=totalXPNeeded,this.labLvl.text="Lv"+currentLevel,this.labAward.visible=!1},BattleResultWindow.prototype.updateRewards=function(awardData){var rewardBar=(GoalManager_1.default.getInstance().star,new RewardBar_1.default);if(rewardBar.x=.5*(this.grpAward.width-rewardBar.width),rewardBar.y=.5*(this.grpAward.height-rewardBar.height),this.grpAward.addChild(rewardBar),awardData.deltaExp>0&&RES.getResByUrl("resource/icon/equip/icon_exp.png",function(data,url){rewardBar.addAwardSlot(new RewardSlot_1.default(data,awardData.deltaExp))},this),awardData.deltaVigor>0&&RES.getResByUrl("resource/icon/equip/energy.png",function(data,url){rewardBar.addAwardSlot(new RewardSlot_1.default(data,awardData.deltaVigor))},this),awardData.deltaDiamond>0&&(RES.getResByUrl("resource/icon/equip/icon_gem.png",function(data,url){rewardBar.addAwardSlot(new RewardSlot_1.default(data,awardData.deltaDiamond))},this),TDGA.onReward(awardData.deltaDiamond,"战斗胜利奖励")),awardData.deltaEquips.length>0)for(var _i=0,_a=awardData.deltaEquips;_i<_a.length;_i++){var equipInfo=_a[_i];equipInfo.data.type==Globals_1.default.BADGE_TYPE_PYTHON||equipInfo.data.type==Globals_1.default.BADGE_TYPE_JAVASCRIPT?Globals_1.default.badgeAwardInfo=equipInfo:RES.getResByUrl("resource/icon/equip/"+equipInfo.data.icon+".png",function(data,url){rewardBar.addAwardSlot(new RewardSlot_1.default(data,""))},this)}if(awardData.deltaHeros.length>0)for(var this_1=this,_b=0,_c=awardData.deltaHeros;_b<_c.length;_b++){var heroInfo=_c[_b];!function(heroInfo){RES.getResByUrl("resource/icon/role/career_head/"+heroInfo.data.career_head+"_s.png",function(data,url){rewardBar.addAwardSlot(new RewardSlot_1.default(data,heroInfo.data.name))},this_1)}(heroInfo)}},BattleResultWindow.prototype.createAnimation=function(){var achievedStar=GoalManager_1.default.getInstance().star,mcDataFactory=new egret.MovieClipDataFactory(RES.getRes("win_"+achievedStar+"_json"),RES.getRes("win_"+achievedStar+"_png"));this._winStar=new egret.MovieClip(mcDataFactory.generateMovieClipData("win_star"+achievedStar));var cbDataFactory=new egret.MovieClipDataFactory(RES.getRes("win_chib_json"),RES.getRes("win_chib_png"));this._winCb=new egret.MovieClip(cbDataFactory.generateMovieClipData("win_chib")),this._winCbReverse=new egret.MovieClip(cbDataFactory.generateMovieClipData("win_chib")),this._winCbReverse.scaleX=-1;var blDataFactory=new egret.MovieClipDataFactory(RES.getRes("win_blingbling_json"),RES.getRes("win_blingbling_png"));this._blinkClip=new egret.MovieClip(blDataFactory.generateMovieClipData("win_blingbling"))},BattleResultWindow.prototype.playAnimation=function(){var _this=this;this.addChild(this._winCb),this.addChild(this._winCbReverse),this.addChild(this._winStar),this.addChild(this._blinkClip),this.swapChildren(this._winCb,this.imgShengli),this.swapChildren(this._winCbReverse,this.imgShengli),this._winCb.x=this.imgShengli.x+960,this._winCb.y=this.imgShengli.y+80,this._winCbReverse.x=975,this._winCbReverse.y=this._winCb.y,this._winStar.x=this.imgStarBg.x+855,this._winStar.y=this.imgStarBg.y+175,this._blinkClip.x=this.imgStarBg.x+850,this._blinkClip.y=this.imgStarBg.y+170,this._winCb.play(),this._winCb.addEventListener(egret.Event.COMPLETE,function(){_this._winStar.play()},this),this._winCbReverse.play(),this._blinkClip.play(-1)},BattleResultWindow.prototype.addListeners=function(){this.btnContinue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.btnNext.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNext,this)},BattleResultWindow.prototype.removeListeners=function(){this.btnContinue.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.btnNext.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNext,this)},BattleResultWindow.prototype.onContinue=function(event){WindowManager_1.default.closeWindow("BattleResultWindow",!0),SceneManager_1.default.getInstance().getRunningScene().battleUI.skip(BattleResultWindow.SKIP_CONITNUE),SceneManager_1.default.getInstance().popScene()},BattleResultWindow.prototype.onNext=function(event){WindowManager_1.default.closeWindow("BattleResultWindow",!0),SceneManager_1.default.getInstance().getRunningScene().battleUI.skip(BattleResultWindow.SKIP_NEXT_LEVEL),SceneManager_1.default.getInstance().popScene()},BattleResultWindow.prototype.onCloseClick=function(e){_super.prototype.onCloseClick.call(this,e),SceneManager_1.default.getInstance().popScene()},BattleResultWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.removeListeners(),NetManager_1.default.getInstance().removeEventListener(UserInfoProxy_1.default.STORY_UPDATE_DATA,this.storyDataUpdate,this),this._blinkClip.stop(),this._blinkClip.movieClipData.spriteSheet.dispose(),this._winStar.stop(),this._winStar.movieClipData.spriteSheet.dispose(),this._winCb.stop(),this._winCb.movieClipData.spriteSheet.dispose(),this._winCbReverse.stop(),this._winCbReverse.movieClipData.spriteSheet.dispose()},BattleResultWindow.SKIP_NEXT_LEVEL=!0,BattleResultWindow.SKIP_CONITNUE=!1,BattleResultWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BattleResultWindow},{"../../../base/da/DataAccessManager":2,"../../../base/popup/BaseWindow":7,"../../../base/popup/WindowManager":13,"../../../control/goal/GoalManager":40,"../../../enums/Globals":46,"../../../enums/Protocols":51,"../../../manager/SceneManager":57,"../../../manager/SoundManager":58,"../../../model/DataAccessEntry":59,"../../../model/da/UserInfoProxy":67,"../../../model/net/NetManager":68,"../../../model/vo/UserInfo":73,"./RewardBar":109,"./RewardSlot":110}],109:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},RewardBar=function(_super){function RewardBar(){_super.call(this),this.slots=[],this.graphics.clear(),this.graphics.beginFill(0,0),this.graphics.drawRect(0,0,500,80),this.graphics.endFill(),this.labDesc=new egret.TextField,this.labDesc.width=400,this.labDesc.height=20,this.labDesc.textAlign=egret.HorizontalAlign.CENTER,this.labDesc.verticalAlign=egret.VerticalAlign.MIDDLE,this.labDesc.size=17,this.labDesc.bold=!0,this.labDesc.x=.5*(this.width-this.labDesc.width),this.labDesc.y=0,this.addChild(this.labDesc)}return __extends(RewardBar,_super),RewardBar.prototype.setAwardDescription=function(desc){this.labDesc.text=desc},RewardBar.prototype.addAwardSlot=function(slot,type,gap,showDesc){slot.x=0;this.height,this.labDesc.height;slot.y=0,this.addChild(slot),this.slots.push(slot),showDesc&&(slot.addChild(slot.txtPos),slot.txtPos.x=1),"normal"===type?this.layout_normal(gap):this.layout_center()},Object.defineProperty(RewardBar.prototype,"awardSlotsCount",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),RewardBar.prototype.layout_center=function(){for(var len=this.slots.length,partWidth=this.width/(len+1),i=0;i<this.slots.length;i++)this.slots[i].x=partWidth*(i+1)-.5*this.slots[i].width},RewardBar.prototype.layout_normal=function(gap){gap||(gap=0);for(var i=(this.slots.length,0);i<this.slots.length;++i)this.slots[i].x=(this.slots[i].width+gap)*i},RewardBar.prototype.clone=function(){return new RewardBar},RewardBar}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=RewardBar},{}],110:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},RewardSlot=function(_super){function RewardSlot(icon,text,type,kind){_super.call(this),this.icon=icon,this.text=text,this.type=type,this.kind=kind,type||(type="normal"),this.bg=new egret.Bitmap(RES.getRes("common_utils_json.item_frame_png")),this.addChild(this.bg),this.contentIcon=new eui.Image,this.addChild(this.contentIcon),this.contentIcon.width=100,this.contentIcon.height=100,this.contentIcon.x=.5*(this.bg.width-this.contentIcon.width),this.contentIcon.y=.5*(this.bg.height-this.contentIcon.height),this.contentIcon.source=icon,"small"===type&&(this.width=this.height=55,this.bg.width=this.bg.height=55,this.contentIcon.width=this.contentIcon.height=55),this.txtPos=new egret.TextField,this.txtPos.width=40,this.txtPos.height=20,this.txtPos.textAlign=egret.HorizontalAlign.CENTER,this.txtPos.verticalAlign=egret.VerticalAlign.MIDDLE,this.txtPos.size=17,this.txtPos.textColor=15658734,this.txtPos.x=this.bg.width-this.txtPos.width,this.txtPos.y=this.bg.height-this.txtPos.height,this.txtPos.text=text,this.addChild(this.txtPos)}return __extends(RewardSlot,_super),RewardSlot.prototype.clone=function(){return new RewardSlot(this.icon,this.text,this.type,this.kind)},RewardSlot}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=RewardSlot},{}],111:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)
},BaseWindow_1=require("../../../base/popup/BaseWindow"),WindowManager_1=require("../../../base/popup/WindowManager"),SoundManager_1=require("../../../manager/SoundManager"),SceneManager_1=require("../../../manager/SceneManager"),BattleResultWindow_1=require("../battleresult/BattleResultWindow"),BattleSettingWindow=function(_super){function BattleSettingWindow(name){_super.call(this,name),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="BattleSettingWindowSkin" width="900" height="452" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="battle_scene_setting_json.battle_setting_Bg_png" x="2" y="1" locked="true"/><e:Button id="btnQuit" label="" x="55" y="160" skinName="btnQuitSkin" /><e:Button id="btnContinue" label="" x="212" y="160" skinName="btnComtinue"/><e:Button id="btnReload" label="" x="372" y="159" skinName="btnReload"/><e:ToggleButton id="btnMusic" label="" x="539" y="158" skinName="btnMusicSkin"/><e:ToggleButton id="btnSound" label="" x="695" y="157" skinName="btnSoundSkin"/></e:Skin>'}return __extends(BattleSettingWindow,_super),BattleSettingWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.addListeners();var effectState=egret.localStorage.getItem("effectSwitch");this.btnSound.selected=!("on"==effectState||!effectState);var musicState=egret.localStorage.getItem("musicSwitch");this.btnMusic.selected=!("on"==musicState||!musicState)},BattleSettingWindow.prototype.addListeners=function(){this.btnQuit.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuit,this),this.btnContinue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.btnReload.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReload,this),this.btnMusic.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMusic,this),this.btnSound.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSound,this)},BattleSettingWindow.prototype.removeListeners=function(){this.btnQuit.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuit,this),this.btnContinue.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.btnReload.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onReload,this),this.btnMusic.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMusic,this),this.btnSound.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSound,this)},BattleSettingWindow.prototype.onQuit=function(event){WindowManager_1.default.closeWindow("BattleSettingWindow",!0),SceneManager_1.default.getInstance().getRunningScene().battleUI.skip(BattleResultWindow_1.default.SKIP_CONITNUE),SceneManager_1.default.getInstance().popScene()},BattleSettingWindow.prototype.onContinue=function(event){WindowManager_1.default.closeWindow("BattleSettingWindow",!0),document.getElementById("code-area").style.display="block"},BattleSettingWindow.prototype.onMusic=function(event){this.btnMusic.selected?(SoundManager_1.default.getInstance().setMusicVolume(0),egret.localStorage.setItem("musicSwitch","off")):(SoundManager_1.default.getInstance().setMusicVolume(1),egret.localStorage.setItem("musicSwitch","on"))},BattleSettingWindow.prototype.onSound=function(event){this.btnSound.selected?(SoundManager_1.default.getInstance().setEffectVolume(0),egret.localStorage.setItem("effectSwitch","off")):(SoundManager_1.default.getInstance().setEffectVolume(1),egret.localStorage.setItem("effectSwitch","on"))},BattleSettingWindow.prototype.onReload=function(event){console.log("重新开始"),WindowManager_1.default.closeWindow("BattleSettingWindow",!0),document.getElementById("code-area").style.display="block",SceneManager_1.default.getInstance().getRunningScene().fightReload()},BattleSettingWindow.prototype.onCloseClick=function(e){_super.prototype.onCloseClick.call(this,e),document.getElementById("code-area").style.display="block"},BattleSettingWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BattleSettingWindow},{"../../../base/popup/BaseWindow":7,"../../../base/popup/WindowManager":13,"../../../manager/SceneManager":57,"../../../manager/SoundManager":58,"../battleresult/BattleResultWindow":108}],112:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),ResourceItem=RES.ResourceItem,BattleTipWindow=function(_super){function BattleTipWindow(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="BattleTipWindowSkin" width="1104" height="832" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="common_utils_json.common_frame_prompt_png" x="1" y="55" scale9Grid="152,125,269,76" width="1105" height="777"/><e:Button id="btnClose" label="按钮" x="1029" y="81" skinName="WindowCloseBtnSkin" scaleX="1" scaleY="1"/><e:Image source="common_utils_json.common_title_line_png" x="2" y="25"/><e:Image source="common_title_prompt_png" x="476" y="-6"/></e:Skin>'}return __extends(BattleTipWindow,_super),BattleTipWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this._container=new egret.Sprite,this.addChild(this._container),this._container.x=60,this._container.y=140,this._txt=new egret.TextField,this._container.addChild(this._txt),this._txt.width=976,this._txt.height=632,this._txt.lineSpacing=10,this.showTip()},BattleTipWindow.prototype.showTip=function(){var _this=this;RES.getResByUrl("resource/battletips/110001.txt",function(data,url){_this._txt.textFlow=(new egret.HtmlTextParser).parser(data)},this,ResourceItem.TYPE_TEXT)},BattleTipWindow.prototype.onCloseClick=function(e){_super.prototype.onCloseClick.call(this,e),document.getElementById("code-area").style.display="block"},BattleTipWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BattleTipWindow},{"../../../base/popup/BaseWindow":7}],113:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GoalState_1=require("../../../control/goal/GoalState"),GoalLabel=function(_super){function GoalLabel(data,state){_super.call(this),this._data=data,this._imgState=new eui.Image,this._txtGoal=new egret.TextField,this._txtGoal.text=data.name,this._txtGoal.x=45,this._txtGoal.y=9,this._txtGoal.size=20,this._txtGoal.fontFamily="Microsoft Yahei",this.addChild(this._imgState),this.addChild(this._txtGoal),this.setState(state)}return __extends(GoalLabel,_super),Object.defineProperty(GoalLabel.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),GoalLabel.prototype.setState=function(state){state===GoalState_1.default.FAILED?(this._txtGoal.textColor=64767,this._txtGoal.strokeColor=7493,this._txtGoal.stroke=2,this._imgState.source=""):(this._txtGoal.textColor=16710049,this._txtGoal.strokeColor=4860692,this._txtGoal.stroke=2,this._imgState.source="resource/skin_assets/battlescene/battle_scene_assets/goals/mission_finish_img.png")},GoalLabel}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GoalLabel},{"../../../control/goal/GoalState":41}],114:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GoalManager_1=require("../../../control/goal/GoalManager"),GoalInfo_1=require("../../../control/goal/GoalInfo"),GoalState_1=require("../../../control/goal/GoalState"),GoalLabel_1=require("./GoalLabel"),SoundManager_1=require("../../../manager/SoundManager"),FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),GoalPanel=function(_super){function GoalPanel(){_super.call(this),this.isExpand=!1,this.x=780,this.y=-200,this.goalBackground=new eui.Image,this.goalBackground.source=RES.getRes("battle_scene_json.goal_frame_png"),this.goalBackground.width=283,this.goalBackground.height=260,this.addChild(this.goalBackground),this.goalTaskWordImg=new eui.Image,this.goalTaskWordImg.source=RES.getRes("battle_scene_json.goal_word_img_png"),this.goalTaskWordImg.x=118,this.goalTaskWordImg.y=23,this.goalTaskWordImg.fillMode="SCALE",this.addChild(this.goalTaskWordImg),this.goalUpSelectedImg=new eui.Image,this.goalUpSelectedImg.source="function_up_selected_png",this.goalUpSelectedImg.x=118,this.goalUpSelectedImg.y=230,this.goalUpSelectedImg.fillMode="SCALE",this.addChild(this.goalUpSelectedImg),this.touchEnabled=!0,this.touchChildren=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),GoalManager_1.default.getInstance().addEventListener(GoalManager_1.default.GOAL_STATE_CHANGED,this.update,this),GoalManager_1.default.getInstance().addEventListener(GoalManager_1.default.GOAL_STATE_INITIALIZED,this.init,this),this.labelContainer=new egret.Sprite,this.labelContainer.x=30,this.labelContainer.y=52;var g=this.labelContainer.graphics;g.clear(),g.beginFill(16711680,0),g.drawRect(0,0,220,150),g.endFill(),this.addChild(this.labelContainer),this.highLightImages=[];for(var i=0;i<3;i++){var imgStar=new eui.Image;this.addChild(imgStar),imgStar.source="resource/icon/item/common_star_normal.png",imgStar.x=75+50*i,imgStar.y=200,this.addChild(imgStar);var highStar=new eui.Image;highStar.source="resource/icon/item/common_star_selected.png",highStar.x=75+50*i,highStar.y=200,this.addChild(highStar),this.highLightImages.push(highStar)}this.setStar(0)}return __extends(GoalPanel,_super),GoalPanel.prototype.onTouchHandler=function(e){this.isExpand?this.collapsePanel():this.expandPanel()},GoalPanel.prototype.expandPanel=function(){var _this=this;FrameTweenLite_1.default.to(this,1,{y:0,onComplete:function(){_this.isExpand=!0,FrameTweenLite_1.default.killTweensOf(_this)}})},GoalPanel.prototype.collapsePanel=function(){var _this=this;FrameTweenLite_1.default.to(this,.3,{y:-200,onComplete:function(){_this.isExpand=!1,FrameTweenLite_1.default.killTweensOf(_this)}})},GoalPanel.prototype.patrolPanel=function(){var _this=this;TweenLite.to(this,1,{y:0,onComplete:function(){_this.isExpand=!0}}).delay(2),TweenLite.to(this,.5,{y:-200,onComplete:function(){_this.isExpand=!1}}).delay(5)},GoalPanel.prototype.init=function(event){var cs=event.data;console.log("goal:",cs),this.labels=[];for(var i in cs){var c=cs[i],goalLabel=new GoalLabel_1.default(c.data,GoalState_1.default.FAILED);goalLabel.x=0,goalLabel.y=50*parseInt(i),this.labelContainer.addChild(goalLabel),this.labels.push(goalLabel)}this.layoutLabels()},GoalPanel.prototype.layoutLabels=function(){for(var len=this.labels.length,partHeight=this.labelContainer.height/(len+1),i=0;i<len;i++)this.labels[i].y=partHeight*(i+1)-this.labels[i].height},GoalPanel.prototype.update=function(event){var cs=event.data;if(cs instanceof Array)for(var i in cs)this.getLabelByName(cs[i].data.name).setState(cs[i].state);else cs instanceof GoalInfo_1.default&&(this.getLabelByName(cs.data.name).setState(cs.state),cs.state===GoalState_1.default.SUCCESS&&SoundManager_1.default.getInstance().playEffect("u08_succeed_mp3"),1===parseInt(cs.data.world_end_after)&&GoalManager_1.default.getInstance().dispatchEvent(new egret.Event(GoalManager_1.default.GOAL_WORLD_END,!1,!1,1.5)));this.setStar(GoalManager_1.default.getInstance().star)},GoalPanel.prototype.getLabelByName=function(name){for(var key in this.labels)if(this.labels[key].data.name===name)return this.labels[key];return null},GoalPanel.prototype.setStar=function(star){for(var i=0;i<3;i++)this.highLightImages[i].visible=i<star},GoalPanel.prototype.dispose=function(){this.removeChildren(),this.labels=null,this.highLightImages=null,GoalManager_1.default.getInstance().removeEventListener(GoalManager_1.default.GOAL_STATE_CHANGED,this.update,this),GoalManager_1.default.getInstance().removeEventListener(GoalManager_1.default.GOAL_STATE_INITIALIZED,this.init,this)},GoalPanel}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GoalPanel},{"../../../base/utils/FrameTweenLite":18,"../../../control/goal/GoalInfo":39,"../../../control/goal/GoalManager":40,"../../../control/goal/GoalState":41,"../../../manager/SoundManager":58,"./GoalLabel":113}],115:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),PopUpManager_1=require("../../base/popup/PopUpManager"),SoundManager_1=require("../../manager/SoundManager"),SceneManager_1=require("../../manager/SceneManager"),Alert=function(_super){function Alert(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="AlertSkin" width="642" height="452" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="alert_bg_png" x="0" y="0" scaleX="1" scaleY="1"/><e:Button id="btnConfirm" y="330" label="确定" x="378" skinName="CommonButtonSkin"/><e:Button id="btnCancel" y="330" label="取消" x="147" skinName="CommonButtonSkin"/><e:Label id="labContent" text="content" x="118" y="150" width="386" height="93" size="23" textAlign="center" verticalAlign="middle"/></e:Skin>'}return __extends(Alert,_super),Alert.show=function(title,content,type){void 0===title&&(title="title"),void 0===content&&(content="content"),void 0===type&&(type=1);var al=new Alert;return al.labContent.text=content,1==type?(al.btnCancel.visible=!0,al.btnCancel.x=.22*al.width,al.btnConfirm.x=.53*al.width):2==type&&(al.btnCancel.visible=!1,al.btnConfirm.x=.5*(al.width-al.btnConfirm.width)),al.btnCancel&&al.btnCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,al.onCancel,al),al.btnClose&&al.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,al.onClose,al),al.btnConfirm.addEventListener(egret.TouchEvent.TOUCH_TAP,al.onConfirm,al),PopUpManager_1.default.addPopUp(al,!0,!0),document.getElementById("code-area").style.display="none",al},Alert.prototype.checkCodeEditorVisible=function(){SceneManager_1.default.getInstance().numScenes>=2&&(document.getElementById("code-area").style.display="block")},Alert.prototype.onClose=function(event){PopUpManager_1.default.removePopUp(this),this.checkCodeEditorVisible(),this.removeListeners(),this.dispatchEvent(new egret.Event("close")),SoundManager_1.default.getInstance().playEffect("button003_mp3")},Alert.prototype.onCancel=function(event){PopUpManager_1.default.removePopUp(this),this.checkCodeEditorVisible(),this.removeListeners(),this.dispatchEvent(new egret.Event("cancel"))},Alert.prototype.onConfirm=function(event){PopUpManager_1.default.removePopUp(this),this.checkCodeEditorVisible(),this.removeListeners(),this.dispatchEvent(new egret.Event("confirm"))},Alert.prototype.removeListeners=function(){this.btnClose&&this.btnCancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancel,this),this.btnClose&&this.btnClose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.btnConfirm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirm,this)},Alert}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=Alert},{"../../base/popup/BaseWindow":7,"../../base/popup/PopUpManager":9,"../../manager/SceneManager":57,"../../manager/SoundManager":58}],116:[function(require,module,exports){"use strict";var ScrollPolicy=eui.ScrollPolicy,MouseScroller=function(){function MouseScroller(){}return MouseScroller.enableMouseScroller=function(scroller){scroller.addEventListener(mouse.MouseEvent.MOUSE_OVER,function(e){scroller.scrollPolicyV=ScrollPolicy.ON,scroller.verticalScrollBar&&(scroller.verticalScrollBar.visible=!0),$(".egret-player").bind("mousewheel",function(event){var delta=event.originalEvent.deltaY/5,viewport=scroller.viewport,down=viewport.contentHeight-viewport.height;down<=0||(scroller.verticalScrollBar.visible=!0,viewport.scrollV<=0?viewport.scrollV=0:viewport.scrollV>=down&&(viewport.scrollV=down),viewport.scrollV+=delta)})},this),scroller.addEventListener(mouse.MouseEvent.MOUSE_OUT,function(e){scroller.scrollPolicyV=ScrollPolicy.AUTO,$(".egret-player").unbind("mousewheel")},this)},MouseScroller.enableMouseScrollView=function(scrollView,offset){scrollView.touchEnabled=!0,scrollView.addEventListener(mouse.MouseEvent.MOUSE_OVER,function(e){$(".egret-player").bind("mousewheel",function(event){var contentHeight=scrollView._getContentHeight();if(!(contentHeight<=scrollView.height)){var delta=event.originalEvent.deltaY/5,down=contentHeight-scrollView.height+(offset||0);scrollView.scrollTop<=0?scrollView.scrollTop=0:scrollView.scrollTop>=down&&(scrollView.scrollTop=down),scrollView.scrollTop+=delta}})},this),scrollView.addEventListener(mouse.MouseEvent.MOUSE_OUT,function(e){$(".egret-player").unbind("mousewheel")},this)},MouseScroller}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MouseScroller},{}],117:[function(require,module,exports){"use strict";var FrameTweenLite_1=require("../../base/utils/FrameTweenLite"),Globals_1=require("../../enums/Globals"),ToastManager=function(){function ToastManager(){}return ToastManager.init=function(layer){this.tipsContainer=new egret.DisplayObjectContainer,layer.addChild(this.tipsContainer)},ToastManager.centerShowTip=function(strTip,interval){this.showTip(strTip,.5*(Globals_1.default.GAME_WIDTH-800),560,interval)},ToastManager.showTip=function(strTip,posx,posy,interval){posx||(posx=360),posy||(posy=560);var wordTextField=new egret.TextField;wordTextField.textAlign=egret.HorizontalAlign.CENTER,wordTextField.verticalAlign=egret.VerticalAlign.MIDDLE,wordTextField.x=posx,wordTextField.y=posy,wordTextField.width=800,wordTextField.height=120,wordTextField.bold=!0,/<font[\s\S]*?>/.test(strTip)?wordTextField.textFlow=(new egret.HtmlTextParser).parser(strTip):wordTextField.text=strTip,this.tipsContainer.addChild(wordTextField);var self=this;FrameTweenLite_1.default.killTweensOf(wordTextField),FrameTweenLite_1.default.fromTo(wordTextField,1.2,{y:560},{y:360,onComplete:function(){self.tipsContainer.contains(wordTextField)&&self.tipsContainer.removeChild(wordTextField),FrameTweenLite_1.default.killTweensOf(wordTextField)}})},ToastManager.prototype.showTips=function(tips,posx,posy,interval){tips.length&&tips.forEach(function(tip){this.showTip(tip)},this)},ToastManager}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ToastManager},{"../../base/utils/FrameTweenLite":18,"../../enums/Globals":46}],118:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},MainToolBtn_1=require("../mainscene/MainToolBtn"),BarrierBtn_1=require("../explore/barrier/BarrierBtn"),BarrierWindow_1=require("./barrier/BarrierWindow"),BaseWindow_1=require("../../base/popup/BaseWindow"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),NetManager_1=require("../../model/net/NetManager"),ConfigManager_1=require("../../manager/ConfigManager"),WindowManager_1=require("../../base/popup/WindowManager"),UserInfoProxy_1=require("../../model/da/UserInfoProxy"),SoundManager_1=require("../../manager/SoundManager"),HUDPanel_1=require("../mainscene/HUDPanel"),Alert_1=require("../../view/common/Alert"),Protocols_1=require("../../enums/Protocols"),ExploreWindow=function(_super){function ExploreWindow(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="ExploreWindowSkin" width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image id="imgBg" source="chapterMap_1001_jpg"/><e:Button id="btnClose" x="1808" y="4" skinName="CommonReturnBtnSkin" /></e:Skin>',this.map_config=ConfigManager_1.default.getInstance().getConfigs("pve_story_map"),this.group_config=ConfigManager_1.default.getInstance().getConfigs("pve_story_group"),this.level_config=ConfigManager_1.default.getInstance().getConfigs("pve_story_level"),this.hudPanel=new HUDPanel_1.default,this.addChild(this.hudPanel),this.userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data,this.currentLevelID=this.userInfo.storyID,this.currentGroupID=this.level_config[this.currentLevelID].group,this.currentMapID=this.level_config[this.currentLevelID].map,this.isShowGroup=!1,NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_GETSTORYINFO),NetManager_1.default.getInstance().addEventListener(UserInfoProxy_1.default.STORY_UPDATE_STAR,this.storyStarUpdate,this)}return __extends(ExploreWindow,_super),ExploreWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.mainToolBtns=new MainToolBtn_1.default,this.addChild(this.mainToolBtns),this.mainToolBtns.x=1024,this.mainToolBtns.y=912},ExploreWindow.prototype.storyStarUpdate=function(e){this.starInfo=e.data,this.updateView();for(var i=0;this.groupPanel&&i<this.groupPanel.barrierList.length;++i){var star_level=this.getStarByStoryId(this.groupPanel.barrierList[i].cellData.levelID,this.starInfo);this.groupPanel.barrierList[i].updateCellStarLevel(star_level)}},ExploreWindow.prototype.updateView=function(chapter_index){this.removeAll(),this.hudPanel.update(this.userInfo),this.mapIdOfPage=chapter_index||this.currentMapID,this.mapIdOfPage!=this.currentMapID?this.mapStateOfPage=this.mapIdOfPage<this.currentMapID?ExploreWindow.STATE_OPEN:ExploreWindow.STATE_LOCK:this.mapStateOfPage=ExploreWindow.STATE_STRIP,this.imgBg.source=RES.getRes("chapterMap_"+this.mapIdOfPage+"_jpg");var group={},level={};this.groups_info={},this.flyweight_groups={},this.flyweight_levels=[];for(var group_key,level_key,mapRawInfo=this.map_config[this.mapIdOfPage],groupIDs=mapRawInfo.group.split("|"),userCurrentMapIndex=Object.keys(this.map_config).indexOf(this.currentMapID.toString())+1,raw_group_info={},raw_level_info={},state_lock=ExploreWindow.STATE_LOCK,group_index=0;group_index<groupIDs.length;++group_index){group_key=groupIDs[group_index],raw_group_info[group_key]=this.group_config[group_key];var pos=raw_group_info[group_key].point&&raw_group_info[group_key].point.split("|")||[101,101],topic=raw_group_info[group_key].topic&&raw_group_info[group_key].topic.split("|")[0];group={chapterIndex:userCurrentMapIndex,groupIndex:group_index+1,name:raw_group_info[group_key].name,rewards:{},levels:{},point:[pos[0],pos[1]],topic:topic},this.flyweight_groups[group_key]=[];for(var level_chuncks=raw_group_info[group_key].level.split("|"),level_index=0;level_index<level_chuncks.length;++level_index)if(level_key=level_chuncks[level_index],level=raw_level_info[level_key]=this.level_config[level_key],this.flyweight_levels.push(level_key),this.flyweight_groups[group_key].push(level_key),level_key&&level){if(ExploreWindow.STATE_STRIP!=this.mapStateOfPage)state_lock=this.mapStateOfPage;else{var group_ind=groupIDs.indexOf(this.currentGroupID);if(group_ind=Math.min(Math.max(group_ind,0),groupIDs.length-1),group_index!=group_ind)state_lock=group_index<group_ind?ExploreWindow.STATE_OPEN:ExploreWindow.STATE_LOCK;else{var level_ind=level_chuncks.indexOf(this.currentLevelID.toString());level_ind=Math.min(Math.max(level_ind,0),level_chuncks.length-1),state_lock=level_index!=level_ind?level_index<level_ind?ExploreWindow.STATE_OPEN:ExploreWindow.STATE_LOCK:ExploreWindow.STATE_STRIP}}var star_level=this.getStarByStoryId(level_key,this.starInfo);group.levels[level_key]={levelIndex:level_index,groupIndex:group_index+1,chapterIndex:userCurrentMapIndex+1,levelID:level_key,name:level.name,topic:level.topic,required_energy:level.energy,hero_rotation:level.hero_rotation,tiledmap:level.tiledmap,tiledimage:level.tiledimage,star1_reward:level.star1_reward,star1_reward_num:level.star1_reward_num,star2_reward:level.star2_reward,star2_reward_num:level.star2_reward_num,star3_reward:level.star3_reward,star3_reward_num:level.star3_reward_num,star_level:star_level,state_locked:state_lock,next_level:level.next_level,level_bgm:level.bgm,find_path:level.find_path}}this.groups_info[group_key]=group}var curr_group_index,groups_labels=Object.keys(this.groups_info),barrier_state=BarrierBtn_1.default.STATE_OPEN;this.barrierBtns=[];for(var i=0;i<groups_labels.length;++i){group_key=groups_labels[i],group=this.groups_info[group_key],ExploreWindow.STATE_STRIP!=this.mapStateOfPage?barrier_state=ExploreWindow.STATE_OPEN==this.mapStateOfPage?BarrierBtn_1.default.STATE_OPEN:BarrierBtn_1.default.STATE_LOCK:(curr_group_index=groups_labels.indexOf(this.currentGroupID.toString()),curr_group_index=Math.min(Math.max(curr_group_index,0),groups_labels.length-1),barrier_state=i!=curr_group_index?i<curr_group_index?BarrierBtn_1.default.STATE_OPEN:BarrierBtn_1.default.STATE_LOCK:BarrierBtn_1.default.STATE_STRIP);var nowStarCount=0,totalStarCount=0;for(var levelId in group.levels)topic||(topic=group.levels[levelId].topic.split("|")[0]),nowStarCount+=group.levels[levelId].star_level,totalStarCount+=3;this.barrierBtns[i]=new BarrierBtn_1.default(barrier_state,i+1,{topic:group.topic,nowStarCount:nowStarCount,totalStarCount:totalStarCount}),this.barrierBtns[i].x=parseInt(group.point[0]),this.barrierBtns[i].y=parseInt(group.point[1])-this.barrierBtns[i].height/2,BarrierBtn_1.default.STATE_LOCK==barrier_state?this.barrierBtns[i].x-=this.barrierBtns[i].width/4:BarrierBtn_1.default.STATE_OPEN==barrier_state?this.barrierBtns[i].x-=this.barrierBtns[i].width/4:this.barrierBtns[i].y+=this.barrierBtns[i].height/4,this.barrierBtns[i].name="btnBarrier"+i,this.addChild(this.barrierBtns[i]),this.barrierBtns[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBarrierBtnTouchHandler,this)}this.btnPrevious=new eui.Button,this.btnPrevious.skinName="ExplorePageUpBtnSkin",this.btnPrevious.x=0,this.btnPrevious.y=504,this.btnNext=new eui.Button,this.btnNext.skinName="ExplorePageDownBtnSkin",this.btnNext.x=1854,this.btnNext.y=504,this.btnPrevious.visible=this.btnNext.visible=!0,this.addChildAt(this.btnNext,this.numChildren-1),this.addChildAt(this.btnPrevious,this.numChildren-2);var chapter_labels=Object.keys(this.map_config),chapter_ind=chapter_labels.indexOf(this.mapIdOfPage.toString());chapter_ind<=0&&(this.btnPrevious.visible=!1),chapter_ind>=chapter_labels.length-1&&(this.btnNext.visible=!1),this.btnPrevious.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBtnMapChangeHandler,this),this.btnNext.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchBtnMapChangeHandler,this)},ExploreWindow.prototype.onBarrierBtnTouchHandler=function(e){if(SoundManager_1.default.getInstance().playEffect("u01_button_mp3"),BarrierBtn_1.default.STATE_LOCK==e.currentTarget.type)return void Alert_1.default.show("提示","请先通关前置关卡，解锁本章节",2);for(var groups_labels=Object.keys(this.groups_info),group_info={},i=0;i<groups_labels.length;++i)if(e.currentTarget==this.barrierBtns[i]){group_info=this.groups_info[groups_labels[i]];break}WindowManager_1.default.showWindow(BarrierWindow_1.default,"BarrierWindow","选关界面",group_info)},ExploreWindow.prototype.onTouchBtnMapChangeHandler=function(e){var chapter_labels=Object.keys(this.map_config),chapter_ind=chapter_labels.indexOf(this.mapIdOfPage.toString());if(e.currentTarget==this.btnPrevious){if(chapter_ind<=0)return;--chapter_ind,this.updateView(parseInt(chapter_labels[chapter_ind]))}else if(e.currentTarget==this.btnNext){if(chapter_ind>=chapter_labels.length-1)return;++chapter_ind,this.updateView(parseInt(chapter_labels[chapter_ind]))}},ExploreWindow.prototype.getStarByStoryId=function(storyId,vStarInfo){for(var index in vStarInfo){var starInfo=vStarInfo[index];if(parseInt(storyId)===starInfo.storyID)return parseInt(starInfo.star)}return 0},ExploreWindow.prototype.isLevelInChapter=function(levelId){return this.flyweight_levels.indexOf(levelId)>-1},ExploreWindow.prototype.isInSameGroup=function(levelId1,levelId2){var groupId1=this.findLevelGroupId(levelId1),groupId2=this.findLevelGroupId(levelId2);return-1!=groupId1&&-1!=groupId2&&groupId1==groupId2},ExploreWindow.prototype.findLevelGroupId=function(levelId){for(var group_key in this.flyweight_groups){if(this.flyweight_groups[group_key].indexOf(levelId)>-1)return group_key}return-1},ExploreWindow.prototype.showGroupPanel=function(groupId){var group_info=this.groups_info[groupId];group_info&&(this.isShowGroup=!0,this.groupInfo=group_info,this.groupPanel=WindowManager_1.default.showWindow(BarrierWindow_1.default,"BarrierWindow","选关界面",group_info))},ExploreWindow.prototype.gotoNextChapter=function(){var chapter_labels=Object.keys(this.map_config),chapter_ind=chapter_labels.indexOf(this.mapIdOfPage.toString());chapter_ind>=chapter_labels.length-1||(++chapter_ind,this.updateView(parseInt(chapter_labels[chapter_ind])))},ExploreWindow.prototype.removeAll=function(){if(this.barrierBtns&&this.barrierBtns.length)for(var i=0;i<this.barrierBtns.length;++i)this.contains(this.barrierBtns[i])&&this.removeChild(this.barrierBtns[i])},ExploreWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),NetManager_1.default.getInstance().removeEventListener(UserInfoProxy_1.default.STORY_UPDATE_STAR,this.storyStarUpdate,this)},ExploreWindow.STATE_OPEN=2,ExploreWindow.STATE_STRIP=1,ExploreWindow.STATE_LOCK=0,ExploreWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ExploreWindow},{"../../base/da/DataAccessManager":2,"../../base/popup/BaseWindow":7,"../../base/popup/WindowManager":13,"../../enums/Protocols":51,"../../manager/ConfigManager":54,"../../manager/SoundManager":58,"../../model/DataAccessEntry":59,"../../model/da/UserInfoProxy":67,"../../model/net/NetManager":68,"../../view/common/Alert":115,"../explore/barrier/BarrierBtn":119,"../mainscene/HUDPanel":143,"../mainscene/MainToolBtn":145,"./barrier/BarrierWindow":121}],119:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BarrierBtn=function(_super){function BarrierBtn(type,barrierName,options){var _this=this;if(void 0===type&&(type=BarrierBtn.STATE_OPEN),_super.call(this),this.type=type,this.barrierName=barrierName,this.options=options||{topic:"基础语法",nowStarCount:0,totalStarCount:0},this.touchChildren=!1,this.touchEnabled=!0,BarrierBtn.STATE_STRIP==this.type){var mcDataFactory=new egret.MovieClipDataFactory(RES.getRes("tollgateBtn_json"),RES.getRes("tollgateBtn_png"));this.barrierShow=new egret.MovieClip(mcDataFactory.generateMovieClipData("tollgate")),this.barrierShow.x=-3,this.barrierShow.y=-87,this.barrierShow.gotoAndPlay(1,-1),this.barrierShow.touchEnabled=!0}else this.barrierShow=new egret.Bitmap;this.addChild(this.barrierShow),this.barrierLabel=new eui.Label,this.barrierLabel.text=this.barrierName&&this.barrierName.toString()||"9",this.barrierLabel.fontFamily="Microsoft YaHei",this.barrierLabel.bold=!0,this.barrierLabel.textColor=16777215,this.barrierLabel.x=34,this.barrierLabel.y=18,this.barrierName&&this.barrierName.toString().length>=2&&(this.barrierLabel.x=25),BarrierBtn.STATE_STRIP==this.type&&(this.barrierLabel.y=25,this.barrierName&&this.barrierName.toString().length>=2?this.barrierLabel.x=25:this.barrierLabel.x=39),this.addChild(this.barrierLabel),BarrierBtn.STATE_OPEN==this.type?RES.getResAsync("explore_json.tanxian7_png",this.completed,this):BarrierBtn.STATE_LOCK==this.type&&RES.getResAsync("explore_json.tanxian7_png",function(data){_this.barrierShow.bitmapData=data,_this.barrierLabel.text="",
RES.getResAsync("explore_json.tollgate_lock_png",function(data){var bmp=new egret.Bitmap;bmp.bitmapData=data,_this.addChild(bmp),bmp.x=28,bmp.y=15},_this)},this),this.knowledgeFrame=new eui.Image,this.knowledgeFrame.texture=RES.getRes("explore_json.tanxian_frame_png"),this.knowledgeFrame.x=-49,this.knowledgeFrame.y=57,this.addChild(this.knowledgeFrame),this.knowledgeLabel=new eui.Label,this.knowledgeLabel.text=this.options.topic,this.knowledgeLabel.x=-36,this.knowledgeLabel.y=70,this.knowledgeLabel.width=170,this.knowledgeLabel.size=18,this.knowledgeLabel.textAlign=egret.HorizontalAlign.CENTER,this.knowledgeLabel.textColor=16777215,this.knowledgeLabel.strokeColor=13433,this.knowledgeLabel.stroke=3,this.addChild(this.knowledgeLabel),BarrierBtn.STATE_STRIP!=this.type&&BarrierBtn.STATE_OPEN!=this.type||(this.starShow=new eui.Image,this.starShow.texture=RES.getRes("explore_json.tanxian_star_png"),this.starShow.x=-75,this.starShow.y=31,this.addChild(this.starShow),this.starLabel=new eui.Label,this.starLabel.text=this.options.nowStarCount+"/"+this.options.totalStarCount,this.starLabel.x=-70,this.starLabel.y=83,this.starLabel.width=50,this.starLabel.textAlign=egret.HorizontalAlign.CENTER,this.starLabel.size=16,this.starLabel.textColor=16776860,this.starLabel.stroke=3,this.starLabel.strokeColor=4992806,this.addChild(this.starLabel))}return __extends(BarrierBtn,_super),BarrierBtn.prototype.completed=function(data){this.barrierShow.bitmapData=data},BarrierBtn.STATE_OPEN=2,BarrierBtn.STATE_STRIP=1,BarrierBtn.STATE_LOCK=0,BarrierBtn}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BarrierBtn},{}],120:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BattleStartLoading_1=require("../../loading/BattleStartLoading"),LayerManager_1=require("../../../manager/LayerManager"),SceneManager_1=require("../../../manager/SceneManager"),BattleScene_1=require("../../battlescene/BattleScene"),WindowManager_1=require("../../../base/popup/WindowManager"),ConfigManager_1=require("../../../manager/ConfigManager"),EquipWindow_1=require("../equipment/EquipWindow"),RewardBar_1=require("../../battleui/battleresult/RewardBar"),RewardSlot_1=require("../../battleui/battleresult/RewardSlot"),Platform_1=require("../../../platforms/Platform"),UIPopupLoading_1=require("../../loading/UIPopupLoading"),Alert_1=require("../../common/Alert"),BarrierCell=function(_super){function BarrierCell(cellData){_super.call(this),this.skinName='<?xml version=\'1.0\' encoding=\'utf-8\'?><e:Skin class="BarrierCellSkin" width="354" height="479" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="barrier_json.barrier_cell_frame_png"/><e:Label text="奖励:" x="60" y="90" width="107" size="24" fontFamily="MicroSoft YaHei UI" textColor="0x00CAFF" strokeColor="0x001D45" stroke="2"/><e:Label id="labelLevelName" text="虎牢关" x="23" y="12" width="310" height="33" bold="true" stroke="2" strokeColor="0x023d8c" textAlign="center" verticalAlign="middle" size="24" fontFamily="Microsoft YaHei"/><e:Image source="barrier_json.barrier_vigor_required_png" x="66" y="281"/><e:Label id="labelVigor" text="-7" x="102" y="285" height="26" size="23" width="76" textAlign="left" verticalAlign="middle" stroke="3" strokeColor="0x001d45"/><e:Image source="common_star_normal_png" x="96" y="334"/><e:Image source="common_star_normal_png" x="156" y="334"/><e:Image source="common_star_normal_png" x="216" y="334"/><e:Button id="btnReFight" skinName="ReFightBtnSkin" verticalCenter="163.5" horizontalCenter="0" name="btnReFight"/><e:Button id="btnFight" y="378" enabled="true" skinName="FightBtnSkin" horizontalCenter="0" name="btnFight"/><e:Label text="体力消耗:" x="60" y="240" width="107" size="24" fontFamily="MicroSoft YaHei UI" textColor="0x00caff" strokeColor="0x001d45" stroke="2"/></e:Skin>',this.cellData=cellData}return __extends(BarrierCell,_super),BarrierCell.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.refreshView(this.cellData)},BarrierCell.prototype.refreshView=function(cellData){this.vSelectedStar=new Array;for(var i=0;i<3;++i)this.vSelectedStar[i]=new eui.Image,this.vSelectedStar[i].x=96+60*i,this.vSelectedStar[i].y=334,this.vSelectedStar[i].source="common_star_selected_png",this.vSelectedStar[i].visible=!1,this.addChild(this.vSelectedStar[i]);this.btnFight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnterBattleHandler,this),this.btnReFight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEnterBattleHandler,this);var raw_data=cellData||this.cellData;raw_data.name&&(this.labelLevelName.text=raw_data.name),raw_data.required_energy&&(this.labelVigor.text=raw_data.required_energy),this.rewardBar=new RewardBar_1.default;var reward={};switch(["star1_reward","star2_reward","star3_reward"].forEach(function(key){raw_data[key].split("|").forEach(function(rewardId,index){if(reward[rewardId])reward[rewardId].reward_num+=parseInt(raw_data[key+"_num"].split("|")[index]);else{reward[rewardId]={reward_num:0,reward_icon:""};var rewardContent=ConfigManager_1.default.getInstance().getConfig("equip",rewardId);if(rewardContent&&(reward[rewardId].reward_icon="resource/icon/equip/"+rewardContent.icon+".png",reward[rewardId].reward_num=parseInt(raw_data[key+"_num"].split("|")[index])),!rewardContent){if(!(rewardContent=ConfigManager_1.default.getInstance().getConfig("hero",rewardId)))return;reward[rewardId].reward_icon="resource/icon/role/career_head/"+rewardContent.career_head+"_s.png",reward[rewardId].reward_num=parseInt(raw_data[key+"_num"].split("|")[index])}}},this)},this),Object.keys(reward).forEach(function(reward_key){var _this=this;RES.getResByUrl(reward[reward_key].reward_icon,function(data,url){_this.rewardBar.addAwardSlot(new RewardSlot_1.default(data,reward[reward_key].reward_num,"small"),"normal",10)},this)},this),this.addChild(this.rewardBar),this.rewardBar.y=130,Object.keys(reward).length){case 1:this.rewardBar.x=153;break;case 2:this.rewardBar.x=87;break;case 3:this.rewardBar.x=83;break;case 4:this.rewardBar.x=49;break;default:this.rewardBar.x=73}this.btnFight.visible=!1,this.btnReFight.visible=!1,BarrierCell.STATE_OPEN==raw_data.state_locked?this.btnReFight.visible=!0:BarrierCell.STATE_LOCK==raw_data.state_locked?(this.btnFight.visible=!0,this.btnFight.enabled=!1):this.btnFight.visible=!0,this.updateCellStar(raw_data)},BarrierCell.prototype.updateCellStar=function(cellData){for(var star_num=cellData.star_level,i=0;i<3;++i)this.vSelectedStar[i].visible=i<star_num},BarrierCell.prototype.updateCellStarLevel=function(star_num){for(var i=0;i<star_num;++i)this.vSelectedStar[i].visible=i<star_num},BarrierCell.prototype.onEnterBattleHandler=function(e){var platform=Platform_1.default.currentPlatform;if(1==platform.classLockInfo.state&&platform.classLockInfo.classId==platform.classId&&"teacher"!=platform.idType&&parseInt(this.cellData.levelID)>=platform.classLockInfo.lockLvl)return void Alert_1.default.show("提示","本班级的进度暂时被老师锁定，请认真学习之前关卡！",2);var that=this;that.btnFight.$setEnabled(!1),that.btnReFight.$setEnabled(!1),TweenLite.delayedCall(10,function(){that.btnFight.$setEnabled(!0),that.btnReFight.$setEnabled(!0)}),LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this),UIPopupLoading_1.default.startPopupLoading(["equip"])},BarrierCell.prototype.onEnterPopup=function(e){LayerManager_1.default.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this),WindowManager_1.default.showWindow(EquipWindow_1.default,"EquipWindow","装备界面",this.cellData)},BarrierCell.prototype.onEnterBattle=function(e){var loadView=e.currentTarget;loadView.removeEventListener(BattleStartLoading_1.default.BATTLE_RES_LOAD_COMPLETE,this.onEnterBattle,this),LayerManager_1.default.stage.removeChild(loadView),WindowManager_1.default.closeAllWindow(!0),SceneManager_1.default.getInstance().pushScene(new BattleScene_1.default,this.cellData)},BarrierCell.STATE_OPEN=2,BarrierCell.STATE_STRIP=1,BarrierCell.STATE_LOCK=0,BarrierCell}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BarrierCell},{"../../../base/popup/WindowManager":13,"../../../manager/ConfigManager":54,"../../../manager/LayerManager":55,"../../../manager/SceneManager":57,"../../../platforms/Platform":81,"../../battlescene/BattleScene":88,"../../battleui/battleresult/RewardBar":109,"../../battleui/battleresult/RewardSlot":110,"../../common/Alert":115,"../../loading/BattleStartLoading":136,"../../loading/UIPopupLoading":139,"../equipment/EquipWindow":128}],121:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),BarrierCell_1=require("./BarrierCell"),FrameTweenLite_1=require("../../../base/utils/FrameTweenLite"),BarrierWindow=function(_super){function BarrierWindow(name){_super.call(this),this.skinName='<?xml version=\'1.0\' encoding=\'utf-8\'?><e:Skin class="BarrierWindowSKin" width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="barrier_json.barrier_knowledge_frame_png" x="0" y="266"/><e:Image source="barrier_json.barrier_knowledge_png" x="64" y="272"/><e:Label id="knowledgePoints" text="基本语法" x="225" y="272" width="559" height="81" size="28" fontFamily="Microsoft YaHei UI" bold="true" verticalAlign="middle"/><e:Image source="barrier_json.barrier_cell_frame_png" x="64" y="405" locked="true" visible="false"/><e:Button id="btnPrev" skinName="ExplorePageUpBtnSkin" verticalCenter="0"/><e:Button id="btnNext" skinName="ExplorePageDownBtnSkin" verticalCenter="0" x="1859"/><e:Button id="btnClose" skinName="CommonReturnBtnSkin" x="1804" y="9"/><e:Image source="barrier_json.barrier_cell_frame_png" x="446" y="403" locked="true" visible="false"/><e:Image source="barrier_json.barrier_frame_name_map_png" x="127" y="193" scale9Grid="27,18,102,32"/><e:Label id="labGroupName" text="怒斩天下" x="75" y="214" width="266" height="29" textAlign="center" size="28" fontFamily="Microsoft YaHei UI" strokeColor="0x0040c3" stroke="2"/></e:Skin>'}return __extends(BarrierWindow,_super),BarrierWindow.prototype.updateView=function(){_super.prototype.updateView.call(this),this.barrierIndex=0,this.barrierList=new Array,this.labGroupName.text=this.data.name,this.knowledgePoints.text=this.data.topic;var levels=this.data.levels;Object.keys(levels).forEach(function(level_key){var barrierCell=new BarrierCell_1.default(levels[level_key]);this.barrierList.push(barrierCell)},this),this.refreshView(!0),this.btnPrev.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnPrevTouchHandler,this),this.btnNext.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnNextTouchHandler,this)},BarrierWindow.prototype.refreshView=function(animation,levelsInfo){this.removeCells();for(var currLevelArrawPos=[],listLen=this.barrierList.length,i=this.barrierIndex;i<listLen&&i<this.barrierIndex+BarrierWindow.MAXBARRIERCELLNUM;++i){var barrierCell=this.barrierList[i],newX=BarrierWindow.BARRIERCELL_POS[0]+(i-this.barrierIndex)*BarrierWindow.BARRIERCELL_POS[2];barrierCell.y=BarrierWindow.BARRIERCELL_POS[1],this.addChild(barrierCell),animation?(barrierCell.x=newX,FrameTweenLite_1.default.to(barrierCell,.2,{delay:.1*i,x:newX})):barrierCell.x=newX+50,barrierCell.cellData&&BarrierCell_1.default.STATE_STRIP==barrierCell.cellData.state_locked&&(currLevelArrawPos=[barrierCell.x,barrierCell.y])}currLevelArrawPos.length>0&&(this.barrier_arrow||(this.barrier_arrow=new eui.Image,this.barrier_arrow.source=RES.getRes("barrier_json.barrier_arrow_png")),this.barrier_arrow.visible=!0,this.barrier_arrow.x=currLevelArrawPos[0]+115,this.barrier_arrow.y=currLevelArrawPos[1]+460,this.addChild(this.barrier_arrow),egret.Tween.get(this.barrier_arrow,{loop:!0}).to({y:currLevelArrawPos[1]+410},500).to({y:currLevelArrawPos[1]+460},450)),this.btnPrev.visible=this.btnNext.visible=!1,this.barrierIndex>0&&(this.btnPrev.visible=!0),this.barrierIndex<this.barrierList.length-BarrierWindow.MAXBARRIERCELLNUM&&(this.btnNext.visible=!0)},BarrierWindow.prototype.updateCellStarInfo=function(groupInfo){var levels=groupInfo.levels||this.data.levels,index=0;Object.keys(levels).forEach(function(level_key){this.barrierList[index++].updateCellStar(levels[level_key])},this)},BarrierWindow.prototype.removeCells=function(){var listLen=this.barrierList.length;if(this.barrierList&&listLen)for(var i=0;i<listLen;++i)this.contains(this.barrierList[i])&&this.removeChild(this.barrierList[i])},BarrierWindow.prototype.btnPrevTouchHandler=function(e){this.barrierIndex<=0||(--this.barrierIndex,this.refreshView(!1))},BarrierWindow.prototype.btnNextTouchHandler=function(e){this.barrierIndex>=this.barrierList.length-BarrierWindow.MAXBARRIERCELLNUM||(++this.barrierIndex,this.refreshView(!1))},BarrierWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.barrier_arrow&&egret.Tween.removeTweens(this.barrier_arrow),this.btnPrev.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnPrevTouchHandler,this),this.btnNext.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btnNextTouchHandler,this)},BarrierWindow.MAXBARRIERCELLNUM=5,BarrierWindow.BARRIERCELL_POS=[33,400,370],BarrierWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BarrierWindow},{"../../../base/popup/BaseWindow":7,"../../../base/utils/FrameTweenLite":18,"./BarrierCell":120}],122:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},WindowManager_1=require("../../../base/popup/WindowManager"),EquipTipWindow_1=require("./EquipTipWindow"),NetManager_1=require("../../../model/net/NetManager"),EquipWindow_1=require("./EquipWindow"),ToastManager_1=require("../../common/ToastManager"),Protocols_1=require("../../../enums/Protocols"),EquipCard=function(_super){function EquipCard(cardSuite){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="EquipCardSkin" width="214" height="278" xmlns:e="http://ns.egret.com/eui"><e:Image id="equipQualityImg" source="common_utils_json.card_blue_png" y="0" x="0"/><e:Image id="equipIconImg" source="element_gem_png" x="48" y="79"/><e:Label id="equipNameLabel" text="红宝石" x="0" y="224" fontFamily="MicroSoft YaHei UI" size="22" bold="true" strokeColor="0x3a3a3b" stroke="3" width="208" height="29" textAlign="center"/><e:Image id="heroCareer" source="common_utils_json.career_warrior_icon_png" x="18" y="11"/><e:Component id="infoBtn" skinName="EquipTipInfoBtnSkin" x="150" y="13"/></e:Skin>',this.name="EquipCard",this.cardSuite=cardSuite,this.ID=cardSuite.ID,this.type=cardSuite.type,this.heroClass=cardSuite.heroClass,this.isOwned=cardSuite.isOwned,this.isOwned&&(this.uuid=cardSuite.uuid,this.userId=cardSuite.userId),this.isRestricted=cardSuite.isRestricted,this.isEquiped=cardSuite.isEquiped,this.equipQualityImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.equipIconImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.equipNameLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.heroCareer.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.infoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchInfoBtnHandler,this)}return __extends(EquipCard,_super),EquipCard.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.updateView()},EquipCard.prototype.onTouchHandler=function(e){if(!this.isOwned){var strTip="<font color='#ff9900' size='31'>未装备上,该装备待收集</font>";return void ToastManager_1.default.showTip(strTip)}if(this.isRestricted){var strTip="<font color='#ff9900' size='31'>该装备不能用于当前英雄</font>";return void ToastManager_1.default.showTip(strTip)}this.RequestOperate()},EquipCard.prototype.RequestOperate=function(){var type=this.type;if(-1!=EquipWindow_1.default.SPECIFIC_TYPES.indexOf(this.type)){type=WindowManager_1.default.getWindowByName("EquipWindow").getSlotPosForSpecialCard(this)}var equipWin=WindowManager_1.default.getWindowByName("EquipWindow"),heroId=equipWin.heroInfo.uuid;NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_USEITEM,{hid:heroId,id:this.uuid,seat:type})},EquipCard.prototype.onTouchInfoBtnHandler=function(e){this.cardSuite&&WindowManager_1.default.showWindow(EquipTipWindow_1.default,"EquipTipWindow","装备提示界面",this.cardSuite)},EquipCard.prototype.setEquiped=function(isEquiped){this.isEquiped=isEquiped,this.cardSuite.isEquiped=isEquiped},EquipCard.prototype.setRestricted=function(isRestricted){this.isRestricted=isRestricted,this.cardSuite.isRestricted=isRestricted,this.restrictedImg||(this.restrictedImg=new eui.Image,this.restrictedImg.source=RES.getRes("common_utils_json.card_icon_limit_png")),this.restrictedImg.x=79,this.restrictedImg.y=101,this.restrictedImg.visible=isRestricted,isRestricted?(this.restrictedImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.addChild(this.restrictedImg)):this.restrictedImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this)},EquipCard.prototype.updateView=function(){this.equipQualityImg.source=RES.getRes("card_"+EquipCard.RANGECOLOR[(this.cardSuite.rarity||1)-1]+"_png"),this.equipIconImg.source="resource/icon/equip/"+this.cardSuite.iconSrc.toLowerCase()+".png",this.equipNameLabel.text=this.cardSuite.name,this.isRestricted&&this.setRestricted(this.isRestricted),this.isOwned&&!this.isRestricted||(this.equipQualityImg.source=RES.getRes("card_dis_png"),this.equipIconImg.source="resource/icon/disequip/"+this.cardSuite.iconSrc.toLowerCase()+".png"),this.heroCareer.source=RES.getRes("common_utils_json.career_"+EquipCard.HEROCAREER[this.heroClass-1]+"_icon_png")},EquipCard.prototype.showEquipTipInShortTime=function(){this.tipImage=new eui.Image,this.tipImage.source=RES.getRes("equip_json.equip_prompt_png"),this.tipImage.visible=!0,this.addChild(this.tipImage),this.tipImage.x=27,this.tipImage.y=110,this.tipImage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.tipImage.alpha=1,egret.Tween.removeTweens(this.tipImage),egret.Tween.get(this.tipImage).to({alpha:0},1500).wait(500).to({alpha:1}).to({alpha:0},1500).wait(500).to({alpha:1}).to({alpha:0},1500).wait(500).call(function(){this.contains(this.tipImage)&&this.removeChild(this.tipImage),this.tipImage&&egret.Tween.removeTweens(this.tipImage)},this)},EquipCard.prototype.dispose=function(){this.equipQualityImg=null,this.equipIconImg=null,this.equipNameLabel=null,this.cardSuite=null,this.tipImage&&(egret.Tween.removeTweens(this.tipImage),this.tipImage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchInfoBtnHandler,this)),this.equipQualityImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.equipIconImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.equipNameLabel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.heroCareer.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.restrictedImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.infoBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchInfoBtnHandler,this)},EquipCard.RANGECOLOR=["white","green","purple","orange","golden"],EquipCard.HEROCAREER=["all","warrior","mage","gunman","assassin"],EquipCard}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EquipCard},{"../../../base/popup/WindowManager":13,"../../../enums/Protocols":51,"../../../model/net/NetManager":68,"../../common/ToastManager":117,"./EquipTipWindow":127,"./EquipWindow":128}],123:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},CommonConfig_1=require("../../../enums/CommonConfig"),NetManager_1=require("../../../model/net/NetManager"),WindowManager_1=require("../../../base/popup/WindowManager"),SoundManager_1=require("../../../manager/SoundManager"),Protocols_1=require("../../../enums/Protocols"),EquipSlot=function(_super){function EquipSlot(slotType,allowTypes){void 0===slotType&&(slotType=CommonConfig_1.default.EQUIP_PRIMARY_ATTACK),_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="EquipSlotSkin" width="147" height="138" currentState="down" xmlns:e="http://ns.egret.com/eui" ><e:Image source="equip_json.equip_iconbox_normal_png" /><e:Image id="imgSelected" source="equip_json.equip_iconbox_selected_png" x="-10" y="-10" scaleX="1" scaleY="1"/><e:Image id="imgIcon" source="common_utils_json.equip_icon_1_png" horizontalCenter="0" verticalCenter="0"/></e:Skin>',this.slotType=slotType,this.slotSuite=null,this.allowTypes=new Array,allowTypes&&allowTypes.length&&(this.allowTypes=allowTypes)}return __extends(EquipSlot,_super),EquipSlot.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.imgSelected.visible=!1,this.imgIcon.source="common_utils_json.equip_icon_"+this.slotType+"_png",this.updateView(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseRollOverHandler,this),this.addEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseRollOutHandler,this)},EquipSlot.prototype.setSlotSuite=function(slotSuite){slotSuite&&this.allowTypes&&this.allowTypes.length&&-1==this.allowTypes.indexOf(slotSuite.type)||(this.slotSuite=slotSuite,this.cardType=slotSuite?slotSuite.type:0,this.slotSuite&&this.slotSuite.uuid&&(this.uniqueId=this.slotSuite.uuid),this.updateView())},EquipSlot.prototype.updateView=function(){this.slotSuite?this.imgIcon.source="resource/icon/equip/"+this.slotSuite.iconSrc.toLowerCase()+".png":this.imgIcon.source=RES.getRes("common_utils_json.equip_icon_"+this.slotType+"_png")},EquipSlot.prototype.onTouchHandler=function(e){if(SoundManager_1.default.getInstance().playEffect("u01_button_mp3"),null!=this.slotSuite){var equipWin=WindowManager_1.default.getWindowByName("EquipWindow"),heroId=equipWin.heroInfo.uuid;NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_USEITEM,{hid:heroId,id:this.slotSuite.uuid,seat:0})}},EquipSlot.prototype.onMouseRollOverHandler=function(e){this.imgSelected.visible=!0},EquipSlot.prototype.onMouseRollOutHandler=function(e){this.imgSelected.visible=!1},EquipSlot.prototype.isSelected=function(bIsSelected){this.imgSelected.visible=bIsSelected},EquipSlot.prototype.dispose=function(){this.slotSuite=null,this.removeEventListener(egret.TouchEvent.TOUCH_ROLL_OVER,this.onMouseRollOverHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_ROLL_OUT,this.onMouseRollOutHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchHandler,this),this.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseRollOverHandler,this),this.removeEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseRollOutHandler,this)},EquipSlot}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EquipSlot},{"../../../base/popup/WindowManager":13,"../../../enums/CommonConfig":45,"../../../enums/Protocols":51,"../../../manager/SoundManager":58,"../../../model/net/NetManager":68}],124:[function(require,module,exports){"use strict";var EquipSuite=function(){function EquipSuite(equipData,equipInfo){void 0===equipData&&(equipData=null),void 0===equipInfo&&(equipInfo=null),equipData?(this.ID=parseInt(equipData.ID),this.name=equipData.name,this.type=parseInt(equipData.type),this.attackDamage=parseInt(equipData.atkdamage),this.rarity=equipData.rarity,this.skill=equipData.skill,this.speed=parseInt(equipData.speed),this.health=parseInt(equipData.hp),this.heroClass=equipData.heroclass,this.viewrange=equipData.viewrange,this.isThroughWalls=equipData.isThroughwalls,this.iconSrc=equipData.icon,this.des=equipData.description,this.isOwned=!1):equipInfo&&(this.ID=equipInfo.modelID,this.name=equipInfo.data.name,this.type=parseInt(equipInfo.data.type),this.attackDamage=parseInt(equipInfo.data.atkdamage),this.rarity=equipInfo.data.rarity,this.skill=equipInfo.data.skill,this.speed=parseInt(equipInfo.data.speed),this.health=parseInt(equipInfo.data.hp),this.heroClass=equipInfo.data.heroclass,this.viewrange=equipInfo.data.viewrange,this.isThroughWalls=equipInfo.data.isThroughwalls,this.iconSrc=equipInfo.data.icon,this.des=equipInfo.data.description,this.isOwned=!0,this.uuid=equipInfo.uuid,this.userId=equipInfo.userId)}return EquipSuite}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EquipSuite},{}],125:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},EquipTipSelfDesc=function(_super){function EquipTipSelfDesc(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="EquipTipSelfDescSkin" width="400" height="55" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image id="propertyIcon"/><e:Label id="propertyDesc1" text="范围伤害" x="104" y="17" width="152" size="22" fontFamily="Microsoft YaHei UI"/><e:Label id="propertyDesc2" text="140" x="256" y="18" width="144" bold="true" size="22" fontFamily="Microsoft YaHei UI" textColor="0xc613b2"/><e:Image source="equip_tips_json.equip_tips_info_icon_png" x="29" y="-8"/></e:Skin>'}return __extends(EquipTipSelfDesc,_super),EquipTipSelfDesc.prototype.refreshView=function(desc1,desc2){this.propertyDesc1.text=desc1,this.propertyDesc2.text=desc2},EquipTipSelfDesc}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EquipTipSelfDesc},{}],126:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Globals_1=require("../../../enums/Globals"),EquipTipSkillDesc=function(_super){function EquipTipSkillDesc(prop){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="EquipTipSkillDescSkin" width="400" height="140" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="battle_scene_json.palette_icon_bg_png" x="10" y="19"/><e:Image id="skillPropertyIcon" x="30" y="40"/><e:Label id="skillPropertyName" text="雷霆闪电" x="141" y="19" width="264" height="33" scaleX="1" scaleY="1" size="28" fontFamily="Microsoft YaHei UI" strokeColor="0x003479" stroke="3"/><e:Label id="skillPropertyAdd" text="技能加成" x="125" y="46" width="155" size="22" fontFamily="Microsoft YaHei UI" visible="false" locked="true"/><e:Label id="skillPropertyAddValue" text="20%" x="230" y="47" width="107" size="22" fontFamily="Microsoft YaHei UI" textColor="0x00bf0d" visible="false" locked="true"/><e:Label id="skillPropertyDesc" text="一大片伤害" x="145" y="70" width="255" height="60" size="22"/></e:Skin>',this.prop=prop}return __extends(EquipTipSkillDesc,_super),EquipTipSkillDesc.prototype.chilrenCreated=function(){_super.prototype.childrenCreated.call(this)},EquipTipSkillDesc.prototype.refreshView=function(prop){this.prop=prop,this.skillPropertyIcon.source=prop.icon,this.skillPropertyName.text=prop.name,this.skillPropertyAddValue.text=prop.skillPropertyAdd,this.skillPropertyDesc.text=prop.short_description,this.onMouseOut.bind(this),this.onMouseOver.bind(this),this.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this,!0),this.addEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this,!0)},EquipTipSkillDesc.prototype.onMouseOver=function(e){var skillDescTip=$("#codeTipData");skillDescTip.html(this.prop.initialHTML);var self=this,wstr=skillDescTip.css("width"),hstr=skillDescTip.css("height"),tipWidth=parseFloat(wstr.substr(0,wstr.length-2)),tipHeight=parseFloat(hstr.substr(0,hstr.length-2)),globalPos=self.parent.localToGlobal(self.x,self.y),dw=.5*(window.innerWidth-Globals_1.default.domGameWidth),dh=.5*(window.innerHeight-Globals_1.default.domGameHeight),rx=Globals_1.default.scaleRatio*globalPos.x,ry=Globals_1.default.scaleRatio*globalPos.y;skillDescTip.css("left",dw+rx+self.width*Globals_1.default.scaleRatio*.5-tipWidth-10),skillDescTip.css("top",dh+ry-tipHeight-25),skillDescTip.removeClass("hidden")},EquipTipSkillDesc.prototype.onMouseOut=function(e){$("#codeTipData").addClass("hidden")},EquipTipSkillDesc.prototype.convertLocalToGlobal=function(lx,ly){return lx+=1070,ly+=270,{x:lx,y:ly}},EquipTipSkillDesc.prototype.dispose=function(){this.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this,!0),this.removeEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this,!0)},EquipTipSkillDesc}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EquipTipSkillDesc},{"../../../enums/Globals":46}],127:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),EquipCard_1=require("../equipment/EquipCard"),ConfigManager_1=require("../../../manager/ConfigManager"),WindowManager_1=require("../../../base/popup/WindowManager"),EquipTipSelfDesc_1=require("../equipment/EquipTipSelfDesc"),EquipTipSkillDesc_1=require("../equipment/EquipTipSkillDesc"),MouseScroller_1=require("../../common/MouseScroller"),EquipTipWindow=function(_super){function EquipTipWindow(){_super.call(this),
this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="EquipTipWindowSkin" width="828" height="670" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="equip_tips_frame_png"/><e:Image id="equipQualityImg" source="common_utils_json.card_white_png" x="86" y="75"/><e:Image source="equip_tips_info_describe_png" x="399" y="57"/><e:Image id="heroCareer" source="common_utils_json.career_warrior_icon_png" x="104" y="85"/><e:Label id="equipNameLabel" text="红宝石" x="86" y="310" width="215" verticalAlign="middle" textAlign="center" size="22" textColor="0xffffff" fontFamily="MicroSoft YaHei UI" strokeColor="0x3a3a3b" stroke="3"/><e:Image source="equip_tips_info_frame_png" x="74" y="375" scaleX="1" scaleY="1"/><e:Image id="equipIconImg" x="134" y="154"/><e:Image source="equip_tips_info_rarity_png" x="103" y="390"/><e:Label id="tipRange" text="普通" x="222" y="393" width="159" size="24" textColor="0xFFFE9C" bold="true" fontFamily="MicroSoft YaHei UI" strokeColor="0x4c2f26" stroke="3" scaleX="1" scaleY="1"/><e:Image source="equip_tips_info_career_png" x="103" y="449"/><e:Label id="tipHeroClass" text="战士" x="222" y="450" width="159" size="24" textColor="0xFFFE9C" bold="true" fontFamily="MicroSoft YaHei UI" strokeColor="0x4C2F26" stroke="3" scaleX="1" scaleY="1"/><e:Image source="equip_tips_info_type_png" x="102" y="503"/><e:Label id="tipType" text="主手" x="222" y="503" width="159" size="24" textColor="0xFFFE9C" bold="true" fontFamily="MicroSoft YaHei UI" strokeColor="0x4C2F26" stroke="3" scaleX="1" scaleY="1"/><e:Button id="equipBtn" skinName="EquipTipEquipBtnSkin" x="108" y="560"/><e:Button id="unloadBtn" skinName="EquipTipUnloadBtnSkin" x="108" y="559"/><e:Scroller id="descScroller" skinName="skins.ScrollerSkin" x="386" y="89" width="395" height="521"><e:Group id="descGroup" width="395" height="521"><e:Label id="txtEquipDesc" text="装备描述" width="338" height="143" size="22" fontFamily="MicroSoft YaHei UI" bold="true" multiline="true" textColor="0xffffff" x="26" y="17" lineSpacing="11"/><e:Image id="tipSplitLine1" source="equip_tips_line_png" visible="false"/><e:Image id="tipSplitLine2" source="equip_tips_line_png" visible="false"/></e:Group></e:Scroller><e:Button id="btnClose" skinName="WindowCloseBtnSkin" x="749" y="13"/></e:Skin>',this.actionBoxObj={item:{},props:[],short:""}}return __extends(EquipTipWindow,_super),EquipTipWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.descScroller.scrollPolicyH="off",MouseScroller_1.default.enableMouseScroller(this.descScroller)},EquipTipWindow.prototype.updateView=function(){this.tipRange.text=EquipTipWindow.RANGENAME[this.data.rarity-1],this.tipHeroClass.text=EquipTipWindow.HEROCAREER[this.data.heroClass-1],this.tipType.text=EquipTipWindow.EQUIPTYPENAME[this.data.type-1],this.equipQualityImg.source=RES.getRes("card_"+EquipCard_1.default.RANGECOLOR[(this.data.rarity||1)-1]+"_png"),this.equipIconImg.source="resource/icon/equip/"+this.data.iconSrc.toLowerCase()+".png",this.equipNameLabel.text=this.data.name,this.data.isEquiped?(this.equipBtn.visible=!1,this.unloadBtn.visible=!0):this.data.isOwned?(this.equipBtn.visible=!0,this.unloadBtn.visible=!1):this.equipBtn.visible=this.unloadBtn.visible=!1,this.heroCareer.source=RES.getRes("common_utils_json.career_"+EquipCard_1.default.HEROCAREER[parseInt(this.data.heroClass)-1]+"_icon_png");var descLines=this.data.des.split(/\\n/),lineNum=0;descLines.forEach(function(line){lineNum+=1+(line.length/15|0)},this),this.txtEquipDesc.text=this.data.des.split(/\\n/).join("\n"),this.skillConfig=ConfigManager_1.default.getInstance().getConfigs("skill"),this.yPos=33*lineNum|0,this.txtEquipDesc.height=this.yPos+7,this.tipSplitLine1.visible=!0,this.tipSplitLine1.y=this.yPos,this.yPos+=40,this.updateSelfDesc(),this.yPos+=40,this.updateSkillDesc(),this.showSkillDesc(),this.equipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onEquipBtnTouchHandler,this),this.unloadBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUnloadBtnTouchHandler,this)},EquipTipWindow.prototype.updateSelfDesc=function(){var descCell,selfDescMark=!1;this.data.health&&!isNaN(this.data.health)&&this.data.health>0&&(selfDescMark=!0,descCell=new EquipTipSelfDesc_1.default,descCell.refreshView("增加生命值","+"+this.data.health),descCell.y=this.yPos,this.descGroup.addChild(descCell),this.yPos+=40),this.data.attackDamage&&!isNaN(this.data.attackDamage)&&this.data.attackDamage>0&&(selfDescMark=!0,descCell=new EquipTipSelfDesc_1.default,descCell.refreshView("增加攻击伤害","+"+this.data.attackDamage),descCell.y=this.yPos,this.descGroup.addChild(descCell),this.yPos+=40),this.data.speed&&!isNaN(this.data.speed)&&this.data.speed>0&&(selfDescMark=!0,descCell=new EquipTipSelfDesc_1.default,descCell.refreshView("增加移动速度","+"+this.data.speed),descCell.y=this.yPos,this.descGroup.addChild(descCell),this.yPos+=40),this.data.viewrange&&!isNaN(this.data.viewrange)&&this.data.viewrange>0&&(selfDescMark=!0,descCell=new EquipTipSelfDesc_1.default,descCell.refreshView("增加可视范围","+"+this.data.viewrange),descCell.y=this.yPos,this.descGroup.addChild(descCell),this.yPos+=40),this.tipSplitLine2.visible=!1,1==selfDescMark&&(this.tipSplitLine2.visible=!0,this.tipSplitLine2.y=this.yPos)},EquipTipWindow.prototype.updateSkillDesc=function(){var _this=this;this.data.ID;this.actionBoxObj.item.name=this.data.name,this.actionBoxObj.item.imageURL="resource/icon/equip/"+this.data.iconSrc+".png",this.data.skill.split("|").forEach(function(skillId){var skillData=ConfigManager_1.default.getInstance().getConfig("skill",parseInt(skillId));if(skillData){var prop={shortName:skillData.fullname,short_name:skillData.shortname,name:skillData.type,short_description:skillData.description,short_example:skillData.example,snippets:{},icon:"resource/icon/action/"+skillData.icon+"_normal.png",type:"function",owner:"hero"};RES.getResAsync("SimplePaletteTip_tpl",function(tpl,key){var initialHTML=_.template(tpl)({doc:prop,marked:marked,docName:"docName",selectedMethod:null,language:"python",writable:!1,argumentExamples:["a","b"]});prop.initialHTML=initialHTML},_this),_this.actionBoxObj.props.push(prop)}},this)},EquipTipWindow.prototype.showSkillDesc=function(){this.actionBoxObj.props.forEach(function(prop){var skillDesc=new EquipTipSkillDesc_1.default(prop);skillDesc.refreshView(prop),this.descGroup.addChild(skillDesc),skillDesc.y=this.yPos,this.yPos+=143},this)},EquipTipWindow.prototype.onEquipBtnTouchHandler=function(e){var equip_win=WindowManager_1.default.getWindowByName("EquipWindow"),equipCard=equip_win.getEquipCardByUniqueId(this.data.uuid,equip_win.equipCards.own);equipCard&&(equipCard.RequestOperate(),WindowManager_1.default.closeWindow("EquipTipWindow"))},EquipTipWindow.prototype.onUnloadBtnTouchHandler=function(e){},EquipTipWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.equipBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onEquipBtnTouchHandler,this),this.unloadBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUnloadBtnTouchHandler,this)},EquipTipWindow.RANGECOLOR=["white","green","purple","orange","golden"],EquipTipWindow.RANGENAME=["普通","优秀","精良","史诗","传奇"],EquipTipWindow.HEROCAREER=["通用","战士","法师","枪手","密探","钢铁战士"],EquipTipWindow.EQUIPTYPENAME=["主手","副手","护甲","芯片","罗盘","晶石次元","晶石预言","晶石塑能"],EquipTipWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EquipTipWindow},{"../../../base/popup/BaseWindow":7,"../../../base/popup/WindowManager":13,"../../../manager/ConfigManager":54,"../../common/MouseScroller":116,"../equipment/EquipCard":122,"../equipment/EquipTipSelfDesc":125,"../equipment/EquipTipSkillDesc":126}],128:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),DataAccessManager_1=require("../../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../../model/DataAccessEntry"),ConfigManager_1=require("../../../manager/ConfigManager"),EquipCard_1=require("./EquipCard"),EquipSlot_1=require("./EquipSlot"),EquipSuite_1=require("./EquipSuite"),CommonConfig_1=require("../../../enums/CommonConfig"),NetManager_1=require("../../../model/net/NetManager"),UserInfoProxy_1=require("../../../model/da/UserInfoProxy"),BattleStartLoading_1=require("../../loading/BattleStartLoading"),SoundManager_1=require("../../../manager/SoundManager"),ToastManager_1=require("../../../view/common/ToastManager"),MouseScroller_1=require("../../common/MouseScroller"),EquipWindow=function(_super){function EquipWindow(){_super.call(this),this.yPos=0,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="EquipWindowSkin" width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><w:Config id="1592a85ede0"/><e:Image source="equip_bg_png" locked="true"/><e:Image source="equip_json.equip_card_frame_png" x="63" y="51" locked="true"/><e:Image source="equip_json.equip_master_png" y="903" locked="true"/><e:Component id="equipTab0" skinName="EquipTabAllSkin" x="69" y="53"/><e:Component id="equipTab1" skinName="EquipTabPrimaryAttackSkin" x="232" y="53"/><e:Component id="equipTab2" skinName="EquipTabAssistantAttackSkin" x="396" y="53"/><e:Component id="equipTab3" skinName="EquipTabArmorSkin" x="559" y="53"/><e:Component id="equipTab4" skinName="EquipTabMicroChipSkin" x="722" y="53"/><e:Component id="equipTab5" skinName="EquipTabCompassSkin" x="885" y="53"/><e:Component id="equipTab6" skinName="EquipTabBariteType1Skin" x="1049" y="53"/><e:Component id="equipTab7" skinName="EquipTabBariteType2Skin" x="1212" y="53"/><e:Component id="equipTab8" skinName="EquipTabBariteType3Skin" x="1375" y="53"/><e:Image id="heroProfileImg" x="1539"/><e:Scroller id="equipScroller" skinName="skins.ScrollerSkin" x="67" y="101" width="1470" height="757"><e:Group id="equipGroup" x="2" y="10" width="1470" height="757" locked="true"><e:Image id="ownCutoffLineImg" source="equip_json.equip_card_frame_master_png" x="2" locked="true"/><e:Image id="notownCutoffLineImg" source="equip_json.equip_card_frame_master_png" x="2" y="410" locked="true"/><e:Image id="ownFrameImg" source="equip_json.equip_card_master_png" x="18" y="75"/><e:Image id="notownFrameImg" source="equip_json.equip_card_master_png" x="18" y="432"/><e:Image id="ownSignImg" source="equip_json.equip_card_label_have_png" x="34" y="108"/><e:Image id="notownSignImg" source="equip_json.equip_card_label_nothave_png" x="34" y="465"/><e:Image id="ownPrompt" source="equip_json.equip_card_lable_have_prompt_png" x="397" y="151"/><e:Image id="notownPrompt" source="equip_json.equip_card_lable_nothave_prompt_png" x="397" y="521"/></e:Group></e:Scroller><e:Image source="equip_json.equip_info_frame_png" x="1619" y="541"/><e:Label text="生命值" x="1702" y="546" width="172" height="59" textAlign="left" verticalAlign="middle" fontFamily="Microsoft Yahei UI" size="28" strokeColor="0x003479" stroke="3" bold="true"/><e:Label text="攻    击" x="1702" y="637" width="172" height="59" verticalAlign="middle" size="28" fontFamily="Microsoft Yahei UI" bold="true" strokeColor="0x003479" stroke="3"/><e:Label text="速    度" x="1702" y="731" width="172" height="59" textAlign="left" verticalAlign="middle" fontFamily="Microsoft Yahei UI" bold="true" strokeColor="0x003479" stroke="3"/><e:Label text="视    野" x="1702" y="827" width="172" height="59" textAlign="left" verticalAlign="middle" fontFamily="Microsoft Yahei UI" bold="true" strokeColor="0x003479" stroke="3"/><e:Label id="healthValue" text="1991" x="1662" y="596" width="172" height="32" textAlign="center" textColor="0xfffe9c" strokeColor="0x4c2f26" stroke="3" size="28" fontFamily="MicroSoft YaHei UI" verticalAlign="middle"/><e:Label id="damageValue" text="872"  x="1662" y="691" width="172" height="36" textAlign="center" textColor="0xfffe9c" strokeColor="0x4c2f26" stroke="3" size="28" fontFamily="MicroSoft YaHei UI" verticalAlign="middle"/><e:Label id="speedValue"  text="211"  x="1662" y="784" width="172" height="36" textAlign="center" textColor="0xfffe9c" strokeColor="0x4c2f26" stroke="3" size="28" fontFamily="MicroSoft YaHei UI" verticalAlign="middle"/><e:Label id="viewValue"   text="985"  x="1662" y="877" width="172" height="36" textAlign="center" textColor="0xFFFE9C" strokeColor="0x4C2F26" stroke="3" size="28" fontFamily="MicroSoft YaHei UI" verticalAlign="middle"/><e:Button id="fightBtn" skinName="EquipFightBtnSkin" x="1614" y="954" name="btnEnterFight"/><e:Button id="btnClose" skinName="CommonReturnBtnSkin" x="1804" y="9"/><e:Image source="common_utils_json.ability_life_icon_png" x="1632" y="563"/><e:Image source="common_utils_json.ability_attack_icon_png" x="1633" y="663"/><e:Image source="common_utils_json.ability_speed_icon_png" x="1633" y="754"/><e:Image source="common_utils_json.ability_view_icon_png" x="1637" y="847"/></e:Skin>'}return __extends(EquipWindow,_super),EquipWindow.prototype.setData=function(_data){this.data=_data},EquipWindow.prototype.updateView=function(){_super.prototype.updateView.call(this),this.fightBtn.name="fightBtn",this.equipScroller.scrollPolicyH="off",MouseScroller_1.default.enableMouseScroller(this.equipScroller);var userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data;this.heroInfo=userInfo.ownedHero,this.heroProfileImg.source="resource/icon/role/career_profile/"+this.heroInfo.data.career_figure.replace("figure","profile")+".png";var userEquipInfo=userInfo.equips,equipConfig=(userInfo.heros,ConfigManager_1.default.getInstance().getConfigs("equip"));this.equipTabs=[],this.equipTabIndex=CommonConfig_1.default.EQUIP_ALL;for(var len=CommonConfig_1.default.EQUIP_TYPES.length,i=0;i<=len;++i)this.equipTabs.push(this["equipTab"+i]),this.equipTabs[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabTouchHandler,this);var ownedEquipTypes=[];this.equipSuites={own:[],notown:[]},this.equipCards={};for(var levelInfo=ConfigManager_1.default.getInstance().getConfig("pve_story_level",this.data.levelID),restrictEquips=levelInfo.restrict_equip.split("|"),i=0;i<userEquipInfo.length;++i){var equipInfo=userEquipInfo[i],equipData=new EquipSuite_1.default(null,equipInfo);equipData.isEquiped=!!this.isEquipedByPlayer(equipData.uuid,userInfo.ownedHero),equipData.isOwned=!0,equipData.isRestricted=1!=equipData.heroClass&&equipData.heroClass-1!=this.heroInfo.data.type,-1!=restrictEquips.indexOf(equipData.ID.toString())&&(equipData.isRestricted=!0),0<equipInfo.data.type&&equipInfo.data.type<=8&&-1==ownedEquipTypes.indexOf(equipInfo.modelID)&&(ownedEquipTypes.push(equipInfo.modelID),this.equipSuites.own.push(equipData))}for(var key in equipConfig){var modelID=parseInt(key);if(-1==ownedEquipTypes.indexOf(modelID)){var equipChunk=equipConfig[modelID];if(!(parseInt(equipChunk.type)<1||parseInt(equipChunk.type)>CommonConfig_1.default.EQUIP_TYPES.length)){var equipSuite=new EquipSuite_1.default(equipConfig[key],null);equipSuite.isEquiped=!1,this.equipSuites.notown.push(equipSuite)}}}Object.keys(this.equipSuites).forEach(function(key){var vEquipSuite=this.equipSuites[key];this.equipCards[key]=[];for(var i=0;i<vEquipSuite.length;++i){var equipCard=new EquipCard_1.default(vEquipSuite[i]);this.equipCards[key].push(equipCard)}},this);var currHeroInfo=userInfo.ownedHero;this.equipSlots=[];for(var equipSlot,i=1;i<=len;++i){if(equipSlot=EquipWindow.SPECIFIC_TYPES.indexOf(i)>-1?new EquipSlot_1.default(i,EquipWindow.SPECIFIC_TYPES):new EquipSlot_1.default(i),0!=currHeroInfo["item"+i]){var equipSuite=this.getEquipSuiteByUniqueId(currHeroInfo["item"+i],this.equipSuites.own);equipSuite&&equipSlot.setSlotSuite(equipSuite)}equipSlot.x=EquipWindow.EQUIP_SLOT_POS[0]+(i-1)*EquipWindow.EQUIP_SLOT_POS[2],equipSlot.y=EquipWindow.EQUIP_SLOT_POS[1],this.equipSlots.push(equipSlot),this.addChild(equipSlot)}this.updatePanel(),this.handleCurrHeroAttributes(),this.onFightBtnTouchHandler.bind(this),this.fightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFightBtnTouchHandler,this),NetManager_1.default.getInstance().addEventListener(UserInfoProxy_1.default.EQUIP_UPDATE_STATE,this.equipStateUpdate,this)},EquipWindow.prototype.updatePanel=function(){this.highlightOnlyTabByIndex(this.equipTabIndex),this.showCardsByType(this.equipTabIndex),this.handleCurrHeroAttributes()},EquipWindow.prototype.equipStateUpdate=function(e){if(200==e.data.data.code){var equipUniqueId=e.data.data.id,slotId=e.data.data.seat;if(0==e.data.data.ret){var equipSlot=this.getEquipSlotByUniqueId(equipUniqueId,this.equipSlots);if(equipSlot&&equipSlot.slotSuite){equipSlot.setSlotSuite(null);var equipCard=this.getEquipCardByUniqueId(equipUniqueId,this.equipCards.own);equipCard.setEquiped(!1)}}else{var equipCard=void 0,equipSlot=void 0;if(equipSlot=this.equipSlots[slotId-1],equipSlot.slotSuite){var slotSuite=equipSlot.slotSuite,slotCardId=slotSuite.uuid;equipCard=this.getEquipCardByUniqueId(slotCardId,this.equipCards.own),equipCard.setEquiped(!1)}equipCard=this.getEquipCardByUniqueId(equipUniqueId,this.equipCards.own),equipCard.setEquiped(!0),equipSlot.setSlotSuite(equipCard.cardSuite)}this.updatePanel()}},EquipWindow.prototype.onTabTouchHandler=function(e){var target=e.target.parent;if(target instanceof eui.Component){for(var len=this.equipTabs.length,i=0;i<len;++i)if(target==this.equipTabs[i]){this.equipTabIndex=i;break}this.updatePanel()}},EquipWindow.prototype.onFightBtnTouchHandler=function(e){SoundManager_1.default.getInstance().playEffect("u10_start_mp3");var levelID=this.data.levelID;this.allCheckBeforeFight()&&(BattleStartLoading_1.default.startBattleLoading(this.data),TDGA.onMissionBegin(levelID))},EquipWindow.prototype.allCheckBeforeFight=function(){var levelInfo=ConfigManager_1.default.getInstance().getConfig("pve_story_level",this.data.levelID),isChecked=!0,requiredSlots=levelInfo.required_equiptype.split("|"),strTip="",slotType=-1;for(var index in this.equipSlots){var slot=this.equipSlots[index];if(slotType=slot.slotType,-1!=requiredSlots.indexOf(slotType.toString())&&!slot.slotSuite){isChecked=!1;strTip+="<font color='#00CD00'>"+CommonConfig_1.default.EQUIP_TYPES_CN[slotType-1]+"</font>";break}}if(0==isChecked){var equipCards=this.getEquipCardsBySlotType(slotType,this.equipCards.own,!0);return equipCards&&equipCards.length>0?(strTip="请装备上<font color='#00CD00'>"+equipCards[0].cardSuite.name+"</font>",equipCards[0].showEquipTipInShortTime()):strTip+="位置必须有装备",ToastManager_1.default.showTip(strTip),!1}var requiredEquips=levelInfo.required_equip.split("|"),currSlotEquipIDs=[];this.equipSlots.forEach(function(slot){slot&&slot.slotSuite&&currSlotEquipIDs.push(slot.slotSuite.ID)},this);var equipId=0;if(requiredEquips.find(function(requiredEquipId){return!isNaN(parseInt(requiredEquipId))&&-1==currSlotEquipIDs.indexOf(parseInt(requiredEquipId))&&(equipId=requiredEquipId,!0)},this)){var equipCards=this.getEquipCardsByConfigId(equipId,this.equipCards.own);return equipCards&&equipCards.length>0?(this.equipScroller.viewport.scrollV=equipCards[0].y-31,equipCards[0].showEquipTipInShortTime(),strTip="<font color='#CD8500' size =27>"+equipCards[0].cardSuite.name+"</font>",strTip="<font size=27>请装备<font>"+strTip):(equipCards=this.getEquipCardsByConfigId(equipId,this.equipCards.notown),this.equipScroller.viewport.scrollV=equipCards[0].y-31,equipCards[0].showEquipTipInShortTime(),strTip="<font color='#00cd00'>"+equipCards[0].cardSuite.name+"</font>"),ToastManager_1.default.showTip(strTip),!1}var restrictEquips=levelInfo.restrict_equip.split("|");if(equipId=0,restrictEquips.find(function(restrictEquipId){return!isNaN(parseInt(restrictEquipId))&&-1!=currSlotEquipIDs.indexOf(parseInt(restrictEquipId))&&(equipId=restrictEquipId,!0)},this)){var equipCards=this.getEquipCardsByConfigId(equipId,this.equipCards.own);if(equipCards&&equipCards.length>0){for(var i=0;i<equipCards.length;++i)equipCards[i].setRestricted(!0);for(var i=0;i<this.equipSlots.length;++i)if(this.equipSlots[i]&&this.equipSlots[i].slotSuite&&this.equipSlots[i].slotSuite.ID==equipId){strTip="<font color='#CD8500' size =27>"+this.equipSlots[i].slotSuite.name+"</font>",strTip="<font size=27>当前关卡内不得使用<font>"+strTip,ToastManager_1.default.showTip(strTip);break}}return!1}parseInt(levelInfo.required_lv),parseInt(levelInfo.required_star);return!0},EquipWindow.prototype.getSlotPosForSpecialCard=function(equipCard){var vEquipSlot=this.getEquipSlotsByType(equipCard.type,this.equipSlots,!0);if(0==vEquipSlot.length){vEquipSlot=this.getEquipSlotsByType(equipCard.type,this.equipSlots);return vEquipSlot[vEquipSlot.length-1].slotType}return vEquipSlot[0].slotType},EquipWindow.prototype.highlightOnlyTabByIndex=function(tabIndex){var len=this.equipTabs.length;tabIndex=Math.min(Math.max(0,tabIndex),len);for(var i=0;i<len;++i)this.equipTabs[i].imgSelected.visible=i==tabIndex},EquipWindow.prototype.highlightOnlySlotByIndex=function(slotIndex){var len=this.equipSlots.length;-1!=slotIndex&&(slotIndex=Math.min(Math.max(1,slotIndex),len));for(var i=1;i<=len;++i)this.equipSlots[i].imgSelected.visible=i==slotIndex},EquipWindow.prototype.getEquipSuiteByUniqueId=function(equipUniqueId,vEquipCardSuite){if(0==equipUniqueId)return null;for(var len=vEquipCardSuite.length,i=0;i<len;++i){var equipCardSuite=vEquipCardSuite[i];if(equipCardSuite.isEquiped&&equipUniqueId==equipCardSuite.uuid)return equipCardSuite}return null},EquipWindow.prototype.getEquipCardByUniqueId=function(equipUniqueId,vEquipCard,requireEquiped){void 0===requireEquiped&&(requireEquiped=!1);for(var cardLen=vEquipCard.length,i=0;i<cardLen;++i){var equipCard=vEquipCard[i];if(equipUniqueId==equipCard.uuid)return requireEquiped?equipCard.isEquiped?equipCard:null:equipCard}return null},EquipWindow.prototype.getEquipSlotByUniqueId=function(equipUniqueId,vEquipSlot){for(var slotLen=vEquipSlot.length,i=0;i<slotLen;++i){var equipSlot=vEquipSlot[i];if(equipSlot.uniqueId&&equipUniqueId==equipSlot.uniqueId)return equipSlot}return null},EquipWindow.prototype.getEquipCardsByConfigId=function(equipConfigId,vEquipCard,isBestRange){void 0===isBestRange&&(isBestRange=!0);for(var bestEquipRange,vCards=Array(),len=vEquipCard.length,i=0;i<len;++i){var equipCard=vEquipCard[i];equipCard.ID==equipConfigId&&(isBestRange?(!bestEquipRange||bestEquipRange<equipCard.cardSuite.rarity)&&(bestEquipRange=equipCard.cardSuite.rarity,vCards.push(equipCard)):vCards.push(equipCard))}if(isBestRange){len=vCards.length;for(var i=len-1;i>=0;--i){var equipCard=vCards[i];equipCard.cardSuite.rarity!=bestEquipRange&&vCards.splice(i,1)}}return vCards},EquipWindow.prototype.getEquipCardsBySlotType=function(slotType,vEquipCard,isBestRange){for(var bestEquipRange,vCards=Array(),len=vEquipCard.length,i=0;i<len;++i){var equipCard=vEquipCard[i];-1==EquipWindow.SPECIFIC_TYPES.indexOf(slotType)&&equipCard.type!=slotType||(isBestRange?(!bestEquipRange||bestEquipRange<equipCard.cardSuite.rarity)&&(bestEquipRange=equipCard.cardSuite.rarity,vCards.push(equipCard)):vCards.push(equipCard))}if(isBestRange){len=vCards.length;for(var i=len-1;i>=0;--i){var equipCard=vCards[i];equipCard.cardSuite.rarity!=bestEquipRange&&vCards.splice(i,1)}}return vCards},EquipWindow.prototype.isEquipedByPlayer=function(equipUniqueId,currHeroInfo){if(0==equipUniqueId)return!1;for(var itemLen=CommonConfig_1.default.EQUIP_TYPES.length,i=0;i<itemLen;++i){var key="item"+(i+1),heroEquipId=currHeroInfo[key];if(heroEquipId&&equipUniqueId==heroEquipId)return!0}return!1},EquipWindow.prototype.showCardsByType=function(type){for(this.yPos=55;this.equipGroup.numChildren;)this.equipGroup.removeChildAt(0);0!=this.equipScroller.viewport.scrollV&&(this.equipScroller.viewport.scrollV=0),this.ownPrompt.visible=this.notownPrompt.visible=!1,this.equipGroup.addChild(this.ownPrompt),this.equipGroup.addChild(this.notownPrompt),Object.keys(this.equipCards).forEach(function(key){this[key+"FrameImg"].x=90,this[key+"FrameImg"].y=this.yPos+17,this.equipGroup.addChild(this[key+"FrameImg"]),this[key+"SignImg"].x=this[key+"FrameImg"].x+15,this[key+"SignImg"].y=this[key+"FrameImg"].y+31,this.equipGroup.addChild(this[key+"SignImg"]);for(var card,cards=this.equipCards[key],cardCount=0,i=0;i<cards.length;++i)card=cards[i],card.isEquiped||card.type!=type&&CommonConfig_1.default.EQUIP_ALL!=type||(card.x=EquipWindow.CARD_XPOS+cardCount%EquipWindow.CARD_PERLINE*EquipWindow.CARD_ATTRIBUTE[2],card.y=this.yPos,0==(cardCount+1)%EquipWindow.CARD_PERLINE&&(this.yPos+=EquipWindow.CARD_ATTRIBUTE[3]),++cardCount,this.equipGroup.addChild(card));(0==cardCount||cardCount%EquipWindow.CARD_PERLINE)&&(this.yPos+=EquipWindow.CARD_ATTRIBUTE[3]),0==cardCount&&("own"==key?this.ownPrompt.visible=!0:0==type&&(this.notownPrompt.visible=!0)),this[key+"CutoffLineImg"].y=this.yPos-395,this.equipGroup.addChildAt(this[key+"CutoffLineImg"],0)},this)},EquipWindow.prototype.getEquipInfoById=function(equipId,userEquipInfo){for(var key in userEquipInfo){var equipInfo=userEquipInfo[key];if(equipId==equipInfo.modelID)return equipInfo.data}return null},EquipWindow.prototype.getEquipSlotsByType=function(cardType,vEquipSlot,requireNotUsed){void 0===requireNotUsed&&(requireNotUsed=!1);for(var slotLen=vEquipSlot.length,equipSlots=new Array,i=0;i<slotLen;++i){var equipSlot=vEquipSlot[i];-1!=equipSlot.allowTypes.indexOf(cardType)&&(requireNotUsed&&equipSlot.slotSuite||equipSlots.push(equipSlot))}return equipSlots},EquipWindow.prototype.handleCurrHeroAttributes=function(){this.healthValue.text=this.getCurrHeroHPValue().toString(),this.damageValue.text=this.getCurrHeroNormalDamage().toString(),this.speedValue.text=(100*this.getCurrHeroSpeedValue()).toFixed(0)+"",this.viewValue.text=this.getCurrentHeroViewRangeValue().toString()},EquipWindow.prototype.getCurrHeroHPValue=function(){return this.getCurrHeroAttribute("hp","healthfactor")},EquipWindow.prototype.getCurrHeroNormalDamage=function(){var result=parseFloat(this.heroInfo.data.atkdamage),factor=parseFloat(this.heroInfo.data.atkdamagefactor),equipSlot=this.equipSlots[0];if(!equipSlot||!equipSlot.slotSuite)return result;var skillId=equipSlot.slotSuite.skill.split("|")[0],skillConfig=ConfigManager_1.default.getInstance().getConfig("skill",skillId);return result+=parseInt(skillConfig.atkdamage)*factor},EquipWindow.prototype.getCurrHeroSpeedValue=function(){return this.getCurrHeroAttribute("speed","speedfactor")},EquipWindow.prototype.getCurrentHeroViewRangeValue=function(){return this.getCurrHeroAttribute("viewrange","viewfactor")},EquipWindow.prototype.getCurrHeroAttribute=function(attrDefault,attrFactor){for(var result=parseFloat(this.heroInfo.data[attrDefault]),factor=parseFloat(this.heroInfo.data[attrFactor]),slotLen=this.equipSlots.length,i=0;i<slotLen;++i){var equipSlot=this.equipSlots[i];"hp"==attrDefault&&(attrDefault="health"),equipSlot.slotSuite&&equipSlot.slotSuite[attrDefault]&&(result+=parseInt(equipSlot.slotSuite[attrDefault])*factor)}return result},EquipWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),NetManager_1.default.getInstance().removeEventListener(UserInfoProxy_1.default.EQUIP_UPDATE_STATE,this.equipStateUpdate,this)},EquipWindow.CARD_ATTRIBUTE=[214,278,251,375],EquipWindow.CARD_PERLINE=5,EquipWindow.CARD_XPOS=210,EquipWindow.SPECIFIC_TYPES=[CommonConfig_1.default.EQUIP_BARITE_TYPE1,CommonConfig_1.default.EQUIP_BARITE_TYPE2,CommonConfig_1.default.EQUIP_BARITE_TYPE3],EquipWindow.EQUIP_SLOT_POS=[64,931,180],EquipWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=EquipWindow},{"../../../base/da/DataAccessManager":2,"../../../base/popup/BaseWindow":7,"../../../enums/CommonConfig":45,"../../../manager/ConfigManager":54,"../../../manager/SoundManager":58,"../../../model/DataAccessEntry":59,"../../../model/da/UserInfoProxy":67,"../../../model/net/NetManager":68,"../../../view/common/ToastManager":117,"../../common/MouseScroller":116,"../../loading/BattleStartLoading":136,"./EquipCard":122,"./EquipSlot":123,"./EquipSuite":124}],129:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},HeroInfo_1=require("../../../model/vo/HeroInfo"),HeroSlot=function(_super){function HeroSlot(heroData){_super.call(this),this._state=HeroSlot.NORMAL_UNSELECTED,this.dragBG(),this._heroData=heroData,this._imgHeadIcon=new eui.Image,this.width=this._imgHeadIcon.width=109,this.height=this._imgHeadIcon.height=109,this._imgHeadIcon.anchorOffsetX=.5*(HeroSlot.WIDTH-109),this._imgHeadIcon.anchorOffsetY=.5*(HeroSlot.HEIGHT-109),this._imgHeadIcon.x=HeroSlot.WIDTH-109,this._imgHeadIcon.y=HeroSlot.HEIGHT-109;var data=heroData instanceof HeroInfo_1.default?heroData.data:heroData;this._imgHeadIcon.source="resource/icon/role/career_head/"+data.career_head+"_c.png",this.addChild(this._imgHeadIcon),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this._imgBgFrame=new eui.Image,this.addChild(this._imgBgFrame),this._imgLock=new eui.Image,this._imgLock.x=HeroSlot.WIDTH-125,this._imgLock.y=50,this._imgLock.width=50,this._imgLock.height=50,this.addChild(this._imgLock),this._imgLock.source="hero_json.pic_lock_png",this._imgLock.visible=!1}return __extends(HeroSlot,_super),Object.defineProperty(HeroSlot.prototype,"state",{get:function(){return this._state},set:function(value){this._state=value,this.setBgSource(value)},enumerable:!0,configurable:!0}),Object.defineProperty(HeroSlot.prototype,"heroData",{get:function(){return this._heroData},set:function(value){this._heroData=value},enumerable:!0,configurable:!0}),HeroSlot.prototype.setBgSource=function(state){switch(state){case HeroSlot.NORMAL_UNSELECTED:this._imgBgFrame.source="hero_json.pic_head_normal_png",this._imgBgFrame.x=36,this._imgBgFrame.y=33,this._imgHeadIcon.scaleX=this._imgHeadIcon.scaleY=1,this._imgLock.visible=!1;break;case HeroSlot.NORMAL_SELECTED:this._imgBgFrame.source="hero_json.pic_head_selected_png",this._imgBgFrame.x=0,this._imgBgFrame.y=0,this._imgHeadIcon.scaleX=this._imgHeadIcon.scaleY=1.2,this._imgLock.visible=!1;break;case HeroSlot.LOCK_UNSELECTED:this._imgBgFrame.source="hero_json.pic_head_normal_png",this._imgBgFrame.x=36,this._imgBgFrame.y=33,this._imgHeadIcon.scaleX=this._imgHeadIcon.scaleY=1,this._imgLock.visible=!0;break;case HeroSlot.LOCK_SELECTED:this._imgBgFrame.source="hero_json.pic_head_selected_png",this._imgBgFrame.x=0,this._imgBgFrame.y=0,this._imgHeadIcon.scaleX=this._imgHeadIcon.scaleY=1.2,this._imgLock.visible=!0}},HeroSlot.prototype.dragBG=function(){var g=this.graphics;g.clear(),g.beginFill(0,0),g.drawRect(0,0,251,226),g.endFill()},HeroSlot.prototype.onTouchTap=function(event){this.dispatchEvent(new egret.Event("heroSlotClicked",!1,!1,this._heroData))},HeroSlot.prototype.dispose=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},HeroSlot.WIDTH=251,HeroSlot.HEIGHT=226,HeroSlot.NORMAL_UNSELECTED="normal_unselected",HeroSlot.NORMAL_SELECTED="normal_selected",HeroSlot.LOCK_UNSELECTED="lock_unselected",HeroSlot.LOCK_SELECTED="lock_selected",HeroSlot}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HeroSlot},{"../../../model/vo/HeroInfo":72}],130:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},HeroSlot_1=require("./HeroSlot"),HeroInfo_1=require("../../../model/vo/HeroInfo"),HeroSlotBar=function(_super){function HeroSlotBar(heroDatas){_super.call(this),this.TOP=10,this.GAP=25,this.COOD_POINTS=[{x:0,y:0},{x:0,y:180},{x:0,y:360},{x:0,y:540},{x:0,y:720}],this._heroDatas=heroDatas,this._slots=[];for(var i in heroDatas){
var heroSlot=new HeroSlot_1.default(heroDatas[i]);this.addChild(heroSlot),this._slots.push(heroSlot),heroSlot.addEventListener("heroSlotClicked",this.onSlotClicked,this)}this.layout(),this._slots.length>0&&(this._selectedData=heroDatas[0],this._selectedSlot=this._slots[0])}return __extends(HeroSlotBar,_super),Object.defineProperty(HeroSlotBar.prototype,"selectedData",{get:function(){return this._selectedData},set:function(value){this._selectedData=value,this.setSelectedSlot(value)},enumerable:!0,configurable:!0}),Object.defineProperty(HeroSlotBar.prototype,"selectedSlot",{get:function(){return this._selectedSlot},enumerable:!0,configurable:!0}),Object.defineProperty(HeroSlotBar.prototype,"heroDatas",{get:function(){return this._heroDatas},enumerable:!0,configurable:!0}),HeroSlotBar.prototype.layout=function(){for(var i in this._slots){var heroSlot=this._slots[i];heroSlot.x=this.COOD_POINTS[i].x,heroSlot.y=this.COOD_POINTS[i].y}},HeroSlotBar.prototype.onSlotClicked=function(event){var heroSlot=event.currentTarget;this.setSelectedSlot(heroSlot.heroData),this.dispatchEvent(new egret.Event("slotClicked",!1,!1,this._selectedData))},HeroSlotBar.prototype.setSelectedSlot=function(heroData){this._selectedData=heroData,this._selectedSlot=this.getSlotByData(heroData);for(var i in this._slots){var heroSlot=this._slots[i];this.selectedSlot==heroSlot?heroSlot.heroData instanceof HeroInfo_1.default?heroSlot.state=HeroSlot_1.default.NORMAL_SELECTED:heroSlot.state=HeroSlot_1.default.LOCK_SELECTED:heroSlot.heroData instanceof HeroInfo_1.default?heroSlot.state=HeroSlot_1.default.NORMAL_UNSELECTED:heroSlot.state=HeroSlot_1.default.LOCK_UNSELECTED}},HeroSlotBar.prototype.getSlotByData=function(heroData){for(var i in this._slots){var heroSlot=this._slots[i];if(heroSlot.heroData==heroData)return heroSlot}return null},HeroSlotBar.prototype.dispose=function(){for(var i in this._slots){var heroSlot=this._slots[i];heroSlot.addEventListener("heroSlotClicked",this.onSlotClicked,this),heroSlot.dispose()}this._slots=null},HeroSlotBar}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HeroSlotBar},{"../../../model/vo/HeroInfo":72,"./HeroSlot":129}],131:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),DataAccessManager_1=require("../../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../../model/DataAccessEntry"),ConfigManager_1=require("../../../manager/ConfigManager"),NetManager_1=require("../../../model/net/NetManager"),HeroInfo_1=require("../../../model/vo/HeroInfo"),HeroSlotBar_1=require("./HeroSlotBar"),SkillBar_1=require("./SkillBar"),Globals_1=require("../../../enums/Globals"),UserInfoProxy_1=require("../../../model/da/UserInfoProxy"),ToastManager_1=require("../../common/ToastManager"),Protocols_1=require("../../../enums/Protocols"),HeroWindow=function(_super){function HeroWindow(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="HeroWindowSkin" width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="hero_json.pic_bg_png" x="0" y="0" locked="true"/><e:Button id="btnClose" label="按钮" x="1799" y="9" skinName="CommonReturnBtnSkin"/><e:Button id="btnChoose" label="出战" x="1497" y="959" skinName="CommonButtonSkin"/><e:Image source="hero_json.pic_hero_bg_png" y="172" horizontalCenter="-104"/><e:Image id="imgStar1" source="hero_json.pic_star_png" x="749" y="954"/><e:Image id="imgStar2" source="hero_json.pic_star_png" x="826" y="954"/><e:Image id="imgStar3" source="hero_json.pic_star_png" x="903" y="954"/><e:Image id="imgStar4" source="hero_json.pic_star_png" x="980" y="954" scaleX="1" scaleY="1"/><e:Image id="imgStar5" source="hero_json.pic_star_png" x="1057" y="955" scaleX="1" scaleY="1"/><e:Image id="imgStar6" source="hero_json.pic_star_png" x="1134" y="954" scaleX="1" scaleY="1"/><e:Image id="imgHero1" width="126" height="112" x="222" y="204" locked="true"/><e:Image id="imgHero2" width="126" height="112" x="222" y="418" locked="true"/><e:Image id="imgHero3" width="126" height="112" x="222" y="626" locked="true"/><e:Image id="imgFigure" width="800" height="874" y="71" horizontalCenter="-104"/><e:Image id="imgCareer" source="hero_json.pic_soldier_logo_warrior_png" width="350" height="176" x="226.5" y="71.12" scaleX="0.89" scaleY="0.88"/><e:Image  id="imgHeroName" source="hero_json.pic_name_Grace_png" width="223" height="98" x="526" y="943"/><e:Label id="labOpenDesc" text="标签" x="1423" y="1030" width="318" size="20" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479" height="30" textAlign="center" verticalAlign="middle"/><e:Image id="imgRecruite" source="hero_json.pic_battle_png" x="386" y="284"/><e:Scroller width="644" height="798" x="1274" y="115" anchorOffsetY="0"><e:Group x="0" y="80" anchorOffsetY="0" height="802"><e:Image source="hero_json.pic_frame_bg_png" x="-2" y="2" scaleX="1" scaleY="1"/><e:Group height="281" y="0" left="-2"><e:Image source="hero_json.pic_title_bg_png" x="2" y="0"/><e:Image source="hero_json.pic_title_1_png" x="18" y="7"/><e:Image source="common_utils_json.ability_life_icon_png" x="44" y="51" scaleX="1" scaleY="1"/><e:Image source="common_utils_json.ability_attack_icon_png" x="41" y="105"/><e:Image source="common_utils_json.ability_speed_icon_png" x="44" y="164"/><e:Image source="common_utils_json.ability_view_icon_png" x="44" y="220"/><e:Label text="生命" x="110" y="58" size="28" width="112" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="攻击" x="110" y="109" size="28" width="112" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="速度" x="110" y="165" size="28" width="112" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="视野" x="110" y="224" size="28" width="112" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label id="labHp" text="123456" x="280" y="66" size="28" textColor="0xfffe9c" stroke="3" strokeColor="0x4c2f26"/><e:Label id="labAttack" text="123456" x="280" y="123" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Label id="labSpeed" text="123456" x="280" y="172" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Label id="labViewRange" text="123456" x="280" y="231" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/></e:Group><e:Group y="279" height="308" visible="false"><e:Image source="hero_json.pic_title_bg_png" x="2" y="0"/><e:Image source="hero_json.pic_title_2_png" x="18" y="7"/><e:Group width="594" height="260" y="50" id="grpSkill"/></e:Group><e:Group y="280" height="516" left="-2" anchorOffsetY="0"><e:Image source="hero_json.pic_title_bg_png" x="2" y="0"/><e:Image source="hero_json.pic_title_3_png" x="18" y="7"/><e:Label id="labDesc" text="" x="18" y="66" width="570" height="448" multiline="true" wordWrap="true" size="28" lineSpacing="5" anchorOffsetY="0"/></e:Group></e:Group></e:Scroller><e:Image id="imgGem" source="icon_gem_png" x="1588" y="958" width="68" height="66"/></e:Skin>',this.isCache=!1,this.touchEnabled=!0,this.userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data}return __extends(HeroWindow,_super),HeroWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.btnChoose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this),this.slotBar=new HeroSlotBar_1.default(this.resolveHeroData()),this.slotBar.x=50,this.slotBar.y=100,this.addChild(this.slotBar),this.slotBar.addEventListener("slotClicked",this.onSlotBarClicked,this);var currentHeroData=this.userInfo.ownedHero;this.updateHeroInfo(currentHeroData),this.slotBar.selectedData=currentHeroData,NetManager_1.default.getInstance().addEventListener(UserInfoProxy_1.default.HERO_BOUGHT,this.heroBought,this),NetManager_1.default.getInstance().addEventListener(UserInfoProxy_1.default.HERO_CHANGED,this.heroChanged,this)},HeroWindow.prototype.resolveHeroData=function(){var heroMap=ConfigManager_1.default.getInstance().getConfigs("hero"),myHeros=this.userInfo.heros,result=[],checks=[];result=result.concat(myHeros);for(var _i=0,myHeros_1=myHeros;_i<myHeros_1.length;_i++){var heroInfo=myHeros_1[_i];checks.push(heroInfo.data)}for(var i in heroMap){var heroData=heroMap[i];-1==checks.indexOf(heroData)&&result.push(heroData)}return result},HeroWindow.prototype.updateHeroInfo=function(currentData){var heroData=currentData instanceof HeroInfo_1.default?currentData.data:currentData;this.currentHero=currentData,this.labHp.text=heroData.hp,this.labSpeed.text=Math.round(100*parseFloat(heroData.speed)).toString(),this.labAttack.text=heroData.atkdamage,this.labViewRange.text=heroData.viewrange,this.labDesc.text=heroData.description,this.imgGem.visible=!1,this.imgRecruite.visible=!1,currentData instanceof HeroInfo_1.default?(this.labOpenDesc.text="",this.btnChoose.icon="",currentData==this.userInfo.ownedHero?(this.btnChoose.label="已出战",this.btnChoose.skinName='<?xml version=\'1.0\' encoding=\'utf-8\'?><e:Skin class="HeroFightButtonSkin" states="up,over,down,disabled" width="241" height="120" currentState="up" xmlns:e="http://ns.egret.com/eui"><e:Image includeIn="up"  source="common_utils_json.common_btn_frame_04_normal_png"/><e:Image source="common_utils_json.common_btn_frame_04_normal_png" includeIn="over,down" /><e:Label id="labelDisplay" top="8" bottom="8" left="8" right="8" size="28" textColor="0xFFFe9c" verticalAlign="middle" textAlign="center" stroke="3" strokeColor="0x4c2f26" text="已出战"/></e:Skin>',this.imgRecruite.visible=!0,this.btnChoose.x=1453,this.btnChoose.y=933):(this.btnChoose.label="出战",this.btnChoose.skinName="CommonButtonSkin",this.btnChoose.x=1497,this.btnChoose.y=959)):(this.labOpenDesc.text=currentData.price_description,parseInt(heroData.price)<0?(this.btnChoose.label="需解锁",this.btnChoose.skinName="CommonButtonSkin",this.btnChoose.x=1497,this.btnChoose.y=959):(this.btnChoose.label=heroData.price,this.btnChoose.skinName="CommonButtonSkin",this.imgGem.visible=!0,this.btnChoose.x=1497,this.btnChoose.y=959)),this.imgFigure.source="resource/icon/role/career_figure/"+heroData.career_figure+".png",this.imgCareer.source=RES.getRes("hero_json.pic_soldier_logo_"+Globals_1.default.HERO_CAREER[heroData.type]+"_png"),this.imgHeroName.source=RES.getRes("hero_json.pic_name_"+heroData.icon+"_png"),this.setQuality(parseInt(heroData.rarity)),this.setSkill(heroData.skill.split("|"))},HeroWindow.prototype.setQuality=function(quality){if(!(quality<1||quality>6))for(var i=1;i<=6;i++)this["imgStar"+i].visible=i<=quality},HeroWindow.prototype.setSkill=function(skillIds){this.grpSkill.removeChildren();for(var _i=0,skillIds_1=skillIds;_i<skillIds_1.length;_i++){var skillIdStr=skillIds_1[_i],skillId=parseInt(skillIdStr);if(!(skillId<1e4)){var skillData=ConfigManager_1.default.getInstance().getConfig("skill",skillId),skillBar=new SkillBar_1.default;skillBar.setSkillData(skillData),this.grpSkill.addChild(skillBar)}}},HeroWindow.prototype.onChoose=function(event){if(!(this.currentHero instanceof HeroInfo_1.default)){var price=parseInt(this.currentHero.price);return price<0?void ToastManager_1.default.centerShowTip("需战斗闯关获得！"):this.userInfo.diamond<price?void ToastManager_1.default.centerShowTip("宝石不足！"):void NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_BUY_HERO,{mid:parseInt(this.currentHero.id)})}this.userInfo.ownedHero.uuid!=this.currentHero.uuid&&NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_SELECT_HERO,{hid:this.currentHero.uuid})},HeroWindow.prototype.onSlotBarClicked=function(event){this.updateHeroInfo(this.slotBar.selectedData)},HeroWindow.prototype.heroBought=function(event){var heroInfo=event.data,slot=this.slotBar.getSlotByData(heroInfo.data);slot&&(slot.heroData=heroInfo,this.updateHeroInfo(heroInfo),this.slotBar.selectedData=heroInfo,ToastManager_1.default.centerShowTip("英雄购买成功！"))},HeroWindow.prototype.heroChanged=function(event){var heroInfo=event.data;this.updateHeroInfo(heroInfo),ToastManager_1.default.centerShowTip("英雄出战成功！")},HeroWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.slotBar.dispose(),NetManager_1.default.getInstance().removeEventListener(UserInfoProxy_1.default.HERO_BOUGHT,this.heroBought,this),this.slotBar.removeEventListener("slotClicked",this.onSlotBarClicked,this),this.btnChoose.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this)},HeroWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HeroWindow},{"../../../base/da/DataAccessManager":2,"../../../base/popup/BaseWindow":7,"../../../enums/Globals":46,"../../../enums/Protocols":51,"../../../manager/ConfigManager":54,"../../../model/DataAccessEntry":59,"../../../model/da/UserInfoProxy":67,"../../../model/net/NetManager":68,"../../../model/vo/HeroInfo":72,"../../common/ToastManager":117,"./HeroSlotBar":130,"./SkillBar":132}],132:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},SkillBar=function(_super){function SkillBar(){_super.call(this),this.graphics.clear(),this.graphics.beginFill(0,0),this.graphics.drawRect(0,0,590,120),this.graphics.endFill(),this.imgIcon=new eui.Image,this.addChild(this.imgIcon),this.imgIcon.x=40,this.imgIcon.y=30,this.labName=new eui.Label,this.labName.x=130,this.labName.y=20,this.addChild(this.labName),this.labName.size=28,this.labName.textColor=16777215,this.labName.fontFamily="Microsoft Yahei",this.labName.stroke=3,this.labName.strokeColor=13433,this.labDesc=new eui.Label,this.labDesc.x=130,this.labDesc.y=60,this.addChild(this.labDesc),this.labDesc.size=22,this.labDesc.textColor=16777215,this.labDesc.fontFamily="Microsoft Yahei",this.labDesc.multiline=!0,this.labDesc.wordWrap=!0}return __extends(SkillBar,_super),SkillBar.prototype.setSkillData=function(skillData){this.labName.text=skillData.name_cn,this.imgIcon.source="resource/icon/action/"+skillData.icon+"_normal.png",this.labDesc.text=skillData.description},SkillBar}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SkillBar},{}],133:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),WindowManager_1=require("../../../base/popup/WindowManager"),SystemNickname_1=require("./SystemNickname"),SystemPassword_1=require("./SystemPassword"),DataAccessEntry_1=require("../../../model/DataAccessEntry"),DataAccessManager_1=require("../../../base/da/DataAccessManager"),HostConfig_1=require("../../../enums/HostConfig"),SoundManager_1=require("../../../manager/SoundManager"),Alert_1=require("../../common/Alert"),Platform_1=require("../../../platforms/Platform"),NetManager_1=require("../../../model/net/NetManager"),UserInfoProxy_1=require("../../../model/da/UserInfoProxy"),OptionWindow=function(_super){function OptionWindow(heroData){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="SystemSkin" width="1100" height="600" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="option_json.system_frame_png" x="1" y="0"/><e:Image source="option_json.system_frame_label_playerinfo_normal_png" x="81" y="112" visible="false"/><e:Image source="option_json.system_frame_label_setup_normal_png" x="233" y="114" visible="false"/><e:Image source="option_json.system_frame_label_joinclassroom_normal_png" x="411" y="114" visible="false"/><e:Component id="systembtn0" skinName="PlayerInformationSkin" x="90" y="105"/><e:Component id="systembtn1" skinName="SettingSkin" x="260" y="105"/><e:Component id="systembtn2" skinName="AddClassSkin" x="430" y="105"/><e:Button id="btnClose" label="按钮" x="999" y="81" skinName="WindowCloseBtnSkin"/><e:ViewStack id="viewStack" selectedIndex="3" width="976" x="48" y="191" height="373"><e:Group x="41" y="18" visible="false"><e:Button id="renamebtn" label="" x="735" y="22" skinName="RenamButton"/><e:Image source="explore_json.explore_head_frame_png" x="23" y="18"/><e:Image id="imgHead" x="45" y="38" scaleX="1" scaleY="1" width="119" height="123"/><e:Group width="426" height="67" x="262" y="16"><e:Image source="option_json.system_info_name_png" x="-14" y="3"/><e:Label id="player_name_label" text="悠悠游客" x="182" y="13" width="229" height="45" size="28" textColor="0xffffff" stroke="3" strokeColor="0x0046a6" verticalAlign="middle"/></e:Group><e:Group width="613" height="67" x="265" y="113"><e:Image source="option_json.system_info_mail_png" x="-14" y="3"/><e:Label id="player_email_label" text="邮箱" x="180" y="13" width="419" height="48" size="28" textColor="0xffffff" stroke="3" strokeColor="0x0046a6" verticalAlign="middle" textAlign="left"/></e:Group><e:Button id="avatarbtn" label="按钮" x="7" y="253" skinName="ChangeAvatarButton"/><e:Button id="changepsdbtn" label="按钮" x="263" y="253" skinName="ChangePasswordButton"/></e:Group><e:Group x="43" y="14" visible="false"><e:ToggleButton id="selectedbtn0" label="切换按钮" x="190" y="91" skinName="systemMusic"/><e:ToggleButton id="selectedbtn1" label="切换按钮" x="636" y="91" skinName="systemSound"/><e:Image source="option_json.system_setup_systemmusic_png" x="28" y="80"/><e:Image source="option_json.system_setup_systemsound_png" x="469" y="86"/><e:Image source="option_json.system_setup_selectlanguage_png" x="28" y="199"/><e:Button id="Languagebtn" label="" x="190" y="208" skinName="SelectLanguage"/></e:Group><e:Group width="724" y="25" x="134" visible="false"><e:Image source="option_json.system_classrome_input_png" x="213" y="7"/><e:TextInput id="InvitationCode" y="125" width="456" height="54" skinName="SystemInputSkin" horizontalCenter="0"/><e:Button id="sureclassbtn" label="按钮" x="291" y="249" skinName="AddClassButton"/></e:Group><e:Group width="724" y="25" x="134"><e:Button id="btnQuitClass" label="退出教室" x="292" y="179" skinName="CommonButtonSkin"/><e:Label text="你的教室" x="128" y="85"/><e:Label id="labClassName" text="Python天才班" x="304" y="83" width="276"/></e:Group></e:ViewStack></e:Skin>',this.isMusicOpen=!0}return __extends(OptionWindow,_super),OptionWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.addListeners(),this.onUserInfo(),this.updateView();var effectState=egret.localStorage.getItem("effectSwitch");this.selectedbtn1.selected=!("on"==effectState||!effectState);var musicState=egret.localStorage.getItem("musicSwitch");this.selectedbtn0.selected=!("on"==musicState||!musicState)},OptionWindow.prototype.addListeners=function(){this.renamebtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onrename,this),this.changepsdbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onchangepassword,this),NetManager_1.default.getInstance().addEventListener(UserInfoProxy_1.default.USER_UPDATE_DATA,this.onUserInfoName,this),this.selectedbtn0.addEventListener(eui.UIEvent.CHANGE,this.systemMusic,this),this.selectedbtn1.addEventListener(eui.UIEvent.CHANGE,this.systemSound,this),this.Languagebtn.addEventListener(eui.UIEvent.CHANGE,this.onLanguage,this),this.sureclassbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSureclass,this),this.btnQuitClass.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuitClass,this)},OptionWindow.prototype.onUserInfo=function(){var userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data;userInfo&&(this.player_name_label.text=userInfo.nickName||"悠悠游客",this.imgHead.source=userInfo.headImgUrl||"resource/icon/role/career_head/"+userInfo.headIcon+".png",this.player_email_label.text=Platform_1.default.currentPlatform.platformAccount)},OptionWindow.prototype.onUserInfoName=function(e){this.player_name_label.text=e.data},OptionWindow.prototype.updateView=function(){_super.prototype.updateView.call(this),this.systembtns=[],this.systemhost=HostConfig_1.default.SESTEM_PLAYER;for(var len=HostConfig_1.default.EQUIP_TYPES.length,i=0;i<=len;++i)this.systembtns.push(this["systembtn"+i]),this.systembtns[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTabTouchHandler,this);this.updatePanel()},OptionWindow.prototype.updatePanel=function(){this.highlightOnlyTabByIndex(this.systemhost),this.showSkinByType(this.systemhost)},OptionWindow.prototype.onTabTouchHandler=function(e){var target=e.target.parent;if(target instanceof eui.Component){for(var len=this.systembtns.length,i=0;i<len;++i)if(target==this.systembtns[i]){this.systemhost=i;break}this.updatePanel()}},OptionWindow.prototype.highlightOnlyTabByIndex=function(tabIndex){var len=this.systembtns.length;tabIndex=Math.min(Math.max(0,tabIndex),len);for(var i=0;i<len;++i)this.systembtns[i].imgSelected.visible=i==tabIndex},OptionWindow.prototype.highlightOnlySlotByIndex=function(slotIndex){var len=this.systemSlots.length;-1!=slotIndex&&(slotIndex=Math.min(Math.max(1,slotIndex),len));for(var i=1;i<=len;++i)this.systemSlots[i].imgSelected.visible=i==slotIndex},OptionWindow.prototype.showSkinByType=function(type){if(2==type){Platform_1.default.currentPlatform;this.viewStack.selectedIndex=type}else this.viewStack.selectedIndex=type},OptionWindow.prototype.removeListeners=function(){this.renamebtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onrename,this),this.changepsdbtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onchangepassword,this),NetManager_1.default.getInstance().removeEventListener(UserInfoProxy_1.default.USER_UPDATE_DATA,this.onUserInfoName,this),this.selectedbtn0.removeEventListener(eui.UIEvent.CHANGE,this.systemMusic,this),this.selectedbtn1.removeEventListener(eui.UIEvent.CHANGE,this.systemSound,this),this.Languagebtn.removeEventListener(eui.UIEvent.CHANGE,this.onLanguage,this),this.sureclassbtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSureclass,this),this.sureclassbtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuitClass,this)},OptionWindow.prototype.onrename=function(event){console.log("更名"),WindowManager_1.default.showWindow(SystemNickname_1.default,"SystemNickname")},OptionWindow.prototype.onchangepassword=function(event){console.log("更改密码"),WindowManager_1.default.showWindow(SystemPassword_1.default,"SystemPassword")},OptionWindow.prototype.systemMusic=function(evt){console.log("系统音乐"),this.selectedbtn0.selected?(SoundManager_1.default.getInstance().setMusicVolume(0),egret.localStorage.setItem("musicSwitch","off")):(SoundManager_1.default.getInstance().setMusicVolume(1),egret.localStorage.setItem("musicSwitch","on"))},OptionWindow.prototype.systemSound=function(evt){console.log("系统音效"),this.selectedbtn1.selected?(SoundManager_1.default.getInstance().setEffectVolume(0),egret.localStorage.setItem("effectSwitch","off")):(SoundManager_1.default.getInstance().setEffectVolume(1),egret.localStorage.setItem("effectSwitch","on"))},OptionWindow.prototype.onLanguage=function(evt){console.log("语言选择")},OptionWindow.prototype.onSureclass=function(evt){var _this=this;console.log("加入教室");var maliPlatform=Platform_1.default.currentPlatform;maliPlatform.joinClass(this.InvitationCode.inputText.text,maliPlatform.openUserId,function(teacherInfo){WindowManager_1.default.closeWindow(_this.name),Alert_1.default.show("","加入"+maliPlatform.className+"班级,老师是"+maliPlatform.classTeacherName,2)})},OptionWindow.prototype.onQuitClass=function(event){},OptionWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=OptionWindow},{"../../../base/da/DataAccessManager":2,"../../../base/popup/BaseWindow":7,"../../../base/popup/WindowManager":13,"../../../enums/HostConfig":47,"../../../manager/SoundManager":58,"../../../model/DataAccessEntry":59,"../../../model/da/UserInfoProxy":67,"../../../model/net/NetManager":68,"../../../platforms/Platform":81,"../../common/Alert":115,"./SystemNickname":134,"./SystemPassword":135}],134:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),WindowManager_1=require("../../../base/popup/WindowManager"),Protocols_1=require("../../../enums/Protocols"),NetManager_1=require("../../../model/net/NetManager"),SystemNickname=function(_super){function SystemNickname(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="SystemNicknameSkin" width="762" height="349" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="option_json.system_frame_name_png" x="0" y="0"/><e:Image source="option_json.system_info_newname_png" x="57" y="109"/><e:Button id="btnClose" label="按钮" x="681" y="71" skinName="WindowCloseBtnSkin"/><e:Button id="surebtn" label="按钮" x="311" y="245" skinName="SureButton"/><e:TextInput id="InputNickname" x="230" y="121" width="412" height="54" skinName="SystemInputSkin"/></e:Skin>'}return __extends(SystemNickname,_super),SystemNickname.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.addListeners()},SystemNickname.prototype.addListeners=function(){this.surebtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onsure,this)},SystemNickname.prototype.removeListeners=function(){this.surebtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onsure,this)},SystemNickname.prototype.clearForm=function(){this.InputNickname.text=""},SystemNickname.prototype.onsure=function(event){var newName=this.InputNickname.inputText.text;console.log(this.InputNickname),NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_CHANGE_NAME,{nickName:newName}),WindowManager_1.default.closeWindow("SystemNickname",!0)},SystemNickname}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SystemNickname},{"../../../base/popup/BaseWindow":7,"../../../base/popup/WindowManager":13,"../../../enums/Protocols":51,"../../../model/net/NetManager":68}],135:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../../base/popup/BaseWindow"),WindowManager_1=require("../../../base/popup/WindowManager"),SystemPassword=function(_super){function SystemPassword(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="SystemPasswordSkin" width="762" height="349" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="option_json.system_frame_password_png" x="0"/><e:Button id="btnClose" label="按钮" x="681" y="71" skinName="WindowCloseBtnSkin"/><e:Image source="option_json.system_info_passwordnew_png" x="50" y="109"/><e:TextInput id="newpsd" x="220" y="117" width="412" height="54" skinName="SystemInputSkin" displayAsPassword="true"/><e:Image source="option_json.system_info_passwordsure_png" x="50" y="184"/><e:TextInput id="surepassword" x="220" y="193" width="447" height="54" skinName="SystemInputSkin" displayAsPassword="true"/><e:Button id="surebtn" label="按钮" x="220" y="264" skinName="SureButton"/><e:Button id="cancelbtn" label="按钮" x="430" y="264" skinName="CancelButton"/><e:Label id="newpassword" text="" x="261" y="131" width="286" locked="true"/><e:Label id="sureoassword" text="" x="265" y="197" width="377" locked="true"/></e:Skin>'}return __extends(SystemPassword,_super),SystemPassword.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.addListeners()},SystemPassword.prototype.addListeners=function(){this.surebtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onsure,this),this.cancelbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.oncancel,this)},SystemPassword.prototype.removeListeners=function(){this.surebtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onsure,this),this.cancelbtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.oncancel,this)},SystemPassword.prototype.clearForm=function(){this.newpassword.text="",this.surepassword.text=""},SystemPassword.prototype.checkPwd=function(pwd,pwdAgain){return pwd===pwdAgain||""!=pwd&&""!=pwdAgain&&pwd==pwdAgain},SystemPassword.prototype.onsure=function(event){console.log("确认"),WindowManager_1.default.closeWindow("SystemPassword")},SystemPassword.prototype.fileUpload=function(fileId,imgId){},SystemPassword.prototype.oncancel=function(event){console.log("取消"),WindowManager_1.default.closeWindow("SystemPassword",!0)},SystemPassword}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=SystemPassword},{"../../../base/popup/BaseWindow":7,"../../../base/popup/WindowManager":13}],136:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Globals_1=require("../../enums/Globals"),ConfigManager_1=require("../../manager/ConfigManager"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),SoundManager_1=require("../../manager/SoundManager"),LayerManager_1=require("../../manager/LayerManager"),WindowManager_1=require("../../base/popup/WindowManager"),SceneManager_1=require("../../manager/SceneManager"),BattleScene_1=require("../battlescene/BattleScene"),FrameTweenLite_1=require("../../base/utils/FrameTweenLite"),BattleStartLoading=function(_super){function BattleStartLoading(){_super.call(this),this.MASK_WIDTH=0,this.mapKey="",this.tipsList=["对我来说，幻想的天赋比吸收知识的能力更有意义。——爱因斯坦","时间有没有尽头？——霍金","成功没有捷径。——扎克伯格","有非凡志向，才有非凡成就。——比尔·盖茨","不要等到明天，明天太遥远，今天就行动。——马云","真正的世界不在你的书里和地图上，而是在外面。——《霍比特人1：意外之旅》","愿原力与你同在。","开拓视野，冲破艰险。看见世界，身临其境。贴近彼此，感受人生。这就是生活的目的。——《白日梦想家》","你必须抛开一切思虑，尼奥。恐惧，疑惑，难以置信。要解放你的心灵。——《黑客帝国1》","最终决定我们命运的不是能力，而是我们自己的选择。——邓布利多","时间就是金钱，我的朋友！——WOW某地精","祈愿夜空暮星闪耀，星光温柔，将你永照。祈愿深浓黑暗降临，你心坚定，无惧无扰。——《指环王》"],this.OFF_SET_X=440,this.OFF_SET_Y=280,this.showLoading(),this.createView(),this.resQueue={}}return __extends(BattleStartLoading,_super),BattleStartLoading.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.x=.5*Globals_1.default.GAME_WIDTH-240,this.textField.y=450+this.OFF_SET_Y,this.textField.size=24,this.textField.width=480,this.textField.height=50,this.textField.textAlign="center",this.textField.text="请稍等..."},BattleStartLoading.prototype.showLoading=function(){var loadingBg=RES.getRes("loading1Bg_jpg"),bmp=new egret.Bitmap(loadingBg);this.addChild(bmp),this.setChildIndex(bmp,0),this.maskContainer=new egret.Sprite,this.addChild(this.maskContainer),this.setChildIndex(this.maskContainer,1),this.loadingMask=new egret.Sprite,this.maskContainer.addChild(this.loadingMask);var bar=RES.getRes("pic_progress-bar_png"),bmpBar=new egret.Bitmap(bar);this.maskContainer.addChild(bmpBar),this.maskContainer.setChildIndex(bmpBar,0),bmpBar.mask=this.loadingMask,this.MASK_WIDTH=bmpBar.width,this.updateMaskGraphics(this.MASK_WIDTH,bmpBar.height);var barBg=RES.getRes("loading_pic_bg_png"),bmpBarBg=new egret.Bitmap(barBg);bmpBarBg.x=.5*(Globals_1.default.GAME_WIDTH-bmpBarBg.width),bmpBarBg.y=800,
this.addChild(bmpBarBg),this.setChildIndex(bmpBarBg,1),this.maskContainer.x=.5*(Globals_1.default.GAME_WIDTH-this.maskContainer.width),this.maskContainer.y=bmpBarBg.y+.5*(bmpBarBg.height-this.maskContainer.height),this.thumb=new egret.Bitmap(RES.getRes("pic_effect_png")),this.addChild(this.thumb),this.thumb.x=this.maskContainer.x-this.thumb.width,this.thumb.y=this.maskContainer.y+.5*(this.maskContainer.height-this.thumb.height);var index=Math.floor(Math.random()*this.tipsList.length);this.tipsText=new egret.TextField,this.tipsText.width=470,this.tipsText.height=80,this.tipsText.x=340+this.OFF_SET_X,this.tipsText.y=190+this.OFF_SET_Y,this.tipsText.textColor=2236962,this.tipsText.bold=!0,this.tipsText.size=24,this.tipsText.multiline=!0,this.tipsText.lineSpacing=5,this.tipsText.wordWrap=!0,this.addChild(this.tipsText),this.tipsText.text=this.tipsList[index]},BattleStartLoading.prototype.updateMaskGraphics=function(w,h){this.maskContainer.graphics.clear(),this.maskContainer.graphics.beginFill(0,0),this.maskContainer.graphics.drawRect(0,0,w,h),this.maskContainer.graphics.endFill()},BattleStartLoading.prototype.setProgress=function(words,current,total){this.updateMask(words,current/total)},BattleStartLoading.prototype.updateMask=function(words,progress){this.textField.text=" "+words+"...  ("+Math.ceil(100*progress)+"%)";this.loadingMask.graphics.clear(),this.loadingMask.graphics.beginFill(0,1),this.loadingMask.graphics.moveTo(0,0),this.loadingMask.graphics.lineTo(this.MASK_WIDTH*progress-20,0),this.loadingMask.graphics.lineTo(this.MASK_WIDTH*progress,this.maskContainer.height/2),this.loadingMask.graphics.lineTo(this.MASK_WIDTH*progress-20,this.maskContainer.height),this.loadingMask.graphics.lineTo(0,this.maskContainer.height),this.loadingMask.graphics.lineTo(0,0),this.thumb.x=this.maskContainer.x-this.thumb.width+20+this.MASK_WIDTH*progress},BattleStartLoading.prototype.addTileMap=function(key){if(this.mapKey.length>1)throw new Error("每个战斗场景只支持一个tilemap,不可以加载或重复加载");this.mapKey=key,this.resQueue[this.mapKey]={url:"battle/map/"+key+".tmx",name:this.mapKey,type:"text"}},BattleStartLoading.prototype.addRes=function(key,url,type,name){null==this.resQueue[key]?this.resQueue[key]={url:url,name:name||key,type:type}:console.log("资源重复添加到加载队列"+key)},BattleStartLoading.prototype.loadCommonRes=function(){var keys="",resources=[];for(var key in this.resQueue){var res=this.resQueue[key];keys+=key+",",resources.push(res)}var configData={groups:[{keys:keys.substr(0,keys.length-1),name:"battle"}],resources:resources};RES.parseConfig(configData,"resource/"),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("battle",0),RES.loadGroup("battlescene",1),this.resQueue={}},BattleStartLoading.prototype.parseCommonRes=function(levelData){this.levelData=levelData,this.userInfo=levelData.player_info,this.addTileMap(levelData.tiledmap),null==levelData.tiledimage&&(levelData.tiledimage="map1_1_0"),this.addRes(levelData.tiledmap+"battleMap_png","battle/map/"+levelData.tiledimage+".png","image"),this.addRes("foot_png","battle/map/foot.png","image"),this.addRes("bubble_png","battle/map/bubble.png","image");var path="codes/"+levelData.levelID+"."+this.userInfo.language+".txt",answer="answers/"+levelData.levelID+"."+this.userInfo.language+".txt";this.addRes(levelData.levelID+"_code_txt",path,"text"),this.addRes(levelData.levelID+"_answer_txt",answer,"text"),this.addRes(levelData.levelID+"_script_js","scripts/"+levelData.levelID+".script.js","text")},BattleStartLoading.prototype.onResourceLoadComplete=function(event){"battle"===event.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.parseContentRes(),this.loadContentRes())},BattleStartLoading.prototype.parseContentRes=function(){for(var data=egret.XML.parse(RES.getRes(this.mapKey)),i=0;i<data.children.length;i++){var layer=data.children[i];if("tileset"==layer.name)for(var j=0;j<layer.children.length;j++){var tileset=layer.children[j];if(tileset.children.length>0){var picName=tileset.children[0].attributes.source;this.addRes(picName,"battle/map/"+picName,"image")}}else if("npc"==layer.attributes.name)for(var j=0;j<layer.children.length;j++){var npc=layer.children[j];if(npc.attributes.name.indexOf("npc")>=0){var names=npc.attributes.name.split("|"),cfg=ConfigManager_1.default.getInstance().getConfig("npc_enemy",Number(names[2]));if(this.addRes(cfg.icon+"_texture_png","battle/anim/"+cfg.icon+"/"+cfg.icon+"_texture.png","image"),this.addRes(cfg.icon+"_texture_json","battle/anim/"+cfg.icon+"/"+cfg.icon+"_texture.json","json"),this.addRes(cfg.icon+"_skeleton_json","battle/anim/"+cfg.icon+"/"+cfg.icon+"_skeleton.json","json"),Number(cfg.ai)>0){var aicfg=ConfigManager_1.default.getInstance().getConfig("ai",Number(cfg.ai));if(2==Number(aicfg.type)&&Number(aicfg.skill)>0){var skillcfg=ConfigManager_1.default.getInstance().getConfig("skill",Number(aicfg.skill));if("build"==skillcfg.skill_type&&skillcfg.build_id.length>1)for(var builds=skillcfg.build_id.split("|"),f=0;f<builds.length;f++){var buildID=Number(builds[f]);if(buildID>0){var cfg=ConfigManager_1.default.getInstance().getConfig("item",buildID);null==cfg&&(cfg=ConfigManager_1.default.getInstance().getConfig("npc_enemy",buildID)),this.addRes(cfg.icon+"_texture_png","battle/anim/"+cfg.icon+"/"+cfg.icon+"_texture.png","image"),this.addRes(cfg.icon+"_texture_json","battle/anim/"+cfg.icon+"/"+cfg.icon+"_texture.json","json"),this.addRes(cfg.icon+"_skeleton_json","battle/anim/"+cfg.icon+"/"+cfg.icon+"_skeleton.json","json")}}}}if(Number(cfg.attack)>0){var skillcfg=ConfigManager_1.default.getInstance().getConfig("skill",Number(cfg.attack));skillcfg.s_effect.length>0&&(console.log(skillcfg.s_effect),this.addRes(skillcfg.s_effect+"_png","battle/effect/"+skillcfg.s_effect+".png","image"),this.addRes(skillcfg.s_effect+"_plist","battle/effect/"+skillcfg.s_effect+".plist","xml")),skillcfg.e_effect.length>0&&(this.addRes(skillcfg.e_effect+"_png","battle/effect/"+skillcfg.e_effect+".png","image"),this.addRes(skillcfg.e_effect+"_plist","battle/effect/"+skillcfg.e_effect+".plist","xml")),skillcfg.m_effect.length>0&&(this.addRes(skillcfg.m_effect+"_png","battle/effect/"+skillcfg.m_effect+".png","image"),this.addRes(skillcfg.m_effect+"_plist","battle/effect/"+skillcfg.m_effect+".plist","xml"))}}else if(npc.attributes.name.indexOf("item")>=0){var names=npc.attributes.name.split("|"),cfg=ConfigManager_1.default.getInstance().getConfig("item",Number(names[2]));this.addRes(cfg.icon+"_texture_png","battle/anim/"+cfg.icon+"/"+cfg.icon+"_texture.png","image"),this.addRes(cfg.icon+"_texture_json","battle/anim/"+cfg.icon+"/"+cfg.icon+"_texture.json","json"),this.addRes(cfg.icon+"_skeleton_json","battle/anim/"+cfg.icon+"/"+cfg.icon+"_skeleton.json","json")}}}var userInfo=this.userInfo;this.addRes(userInfo.ownedHero.icon+"_texture_png","battle/anim/"+userInfo.ownedHero.icon+"/"+userInfo.ownedHero.icon+"_texture.png","image"),this.addRes(userInfo.ownedHero.icon+"_texture_json","battle/anim/"+userInfo.ownedHero.icon+"/"+userInfo.ownedHero.icon+"_texture.json","json"),this.addRes(userInfo.ownedHero.icon+"_skeleton_json","battle/anim/"+userInfo.ownedHero.icon+"/"+userInfo.ownedHero.icon+"_skeleton.json","json");for(var i=1;i<9;i++)if(userInfo.ownedHero["item"+i]>0)for(var ids=userInfo.getEquipById(userInfo.ownedHero["item"+i]).data.skill.split("|"),j=0;j<ids.length;j++)if(Number(ids[j])>0){var skillcfg=ConfigManager_1.default.getInstance().getConfig("skill",Number(ids[j]));if(skillcfg.s_effect.length>0&&(this.addRes(skillcfg.s_effect+"_png","battle/effect/"+skillcfg.s_effect+".png","image"),this.addRes(skillcfg.s_effect+"_plist","battle/effect/"+skillcfg.s_effect+".plist","xml")),skillcfg.m_effect.length>0&&(this.addRes(skillcfg.m_effect+"_png","battle/effect/"+skillcfg.m_effect+".png","image"),this.addRes(skillcfg.m_effect+"_plist","battle/effect/"+skillcfg.m_effect+".plist","xml")),skillcfg.e_effect.length>0&&(this.addRes(skillcfg.e_effect+"_png","battle/effect/"+skillcfg.e_effect+".png","image"),this.addRes(skillcfg.e_effect+"_plist","battle/effect/"+skillcfg.e_effect+".plist","xml")),"build"==skillcfg.skill_type&&skillcfg.build_id+0>0){var cfg=ConfigManager_1.default.getInstance().getConfig("item",Number(skillcfg.build_id));if(null==cfg&&(cfg=ConfigManager_1.default.getInstance().getConfig("npc_enemy",Number(skillcfg.build_id)),Number(cfg.attack)>0)){var skillcfg=ConfigManager_1.default.getInstance().getConfig("skill",Number(cfg.attack));skillcfg.s_effect.length>0&&(console.log(skillcfg.s_effect),this.addRes(skillcfg.s_effect+"_png","battle/effect/"+skillcfg.s_effect+".png","image"),this.addRes(skillcfg.s_effect+"_plist","battle/effect/"+skillcfg.s_effect+".plist","xml")),skillcfg.e_effect.length>0&&(this.addRes(skillcfg.e_effect+"_png","battle/effect/"+skillcfg.e_effect+".png","image"),this.addRes(skillcfg.e_effect+"_plist","battle/effect/"+skillcfg.e_effect+".plist","xml")),skillcfg.m_effect.length>0&&(this.addRes(skillcfg.m_effect+"_png","battle/effect/"+skillcfg.m_effect+".png","image"),this.addRes(skillcfg.m_effect+"_plist","battle/effect/"+skillcfg.m_effect+".plist","xml"))}this.addRes(cfg.icon+"_texture_png","battle/anim/"+cfg.icon+"/"+cfg.icon+"_texture.png","image"),this.addRes(cfg.icon+"_texture_json","battle/anim/"+cfg.icon+"/"+cfg.icon+"_texture.json","json"),this.addRes(cfg.icon+"_skeleton_json","battle/anim/"+cfg.icon+"/"+cfg.icon+"_skeleton.json","json")}}},BattleStartLoading.prototype.loadContentRes=function(){var keys="",resources=[];for(var key in this.resQueue){var res=this.resQueue[key];keys+=key+",",resources.push(res)}var configData={groups:[{keys:keys.substr(0,keys.length-1),name:"battleContent"}],resources:resources};RES.parseConfig(configData,"resource/"),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onContentLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onContentProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("battleContent",0),this.resQueue={}},BattleStartLoading.prototype.onContentLoadComplete=function(event){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onContentLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onContentProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.setProgress("成功创建世界,即将开始游戏",1,1),this.dispatchEvent(new egret.Event(BattleStartLoading.BATTLE_RES_LOAD_COMPLETE,!1,!1,this.levelData))},BattleStartLoading.prototype.onContentProgress=function(event){this.setProgress("加载界面素材资源",event.itemsTotal+4*event.itemsLoaded,5*event.itemsTotal)},BattleStartLoading.prototype.onItemLoadError=function(event){console.warn("Url:"+event.resItem.url+" has failed to load")},BattleStartLoading.prototype.onResourceLoadError=function(event){console.warn("Group:"+event.groupName+" has failed to load")},BattleStartLoading.prototype.onResourceProgress=function(event){this.setProgress("加载界面素材资源",event.itemsLoaded,5*event.itemsTotal)},BattleStartLoading.startBattleLoading=function(levelData){SoundManager_1.default.getInstance().stop("ui_mp3");var levelBgm=levelData.level_bgm;levelBgm&&levelBgm.length>0&&SoundManager_1.default.getInstance().stop(levelBgm),SoundManager_1.default.getInstance().playMusic(levelBgm+"_mp3",0,0);var loadView=new BattleStartLoading;levelData.player_info||(levelData.player_info=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data),LayerManager_1.default.stage.addChildAt(loadView,LayerManager_1.default.stage.numChildren-1),loadView.addEventListener(BattleStartLoading.BATTLE_RES_LOAD_COMPLETE,this.onEnterBattle,this),loadView.parseCommonRes(levelData),loadView.loadCommonRes()},BattleStartLoading.onEnterBattle=function(e){var loadView=e.currentTarget;loadView.removeEventListener(BattleStartLoading.BATTLE_RES_LOAD_COMPLETE,this.onEnterBattle,this),LayerManager_1.default.stage.removeChild(loadView),WindowManager_1.default.closeAllWindow(!0),FrameTweenLite_1.default.killAll(),SceneManager_1.default.getInstance().replaceScene(new BattleScene_1.default,e.data),console.log("[BattleStartLoading.onEnterBattle]",e.data)},BattleStartLoading.BATTLE_RES_LOAD_COMPLETE="battleResLoadComplete",BattleStartLoading}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=BattleStartLoading},{"../../base/da/DataAccessManager":2,"../../base/popup/WindowManager":13,"../../base/utils/FrameTweenLite":18,"../../enums/Globals":46,"../../manager/ConfigManager":54,"../../manager/LayerManager":55,"../../manager/SceneManager":57,"../../manager/SoundManager":58,"../../model/DataAccessEntry":59,"../battlescene/BattleScene":88}],137:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},SoundManager_1=require("../../manager/SoundManager"),ScreenLoading_1=require("./ScreenLoading"),LayerManager_1=require("../../manager/LayerManager"),Globals_1=require("../../enums/Globals"),Platform_1=require("../../platforms/Platform"),PasswordHelper_1=require("../mainsceneui/PasswordHelper"),ConfigManager_1=require("../../manager/ConfigManager"),NetManager_1=require("../../model/net/NetManager"),GameStartLoading=function(_super){function GameStartLoading(){_super.call(this),this.RES_GROUP_COUNT=4,this.currentGroupIndex=0,this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}return __extends(GameStartLoading,_super),GameStartLoading.prototype.load=function(){this.screenLoading=new ScreenLoading_1.default,this.addChild(this.screenLoading),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json?ver=1.0.0","resource/")},GameStartLoading.prototype.onConfigComplete=function(event){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onPreloadResourceComplete,this),RES.loadGroup("preload",100)},GameStartLoading.prototype.onPreloadResourceComplete=function(event){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onPreloadResourceComplete,this),this.screenLoading.showLoading(),new eui.Theme("resource/default.thm.json",this.stage).addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("config",0),RES.loadGroup("mainscene",1),RES.loadGroup("common",2),RES.loadGroup("login",3)},GameStartLoading.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},GameStartLoading.prototype.onResourceLoadComplete=function(event){if("config"==event.groupName){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.currentGroupIndex=0,ConfigManager_1.default.getInstance().init();var sysConfig=RES.getRes("sys_json");Platform_1.default.createPlatform(sysConfig.platform);var userName=egret.localStorage.getItem("user_name");userName&&"null"!=userName?(NetManager_1.default.getInstance().userName=egret.localStorage.getItem("user_name"),Platform_1.default.currentPlatform.openUserId=NetManager_1.default.getInstance().userName,this.isResourceLoadEnd=!0,this.createScene()):this.showLogin()}"sounds"==event.groupName&&(SoundManager_1.default.getInstance().playMusic("ui_mp3",0,0),SoundManager_1.default.getInstance().restoreSoundSetting()),this.currentGroupIndex++},GameStartLoading.prototype.showLogin=function(){this.screenLoading.showLogin(),this.thumb=new egret.Bitmap(RES.getRes("start_login_bg")),this.addChild(this.thumb),this.thumb.x=Globals_1.default.GAME_WIDTH/2-410,this.thumb.y=Globals_1.default.GAME_HEIGHT-470,this.nameInput=new eui.TextInput,this.nameInput.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="GameTextInputSkin" width="512" height="91" states="normal,disabled,normalWithPrompt,disabledWithPrompt" xmlns:e="http://ns.egret.com/eui"><e:Image width="100%" height="100%" source="common_utils_json.common_newinput_frame_png" scale9Grid="9,10,238,21"/><e:EditableText id="textDisplay" verticalCenter="0" left="20" right="10" textColor="0x023c7c" textColor.disabled="0xff0000" width="100%" height="34" size="40"  verticalAlign="middle" minHeight="80" height.normalWithPrompt="38"/><e:Label id="promptDisplay" verticalCenter="0" left="10" right="10" textColor="0xa9a9a9" width="100%" height="38" size="20" touchEnabled="false" includeIn="normalWithPrompt,disabledWithPrompt" visible.disabledWithPrompt="false" visible.disabled="false" visible.normal="false" visible.normalWithPrompt="false" visible="false"/></e:Skin>',this.nameInput.prompt="请输入账号",this.nameInput.x=this.thumb.x+160,this.nameInput.y=this.thumb.y-20,this.addChild(this.nameInput),this.pwdInput=new eui.TextInput,this.pwdInput.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="GameTextInputSkin" width="512" height="91" states="normal,disabled,normalWithPrompt,disabledWithPrompt" xmlns:e="http://ns.egret.com/eui"><e:Image width="100%" height="100%" source="common_utils_json.common_newinput_frame_png" scale9Grid="9,10,238,21"/><e:EditableText id="textDisplay" verticalCenter="0" left="20" right="10" textColor="0x023c7c" textColor.disabled="0xff0000" width="100%" height="34" size="40"  verticalAlign="middle" minHeight="80" height.normalWithPrompt="38"/><e:Label id="promptDisplay" verticalCenter="0" left="10" right="10" textColor="0xa9a9a9" width="100%" height="38" size="20" touchEnabled="false" includeIn="normalWithPrompt,disabledWithPrompt" visible.disabledWithPrompt="false" visible.disabled="false" visible.normal="false" visible.normalWithPrompt="false" visible="false"/></e:Skin>',this.pwdInput.prompt="请输入密码",this.pwdInput.x=this.thumb.x+160,this.pwdInput.y=this.thumb.y+90,this.addChild(this.pwdInput),this.passwordHelper=new PasswordHelper_1.default(this.pwdInput),this.startButton=new eui.Button,this.startButton.label="",this.startButton.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="btnStartLearnSkin" width="439" height="147" currentState="up" xmlns:e="http://ns.egret.com/eui" states="up,over,down,disabled" ><e:Image source="start_btn_bg" includeIn="down" x="21" y="5" width="439" height="147"/><e:Image source="start_btn_bg" includeIn="over" x="0" y="0" width="470" height="158"/><e:Image source="start_btn_bg" includeIn="up" x="21" y="5" width="439" height="147"/></e:Skin>',this.startButton.x=Globals_1.default.GAME_WIDTH/2-219,this.startButton.y=Globals_1.default.GAME_HEIGHT-177,this.errText=new eui.Label,this.errText.text="err",this.errText.textColor=16711680,this.errText.x=this.thumb.x+160,this.errText.y=this.thumb.y+182,this.errText.textAlign="center",this.errText.visible=!1,this.addChild(this.errText),this.startButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartPressed,this),this.addChild(this.startButton),this.signinButton=new eui.Button,this.signinButton.label="",this.signinButton.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="btnStartLearnSkin" width="309" height="88" currentState="up" xmlns:e="http://ns.egret.com/eui" states="up,over,down,disabled" ><e:Image source="common_btn_signin_png" includeIn="down" x="6" y="2" width="343" height="102"/><e:Image source="common_btn_signin_png" includeIn="over" x="0" y="0" width="355" height="106"/><e:Image source="common_btn_signin_png" includeIn="up" x="6" y="2" width="343" height="102"/></e:Skin>',this.signinButton.x=Globals_1.default.GAME_WIDTH/2+410,this.signinButton.y=Globals_1.default.GAME_HEIGHT-220,this.signinButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSigninPressed,this),this.addChild(this.signinButton)},GameStartLoading.prototype.isEmail=function(str){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(str)},GameStartLoading.prototype.isMobilePhone=function(str){return/^(((13[0-9]{1})|(14[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/.test(str)},GameStartLoading.prototype.onSigninPressed=function(){window.location.href="http://www.youyoucode/cn/login/signup.html?redirect=code.youyoucode.cn"},GameStartLoading.prototype.onStartPressed=function(){var _this=this;if(0==this.nameInput.text.length){this.errText.text="账号不能为空,请重新输入",this.errText.visible=!0;var that=this;TweenLite.delayedCall(3,function(){that.errText.text="",that.errText.visible=!1})}else{Platform_1.default.currentPlatform.isAnonymous=!1;var userData={password:this.passwordHelper.passwordChars};this.isEmail(this.nameInput.text)?userData.email=this.nameInput.text:this.isMobilePhone(this.nameInput.text)?userData.email=this.nameInput.text:userData.username=this.nameInput.text,Platform_1.default.currentPlatform.login(userData,function(result){TweenLite.to(_this.startButton,.4,{y:Globals_1.default.GAME_HEIGHT}),_this.thumb.visible=!1,_this.nameInput.visible=!1,_this.pwdInput.visible=!1,_this.screenLoading.onStartPressed(),egret.localStorage.setItem("login_name",null),NetManager_1.default.getInstance().userName=result.userId,egret.localStorage.setItem("user_name",NetManager_1.default.getInstance().userName),_this.isResourceLoadEnd=!0,_this.createScene()})}},GameStartLoading.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&(LayerManager_1.default.stage.removeChild(this),this.dispatchEvent(new egret.Event("allLoadComplete")))},GameStartLoading.prototype.onItemLoadError=function(event){console.warn("Url:"+event.resItem.url+" has failed to load")},GameStartLoading.prototype.onResourceLoadError=function(event){console.warn("Group:"+event.groupName+" has failed to load"),this.onResourceLoadComplete(event)},GameStartLoading.prototype.onResourceProgress=function(event){var pro=this.currentGroupIndex+event.itemsLoaded/event.itemsTotal;this.screenLoading.setProgress(pro,this.RES_GROUP_COUNT)},GameStartLoading}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GameStartLoading},{"../../enums/Globals":46,"../../manager/ConfigManager":54,"../../manager/LayerManager":55,"../../manager/SoundManager":58,"../../model/net/NetManager":68,"../../platforms/Platform":81,"../mainsceneui/PasswordHelper":148,"./ScreenLoading":138}],138:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Globals_1=require("../../enums/Globals"),LayerManager_1=require("../../manager/LayerManager"),ScreenLoading=function(_super){function ScreenLoading(){_super.call(this),this.MASK_WIDTH=0,this.OFF_SET_X=440,this.OFF_SET_Y=410,this.createView()}return __extends(ScreenLoading,_super),ScreenLoading.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.x=.5*Globals_1.default.GAME_WIDTH-240,this.textField.y=414+this.OFF_SET_Y,this.textField.size=24,this.textField.width=480,this.textField.height=50,this.textField.textAlign="center",this.textField.text="请稍等..."},ScreenLoading.prototype.showLoading=function(bgRes){void 0===bgRes&&(bgRes="loadingBg_jpg");var loadingBg=RES.getRes(bgRes),bmp=new egret.Bitmap(loadingBg);this.addChild(bmp),this.setChildIndex(bmp,0),this.maskContainer=new egret.Sprite,this.addChild(this.maskContainer),this.setChildIndex(this.maskContainer,1),this.loadingMask=new egret.Sprite,this.maskContainer.addChild(this.loadingMask);var bar=RES.getRes("pic_progress-bar_png"),bmpBar=new egret.Bitmap(bar);this.maskContainer.addChild(bmpBar),this.maskContainer.setChildIndex(bmpBar,0),bmpBar.mask=this.loadingMask,this.MASK_WIDTH=bmpBar.width,this.updateMaskGraphics(this.MASK_WIDTH,bmpBar.height);var barBg=RES.getRes("loading_pic_bg_png");this.bmpBarBg=new egret.Bitmap(barBg),this.bmpBarBg.x=.5*(Globals_1.default.GAME_WIDTH-this.bmpBarBg.width),this.bmpBarBg.y=800,this.addChild(this.bmpBarBg),this.setChildIndex(this.bmpBarBg,1),this.maskContainer.x=.5*(Globals_1.default.GAME_WIDTH-this.maskContainer.width),this.maskContainer.y=this.bmpBarBg.y+.5*(this.bmpBarBg.height-this.maskContainer.height),this.thumb=new egret.Bitmap(RES.getRes("pic_effect_png")),this.addChild(this.thumb),this.thumb.x=this.maskContainer.x-this.thumb.width,this.thumb.y=this.maskContainer.y+.5*(this.maskContainer.height-this.thumb.height)},ScreenLoading.prototype.showLogin=function(){this.maskContainer.visible=!1,this.thumb.visible=!1,this.bmpBarBg.visible=!1,this.textField.visible=!1},ScreenLoading.prototype.onStartPressed=function(){this.textField.size=30,this.textField.text="正在初始化数据,请稍等...",this.textField.visible=!0},ScreenLoading.prototype.updateMaskGraphics=function(w,h){this.maskContainer.graphics.clear(),this.maskContainer.graphics.beginFill(0,0),this.maskContainer.graphics.drawRect(0,0,w,h),this.maskContainer.graphics.endFill()},ScreenLoading.prototype.setProgress=function(current,total){this.updateMask(current,total)},ScreenLoading.prototype.updateMask=function(cur,max){this.loadingMask.graphics.clear(),this.loadingMask.graphics.beginFill(0,1);var progress=this.MASK_WIDTH*cur/max;this.loadingMask.graphics.moveTo(0,0),this.loadingMask.graphics.lineTo(progress-20,0),this.loadingMask.graphics.lineTo(progress,this.maskContainer.height/2),this.loadingMask.graphics.lineTo(progress-20,this.maskContainer.height),this.loadingMask.graphics.lineTo(0,this.maskContainer.height),this.loadingMask.graphics.lineTo(0,0),this.loadingMask.graphics.endFill(),this.thumb.x=this.maskContainer.x-this.thumb.width+20+progress,this.textField.text="loading..."+Math.ceil(cur)+"/"+max+"  ("+Math.ceil(progress/this.MASK_WIDTH*100)+"%)"},ScreenLoading.show=function(){ScreenLoading.instance||(ScreenLoading.instance=new ScreenLoading),LayerManager_1.default.appLayer.addChildAt(ScreenLoading.instance,LayerManager_1.default.appLayer.numChildren-1),ScreenLoading.instance.showLoading()},ScreenLoading.setProgress=function(cur,max){ScreenLoading.instance&&ScreenLoading.instance.setProgress(cur,max)},ScreenLoading.hide=function(){LayerManager_1.default.appLayer.contains(ScreenLoading.instance)&&LayerManager_1.default.appLayer.removeChild(ScreenLoading.instance)},ScreenLoading}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ScreenLoading},{"../../enums/Globals":46,"../../manager/LayerManager":55}],139:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},LayerManager_1=require("../../manager/LayerManager"),Globals_1=require("../../enums/Globals"),FrameTweenLite_1=require("../../base/utils/FrameTweenLite"),UIPopupLoading=function(_super){function UIPopupLoading(){_super.call(this),this.currentGroupIndex=0,this.createLoadingUI()}return __extends(UIPopupLoading,_super),UIPopupLoading.prototype.createLoadingUI=function(){this.sceneMask=new egret.Sprite,this.sceneMask.graphics.clear(),this.sceneMask.graphics.beginFill(0,1),this.sceneMask.graphics.drawRect(0,0,Globals_1.default.GAME_WIDTH,Globals_1.default.GAME_HEIGHT),this.sceneMask.alpha=0,this.addChild(this.sceneMask),this.bmpbg=new egret.Bitmap(RES.getRes("small_loading_bg")),this.bmpbg.x=Globals_1.default.GAME_WIDTH/2-75,this.bmpbg.y=Globals_1.default.GAME_HEIGHT/2-75,this.bmpbg.alpha=0,this.addChild(this.bmpbg),this.loadingMask=new egret.Sprite,this.addChild(this.loadingMask),this.bmp=new egret.Bitmap(RES.getRes("small_loading_top")),this.bmp.x=Globals_1.default.GAME_WIDTH/2-75,this.bmp.y=Globals_1.default.GAME_HEIGHT/2-75,this.addChild(this.bmp),this.bmp.alpha=0,this.bmp.mask=this.loadingMask,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this)},UIPopupLoading.prototype.onAddedToStage=function(event){RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this);for(var i=0;i<this.data.length;i++)RES.loadGroup(this.data[i],i);this.sceneMask.alpha=0;var that=this;FrameTweenLite_1.default.to(this.sceneMask,1,{alpha:.7,onComplete:function(){that.bmp.alpha=1,that.bmpbg.alpha=1}})},UIPopupLoading.startPopupLoading=function(dat){var loadView=new UIPopupLoading;loadView.loadCommonRes(dat),LayerManager_1.default.stage.addChildAt(loadView,LayerManager_1.default.stage.numChildren-1)},UIPopupLoading.prototype.loadCommonRes=function(dat){this.data=dat,this.currentGroupIndex=0},UIPopupLoading.prototype.onResourceLoadComplete=function(event){++this.currentGroupIndex>=this.data.length&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),FrameTweenLite_1.default.killAll(),LayerManager_1.default.stage.dispatchEvent(new egret.Event(UIPopupLoading.POPUP_RES_LOAD_COMPLETE,!1,!1,this.data)),LayerManager_1.default.stage.removeChild(this))},UIPopupLoading.prototype.onResourceLoadError=function(event){},UIPopupLoading.prototype.onResourceProgress=function(event){var angle=360*event.itemsLoaded/event.itemsTotal,n=Math.ceil(Math.abs(angle)/45),angleA=angle/n,startFrom=270;angleA=angleA*Math.PI/180,this.loadingMask.graphics.clear(),this.loadingMask.graphics.beginFill(0,1),this.loadingMask.graphics.moveTo(Globals_1.default.GAME_WIDTH/2,Globals_1.default.GAME_HEIGHT/2),this.loadingMask.graphics.lineTo(Globals_1.default.GAME_WIDTH/2+80*Math.cos(startFrom),Globals_1.default.GAME_HEIGHT/2+80*Math.sin(startFrom));for(var i=1;i<=n;i++){startFrom+=angleA;var angleMid=startFrom-angleA/2,bx=Globals_1.default.GAME_WIDTH/2+80/Math.cos(angleA/2)*Math.cos(angleMid),by=Globals_1.default.GAME_HEIGHT/2+80/Math.cos(angleA/2)*Math.sin(angleMid),cx=Globals_1.default.GAME_WIDTH/2+80*Math.cos(startFrom),cy=Globals_1.default.GAME_HEIGHT/2+80*Math.sin(startFrom);this.loadingMask.graphics.curveTo(bx,by,cx,cy)}360!=angle&&this.loadingMask.graphics.moveTo(Globals_1.default.GAME_WIDTH/2,Globals_1.default.GAME_HEIGHT/2)},UIPopupLoading.prototype.onItemLoadError=function(event){console.warn("Url:"+event.resItem.url+" has failed to load")},UIPopupLoading.POPUP_RES_LOAD_COMPLETE="popupResLoadComplete",UIPopupLoading
}(egret.Sprite);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=UIPopupLoading},{"../../base/utils/FrameTweenLite":18,"../../enums/Globals":46,"../../manager/LayerManager":55}],140:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ArenaBtn=function(_super){function ArenaBtn(){_super.call(this),this.isDisabled=!0,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="ArenaBtnSkin" width="820" height="280" xmlns:e="http://ns.egret.com/eui"><e:Image id=\'gamefeature_display\' source="main_scene_json.gamefeature_display_normal" locked="true"/><e:Image id=\'gamefeature_name\'    source="main_scene_json.gamefeature_word_disabled_3" x="274" y="96"/><e:Image source="main_scene_json.gamefeature_locked" x="242" y="49"/><e:Image source="main_scene_json.gamefeature_disabled" x="120" y="49"/></e:Skin>'}return __extends(ArenaBtn,_super),ArenaBtn.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),1!=this.isDisabled&&this.initListeners()},ArenaBtn.prototype.onMouseOut=function(e){this.selected_frame.visible=!1},ArenaBtn.prototype.onMouseOver=function(e){this.selected_frame.visible=!0},ArenaBtn.prototype.initListeners=function(){this.touchEnabled=this.touchChildren=!0,this.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),this.addEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this)},ArenaBtn.prototype.removeListeners=function(){this.touchEnabled=this.touchChildren=!1,this.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),this.removeEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this)},ArenaBtn}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ArenaBtn},{}],141:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ExploreWayBtn=function(_super){function ExploreWayBtn(options){_super.call(this),this.isDisabled=!1,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="ExploreWayBtnSkin" width="836" height="282" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image id=\'gamefeature_display\' source="main_scene_json.gamefeature_display_normal"/><e:Image id=\'gamefeature_name\'    source="main_scene_json.gamefeature_word_normal_1" x="274" y="96"/><e:Image id="campaign_name_display" source="main_scene_json.campaign_word_normal_1" x="102" y="41"/><e:Image id=\'level_start_0\' source="common_utils_json.num_blue_1_png" x="238" y="46"/><e:Image id=\'level_start_1\'   source="common_utils_json.num_blue_0_png" x="256" y="46"/><e:Image id=\'level_connect\' source="common_utils_json.num_blue_and_png" x="279" y="46"/><e:Image id=\'level_end_0\' source="common_utils_json.num_blue_2_png" x="301" y="46"/><e:Image id=\'level_end_1\'   source="common_utils_json.num_blue_1_png" x="321" y="46"/><e:Image id=\'gamefeature_disabled\' source="main_scene_json.gamefeature_disabled" x="31" y="33" visible="false"/></e:Skin>',this.name="btnExploreWay"}return __extends(ExploreWayBtn,_super),ExploreWayBtn.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.campaign_name_display.texture=RES.getRes("main_scene_json.campaign_word_normal_1"),1!=this.isDisabled&&this.initListeners()},ExploreWayBtn.prototype.setCurrLevelTip=function(levelTip,state){this.level_start_0.visible=this.level_start_1.visible=this.level_end_0.visible=this.level_end_1.visible=!1,this.level_connect.visible=!0,levelTip||(levelTip="1-1"),this.level_chunk=levelTip,void 0!=state&&"normal"!=state||(state="blue"),"selected"==state&&(state="yellow");var tip=levelTip.split("-"),mapIndex=tip[0],levelIndex=tip[1];2==mapIndex.length?(this.level_start_0.visible=this.level_start_1.visible=!0,this.level_start_0.texture=RES.getRes("common_utils_json.num_"+state+"_"+mapIndex[0]+"_png"),this.level_start_1.texture=RES.getRes("common_utils_json.num_"+state+"_"+mapIndex[1]+"_png")):1==mapIndex.length&&(this.level_start_1.visible=!0,this.level_start_0.visible=!1,this.level_start_1.texture=RES.getRes("common_utils_json.num_"+state+"_"+mapIndex[0]+"_png")),this.level_connect.texture=RES.getRes("common_utils_json.num_"+state+"_and_png"),2==levelIndex.length?(this.level_end_0.visible=this.level_end_1.visible=!0,this.level_end_0.texture=RES.getRes("common_utils_json.num_"+state+"_"+levelIndex[0]+"_png"),this.level_end_1.texture=RES.getRes("common_utils_json.num_"+state+"_"+levelIndex[1]+"_png")):1==levelIndex.length&&(this.level_end_0.visible=!0,this.level_end_1.visible=!1,this.level_end_0.texture=RES.getRes("common_utils_json.num_"+state+"_"+levelIndex[0]+"_png"))},ExploreWayBtn.prototype.onMouseOut=function(e){this.gamefeature_display.texture=RES.getRes("main_scene_json.gamefeature_display_normal"),this.gamefeature_name.texture=RES.getRes("main_scene_json.gamefeature_word_normal_1"),this.campaign_name_display.texture=RES.getRes("main_scene_json.campaign_word_normal_1"),this.setCurrLevelTip(this.level_chunk,"normal")},ExploreWayBtn.prototype.onMouseOver=function(e){this.gamefeature_display.texture=RES.getRes("main_scene_json.gamefeature_display_selected"),this.gamefeature_name.texture=RES.getRes("main_scene_json.gamefeature_word_selected_1"),this.campaign_name_display.texture=RES.getRes("main_scene_json.campaign_word_selected_1"),this.setCurrLevelTip(this.level_chunk,"selected")},ExploreWayBtn.prototype.initListeners=function(){this.touchEnabled=!0,this.touchChildren=!1,this.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),this.addEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this)},ExploreWayBtn.prototype.removeListeners=function(){this.touchEnabled=this.touchChildren=!1,this.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),this.removeEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this)},ExploreWayBtn}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ExploreWayBtn},{}],142:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GeekWayBtn=function(_super){function GeekWayBtn(){_super.call(this),this.isDisabled=!0,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="GeekWayBtnSkin" width="836" height="282" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image id=\'gamefeature_display\' source="main_scene_json.gamefeature_display_normal" locked="true"/><e:Image id=\'gamefeature_name\'    source="main_scene_json.gamefeature_word_disabled_2" x="274" y="96"/><e:Image source="main_scene_json.gamefeature_locked" x="242" y="49"/><e:Image source="main_scene_json.gamefeature_disabled" x="120" y="49"/></e:Skin>'}return __extends(GeekWayBtn,_super),GeekWayBtn.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),1!=this.isDisabled&&this.initListeners()},GeekWayBtn.prototype.onMouseOut=function(e){this.gamefeature_display.texture=RES.getRes("main_scene_json.gamefeature_display_normal_2"),this.gamefeature_name.visible=RES.getRes("main_scene_json.gamefeature_word_normal_2"),this.campaign_name_display.texture=RES.getRes("main_scene_json.campaign_word_normal_2")},GeekWayBtn.prototype.onMouseOver=function(e){this.gamefeature_display.texture=RES.getRes("main_scene_json.gamefeature_display_selected_2"),this.gamefeature_name.visible=RES.getRes("main_scene_json.gamefeature_word_selected_2"),this.campaign_name_display.texture=RES.getRes("main_scene_json.campaign_word_selected_2")},GeekWayBtn.prototype.initListeners=function(){this.touchEnabled=this.touchChildren=!0,this.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),this.addEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this)},GeekWayBtn.prototype.removeListeners=function(){this.touchEnabled=this.touchChildren=!1,this.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),this.removeEventListener(mouse.MouseEvent.MOUSE_OUT,this.onMouseOut,this)},GeekWayBtn}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GeekWayBtn},{}],143:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Globals_1=require("../../enums/Globals"),NetManager_1=require("../../model/net/NetManager"),UserInfoProxy_1=require("../../model/da/UserInfoProxy"),WindowManager_1=require("../../base/popup/WindowManager"),RegisterAgeWindow_1=require("../mainsceneui/RegisterAgeWindow"),Alert_1=require("../../view/common/Alert"),HUDPanel=function(_super){function HUDPanel(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="HUDPanelSkin" width="1007" height="200" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><w:Config id="15ad59d796f"/><e:Image source="main_scene_json.hud_name_frame" x="149" y="58" scaleX="1" scaleY="1" locked="true"/><e:Image source="main_scene_json.hud_tips_frame" x="149" y="62" scaleX="1" scaleY="1" visible="false"/><e:Image id="imgHead" x="38" y="26" scaleX="1" scaleY="1" width="119" height="123"/><e:Image source="main_scene_json.hud_head_frame" x="18" y="11" scaleX="1" scaleY="1"/><e:Label id="player_name_label" text="悠悠游客" x="171" y="22" width="257" size="36" strokeColor="0x090000" stroke="2"/><e:Label id="labelExp" text="EXP    0/0" x="160" y="118" width="208" height="24" size="24" textAlign="left" stroke="3" strokeColor="0x023d8c"/><e:Label id="labelLvl" text="Lv. 19" x="18" y="153" size="24" strokeColor="0x023d8c" stroke="3" width="159" textAlign="center" fontFamily="Microsoft YaHei UI" textColor="0xffffff"/><e:Button id=\'btnRegister\' x="254" y="148" skinName="RegisterButtonSkin"/><e:Button id="btnLoginOut" x="145" y="148" skinName="LoginOutButtonSkin"/><e:Button id=\'btnLoginIn\'  x="145" y="148" skinName="LoginInButtonSkin"/><e:Image source="main_scene_json.vigor_cell_normal" x="160" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="180" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="200" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="220" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="240" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="260" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="280" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="300" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="320" y="76"/><e:Image source="main_scene_json.vigor_cell_normal" x="340" y="76"/><e:Image id="vigor_cell_0" source="main_scene_json.vigor_cell_selected" x="160" y="76"/><e:Image id="vigor_cell_1" source="main_scene_json.vigor_cell_selected" x="180" y="76"/><e:Image id="vigor_cell_2" source="main_scene_json.vigor_cell_selected" x="200" y="76"/><e:Image id="vigor_cell_3" source="main_scene_json.vigor_cell_selected" x="220" y="76"/><e:Image id="vigor_cell_4" source="main_scene_json.vigor_cell_selected" x="240" y="76"/><e:Image id="vigor_cell_5" source="main_scene_json.vigor_cell_selected" x="260" y="76"/><e:Image id="vigor_cell_6" source="main_scene_json.vigor_cell_selected" x="280" y="76"/><e:Image id="vigor_cell_7" source="main_scene_json.vigor_cell_selected" x="300" y="76"/><e:Image id="vigor_cell_8" source="main_scene_json.vigor_cell_selected" x="320" y="76"/><e:Image id="vigor_cell_9" source="main_scene_json.vigor_cell_selected" x="340" y="76"/><e:Image source="explore_json.explore_tips_frame_png" x="501" y="33"/><e:Image source="explore_json.explore_icon_vigor_png" x="449" y="22"/><e:Label id="labelVigorCount" text="200/200" x="517" y="40" width="127" height="46" size="24" verticalAlign="middle" textAlign="center" stroke="3" strokeColor="0x023d8c"/><e:Button id="btnBuyVigor" skinName="CommonBuyBtnSkin" x="637" y="41"/><e:Image source="explore_json.explore_tips_frame_png" x="772" y="32"/><e:Image source="explore_json.explore_icon_gem_png" x="731" y="21"/><e:Label id="labelGemCount" text="2345" x="796" y="38" width="120" height="45" size="24" verticalAlign="middle" textAlign="center" stroke="3" strokeColor="0x023d8c"/><e:Button id="btnBuyGem" skinName="CommonBuyBtnSkin" x="907" y="40"/></e:Skin>'}return __extends(HUDPanel,_super),HUDPanel.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.btnLoginIn.name="btnLogin",this.touchEnabled=this.touchChildren=!0,this.btnRegister.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRegisterTouchHandler,this),this.btnLoginIn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnLoginTouchHandler,this),this.btnLoginOut.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnLogOutTouchHandler,this),this.btnBuyVigor.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyVigor,this),this.btnBuyGem.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyGem,this),NetManager_1.default.getInstance().addEventListener(UserInfoProxy_1.default.STORY_UPDATE_DATA,this.onUserInfoUpdate,this)},HUDPanel.prototype.onBtnRegisterTouchHandler=function(e){WindowManager_1.default.showWindow(RegisterAgeWindow_1.default,"RegisterAgeWindow")},HUDPanel.prototype.onBtnLoginTouchHandler=function(e){},HUDPanel.prototype.onBtnLogOutTouchHandler=function(e){egret.localStorage.setItem("user_name",null),window.location.reload()},HUDPanel.prototype.onBuyVigor=function(event){Alert_1.default.show("体力购买","暂未开放",2)},HUDPanel.prototype.onBuyGem=function(event){Alert_1.default.show("钻石购买","暂未开放",2)},HUDPanel.prototype.onUserInfoUpdate=function(event){var userInfo=event.data.userInfo;userInfo&&this.update(userInfo)},HUDPanel.prototype.update=function(userInfo){this.player_name_label.text=userInfo.nickName||"悠悠游客",this.imgHead.source=userInfo.headImgUrl||"resource/icon/role/career_head/"+userInfo.headIcon+".png",this.labelGemCount.text=userInfo.diamond.toString(),this.labelLvl.text="Lv. "+userInfo.level.toString(),this.labelVigorCount.text=userInfo.vigor+"/"+Globals_1.default.MAX_INIT_VIGOR,this.calculateExp(userInfo.exp),this.calculateVigor(userInfo.vigor),this.btnLoginIn.visible=!1,this.btnLoginOut.visible=!0,this.btnRegister.visible=!1},HUDPanel.prototype.calculateExp=function(userExp){var currLevel=this.levelFromExp(userExp),currLevelExp=this.expForLevel(currLevel),currExp=userExp-currLevelExp,totalExp=this.expForLevel(currLevel+1)-currLevelExp;this.labelExp.text="EXP   "+currExp+"/"+totalExp},HUDPanel.prototype.levelFromExp=function(exp){return exp<=0?1:Math.floor(5*Math.log(.01*(exp+100)))+1},HUDPanel.prototype.expForLevel=function(level){return level<=1?0:Math.ceil(100*Math.exp((level-1)/5)-100)},HUDPanel.prototype.calculateVigor=function(userVigor){for(var vigor_cell_num=Math.floor(userVigor/15),i=0;i<10;++i)this["vigor_cell_"+i].visible=i<vigor_cell_num},HUDPanel.prototype.dispose=function(){this.btnRegister.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnRegisterTouchHandler,this),this.btnLoginIn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnLoginTouchHandler,this),this.btnLoginOut.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnLoginTouchHandler,this),this.btnBuyVigor.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyVigor,this),this.btnBuyGem.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuyGem,this),this.btnLoginOut.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnLogOutTouchHandler,this),NetManager_1.default.getInstance().removeEventListener(UserInfoProxy_1.default.STORY_UPDATE_DATA,this.onUserInfoUpdate,this)},HUDPanel}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=HUDPanel},{"../../base/popup/WindowManager":13,"../../enums/Globals":46,"../../model/da/UserInfoProxy":67,"../../model/net/NetManager":68,"../../view/common/Alert":115,"../mainsceneui/RegisterAgeWindow":149}],144:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Scene_1=require("../../base/view/Scene"),LoginProxy_1=require("./../../model/da/LoginProxy"),UserInfo_1=require("../../model/vo/UserInfo"),HUDPanel_1=require("./HUDPanel"),MainToolBtn_1=require("./MainToolBtn"),ExploreWayBtn_1=require("./ExploreWayBtn"),GeekWayBtn_1=require("./GeekWayBtn"),ArenaBtn_1=require("./ArenaBtn"),NetManager_1=require("../../model/net/NetManager"),ExploreWindow_1=require("../explore/ExploreWindow"),WindowManager_1=require("../../base/popup/WindowManager"),FrameTweenLite_1=require("../../base/utils/FrameTweenLite"),SoundManager_1=require("../../manager/SoundManager"),ConfigManager_1=require("../../../src/manager/ConfigManager"),Platform_1=require("../../platforms/Platform"),BattleStartLoading_1=require("../loading/BattleStartLoading"),EquipInfo_1=require("../../model/vo/EquipInfo"),HeroInfo_1=require("../../model/vo/HeroInfo"),UIPopupLoading_1=require("../loading/UIPopupLoading"),LayerManager_1=require("../../manager/LayerManager"),UserInfoProxy_1=require("../../model/da/UserInfoProxy"),Protocols_1=require("../../enums/Protocols"),MainScene=function(_super){function MainScene(){_super.call(this),this.skinName="MainSceneSkin"}return __extends(MainScene,_super),MainScene.prototype.setData=function(dat){NetManager_1.default.getInstance().addEventListener(LoginProxy_1.default.LOGIN_DATA,this.onLoginData,this),NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_LOGIN,{name:Platform_1.default.currentPlatform.platformName||"悠悠游客",classId:Platform_1.default.currentPlatform.classId})},MainScene.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.hudPanel=new HUDPanel_1.default,this.addChild(this.hudPanel),this.exploreWayBtn=new ExploreWayBtn_1.default,this.addChild(this.exploreWayBtn),this.exploreWayBtn.x=2217,this.exploreWayBtn.y=140,FrameTweenLite_1.default.to(this.exploreWayBtn,.3,{x:1017}),this.geekWayBtn=new GeekWayBtn_1.default,this.addChild(this.geekWayBtn),this.geekWayBtn.x=2217,this.geekWayBtn.y=380,FrameTweenLite_1.default.to(this.geekWayBtn,.3,{delay:.15,x:1017}),this.arenaBtn=new ArenaBtn_1.default,this.addChild(this.arenaBtn),this.arenaBtn.x=2217,this.arenaBtn.y=620,FrameTweenLite_1.default.to(this.arenaBtn,.3,{delay:.3,x:1017}),this.mainToolBtns=new MainToolBtn_1.default,this.addChild(this.mainToolBtns),this.mainToolBtns.x=1024,this.mainToolBtns.y=912,this.initListeners(),NetManager_1.default.getInstance().addEventListener(UserInfoProxy_1.default.HERO_CHANGED,this.onUserInfoUpdate,this)},MainScene.prototype.onUserInfoUpdate=function(e){var heroInfo=e.data;this.userInfo&&(this.user_carrer_figure.source="resource/icon/role/career_figure/"+heroInfo.data.career_figure+".png")},MainScene.prototype.onLoginData=function(event){NetManager_1.default.getInstance().removeEventListener(LoginProxy_1.default.LOGIN_DATA,this.onLoginData,this),this.userInfo=event.data,console.log(this.userInfo),this.hudPanel.update(this.userInfo),this.exploreWayBtn.setCurrLevelTip(this.getCurrLevelInfo(this.userInfo)),this.mainToolBtns.btnTeacher.visible=this.userInfo.isTeacher,this.user_carrer_figure.source="resource/icon/role/career_figure/"+this.userInfo.ownedHero.data.career_figure+".png"},MainScene.prototype.initListeners=function(){this.touchEnabled=this.touchChildren=!0,this.exploreWayBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExploreWayTouchHandler,this)},MainScene.prototype.onBtnExploreWayTouchHandler=function(e){SoundManager_1.default.getInstance().playEffect("u01_button_mp3"),FrameTweenLite_1.default.to(this.exploreWayBtn,.22,{x:2100}),FrameTweenLite_1.default.to(this.geekWayBtn,.22,{delay:.15,x:2100}),FrameTweenLite_1.default.to(this.arenaBtn,.22,{delay:.3,x:2100}),LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this),UIPopupLoading_1.default.startPopupLoading(["explore"])},MainScene.prototype.onEnterPopup=function(e){this.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this),WindowManager_1.default.showWindow(ExploreWindow_1.default,"ExploreWindow","地图界面",this.userInfo),FrameTweenLite_1.default.killTweensOf(this.exploreWayBtn),FrameTweenLite_1.default.killTweensOf(this.geekWayBtn),FrameTweenLite_1.default.killTweensOf(this.arenaBtn),this.exploreWayBtn.x=1017,this.geekWayBtn.x=1017,this.arenaBtn.x=1017},MainScene.prototype.getCurrLevelInfo=function(userInfo){var chapter_config=ConfigManager_1.default.getInstance().getConfigs("pve_story_map"),level_config=(ConfigManager_1.default.getInstance().getConfigs("pve_story_group"),ConfigManager_1.default.getInstance().getConfigs("pve_story_level")),retain_level_index=userInfo.storyID,retain_chapter_index=(level_config[retain_level_index].group,level_config[retain_level_index].map),chapter_chunck=Object.keys(chapter_config).indexOf(retain_chapter_index)+1,levels=[];for(var levelId in level_config)level_config[levelId].map==retain_chapter_index&&levels.push(levelId);return chapter_chunck+"-"+(levels.indexOf(retain_level_index.toString())+1)},MainScene.prototype.removeListeners=function(){this.touchEnabled=this.touchChildren=!1,this.exploreWayBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnExploreWayTouchHandler,this)},MainScene.prototype.dispose=function(){this.removeListeners()},MainScene.prototype.enterGuideLevel=function(){var level=ConfigManager_1.default.getInstance().getConfig("pve_story_level",11e4),userInfo=new UserInfo_1.default,data={user:{activate:0,coin:0,diamond:0,exp:0,hid:55,id:264,level:1,mid:1001,name:"namePlayer",storyID:11e4},equips:[{id:130,mid:10100,uid:264},{id:131,mid:12101,uid:264},{id:132,mid:13001,uid:264},{id:133,mid:14004,uid:264}],heros:[{exp:0,id:55,mid:30002,item1:130,item2:0,item3:131,item4:132,item5:133,item6:0,item7:0,item8:0,uid:264}]},resInfo=data.user;userInfo.uuid=parseInt(resInfo.id),userInfo.exp=parseInt(resInfo.exp),userInfo.diamond=parseInt(resInfo.diamond),userInfo.level=parseInt(resInfo.level),userInfo.nickName=resInfo.name,userInfo.vigor=parseInt(resInfo.physical),userInfo.serverTime=parseFloat(resInfo.createTime),userInfo.coin=parseInt(resInfo.coin),userInfo.storyID=parseInt(resInfo.storyID),userInfo.modelID=parseInt(resInfo.mid),userInfo.heroId=parseInt(resInfo.hid);var equips=data.equips,heros=data.heros;userInfo.equips=[];for(var _i=0,equips_1=equips;_i<equips_1.length;_i++){var equip=equips_1[_i],equipInfo=new EquipInfo_1.default;equipInfo.uuid=parseFloat(equip.id),equipInfo.modelID=parseInt(equip.mid),equipInfo.userId=parseFloat(equip.uid),equipInfo.updateTime=parseFloat(equip.createTime||0),userInfo.equips.push(equipInfo)}userInfo.heros=[];for(var _a=0,heros_1=heros;_a<heros_1.length;_a++){var hero=heros_1[_a],heroInfo=new HeroInfo_1.default;heroInfo.exp=parseFloat(hero.exp),heroInfo.uuid=parseFloat(hero.id),heroInfo.item1=parseInt(hero.item1),heroInfo.item2=parseInt(hero.item2),heroInfo.item3=parseInt(hero.item3),heroInfo.item4=parseInt(hero.item4),heroInfo.item5=parseInt(hero.item5),heroInfo.item6=parseInt(hero.item6),heroInfo.item7=parseInt(hero.item7),heroInfo.item8=parseInt(hero.item8),heroInfo.mid=parseInt(hero.mid),heroInfo.userId=parseFloat(hero.uid),userInfo.heros.push(heroInfo)}var levelData={levelID:level.id,name:level.name,topic:level.topic,required_energy:level.energy,hero_rotation:level.hero_rotation,tiledmap:level.tiledmap,tiledimage:level.tiledimage,star1_reward:level.star1_reward,star1_reward_num:level.star1_reward_num,star2_reward:level.star2_reward,star2_reward_num:level.star2_reward_num,star3_reward:level.star3_reward,star3_reward_num:level.star3_reward_num,star_level:0,state_locked:ExploreWindow_1.default.STATE_STRIP,next_level:level.next_level,level_bgm:level.bgm,find_path:level.find_path,player_info:userInfo};SoundManager_1.default.getInstance().playEffect("u10_start_mp3"),BattleStartLoading_1.default.startBattleLoading(levelData)},MainScene}(Scene_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MainScene},{"../../../src/manager/ConfigManager":54,"../../base/popup/WindowManager":13,"../../base/utils/FrameTweenLite":18,"../../base/view/Scene":24,"../../enums/Protocols":51,"../../manager/LayerManager":55,"../../manager/SoundManager":58,"../../model/da/UserInfoProxy":67,"../../model/net/NetManager":68,"../../model/vo/EquipInfo":71,"../../model/vo/HeroInfo":72,"../../model/vo/UserInfo":73,"../../platforms/Platform":81,"../explore/ExploreWindow":118,"../loading/BattleStartLoading":136,"../loading/UIPopupLoading":139,"./../../model/da/LoginProxy":64,"./ArenaBtn":140,"./ExploreWayBtn":141,"./GeekWayBtn":142,"./HUDPanel":143,"./MainToolBtn":145}],145:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ToolTipManager_1=require("../../base/tip/ToolTipManager"),PopUpPosition_1=require("../../base/popup/PopUpPosition"),TextToolTip_1=require("../../base/tip/TextToolTip"),WindowManager_1=require("../../base/popup/WindowManager"),OptionWindow_1=require("../explore/option/OptionWindow"),HeroWindow_1=require("../explore/hero/HeroWindow"),BadgeWindow_1=require("../badge/BadgeWindow"),ClassHelpWindow_1=require("../teach/ClassHelpWindow"),LayerManager_1=require("../../manager/LayerManager"),UIPopupLoading_1=require("../loading/UIPopupLoading"),MainToolBtn=function(_super){function MainToolBtn(){_super.call(this),this.lockState=0,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="MainToolBtnSkin" width="894" height="187" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Button id="btnSetting" skinName="SettingButtonSkin" x="167" y="0"/><e:Button id="btnWarrior" skinName="WarriorButtonSkin" x="347" y="0"/><e:Button id="btnAchievement" skinName="AchievementButtonSkin" x="527" y="0"/><e:Button id="btnMall" skinName="MallButtonSkin" x="707" y="0" visible="false"/><e:Button id="btnTeacher" x="0" y="0" skinName="TeacherCheckButtonSkin"/></e:Skin>'}return __extends(MainToolBtn,_super),MainToolBtn.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.initListeners()},MainToolBtn.prototype.partAdded=function(partName,instance){_super.prototype.partAdded.call(this,partName,instance),"btnSetting"===partName&&this.btnSetting,"btnTeacher"==partName&&(this.btnTeacher.visible=!1)},MainToolBtn.prototype.initListeners=function(){this.touchEnabled=this.touchChildren=!0,this.btnSetting.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnSettingTouchHandler,this),this.btnWarrior.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnWarriorTouchHandler,this),this.btnAchievement.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnAchievementTouchHandler,this),this.btnMall.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnMallTouchHandler,this),this.btnTeacher.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTeachTouchHandler,this),ToolTipManager_1.default.register(this.btnSetting,"用户设置：昵称、密码、头像、音效等",TextToolTip_1.default,PopUpPosition_1.default.ABOVE),ToolTipManager_1.default.register(this.btnAchievement,"徽章：查看获得徽章、领取徽章奖励",TextToolTip_1.default,PopUpPosition_1.default.ABOVE),ToolTipManager_1.default.register(this.btnWarrior,"英雄：查看、选择出战英雄和语言类型",TextToolTip_1.default,PopUpPosition_1.default.ABOVE),this.btnMall.addEventListener("doubleClick",function(){console.log("double clicked!")},this)},MainToolBtn.prototype.removeListeners=function(){this.touchEnabled=this.touchChildren=!1,this.btnSetting.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnSettingTouchHandler,this),this.btnWarrior.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnWarriorTouchHandler,this),this.btnAchievement.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnAchievementTouchHandler,this),this.btnMall.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnMallTouchHandler,this),this.btnTeacher.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTeachTouchHandler,this),ToolTipManager_1.default.unRegister(this.btnSetting),ToolTipManager_1.default.unRegister(this.btnAchievement),ToolTipManager_1.default.unRegister(this.btnWarrior)},MainToolBtn.prototype.onBtnSettingTouchHandler=function(e){LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterOptionPopup,this),UIPopupLoading_1.default.startPopupLoading(["option"])},MainToolBtn.prototype.onEnterOptionPopup=function(e){LayerManager_1.default.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterOptionPopup,this),WindowManager_1.default.showWindow(OptionWindow_1.default,"OptionWindow")},MainToolBtn.prototype.onBtnWarriorTouchHandler=function(e){LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterHeroPopup,this),UIPopupLoading_1.default.startPopupLoading(["hero"])},MainToolBtn.prototype.onEnterHeroPopup=function(e){LayerManager_1.default.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterHeroPopup,this),WindowManager_1.default.showWindow(HeroWindow_1.default,"HeroWindow")},MainToolBtn.prototype.onBtnAchievementTouchHandler=function(e){LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterBadgePopup,this),UIPopupLoading_1.default.startPopupLoading(["badge"])},MainToolBtn.prototype.onEnterBadgePopup=function(e){LayerManager_1.default.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterBadgePopup,this),WindowManager_1.default.showWindow(BadgeWindow_1.default,"BadgeWindow")},MainToolBtn.prototype.onBtnMallTouchHandler=function(e){},MainToolBtn.prototype.onBtnTeachTouchHandler=function(event){WindowManager_1.default.showWindow(ClassHelpWindow_1.default,"ClassHelpWindow")},MainToolBtn.prototype.dispose=function(){this.removeListeners()},MainToolBtn}(eui.Component);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=MainToolBtn},{"../../base/popup/PopUpPosition":11,"../../base/popup/WindowManager":13,"../../base/tip/TextToolTip":15,"../../base/tip/ToolTipManager":17,"../../manager/LayerManager":55,"../badge/BadgeWindow":87,"../explore/hero/HeroWindow":131,"../explore/option/OptionWindow":133,"../loading/UIPopupLoading":139,"../teach/ClassHelpWindow":152}],146:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),WindowManager_1=require("../../base/popup/WindowManager"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),NetManager_1=require("../../model/net/NetManager"),Protocols_1=require("../../enums/Protocols"),CreateRoleWindow=function(_super){function CreateRoleWindow(){_super.call(this),
this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="CreateRoleWindowSkin" width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><w:Config id="15b195bfe58"/><e:Image source="create_role_bg_jpg" x="0" y="0"/><e:Image id="imgFigure0" width="916" height="920" x="890" y="102" scaleX="0.72" scaleY="0.88" anchorOffsetX="0" anchorOffsetY="0"/><e:Image id="imgFigure" width="916" height="920" x="375" y="115" scaleX="0.72" scaleY="0.88" anchorOffsetX="0" anchorOffsetY="0"/><e:Image source="create_role_front_png" y="771" x="0" scaleX="1" scaleY="1"/><e:Image source="create_role_info_frame_png" x="0" y="310.4"/><e:Image source="create_role_info_frame_png" x="1509" y="293.73"/><e:Image source="create_role_info_frame_01_png" x="91" y="729.4"/><e:Image source="create_role_info_frame_01_png" x="91" y="789.9"/><e:Image source="create_role_info_frame_01_png" x="91" y="849.9"/><e:Image source="create_role_info_frame_01_png" x="91" y="909.4"/><e:Image source="create_role_info_frame_01_png" x="1600" y="907.88" scaleX="1" scaleY="1"/><e:Image source="create_role_info_frame_01_png" x="1600" y="848.88" scaleX="1" scaleY="1"/><e:Image source="create_role_info_frame_01_png" x="1600" y="788.88" scaleX="1" scaleY="1"/><e:Image source="create_role_info_frame_01_png" x="1600" y="727.88" scaleX="1" scaleY="1"/><e:Image source="common_utils_json.ability_life_icon_png" x="99" y="728.4" scaleX="1" scaleY="1"/><e:Image source="common_utils_json.ability_attack_icon_png" x="96" y="790.4"/><e:Image source="common_utils_json.ability_speed_icon_png" x="99" y="852.4"/><e:Image source="common_utils_json.ability_view_icon_png" x="99" y="910.4"/><e:Label text="生命" x="165" y="735.4" size="28" width="76" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="攻击" x="165" y="793.4" size="28" width="78" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="速度" x="165" y="853.4" size="28" width="80" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="视野" x="165" y="913.4" size="28" width="82" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label id="labHp" text="123456" x="238" y="742.4" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Label id="labAttack" text="123456" x="238" y="802.4" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Label id="labSpeed" text="123456" x="238" y="861.4" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Label id="labViewRange" text="123456" x="238" y="922.4" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Image source="common_utils_json.ability_life_icon_png" x="1613" y="724.88" scaleX="1" scaleY="1"/><e:Image source="common_utils_json.ability_attack_icon_png" x="1610" y="786.88"/><e:Image source="common_utils_json.ability_speed_icon_png" x="1613" y="848.88"/><e:Image source="common_utils_json.ability_view_icon_png" x="1613" y="906.88"/><e:Label text="生命" x="1679" y="730.88" size="28" width="76" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="攻击" x="1679" y="795.4" size="28" width="78" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="速度" x="1679" y="854.4" size="28" width="80" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label text="视野" x="1679" y="913.4" size="28" width="82" height="42" verticalAlign="middle" fontFamily="Microsoft Yahei" stroke="3" strokeColor="0x003479"/><e:Label id="labHp0" text="123456" x="1752" y="741.4" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Label id="labAttack0" text="123456" x="1752" y="803.4" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Label id="labSpeed0" text="123456" x="1752" y="862.4" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Label id="labViewRange0" text="123456" x="1752" y="921.4" size="28" textColor="0xFFFE9C" stroke="3" strokeColor="0x4C2F26"/><e:Image id="imgHeroName" width="223" height="98" x="102" y="267.4" source="hero_json.pic_name_Grace_png"/><e:Image width="223" height="98" x="1606" y="267.4" id="imgHeroName0" source="hero_json.pic_name_Grace_png"/><e:Label id="labDesc" text="标签" x="29" y="381.55" width="360" height="314" size="24" stroke="3" strokeColor="0x0036d1" multiline="true" wordWrap="true" fontFamily="Microsoft YaHei" lineSpacing="5"/><e:Label id="labDesc0" text="标签" x="1538" y="381.55" width="360" height="314" scaleX="1" scaleY="1" stroke="3" strokeColor="0x0036d1" size="24" multiline="true" wordWrap="true" fontFamily="Microsoft YaHei" lineSpacing="5"/><e:Button id="btnCreate" label="按钮" x="792" y="771" skinName="CreateRoleButtonSkin"/></e:Skin>'}return __extends(CreateRoleWindow,_super),CreateRoleWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.btnCreate.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreateRole,this),this.userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data;var hero=this.userInfo.heros[0],hero0=this.userInfo.heros[1],grace=hero.data,turing=hero0.data;this.labHp.text=grace.hp,this.labSpeed.text=Math.round(100*parseFloat(grace.speed)).toString(),this.labAttack.text=grace.atkdamage,this.labViewRange.text=grace.viewrange,this.labDesc.text=grace.description,this.imgFigure.source="resource/icon/role/career_figure/"+grace.career_figure+".png",this.imgHeroName.source=RES.getRes("hero_json.pic_name_"+grace.icon+"_png"),this.labHp0.text=turing.hp,this.labSpeed0.text=Math.round(100*parseFloat(turing.speed)).toString(),this.labAttack0.text=turing.atkdamage,this.labViewRange0.text=turing.viewrange,this.labDesc0.text=turing.description,this.imgFigure0.source="resource/icon/role/career_figure/"+turing.career_figure+".png",this.imgHeroName0.source=RES.getRes("hero_json.pic_name_"+turing.icon+"_png"),this.imgFigure.touchEnabled=this.imgFigure0.touchEnabled=!0,this.imgFigure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedHero,this),this.imgFigure0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedHero,this),this.selectedHero=hero,this.selectedHeroImg=this.imgFigure,this.updateFigure(this.imgFigure,this.imgFigure0)},CreateRoleWindow.prototype.updateFigure=function(selected,other){selected.scaleX=selected.scaleY=1,other.scaleX=other.scaleY=.8},CreateRoleWindow.prototype.onSelectedHero=function(event){this.selectedHeroImg!=event.currentTarget&&(event.currentTarget==this.imgFigure?(this.selectedHeroImg=this.imgFigure,this.selectedHero=this.userInfo.heros[0],this.updateFigure(this.imgFigure,this.imgFigure0)):(this.selectedHeroImg=this.imgFigure0,this.selectedHero=this.userInfo.heros[1],this.updateFigure(this.imgFigure0,this.imgFigure)))},CreateRoleWindow.prototype.onCreateRole=function(event){NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_SELECT_HERO,{hid:this.selectedHero.uuid}),WindowManager_1.default.closeWindow(this.name,!0)},CreateRoleWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.btnCreate.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreateRole,this),this.imgFigure.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedHero,this),this.imgFigure0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedHero,this)},CreateRoleWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=CreateRoleWindow},{"../../base/da/DataAccessManager":2,"../../base/popup/BaseWindow":7,"../../base/popup/WindowManager":13,"../../enums/Protocols":51,"../../model/DataAccessEntry":59,"../../model/net/NetManager":68}],147:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),WindowManager_1=require("../../base/popup/WindowManager"),ToolTipManager_1=require("../../base/tip/ToolTipManager"),TextToolTip_1=require("../../base/tip/TextToolTip"),PopUpPosition_1=require("../../base/popup/PopUpPosition"),PasswordHelper_1=require("./PasswordHelper"),RegisterAgeWindow_1=require("./RegisterAgeWindow"),QQPlatform_1=require("../../platforms/QQPlatform"),Platform_1=require("../../platforms/Platform"),LoginWindow=function(_super){function LoginWindow(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="LoginWindowSkin" width="793" height="588" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="login_json.login_frame_png" x="0" y="0"/><e:Button id="btnClose" label="按钮" x="718" y="65" skinName="WindowCloseBtnSkin"/><e:Image source="login_json.login_mail_png" x="123" y="90"/><e:TextInput id="txtEmail" x="123" y="170" width="538" skinName="GameTextInputSkin"/><e:TextInput id="txtPsd" x="123" y="336" width="538" displayAsPassword="true" skinName="GameTextInputSkin"/><e:Image source="login_json.login_password_png" x="123" y="252"/><e:Label id="labNoUser" text="该用户不存在" x="123" y="236" width="279" size="22" textColor="0xdd544a"/><e:Image id="imgQQ" source="login_json.login_icon_qq_png" x="362" y="407" visible="false"/><e:Label id="labForgetPsd" text="忘记密码？" x="123" y="394" size="22"/><e:Button id="btnLogin" label="登录" x="326" y="479" skinName="CommonButtonSkin"/><e:Label id="labNewAccount" text="注册新账号" x="523" y="502" size="22"/></e:Skin>'}return __extends(LoginWindow,_super),LoginWindow.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this),this.labNoUser.visible=!1,this.labForgetPsd.touchEnabled=this.labNewAccount.touchEnabled=this.imgQQ.touchEnabled=!0,this.labForgetPsd.name="labForgetPsd",this.labForgetPsd.visible=!1,this.labNewAccount.name="labNewAccount",this.imgQQ.name="imgQQ",this.btnLogin.name="btnLogin",ToolTipManager_1.default.register(this.imgQQ,"使用QQ登录",TextToolTip_1.default,PopUpPosition_1.default.RIGHT),this.passwordHelper=new PasswordHelper_1.default(this.txtPsd),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.labNewAccount.touchEnabled=!0,this.labNewAccount.textFlow=new Array({text:"注册新账号",style:{underline:!0}}),this.labNewAccount.addEventListener(mouse.MouseEvent.MOUSE_OVER,function(evt){_this.labNewAccount.textColor=16776960},this),this.labNewAccount.addEventListener(mouse.MouseEvent.MOUSE_OUT,function(evt){_this.labNewAccount.textColor=16777215},this)},LoginWindow.prototype.isEmail=function(str){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(str)},LoginWindow.prototype.isMobilePhone=function(str){return/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/.test(str)},LoginWindow.prototype.onTouchTap=function(event){switch(event.target.name){case"btnLogin":Platform_1.default.currentPlatform.login({email:this.txtEmail.text,password:this.passwordHelper.passwordChars},function(result){Platform_1.default.currentPlatform.reload()});break;case"imgQQ":egret.localStorage.setItem("platform","qq"),(new QQPlatform_1.default).openLogin();break;case"labNewAccount":WindowManager_1.default.closeWindow(this.name),WindowManager_1.default.showWindow(RegisterAgeWindow_1.default,"RegisterAgeWindow")}},LoginWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),ToolTipManager_1.default.unRegister(this.imgQQ),this.passwordHelper.dispose(),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},LoginWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=LoginWindow},{"../../base/popup/BaseWindow":7,"../../base/popup/PopUpPosition":11,"../../base/popup/WindowManager":13,"../../base/tip/TextToolTip":15,"../../base/tip/ToolTipManager":17,"../../platforms/Platform":81,"../../platforms/QQPlatform":82,"./PasswordHelper":148,"./RegisterAgeWindow":149}],148:[function(require,module,exports){"use strict";var PasswordHelper=function(){function PasswordHelper(txtPassword){this.currentPsdChars="",this.txtPassword=txtPassword,this.txtPassword.displayAsPassword=!0,this.txtPassword.textDisplay.addEventListener(egret.Event.CHANGE,this.onPsdChanged,this),this.txtPassword.textDisplay.displayAsPassword=!0}return PasswordHelper.prototype.getCursortPosition=function(ctrl){var CaretPos=0;if(document.selection){ctrl.focus(),document.getSelection().getRangeAt(0);var Sel=document.selection.createRange();Sel.moveStart("character",-ctrl.value.length),CaretPos=Sel.text.length}else(ctrl.selectionStart||0==ctrl.selectionStart)&&(CaretPos=ctrl.selectionStart);return CaretPos},PasswordHelper.prototype.insertAt=function(str,substr,pos){var newstr="";if(0==str.length)return newstr=substr;var newstr=str.substring(0,pos)+substr+str.substring(pos,str.length);return newstr},PasswordHelper.prototype.removeAt=function(str,pos,len){return str=str.substring(0,pos)+str.substring(pos+len,str.length)},PasswordHelper.prototype.onPsdChanged=function(event){var currentPsd=event.currentTarget.text,he=$("#egretInput").get(0),curPos=this.getCursortPosition(he);if(currentPsd.length>this.currentPsdChars.length){var newChar=currentPsd.substr(curPos-1,1);this.currentPsdChars=this.insertAt(this.currentPsdChars,newChar,curPos-1)}else{currentPsd.substr(curPos,1);this.currentPsdChars=this.removeAt(this.currentPsdChars,curPos,1)}for(var result="",i=0;i<currentPsd.length;i++)result+="*";this.txtPassword.textDisplay.text=result},Object.defineProperty(PasswordHelper.prototype,"passwordChars",{get:function(){return this.currentPsdChars},enumerable:!0,configurable:!0}),PasswordHelper.prototype.dispose=function(){this.txtPassword.textDisplay.removeEventListener(egret.Event.CHANGE,this.onPsdChanged,this),this.txtPassword=null},PasswordHelper}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=PasswordHelper},{}],149:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),WindowManager_1=require("../../base/popup/WindowManager"),RegisterWindow_1=require("./RegisterWindow"),LoginWindow_1=require("./LoginWindow"),Alert_1=require("../common/Alert"),LayerManager_1=require("../../manager/LayerManager"),UIPopupLoading_1=require("../loading/UIPopupLoading"),RegisterAgeWindow=function(_super){function RegisterAgeWindow(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="RegisterAgeWindowSkin" width="793" height="618" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="register_json.register_title_png" x="11" y="0" scaleX="1" scaleY="1"/><e:Image source="register_json.register_frame_01_png" x="0" y="51"/><e:Button id="btnClose" label="按钮" x="719" y="68" skinName="WindowCloseBtnSkin"/><e:Image source="register_json.register_age_png" x="211" y="129"/><e:Button id="btnNext" label="下一步" x="331" y="498" skinName="CommonButtonSkin"/><e:TextInput id="txtAge" x="362" y="151" width="162" skinName="GameTextInputSkin" height="38"/><e:Label text="*我们热心于教育事业，请填" x="62" y="289" size="22" textColor="0x36d5ff" fontFamily="Microsoft Yahei"/><e:Label text="*我们将严格保护用户的隐私信息" x="62" y="368" size="22" textColor="0x36D5FF" fontFamily="Microsoft Yahei"/><e:Label text="*当前游戏处于免费删档测试阶段，更多内容敬请期待正式版本！" x="95" y="378" size="20" textColor="0xdd544a" visible="false"/><e:Label text="真实年龄" x="337" y="289" size="22" fontFamily="Microsoft Yahei"/><e:Label text="帮助我们开发出更好的教育产品" x="424" y="289" size="22" width="330" textColor="0x36d5ff" height="23" fontFamily="Microsoft Yahei"/><e:Label id="labAccount" text="已有账号" x="538" y="521" size="22" fontFamily="Microsoft Yahei"/></e:Skin>'}return __extends(RegisterAgeWindow,_super),RegisterAgeWindow.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this),this.txtAge.restrict="0-9",this.txtAge.maxChars=2,this.labAccount.touchEnabled=!0,this.btnNext.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNext,this),this.labAccount.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this),this.labAccount.textFlow=new Array({text:"已有账号",style:{underline:!0}}),this.labAccount.addEventListener(mouse.MouseEvent.MOUSE_OVER,function(evt){_this.labAccount.textColor=16776960},this),this.labAccount.addEventListener(mouse.MouseEvent.MOUSE_OUT,function(evt){_this.labAccount.textColor=16777215},this)},RegisterAgeWindow.prototype.onNext=function(event){return this.txtAge.text&&0!=this.txtAge.text.length?"0"==this.txtAge.text.charAt(0)?void Alert_1.default.show("错误","输入的年龄非法！",2):(WindowManager_1.default.closeWindow(this.name),LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this),void UIPopupLoading_1.default.startPopupLoading(["register"])):void Alert_1.default.show("错误","请输入年龄！",2)},RegisterAgeWindow.prototype.onEnterPopup=function(e){LayerManager_1.default.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this),WindowManager_1.default.showWindow(RegisterWindow_1.default,"RegisterWindow")},RegisterAgeWindow.prototype.onLogin=function(event){WindowManager_1.default.closeWindow(this.name),WindowManager_1.default.showWindow(LoginWindow_1.default,"LoginWindow")},RegisterAgeWindow.prototype.dispose=function(){this.btnNext.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onNext,this),this.labAccount.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this)},RegisterAgeWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=RegisterAgeWindow},{"../../base/popup/BaseWindow":7,"../../base/popup/WindowManager":13,"../../manager/LayerManager":55,"../common/Alert":115,"../loading/UIPopupLoading":139,"./LoginWindow":147,"./RegisterWindow":150}],150:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),PasswordHelper_1=require("./PasswordHelper"),WindowManager_1=require("../../base/popup/WindowManager"),LoginWindow_1=require("./LoginWindow"),Alert_1=require("../common/Alert"),Platform_1=require("../../platforms/Platform"),RegisterWindow=function(_super){function RegisterWindow(){_super.call(this),this.familyNames=["阳光","宇宙","波动","光明","黑暗","弑神","星际","破碎","天使","恶魔","深渊","流浪","绝对","能量","星辰","恒星"," 透明","时空","未来","量子","平行","多维","太阳","逐风","平衡","冰雪","翡翠","青空","无尽","旋风","深空","时间","死光","银翼","寂静","骇客","幻影","银河","瀚海","超能","心灵","再见","绝地","次元","黑体","四季","预言","无声","流金","灰烬","零度","震荡波","黑洞","永恒","超新星","创生","别了","反重力","迷失","奇迹","重生","暮星","风暴","寒冰","逝去的","沉思的","微笑","烈炎","全息","至尊","超光速","零重力","果壳中的","造梦","神奇","天外","以太","遗落","真 实","传说","彩虹","金色","七彩","全金属","最终","最后的","纯黑","循环","爆裂","信仰","反物质","万物","奇异","异世","星河","天选","无翼","苍蓝","幻世","紫罗兰"],this.firstNames=["梦想","公主","骑士","末裔","守护者","旅人","彼端","圆环","礼赞","荣耀","魔比斯环","星云","效应","之魂","之心","之瞳","之外","之翼","之歌","之风","记忆","流星雨","碎片","雨滴","梦境","旅程","小子","心晴","沙漏","空间","力场","武士","预感","机器","力量","猎人","战警","杀手","普朗克","薛定谔","沐歌","回溯","纪元","太阳风","幻梦","咏叹调","之森","岁月","翘曲","使者","劫灰","阿西莫夫","赛博格","勇者","之主","尘埃","之眼","之手","漫游者","之壁","狂想","梦想家","少女","宝贝","浪人","圆舞曲","矩阵","之愿","光年","战神","之怒","之绊","之下","流亡者","斜晖","冲击","赛博朋克","超弦","来客","镜像","穿越","乌托邦","帝国","狂猎","的祝福","秘密 ","之夜","之门","凝视者","理想乡","万岁","之誓","的祈祷","勇士","之女","之子","的陨落","降临","残阳","悠悠","狂潮","幻想","浮生","领域"],this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="RegisterWindowSkin" width="793" height="757" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="register_json.register_title_png" x="17" y="0" scaleX="1" scaleY="1"/><e:Image source="register_json.register_frame_02_png" x="2" y="53"/><e:Button id="btnClose" label="按钮" x="720" y="66" skinName="WindowCloseBtnSkin"/><e:Image source="register_json.register_mail_png" x="138" y="92"/><e:TextInput id="txtNickName" x="137" y="593" width="506" height="58" skinName="GameTextInputSkin"/><e:TextInput id="txtPsd" x="136" y="313" width="506" height="58" displayAsPassword="true" skinName="GameTextInputSkin"/><e:TextInput id="txtPsd2" x="136" y="453" width="506" height="58" displayAsPassword="true" skinName="GameTextInputSkin"/><e:TextInput id="txtEmail" x="135" y="175" width="506" height="58" skinName="GameTextInputSkin"/><e:Image source="register_json.register_password_png" x="139" y="232"/><e:Image source="register_json.register_confirm_png" x="137" y="372"/><e:Image source="register_json.register_name_png" x="139" y="510"/><e:Button id="btnRandName" x="654" y="577" skinName="RandomNameButtonSkin"/><e:Button id="btnRegister" label="注册" x="335" y="658" skinName="CommonButtonSkin"/><e:Label id="labHasAccount" text="已有账号" x="530" y="679" size="22"/></e:Skin>'}return __extends(RegisterWindow,_super),RegisterWindow.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this),this.psdHelper=new PasswordHelper_1.default(this.txtPsd),this.psd1Helper=new PasswordHelper_1.default(this.txtPsd2),this.btnRegister.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegister,this),this.btnRandName.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUpdateName,this),this.labHasAccount.touchEnabled=!0,this.labHasAccount.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this),this.txtNickName.text=this.randomName(),this.labHasAccount.textFlow=new Array({text:"已有账号",style:{underline:!0}}),this.labHasAccount.addEventListener(mouse.MouseEvent.MOUSE_OVER,function(evt){_this.labHasAccount.textColor=16776960},this),this.labHasAccount.addEventListener(mouse.MouseEvent.MOUSE_OUT,function(evt){_this.labHasAccount.textColor=16777215},this)},RegisterWindow.prototype.onRegister=function(event){var _this=this,checkResult=this.check();if(0!=checkResult){var tip="输入的信息有误";switch(checkResult){case 5:tip="邮件名不正确";break;case 2:tip="密码未输入";break;case 3:tip="密码长度不能小于6";break;case 4:tip="昵称不能省略";break;case 1:tip="两次密码不一致";break;case 6:tip="用户名或者密码中含有空格"}return void Alert_1.default.show("输入错误",tip,2)}var param={username:this.txtNickName.text,email:this.txtEmail.text,password:this.psd1Helper.passwordChars};Platform_1.default.currentPlatform.isAnonymous?(param.id=Platform_1.default.currentPlatform.openUserId,Platform_1.default.currentPlatform.bindAnonymous(param,function(result){Platform_1.default.currentPlatform.login({email:_this.txtEmail.text,password:_this.psd1Helper.passwordChars},function(result){window.location.reload()})})):Platform_1.default.currentPlatform.register(param,function(result){console.log(result),Platform_1.default.currentPlatform.login({email:_this.txtEmail.text,password:_this.psd1Helper.passwordChars},function(result){window.location.reload()})})},RegisterWindow.prototype.onUpdateName=function(event){this.txtNickName.text=this.randomName()},RegisterWindow.prototype.onLogin=function(event){WindowManager_1.default.closeWindow(this.name),WindowManager_1.default.showWindow(LoginWindow_1.default,"LoginWindow")},RegisterWindow.prototype.randomName=function(){return this.familyNames[Math.floor(this.familyNames.length*Math.random())]+this.firstNames[Math.floor(this.firstNames.length*Math.random())]},RegisterWindow.prototype.validateEmail=function(email){return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(email)},RegisterWindow.prototype.check=function(){return this.validateEmail(this.txtEmail.text)?this.psdHelper.passwordChars!=this.psd1Helper.passwordChars?1:""==this.psdHelper.passwordChars||""==this.psd1Helper.passwordChars?2:this.psdHelper.passwordChars.length<6?3:""==this.txtNickName.text?4:1!=this.txtNickName.text.split(" ").length||1!=this.psdHelper.passwordChars.split(" ").length?6:0:5},RegisterWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.psdHelper.dispose(),this.psd1Helper.dispose(),this.btnRegister.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegister,this),this.btnRandName.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onUpdateName,this),this.labHasAccount.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this)},RegisterWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=RegisterWindow},{"../../base/popup/BaseWindow":7,"../../base/popup/WindowManager":13,"../../platforms/Platform":81,"../common/Alert":115,"./LoginWindow":147,"./PasswordHelper":148}],151:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ItemRenderer=eui.ItemRenderer,ConfigManager_1=require("../../manager/ConfigManager"),BattleStartLoading_1=require("../loading/BattleStartLoading"),SoundManager_1=require("../../manager/SoundManager"),ExploreWindow_1=require("../explore/ExploreWindow"),NetManager_1=require("../../model/net/NetManager"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),TeachSystemProxy_1=require("../../model/da/TeachSystemProxy"),Protocols_1=require("../../enums/Protocols"),Alert_1=require("../common/Alert"),ClassHelpItemRenderer=function(_super){function ClassHelpItemRenderer(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="ClassHelpItemRendererSkin" width="1742" height="89" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="teaching_help_frame_png" x="0" y="0" scale9Grid="54,32,86,24" width="1736" height="89" scaleX="1" scaleY="1" anchorOffsetX="0"/><e:Button id="btnGoToHelp" label="按钮" x="1374" y="6" skinName="HelpButtonSkin"/><e:Label id="labMsg" text="XXXX在XXXX遇到困难，发来求助。" x="44" y="30" width="1040" height="30" size="28"/><e:Label id="labDate" text="2017-4-10" x="1112" y="34" size="24" textColor="0x00fcff" stroke="3" strokeColor="0x001d45" width="251" anchorOffsetX="0" anchorOffsetY="0" height="26"/><e:Button id="btnRemove" label="删除" x="1528" y="10" skinName="CommonButtonSkin"/></e:Skin>'}return __extends(ClassHelpItemRenderer,_super),ClassHelpItemRenderer.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var requestMsg=this.data,levelData=ConfigManager_1.default.getInstance().getConfig("pve_story_level",requestMsg.storyId),prefix=requestMsg.studentEmail.length>0?requestMsg.studentEmail:requestMsg.fromName;this.labMsg.text=prefix+"在"+levelData.tiledmap+"关卡遇到困难，发来求助。",this.labDate.text=requestMsg.formatRequestTime},ClassHelpItemRenderer.prototype.childrenCreated=function(){var _this=this;_super.prototype.childrenCreated.call(this),this.btnGoToHelp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGoToBattle,this),this.btnRemove.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Alert_1.default.show("","确认删除学生的求助么？").once("confirm",function(){var requestMsg=_this.data;NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_REMOVE_QUESTION,{id:requestMsg.uuid,teacherId:requestMsg.teacherId})},_this)},this)},ClassHelpItemRenderer.prototype.onGoToBattle=function(event){var requestMsg=this.data;NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_GETUSERINFO,{id:requestMsg.from});var teachProxy=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY);teachProxy.addEventListener(TeachSystemProxy_1.default.USER_INFO_COMPLETE,this.onUserInfoComplete,this),teachProxy.currentHelpId=requestMsg.uuid,SoundManager_1.default.getInstance().playEffect("u10_start_mp3")},ClassHelpItemRenderer.prototype.onUserInfoComplete=function(event){DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).removeEventListener(TeachSystemProxy_1.default.USER_INFO_COMPLETE,this.onUserInfoComplete,this);var requestMsg=this.data,level=ConfigManager_1.default.getInstance().getConfig("pve_story_level",requestMsg.storyId),levelData={levelID:level.id,name:level.name,topic:level.topic,required_energy:level.energy,hero_rotation:level.hero_rotation,tiledmap:level.tiledmap,tiledimage:level.tiledimage,star1_reward:level.star1_reward,star1_reward_num:level.star1_reward_num,star2_reward:level.star2_reward,star2_reward_num:level.star2_reward_num,star3_reward:level.star3_reward,star3_reward_num:level.star3_reward_num,star_level:0,state_locked:ExploreWindow_1.default.STATE_STRIP,next_level:level.next_level,level_bgm:level.bgm,find_path:level.find_path,teach_info:requestMsg,player_info:event.data};console.log(levelData),BattleStartLoading_1.default.startBattleLoading(levelData)},ClassHelpItemRenderer}(ItemRenderer);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ClassHelpItemRenderer},{"../../base/da/DataAccessManager":2,"../../enums/Protocols":51,"../../manager/ConfigManager":54,"../../manager/SoundManager":58,"../../model/DataAccessEntry":59,"../../model/da/TeachSystemProxy":66,"../../model/net/NetManager":68,"../common/Alert":115,"../explore/ExploreWindow":118,"../loading/BattleStartLoading":136}],152:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),ClassHelpItemRenderer_1=require("./ClassHelpItemRenderer"),NetManager_1=require("../../model/net/NetManager"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),TeachSystemProxy_1=require("../../model/da/TeachSystemProxy"),MouseScroller_1=require("../common/MouseScroller"),Protocols_1=require("../../enums/Protocols"),ClassHelpWindow=function(_super){function ClassHelpWindow(){_super.call(this),this.sortType=1,this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="ClassHelpWindowSkin" width="1920" height="1080" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Button id="btnClose" label="按钮" x="1808" y="42" skinName="WindowCloseBtnSkin"/><e:Label id="labClassName" text="4年级一班" x="792" y="26" size="48" textColor="0xffffff" stroke="4" strokeColor="0x007ed7" textAlign="center" width="383"/><e:Label text="等待求助：" x="904" y="93" size="28" textColor="0x36d5ff" stroke="3" strokeColor="0x023d8c"/><e:Label id="labWait" text="0" x="1047" y="94" size="28" stroke="3" strokeColor="0x001D45" textColor="0xDDD76D"/><e:Scroller id="scrollerHelp"  skinName="skins.ScrollerSkin" width="1740" height="878" x="90" y="148" anchorOffsetX="0"><e:Group width="1740" height="878"><e:List id="list" width="1740" x="0" y="0" scaleX="1" scaleY="1"><e:layout><e:VerticalLayout horizontalAlign="center"/></e:layout></e:List></e:Group></e:Scroller><e:Button id="btnIDSort" label="ID排序" x="1372" y="42" skinName="CommonButtonSkin" anchorOffsetX="0" width="153"/><e:Button id="btnTimeSort" label="时间排序" x="1564" y="42" skinName="CommonButtonSkin"/></e:Skin>',NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_GETQUESTIONS),DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).addEventListener(TeachSystemProxy_1.default.QUESTIONS_COMPLETE,this.onQuestions,this),DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).addEventListener(TeachSystemProxy_1.default.QUESTION_REMOVED,this.onQuestionRemoved,this),
this._userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data,this.btnIDSort.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onIDSort,this),this.btnTimeSort.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTimeSort,this)}return __extends(ClassHelpWindow,_super),ClassHelpWindow.prototype.onQuestions=function(event){var clean=event.data;this.isComplete&&this.updateData(clean),this.data=clean},ClassHelpWindow.prototype.onQuestionRemoved=function(event){var clean=event.data;this.isComplete&&this.updateData(clean),this.data=clean},ClassHelpWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),MouseScroller_1.default.enableMouseScroller(this.scrollerHelp),this.list.itemRenderer=ClassHelpItemRenderer_1.default,this.data&&this.updateData(this.data),this.labClassName.text=this._userInfo.className},ClassHelpWindow.prototype.updateData=function(data){var ar=data,effectQ=[];for(var i in ar)ar[i].hadRead||effectQ.push(ar[i]);effectQ.sort(this.sortByStoryId),this.sortType=1,this.list.dataProvider=new eui.ArrayCollection(effectQ),this.labWait.text=this.list.dataProvider.length.toString()},ClassHelpWindow.prototype.eliminateRepeat=function(origin){for(var result=[],questionCount=origin.length,i=0;i<questionCount;i++){for(var can=origin[i],isRepeat=!1,j=i+1;j<questionCount;j++){var test=origin[j];if(test.fromName==can.fromName&&test.storyId==can.storyId&&!test.hadRead){isRepeat=!0;break}}isRepeat||result.push(can)}return result},ClassHelpWindow.prototype.sortByRequestTime=function(a,b){return a.requestTime>b.requestTime?1:a.requestTime<b.requestTime?-1:0},ClassHelpWindow.prototype.sortByStoryId=function(a,b){return a.storyId>b.storyId?1:a.storyId<b.storyId?-1:0},ClassHelpWindow.prototype.onIDSort=function(event){if(1!=this.sortType){var ar=this.data,effectQ=[];for(var i in ar)ar[i].hadRead||effectQ.push(ar[i]);effectQ.sort(this.sortByStoryId),this.sortType=1,this.list.dataProvider=new eui.ArrayCollection(effectQ)}},ClassHelpWindow.prototype.onTimeSort=function(event){if(2!=this.sortType){var ar=this.data,effectQ=[];for(var i in ar)ar[i].hadRead||effectQ.push(ar[i]);effectQ.sort(this.sortByRequestTime),this.sortType=2,this.list.dataProvider=new eui.ArrayCollection(effectQ)}},ClassHelpWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.btnIDSort.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onIDSort,this),this.btnTimeSort.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTimeSort,this),DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).removeEventListener(TeachSystemProxy_1.default.QUESTIONS_COMPLETE,this.onQuestions,this)},ClassHelpWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ClassHelpWindow},{"../../base/da/DataAccessManager":2,"../../base/popup/BaseWindow":7,"../../enums/Protocols":51,"../../model/DataAccessEntry":59,"../../model/da/TeachSystemProxy":66,"../../model/net/NetManager":68,"../common/MouseScroller":116,"./ClassHelpItemRenderer":151}],153:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),Platform_1=require("../../platforms/Platform"),NetManager_1=require("../../model/net/NetManager"),WindowManager_1=require("../../base/popup/WindowManager"),RadioButton=eui.RadioButton,IDChooseWindow=function(_super){function IDChooseWindow(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="IDChooseWindowSkin" width="1239" height="861" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image width="1239" height="861" x="0" y="0" source="resource/skin_assets/teach/teaching_choose_frame_bottom.png" anchorOffsetX="0" anchorOffsetY="0"/><e:Button id="btnConfirm" label="确认" x="552.5" y="718" skinName="CommonButtonSkin"/><e:Label text="你具有多重身份，请选择身份进入课堂" x="330" y="109" anchorOffsetX="0" width="598" textAlign="center"/></e:Skin>'}return __extends(IDChooseWindow,_super),IDChooseWindow.prototype.updateView=function(){var _this=this;_super.prototype.updateView.call(this),this.btnConfirm.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirm,this);var classInfoes=this.data,grp=new eui.RadioButtonGroup;grp.enabled=!0;for(var i=0;i<classInfoes.length;i++){var classInfo=classInfoes[i],rb=new RadioButton;rb.group=grp,rb.label=classInfo.name+"-"+classInfo.idType,rb.anchor=classInfo,rb.skinName="skins.RadioButtonSkin",rb.x=500,rb.y=200+80*i,this.addChild(rb),rb.addEventListener(egret.Event.CHANGE,function(event){_this.choosedClassInfo=event.currentTarget.anchor},this)}},IDChooseWindow.prototype.onConfirm=function(event){var classInfo=this.choosedClassInfo;if(classInfo){var maliPlatform=Platform_1.default.currentPlatform;maliPlatform.joinedClass=classInfo.joinedClass,maliPlatform.classTeacherId=classInfo.teacherId,maliPlatform.classTeacherName=classInfo.teacherName,maliPlatform.classId=classInfo.id,maliPlatform.className=classInfo.name,maliPlatform.inviteCode=classInfo.invitationCode,maliPlatform.idType=classInfo.idType,maliPlatform.timeSpan=classInfo.timeSpan,maliPlatform.sync=classInfo.sync,maliPlatform.price=classInfo.price,maliPlatform.userStatusInClass=classInfo.userStatusInClass,NetManager_1.default.getInstance().init(),WindowManager_1.default.closeWindow("IDChooseWindow",!0)}},IDChooseWindow.prototype.dispose=function(){_super.prototype.dispose.call(this),this.btnConfirm.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onConfirm,this)},IDChooseWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=IDChooseWindow},{"../../base/popup/BaseWindow":7,"../../base/popup/WindowManager":13,"../../model/net/NetManager":68,"../../platforms/Platform":81}],154:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},ConfigManager_1=require("../../manager/ConfigManager"),WindowManager_1=require("../../base/popup/WindowManager"),EquipWindow_1=require("../explore/equipment/EquipWindow"),SceneManager_1=require("../../manager/SceneManager"),NetManager_1=require("../../model/net/NetManager"),Alert_1=require("../common/Alert"),LayerManager_1=require("../../manager/LayerManager"),UIPopupLoading_1=require("../loading/UIPopupLoading"),Protocols_1=require("../../enums/Protocols"),NetManager_2=require("../../model/net/NetManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),DataAccessManager_1=require("../../base/da/DataAccessManager"),ReplyListItemRenderer=function(_super){function ReplyListItemRenderer(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="ReplyListItemRendererSkin" width="788" height="85" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="teaching_help_frame_png" x="0" y="0" scale9Grid="51,34,88,21" height="84" width="787" anchorOffsetX="0"/><e:Label id="labMsg" text="标签" x="33" y="27" width="527" height="34" size="28" verticalAlign="middle" anchorOffsetX="0"/><e:Button id="btnView" label="前往" x="545" y="2" skinName="StudentCheckCodeButtonSkin"/><e:Button id="btnRemove" label="删除" x="634" y="9" skinName="CommonButtonSkin"/></e:Skin>',this.labMsg.touchEnabled=!0,this.btnView.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.btnRemove.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRemove,this)}return __extends(ReplyListItemRenderer,_super),ReplyListItemRenderer.prototype.dataChanged=function(){_super.prototype.dataChanged.call(this);var msg=this.data,levelData=ConfigManager_1.default.getInstance().getConfig("pve_story_level",msg.storyId),mapData=ConfigManager_1.default.getInstance().getConfig("pve_story_map",parseInt(levelData.map));this.labMsg.text="查看地图"+mapData.name+"关卡"+levelData.name+"的教师回复"},ReplyListItemRenderer.prototype.onRemove=function(event){var _this=this,alert=Alert_1.default.show("","确认删除老师的回复么？");alert.once("confirm",function(){var msg=_this.data,userInfo=DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.USERINFO_PROXY).data;NetManager_2.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_REMOVE_REPLY,{id:msg.uuid,uid:userInfo.uuid}),document.getElementById("code-area").style.display="none"},this),alert.once("cancel",function(){document.getElementById("code-area").style.display="none"},this)},ReplyListItemRenderer.prototype.onTouch=function(event){var _this=this,alert=Alert_1.default.show("","确认是否前往此关卡，并覆盖您的当前代码？");alert.once("confirm",function(){WindowManager_1.default.closeAllWindow(),SceneManager_1.default.getInstance().popScene();var responseMsg=_this.data;ConfigManager_1.default.getInstance().getConfig("pve_story_level",responseMsg.storyId);_this.levelData=responseMsg,LayerManager_1.default.stage.addEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,_this.onEnterPopup,_this),UIPopupLoading_1.default.startPopupLoading(["equip"])},this),alert.once("cancel",function(){document.getElementById("code-area").style.display="none"},this)},ReplyListItemRenderer.prototype.onEnterPopup=function(e){LayerManager_1.default.stage.removeEventListener(UIPopupLoading_1.default.POPUP_RES_LOAD_COMPLETE,this.onEnterPopup,this);var level=this.levelData.tempLevelData;level.level_code=this.levelData.code,WindowManager_1.default.showWindow(EquipWindow_1.default,"EquipWindow","装备界面",level),NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_READREPLY,{id:this.levelData.uuid})},ReplyListItemRenderer}(eui.ItemRenderer);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ReplyListItemRenderer},{"../../base/da/DataAccessManager":2,"../../base/popup/WindowManager":13,"../../enums/Protocols":51,"../../manager/ConfigManager":54,"../../manager/LayerManager":55,"../../manager/SceneManager":57,"../../model/DataAccessEntry":59,"../../model/net/NetManager":68,"../common/Alert":115,"../explore/equipment/EquipWindow":128,"../loading/UIPopupLoading":139}],155:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},BaseWindow_1=require("../../base/popup/BaseWindow"),NetManager_1=require("../../model/net/NetManager"),DataAccessManager_1=require("../../base/da/DataAccessManager"),DataAccessEntry_1=require("../../model/DataAccessEntry"),TeachSystemProxy_1=require("../../model/da/TeachSystemProxy"),ReplyListItemRenderer_1=require("./ReplyListItemRenderer"),MouseScroller_1=require("../common/MouseScroller"),Protocols_1=require("../../enums/Protocols"),ReplyListWindow=function(_super){function ReplyListWindow(){_super.call(this),this.skinName='<?xml version="1.0" encoding="utf-8"?><e:Skin class="ReplyListWindowSkin" width="942" height="527" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing"><e:Image source="common_utils_json.common_frame_prompt_png" x="0" y="21" scale9Grid="159,120,271,78" width="941" height="506" anchorOffsetX="0"/><e:Image source="common_utils_json.common_split_line_png" x="177" y="24"/><e:Button id="btnClose" label="按钮" x="865" y="46" skinName="WindowCloseBtnSkin"/><e:Scroller id="scrollerReply" width="815" height="396" x="59" y="91" skinName="skins.ScrollerSkin" anchorOffsetX="0"><e:Group width="815" height="396"><e:List id="list" width="815" x="0" y="0" scaleX="1" scaleY="1"><e:layout><e:VerticalLayout horizontalAlign="center"/></e:layout></e:List><e:Label id="labTip" text="你还没收到老师的答复哦！" x="191" y="158" width="437" scaleX="1" scaleY="1" verticalAlign="middle" textAlign="center"/></e:Group></e:Scroller></e:Skin>',DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).addEventListener(TeachSystemProxy_1.default.REPLYS_COMPLETE,this.onReplys,this),DataAccessManager_1.default.getAccess(DataAccessEntry_1.default.TEACH_SYSTEM_PROXY).addEventListener(TeachSystemProxy_1.default.REPLY_REMOVED,this.onReplyRemoved,this)}return __extends(ReplyListWindow,_super),ReplyListWindow.prototype.childrenCreated=function(){_super.prototype.childrenCreated.call(this),this.labTip.visible=!1},ReplyListWindow.prototype.updateView=function(){_super.prototype.updateView.call(this),MouseScroller_1.default.enableMouseScroller(this.scrollerReply),this.list.itemRenderer=ReplyListItemRenderer_1.default,NetManager_1.default.getInstance().callServerSocket(Protocols_1.default.ROUTE_GETREPLYS)},ReplyListWindow.prototype.onReplys=function(event){var ar=event.data,effectQ=[];for(var i in ar)ar[i].hadRead||(effectQ.push(ar[i]),ar[i].tempLevelData=this.data);effectQ.length<1&&(this.labTip.visible=!0),this.list.dataProvider=new eui.ArrayCollection(effectQ)},ReplyListWindow.prototype.onReplyRemoved=function(event){var ar=event.data,effectQ=[];for(var i in ar)ar[i].hadRead||(effectQ.push(ar[i]),ar[i].tempLevelData=this.data);effectQ.length<1&&(this.labTip.visible=!0),this.list.dataProvider=new eui.ArrayCollection(effectQ)},ReplyListWindow.prototype.onCloseClick=function(e){_super.prototype.onCloseClick.call(this,e),document.getElementById("code-area").style.display="block"},ReplyListWindow}(BaseWindow_1.default);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ReplyListWindow},{"../../base/da/DataAccessManager":2,"../../base/popup/BaseWindow":7,"../../enums/Protocols":51,"../../model/DataAccessEntry":59,"../../model/da/TeachSystemProxy":66,"../../model/net/NetManager":68,"../common/MouseScroller":116,"./ReplyListItemRenderer":154}]},{},[53]);