var PalfishUI=PalfishUI||function(n,i){"use strict";function o(n){var o=i.account.getUser();o.token?n&&n.loggedIn&&n.loggedIn(o,{from:"logged-in"}):a(n)}function a(o){function a(){var a=n("#login-modal #phone").val(),e=n("#login-modal #password").val(),l=n("#login-modal #area span").text();return a?e?void i.account.logIn({phone:a,password:e,area:l},function(n){t(),n.phone||(n.phone=a),o.loggedIn&&o.loggedIn(n,{from:"sign-in"})},function(n){d(n.msg)}):void d("请输入密码"):void d("请输入手机号")}var l=n("#login-modal");if(!(l.length>0)){o=o||{};var s=o.signUpTip||"免费注册“伴鱼”账号",c='<div id="login-modal" class="modal"><div class="title">登录</div><div id="area">+<span>86</span></div><input type="text" id="phone" placeholder="请输入手机号"/><br/><input type="password" id="password" placeholder="请输入密码"/> <br/><input type="button" id="login" class="button green-bg" value="登录"/>';o.wechat&&"wechat"==i.appEnv()&&(c+='<input type="button" id="wechat-login-btn" class="button green-border green" value="微信登录"/>'),c+='<div id="signup" class="tip link">'+s+'</div></div><div id="login-modal-mask" class="palfish-mask"></div><div id="country"><div id="closelist"><span id="close-country-area">×</span>选择国家区号</div><div class="countrylist"></div></div>',n("body").append(c),n("#login-modal").css("top",n(window).scrollTop()+(n(window).height()-n("#login-modal").height())/2),u(),o.wechat&&p(o),n("#login-modal")[0].addEventListener("touchmove",v,!1),n("#login-modal-mask")[0].addEventListener("touchmove",v,!1),n("#login-modal-mask").on("click",function(){n("#login-modal-mask")[0].removeEventListener("touchmove",v),t(),o.cancel&&o.cancel()}),n("#login-modal #login").on("click",a),n("#login-modal #signup").on("click",function(){t(),e(o)})}}function t(){n("#login-modal, #login-modal-mask").remove(),n("#country").remove()}function e(o){function t(){var a=n("#signup-modal #phone").val();if(!a)return void d("请输入手机号");var t=n("#signup-modal #code").val();if(!t)return void d("请输入验证码");var e=n("#signup-modal #password").val();if(!e)return void d("请输入密码");if(e.length<6||e.length>20)return void d("密码长度不正确");var s=n("#signup-modal #area span").text(),c={phone:a,code:t,cate:1,password:e,area:s};o&&o.src&&(c.src=o.src),i.account.signUp(c,function(n){l(),n.phone||(n.phone=a),o.loggedIn&&o.loggedIn(n,{from:"sign-up"})},r)}function e(){var o=n("#signup-modal #get-code-btn");if(!o.hasClass("disable")){var a=n("#signup-modal #phone").val();if(!a)return void d("请输入手机号");var t=n("#signup-modal #area span").text(),e={phone:a,area:t,vtype:"register",cate:1};o.addClass("disable"),o.text("获取中..."),i.post("/account/vcode",e,function(n){m=n.hash_code,s()},function(n){d(n.msg),o.removeClass("disable"),o.text("获取验证码")})}}function s(){var i=120,o=n("#signup-modal #get-code-btn"),a=null;a=setInterval(function(){--i,0==i?(o.removeClass("disable"),clearInterval(a),o.text("再次获取")):o.text(i)},1e3)}var c=n("#signup-modal");if(!(c.length>0)){o=o||{};var g=o.signUpTitle||"免费注册",m="",h=i.isMobile()?"4rem":"180px",f='<div id="signup-modal" class="modal"><div class="title">'+g+'</div><div id="area">+<span>86</span></div><input type="text" id="phone" placeholder="手机号"/><br/><input type="number" id="code" style = "width:'+h+'!important;" placeholder="短信验证码"/><div class="button blue-gray-bg right small-btn" id="get-code-btn">获取验证码</div></br><input type="password" id="password" placeholder="设置6-20位密码"/> <br/><input type="button" id="signup-btn" class="button yellow-bg" value="立即注册"/>';o.wechat&&(f+='<input type="button" id="wechat-login-btn" class="button green-bg" value="微信登录"/>'),o.onlySignUp||(f+='<div id="login" class="tip link">已有账户,立即登录</div>'),f+='</div><div id="signup-modal-mask" class="palfish-mask"></div><div id="country"><div class="closelist"><span id="close-country-area">×</span>选择国家区号</div><div class="countrylist"></div></div>',n("body").append(f),n("#signup-modal").css("top",n(window).scrollTop()+(n(window).height()-n("#signup-modal").height())/2),u(),o.wechat&&"wechat"==i.appEnv()&&p(o),n("#signup-modal")[0].addEventListener("touchmove",v,!1),n("#signup-modal-mask")[0].addEventListener("touchmove",v,!1),n("#signup-modal-mask").on("click",function(){n("#signup-modal-mask")[0].removeEventListener("touchmove",v),l(),o&&o.cancel&&o.cancel()}),n("#signup-modal #get-code-btn").on("click",e),n("#signup-modal #signup-btn").on("click",t),o.onlySignUp||n("#signup-modal #login").on("click",function(){l(),a(o)})}}function l(){n("#signup-modal, #signup-modal-mask").remove(),n("#country").remove()}function s(i){var o='<span class="palfish-toast"><span class="palfish-toast-wrapper">'+i+"</span></span>";n("body").append(o),setTimeout(function(){n(".palfish-toast").addClass("toast-animation"),setTimeout(function(){n(".palfish-toast").remove()},2e3)},200)}function d(i){var o='<div id="palfish-alert" class="palfish-alert"><div id="palfish-alert-close" class="palfish-close"></div><div class="text">'+i+'</div></div><div id="palfish-alert-mask" class="palfish-mask"></div>';n("body").append(o),n("#palfish-alert-close, #palfish-alert-mask").on("click",c)}function c(){n("#palfish-alert,#palfish-alert-mask").remove()}function r(n){return d(n.msg)}function u(i){function o(){var o="";n.getJSON("/klian/web/dist/common/resources/country2.json",function(a){for(var t=0;t<a.length;t++)o+='<li id="'+a[t].area+'">'+(i===!0?a[t].english:a[t].chinese)+"</li>";n("#country .countrylist").append("<ul>"+o+"</ul>"),n("#country").show()})}if(0==n("#country").length){var a='<div id="country"><div id="closelist"><span id="close-country-area">×</span>'+(i===!0?"Please choose your country code":"选择国家区号")+'</div><div class="countrylist"></div>';n("body").append(a)}n("#closelist").on("click",function(){n("#country .countrylist ul").remove(),n("#country").hide()}),n("#area").on("click",function(){o(),n("#country .countrylist").on("click","li",function(){var i=n(this);n("#area").html("+<span>"+i.attr("id")+"</span>"),n("#country .countrylist ul").remove(),n("#country").hide()})})}function p(o){n("#wechat-login-btn").on("click",function(){i.account.wechatLogin(o)})}function v(n){n.preventDefault()}var g={showLoginModal:a,hideLoginModal:t,mandatoryLogin:o,showSignUpModal:e,alert:d,hideAlert:c,failureAlert:r,handleCountryArea:u,toast:s};return g}($,P);